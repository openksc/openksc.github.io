<!doctype html><html lang=en-US><head><meta charset=utf-8><title>Kubernetes Multi-cluster Deployment: Kubernetes Cluster Federation and KubeSphere</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="KubeSphere v3.0 supports the management of multiple clusters, isolated management of resources, and federated deployments."><meta name=keywords content="Kubernetes,KubeSphere,Multi-cluster,Container"><meta property="og:type" content="article"><meta property="og:title" content="Kubernetes Multi-cluster Deployment: Kubernetes Cluster Federation and KubeSphere"><meta property="og:description" content="KubeSphere v3.0 supports the management of multiple clusters, isolated management of resources, and federated deployments."><meta property="og:image" content="https://ap3.qingstor.com/kubesphere-website/docs/kubesphere-architecture.png"><meta property="og:url" content="https://openksc.github.io/blogs/multi-cluster-deployment/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeSphere"><meta property="twitter:image" content="https://ap3.qingstor.com/kubesphere-website/docs/kubesphere-architecture.png"><meta name=docsearch:language content="en-US"><meta name=docsearch:version content><link rel=canonical href=https://kubesphere.io/blogs/multi-cluster-deployment/><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=apple-touch-icon href=/images/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/svg+xml href=/images/favicons/favicon.svg><link rel=icon type=image/png href=/images/favicons/favicon.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg color=#00ad6e><meta name=msapplication-config content='/images/favicons/browserconfig.xml'><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/fonts/Roboto/stylesheet.css><link rel=stylesheet href=/fonts/ProximaNova/stylesheet.css><link rel=stylesheet href=/css/jquery.modal.min.css><link rel=stylesheet href=/css/viewer.min.css><link rel=stylesheet href=/swiper/swiper-bundle.min.css><link rel=stylesheet href=/scss/common.min.0c3fdcc05ec210321169846714f74b11c4a1baf09a1833fa9273b2347c81e636.css><script src=/js/jquery-3.7.1.min.js></script><script src=/js/viewer.min.js></script><script src=/js/jquery.modal.min.js></script><script src=/swiper/swiper-bundle.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0888981f1fa45d241b1fb6962da2963e",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YYCVN36HT5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YYCVN36HT5")</script><script type=text/javascript>!function(e,t,n,s,o){e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=("https:"==document.location.protocol?"https://":"http://")+s,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio"),gio("init","8a24ae300cbf8b8c",{}),gio("send")</script><script type=text/javascript>_linkedin_partner_id="3131724",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id)</script><script type=text/javascript>(function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)})()</script><noscript>&lt; img height="1" width="1" style="display:none;" alt="" src="https://px.ads.linkedin.com/collect/?pid=3131724&fmt=gif" /></noscript><script>!function(e,t,n,s,o,i){e.twq||(s=e.twq=function(){s.exe?s.exe.apply(s,arguments):s.queue.push(arguments)},s.version="1.1",s.queue=[],o=t.createElement(n),o.async=!0,o.src="//static.ads-twitter.com/uwt.js",i=t.getElementsByTagName(n)[0],i.parentNode.insertBefore(o,i))}(window,document,"script"),twq("init","o65xa"),twq("track","PageView")</script><link rel=stylesheet href=/scss/content.min.f73b326fbf8c5bd331900b0de21c7dde608a4926f482f6465f9ae1d9049b83ad.css><link rel=stylesheet href=/scss/markdown.min.db47186481122431dffae72d17dbbd51f90b66f022cc163458645709924e4eac.css></head><body><header class=navigation><div class=join-div><div class=content>ðŸš€ KubeSphere v4.1.3 with Enhancements and Bug Fixes is available now. <a href=/docs/v4.1/20-release-notes/release-v413/ target=_blank rel="noopener noreferrer">Read the release notes â†’</a>
<img id=close-join src=/images/header/close.svg alt=close></div></div><div class=common-layout><div class=header-container><a href=/ aria-label=logo><img src=/images/header/logo.svg alt class=logo></a><ul class=nav><li class=menu-li><span class=menu-span>Scenarios</span><ul class="dropdown-menu menu-2"><li><a href=/devops/>Embracing One-stop DevOps Workflow</a></li><li><a href=/service-mesh/>Running Microservices on Kubernetes</a></li><li><a href=/observability/>Building Cloud Native Observability</a></li></ul></li><li class=menu-li><span class=menu-span>Resources</span><ul class="dropdown-menu menu-3"><li><a href=/projects/>Open Source Projects</a></li><li><a href=/conferences/>KubeCon & QCon</a></li><li><a href=/blogs/>Technology Blogs</a></li><li><a href=/videos/>Video Resources</a></li></ul></li><li class=menu-li><span class=menu-span>Documentation</span><ul class="dropdown-menu menu-4"><li><a href=/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/docs/v3.4>v3.4</a></li><li><a href=/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/en/%20 target=_blank rel="noopener noreferrer">Extension Development</a></li><li><a href=https://kube.design/ target=_blank rel="noopener noreferrer">Kube Design</a></li></ul></li><li class=menu-li><span class=menu-span>Community</span><ul class="dropdown-menu menu-5"><li><a href=/contribution/>Contribution</a></li><li><a href=/case/>Case Studies</a></li><li><a href=/partner/>Partner</a></li><li><a href=/news/>News</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">RoadMap</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025 target=_blank rel="noopener noreferrer">OSPP 2025</a></li></ul></li></ul><div class=right-menu><ul><li class=language-menu><div><img src=/images/header/black.svg alt>
<span>English</span></div><ul class=dropdown-menu><li onclick='handleLangClick("en","/blogs/multi-cluster-deployment/")'>English</li></ul></li><li class=github-li><div class=github-star><a class=star-btn href=https://github.com/kubesphere/kubesphere rel="noopener noreferrer" target=_blank><span class=star-img></span>&nbsp;<span>Star</span>
</a><a class=social-count href=https://github.com/kubesphere/kubesphere/stargazers rel="noopener noreferrer" target=_blank></a></div></li><li class=menu-icon><img src=/images/header/menu.svg alt></li></ul></div></div></div><div id=modal-for-menu class=modal><ul class=nav><li data-check=0 class=menu-li><span class=menu-span>Scenarios</span><ul class=dropdown-menu><li><a href=/devops/>Embracing One-stop DevOps Workflow</a></li><li><a href=/service-mesh/>Running Microservices on Kubernetes</a></li><li><a href=/observability/>Building Cloud Native Observability</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>Resources</span><ul class=dropdown-menu><li><a href=/projects/>Open Source Projects</a></li><li><a href=/conferences/>KubeCon & QCon</a></li><li><a href=/blogs/>Technology Blogs</a></li><li><a href=/videos/>Video Resources</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>Documentation</span><ul class=dropdown-menu><li><a href=/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/docs/v3.4>v3.4</a></li><li><a href=/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/en/%20>Extension Development</a></li><li><a href=https://kube.design/>Kube Design</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>Community</span><ul class=dropdown-menu><li><a href=/contribution/>Contribution</a></li><li><a href=/case/>Case Studies</a></li><li><a href=/partner/>Partner</a></li><li><a href=/news/>News</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md>RoadMap</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025>OSPP 2025</a></li></ul></li></ul><div class=link-div><a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank rel="noopener noreferrer" aria-label=slack><img src=/images/header/slack-hover.svg alt>
</a><a href=https://x.com/KubeSphere target=_blank rel="noopener noreferrer" aria-label=twitter><img src=/images/header/twitter-hover.svg alt>
</a><a href=https://github.com/kubesphere/kubesphere target=_blank rel="noopener noreferrer" aria-label=github><img src=/images/header/github-hover.svg alt></a></div></div></header><script>var bindNavMouseEvent,bindScrollChangeHeader,bindClickShowMenu,bindClickModalLi,bindClickClose,language,handleLangClick,githubApiLink="https://api.github.com/repos/kubesphere/kubesphere",getStar=function(){$(".social-count").hide(),$.getJSON(githubApiLink,function(e){$(".social-count").show().html(e.stargazers_count)})};getStar(),bindNavMouseEvent=function(e,t){t||(t=$(e));var n=!1;t.mouseenter(function(){if(n)return!1;n=!0,$(this).find(".dropdown-menu").fadeIn(200,function(){n=!1})}),t.mouseleave(function(){$(this).find(".dropdown-menu").fadeOut(200)})},bindScrollChangeHeader=function(){var t=100,e=$("header");window.addEventListener("scroll",function(){var t=window.scrollY;t>0?e.addClass("navigationScroll"):e.removeClass("navigationScroll")})},bindClickShowMenu=function(){$(".menu-icon").click(function(){$("#modal-for-menu").modal()})},bindClickModalLi=function(){$(".modal .menu-li").click(function(){var e=$(this).data("check");e===0?($(this).data("check",1),$(this).find(".dropdown-menu").slideDown(200)):($(this).data("check",0),$(this).find(".dropdown-menu").slideUp(200)),$(this).find(".menu-span").toggleClass("up")})},bindClickClose=function(){$("#close-join").click(function(){$(".navigation .join-div").hide(),$(".main-section").removeClass("padding")})},language="en",bindClickClose(),bindScrollChangeHeader(),$(".header-container .menu-li").each(function(){bindNavMouseEvent("",$(this))}),bindNavMouseEvent(".header-container .language-menu"),bindNavMouseEvent(".header-container .btn-li"),bindClickShowMenu(),bindClickModalLi(),handleLangClick=function(e,t){try{localStorage.setItem("lang",e)}catch{}location.href=t}</script><section class=main-section><div class=common-layout><div class=breadcrumb><span><a href=/blogs/>Technology Blogs</a> > </span><span>Kubernetes Multi-cluster Deployment: Kubernetes Cluster Federation and KubeSphere</span></div><div class='main-div middle-div'><div class=author>Jeff, Feynman, Sherlock</div><span class=date>Published onï¼š2020-07-20</span>&nbsp;&nbsp;&nbsp;
<span style=font-size:14px;color:#919aa3 id=busuanzi_container_page_pv>The number of views: <span id=busuanzi_value_page_pv></span></span><h1>Kubernetes Multi-cluster Deployment: Kubernetes Cluster Federation and KubeSphere</h1><div class=share-1><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fblogs%2fmulti-cluster-deployment%2f&text=Kubernetes%20Multi-cluster%20Deployment%3a%20Kubernetes%20Cluster%20Federation%20and%20KubeSphere" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fblogs%2fmulti-cluster-deployment%2f&title=Kubernetes%20Multi-cluster%20Deployment%3a%20Kubernetes%20Cluster%20Federation%20and%20KubeSphere" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fblogs%2fmulti-cluster-deployment%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fblogs%2fmulti-cluster-deployment%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fblogs%2fmulti-cluster-deployment%2f&t=Kubernetes%20Multi-cluster%20Deployment%3a%20Kubernetes%20Cluster%20Federation%20and%20KubeSphere" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div><div class=content><div class=md-body><h2 id=scenarios-for-multi-cluster-deployment>Scenarios for Multi-cluster Deployment</h2><p>As the container technology and Kubernetes see a surge in popularity among their users, it is not uncommon for enterprises to run multiple clusters for their business. In general, here are the main scenarios where multiple Kubernetes clusters can be adopted.</p><h3 id=high-availability>High Availability</h3><p>You can deploy workloads on multiple clusters by using a global VIP or DNS to send requests to corresponding backend clusters. When a cluster malfunctions or fails to handle requests, the VIP or DNS records can be transferred to a health cluster.</p><p><img src=https://ap3.qingstor.com/kubesphere-website/docs/ha.png alt=high-availability></p><h3 id=low-latency>Low Latency</h3><p>When clusters are deployed in various regions, user requests can be forwarded to the nearest cluster, greatly reducing network latency. For example, we have three Kubernetes clusters deployed in New York, Houston and Los Angeles respectively. For users in California, their requests can be forwarded to Los Angeles. This will reduce the network latency due to geographical distance, providing the most consistent user experience possible for users in different areas.</p><h3 id=failure-isolation>Failure Isolation</h3><p>Generally, it is much easier for multiple small clusters to isolate failures than a large cluster. In case of outages, network failures, insufficient resources or other possible resulting issues, the failure can be isolated within a certain cluster without spreading to others.</p><h3 id=business-isolation>Business Isolation</h3><p>Although Kubernetes provides namespaces as a solution to app isolation, this method only represents the isolation in logic. This is because different namespaces are connected through the network, which means the issue of resource preemption still exists. To achieve further isolation, you need to create additional network isolation policies or set resource quotas. Using multiple Kubernetes clusters can achieve complete physical isolation that is more secure and reliable than the isolation through namespaces. For example, this is extremely effective when different departments within an enterprise use multiple clusters for the deployment of development, testing or production environments.</p><p><img src=https://ap3.qingstor.com/kubesphere-website/docs/pipeline.png alt=pipeline></p><h3 id=avoid-vendor-lock-in>Avoid Vendor Lock-in</h3><p>Kubernetes has become the de facto standard in container orchestration. Against this backdrop, many enterprises avoid putting all eggs in one basket as they deploy clusters by using services of different cloud providers. That means they can transfer and scale their business anytime between clusters. However, it is not that easy for them to transfer their business in terms of costs, as different cloud providers feature varied Kubernetes services, including storage and network interface.</p><h2 id=multi-cluster-deployment>Multi-cluster Deployment</h2><p>The application of multi-cluster deployment offers solutions to a variety of problems as we can see from the scenarios above. Nevertheless, it brings more complexity for operation and maintenance. For a single cluster, app deployment and upgrade are quite straightforward as you can directly update yaml of the cluster. For multiple clusters, you can update them one by one, but how can you guarantee the application load status is the same across different clusters? How to implement service discovery among different clusters? How to achieve load balancing across clusters? The answer given by the community is Kubernetes Cluster Federation.</p><h3 id=kubernetes-federation-v1>Kubernetes Federation v1</h3><p><img src=https://ap3.qingstor.com/kubesphere-website/docs/federation-v1.png alt=federation-v1></p><p>There are two versions of Kubernetes Federation with the original v1 already deprecated. In v1, the general architecture is very similar to that of Kubernetes. As shown above, Federation API Server is used for the management of different clusters. It receives the request to create the deployment of multiple clusters as Federation Controller Manager deploys workloads on each cluster.</p><p><img src=https://ap3.qingstor.com/kubesphere-website/docs/annotations.png alt=annotations></p><p>In terms of API, federated resources are scheduled through annotations, ensuring great compatibility with the original Kubernetes API. As such, the original code can be reused and existing deployment files of users can be easily transferred without any major change. However, this also prevents users from taking further advantage of Federation for API evolution. At the same time, a corresponding controller is needed for each federated resource so that they can be scheduled to different clusters. Originally, Kubernetes Cluster Federation only supported a limited number of resource type.</p><h3 id=kubernetes-federation-v2>Kubernetes Federation v2</h3><p><img src=https://ap3.qingstor.com/kubesphere-website/docs/federation-v2.png alt=federation-v2></p><p>The community developed Kubernetes Federation v2 (KubeFed) on the basis of v1. KubeFed has defined its own API standards through CRDs while deprecating the annotation method used before. The architecture has changed significantly as well, discarding Federated API Server and etcd that need to be deployed independently. The control plane of KubeFed adopts the popular implementation of CRD + Controller, which can be directly installed on existing Kubernetes clusters without any additional deployment.</p><p>KubeFed mainly defines four resource types:</p><ul><li><p><strong>Cluster Configuration</strong> defines the register information needed for the control plane to add member clusters, including cluster name, APIServer address and the credential to create deployments.</p></li><li><p><strong>Type Configuration</strong> defines the resource type that KubeFed should handle. Each Type Configuration is a CRD object that contains three configuration items:</p><ul><li><strong>Template.</strong> Templates define the representation of a common resource to be handled. If the object does not have a corresponding definition on the cluster where it will be deployed, the deployment will fail. In the following example of FederatedDeployment, the template contains all the information needed to create the deployment.</li><li><strong>Placement</strong>. Placements define the name of the cluster that a resource object will appear in, with two methods available (<code>clusters</code> and <code>clusterSelector</code>).</li><li><strong>Override</strong>. Overrides define per-cluster, field-level variation that apply to the template, allowing you to customize configurations. In the example below, the number of replicas defined in <code>template</code> is 1, while <code>overrides</code> shows the replica number of cluster gondor will be 4 when it is deployed instead of 1 in <code>template</code>. A subset of the syntax of <a href=https://jsonpatch.com/ target=_blank rel="noopener noreferrer">Jsonpatch</a> is achieved in <code>overrides</code>, which means, theoretically, all the content in <code>template</code> can be overridden.</li></ul><p><img src=https://ap3.qingstor.com/kubesphere-website/docs/example.png alt=FederatedDeployment></p></li><li><p><strong>Schedule</strong> defines how apps are deployed across clusters, mainly related to ReplicaSets and Deployments. The maximum and minimum number of replicas of the load on a cluster can be defined through Schedule, which is similar to the annotation method in v1.</p></li><li><p><strong>MultiClusterDNS</strong> makes it possible for service discovery across clusters. Service discovery across multiple clusters is much more complicated than in a single cluster. ServiceDNSRecord, IngressDNSRecord and DNSEndpoint objects are used in KubeFed to implement service discovery across multiple clusters (DNS needed as well).</p></li></ul><p>In general, KubeFed has provided solutions to many problems in v1. With CRDs, federated resources can be scaled to a large extent. Basically, all Kubernetes resources can be deployed across multiple clusters, including the CRD resources defined by users themselves.</p><p>However, KubeFed also has some issues to be resolved:</p><ul><li><strong>Single point of failure</strong>. The control plane of KubeFed is achieved through CRD + Controller. High availability can be implemented for the controller itself, but the whole control plane will malfunction if Kubernetes it runs on fails. This was also <a href=https://github.com/kubernetes-sigs/kubefed/issues/636 target=_blank rel="noopener noreferrer">discussed in the community</a> before. Currently, KubeFed uses the push/reconcile method. When federated resources are created, the controller of the control plane will send the resource object to clusters accordingly. After that, the control plane is not responsible for how the member cluster handles resources. Therefore, existing application workloads will not be affected when KubeFed control plane fails.</li><li><strong>Maturity</strong>. The KubeFed community is not as active as the Kubernetes community. Its iteration cycle is too slow and many features are still in the beta stage.</li><li><strong>Abstraction</strong>. KubeFed defines resources to be managed through Type Configurations. Different Type Configurations only vary in their templates. The advantage is that the logic can be unified so that they can be quickly achieved. In KubeFed, the corresponding Controllers of Type Configuration resources are all created through <a href=https://github.com/kubernetes-sigs/kubefed/blob/master/pkg/controller/federatedtypeconfig/controller.go target=_blank rel="noopener noreferrer">templates</a>. That said, the shortcoming is quite obvious as customized features are not supported for special Types. For instance, for a FederatedDeployment object, KubeFed only needs to create a deployment object accordingly based on template and override, which will be deployed on the cluster specified in placement. As for whether the corresponding Pod is created based on the deployment and how the Pod runs, you can only check the information in the related cluster. The community has realized this issue and is working on it. A <a href=https://github.com/kubernetes-sigs/kubefed/pull/1237 target=_blank rel="noopener noreferrer">proposal</a> has already been raised.</li></ul><h2 id=multi-cluster-feature-in-kubesphere>Multi-cluster Feature in KubeSphere</h2><p>Resource federation is what the community has proposed to solve the issue of deployments across multiple Kubernetes clusters. For many enterprise users, the deployment of multiple clusters is not necessary. What is more important is that they need to be able to manage the resources across multiple clusters at the same time and in the same place.</p><p><a href=https://github.com/kubesphere target=_blank rel="noopener noreferrer">KubeSphere</a> supports the management of multiple Kubernetes clusters, isolated management of resources, and federated deployments. In addition, it also features multi-dimensional queries (monitoring, logging, events and auditing) of resources such as clusters and apps, as well as alerts and notifications through various channels. Apps can be deployed on multiple clusters with CI/CD pipelines.</p><p><img src=https://ap3.qingstor.com/kubesphere-website/docs/workflow.png alt=kubesphere-workflow></p><p>KubeSphere 3.0 supports unified management of user access for the multi-cluster feature based on KubeFed, RBAC and Open Policy Agent. With the multi-tenant architecture, it is very convenient for business departments, development teams and Ops teams to manage resources isolatedly in a unified console according to their needs.</p><p><img src=https://ap3.qingstor.com/kubesphere-website/docs/business.png alt=business></p><h3 id=architecture>Architecture</h3><p><img src=https://ap3.qingstor.com/kubesphere-website/docs/kubesphere-architecture.png alt=kubesphere-architecture></p><p>The overall multi-cluster architecture of KubeSphere <a href=https://kubesphere.io/ target=_blank rel="noopener noreferrer">Container Platform</a> is shown above. The cluster where the control plane is located is called Host cluster. The cluster managed by the Host cluster is called Member cluster, which is essentially a Kubernetes cluster with KubeSphere installed. The Host cluster needs to be able to access the kube-apiserver of Member clusters. Besides, there is no requirement for the network connectivity between Member clusters. The Host cluster is independent of the member clusters managed by it, which do not know the existence of the Host cluster. The advantage of the logic is that when the Host cluster malfunctions, Member clusters will not be affected and deployed workloads can continue to run as well.</p><p>In addition, the Host cluster also serves as an entry for API requests. It will forward all resource requests for member clusters to them. In this way, not only can requests be aggregated, but also authentication and authorization can be implemented in a unified fashion.</p><h3 id=authorization-and-authentication>Authorization and Authentication</h3><p>It can be seen from the architecture that the Host cluster is responsible for the synchronization of identity and access information of clusters, which is achieved by federated resources of KubeFed. When FederatedUser, FederatedRole, or FederatedRoleBinding is created on the Host cluster, KubeFed will push User, Role, or Rolebinding to Member clusters. Any access change will only be applied to the Host cluster, which will then be synchronized to Member clusters. This is to ensure the integrity of each Member cluster. In this regard, the identity and access data stored in Member clusters enable them to implement authentication and authorization independently without any reliance on the Host cluster. In the multi-cluster architecture of KubeSphere, the Host cluster acts as a resource coordinator instead of a dictator, since it delegates power to Member clusters as much as possible.</p><h3 id=cluster-connectivity>Cluster Connectivity</h3><p>The multi-cluster feature of KubeSphere only entails the access of the Host cluster to the Kubernetes APIServer of Member clusters. There is no requirement for network connectivity at the cluster level. KubeSphere provides two methods for the connection of Host and Member clusters:</p><ul><li><p><strong>Direct connection</strong>. If the kube-apiserver address of Member clusters is accessible on any node of the Host cluster, you can adopt this method. Member clusters only need to provide the cluster kubeconfig. This method applies to most public cloud Kubernetes services or the scenario where the Host cluster and Member clusters are in the same network.</p></li><li><p><strong>Agent connection</strong>. In case Member clusters are in a private network with the kube-apiserver address unable to be exposed, KubeSphere provides <a href=https://github.com/kubesphere/tower target=_blank rel="noopener noreferrer">Tower</a> for agent connection. Specifically, the Host cluster will run a proxy service. When a new cluster joins, the Host cluster will generate all credential information. Besides, the agent running on Member clusters will connect to the proxy service running on the Host cluster. A reverse proxy will be created after the handshake succeeds. As the kube-apiserver address of Member clusters will change in agent connection, the Host cluster needs to create a new kubeconfig for Member clusters. This is very convenient as the underlying details can be hidden. In either direct connection or agent connection, the control plane is provided with a kubeconfig that can be used directly.</p><p><img src=https://ap3.qingstor.com/kubesphere-website/docs/cluster-tunnel.jpg alt=cluster-tunnel></p></li></ul><h3 id=api-forwarding>API Forwarding</h3><p>In the multi-cluster architecture of KubeSphere, the Host cluster serves as a cluster entry. All API requests are directly sent to the Host cluster first, which will decide where these requests go next. To provide the best compatibility possible with the original API in the multi-cluster environment, the API request whose path begins with <code>/apis/clusters/{cluster}</code> will be forwarded to the cluster <code>{cluster}</code>, with <code>/clusters/{cluster}</code> removed. The advantage is that there is no difference between the request the cluster receives this way with other requests, with no additional configuration or operation needed.</p><p><img src=https://ap3.qingstor.com/kubesphere-website/docs/api-forwarding.png alt=api-forwarding></p><p>For example:</p><p><img src=https://ap3.qingstor.com/kubesphere-website/docs/api-fowarding1.png alt=api-fowarding1></p><p>The request above will be forwarded to a cluster named rohan and be handled as:</p><p><img src=https://ap3.qingstor.com/kubesphere-website/docs/api-forwarding2.png alt=api-forwarding2></p><h2 id=summary>Summary</h2><p>The topic of multi-cluster deployment is far more complicated than we think. The fact that the Federation solution provided by the community has not been officially released after two versions is a typical example. As we often put it, there is no Silver Bullet in software engineering. It is impossible for multi-cluster tools such as KubeFed and KubeSphere to solve all the issues. We need to find the solution that best suits us based on the specific business scenario. It is believed that these tools will become more mature over time, which can be applied in more scenarios.</p><h2 id=references>References</h2><ol><li>KubeFed: <a href=https://github.com/kubernetes-sigs/kubefed target=_blank rel="noopener noreferrer">https://github.com/kubernetes-sigs/kubefed</a></li><li>KubeSphere Website: <a href=https://kubesphere.io/ target=_blank rel="noopener noreferrer">https://kubesphere.io/</a></li><li>Kubernetes Federation Evolution: <a href=https://kubernetes.io/blog/2018/12/12/kubernetes-federation-evolution/ target=_blank rel="noopener noreferrer">https://kubernetes.io/blog/2018/12/12/kubernetes-federation-evolution/</a></li><li>KubeSphere GitHub: <a href=https://github.com/kubesphere target=_blank rel="noopener noreferrer">https://github.com/kubesphere</a></li></ol></div></div><div class=share-2><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fblogs%2fmulti-cluster-deployment%2f&text=Kubernetes%20Multi-cluster%20Deployment%3a%20Kubernetes%20Cluster%20Federation%20and%20KubeSphere" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fblogs%2fmulti-cluster-deployment%2f&title=Kubernetes%20Multi-cluster%20Deployment%3a%20Kubernetes%20Cluster%20Federation%20and%20KubeSphere" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fblogs%2fmulti-cluster-deployment%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fblogs%2fmulti-cluster-deployment%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fblogs%2fmulti-cluster-deployment%2f&t=Kubernetes%20Multi-cluster%20Deployment%3a%20Kubernetes%20Cluster%20Federation%20and%20KubeSphere" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div></div><div class=aside><div class=inner-div><div class=title>Table of Contents</div><div class=tabs><nav id=TableOfContents><ul><li><a href=#scenarios-for-multi-cluster-deployment>Scenarios for Multi-cluster Deployment</a><ul><li><a href=#high-availability>High Availability</a></li><li><a href=#low-latency>Low Latency</a></li><li><a href=#failure-isolation>Failure Isolation</a></li><li><a href=#business-isolation>Business Isolation</a></li><li><a href=#avoid-vendor-lock-in>Avoid Vendor Lock-in</a></li></ul></li><li><a href=#multi-cluster-deployment>Multi-cluster Deployment</a><ul><li><a href=#kubernetes-federation-v1>Kubernetes Federation v1</a></li><li><a href=#kubernetes-federation-v2>Kubernetes Federation v2</a></li></ul></li><li><a href=#multi-cluster-feature-in-kubesphere>Multi-cluster Feature in KubeSphere</a><ul><li><a href=#architecture>Architecture</a></li><li><a href=#authorization-and-authentication>Authorization and Authentication</a></li><li><a href=#cluster-connectivity>Cluster Connectivity</a></li><li><a href=#api-forwarding>API Forwarding</a></li></ul></li><li><a href=#summary>Summary</a></li><li><a href=#references>References</a></li></ul></nav></div></div></div></div></section><div class=SubscribeForm><div class=innerBox><img class=close src=/images/home/close.svg alt=close><p class=description>Receive the latest news, articles and updates from KubeSphere</p><div id=blog_formAddress data-usesendcloud=false><form action="https://kubesphere.us10.list-manage.com/subscribe/post?u=c85ea2b944b08b951f607bdd4&amp;id=83f673a2d9" method=post target=_blank novalidate><input name=EMAIL id=email-input-blog type=text placeholder='Please enter your email address'>
<button type=submit id=email-submit-blog>Subscribe</button></form><span id=message_blog data-message1='email is required!' data-message2='Please enter a valid email address!'></span></div></div></div><footer><div class=footer><div class="footer-main common-layout"><div class=up-main><div class=left-div><img src=/images/logo.svg alt class=foot-logo><p>Receive the latest news, articles and updates from KubeSphere</p><div id=formAddress data-usesendcloud=false><form action="https://kubesphere.us10.list-manage.com/subscribe/post?u=c85ea2b944b08b951f607bdd4&amp;id=83f673a2d9" method=post target=_blank novalidate><input name=EMAIL id=email-input type=text placeholder='Please enter your email address'>
<button type=submit id=email-submit>Subscribe</button></form></div><span id=message data-message1='email is required!' data-message2='Please enter a valid email address!'></span>
<script>var bindSubmit=function(){var e=$("#email-input");$("#email-submit").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message").data("message1"),a=$("#message").data("message2"),r=$("#message").data("message3"),c=$("#message1").data("success");if(n)if(validateEmail(n)){if(s=$("#formAddress").data("usesendcloud"),!s)return;o=$("#formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:$("#email-input").val().toString()},success:function(){showSuccessMessage(c),setTimeout(function(){$("#email-input").val("")},1e3)},error:function(){showMessage(r)}})}else t.preventDefault(),showMessage(a);else t.preventDefault(),showMessage(i)})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},showMessage=function(e){$("#message").html(e).show()},showSuccessMessage=function(e){$("#message1").html(e).show()},bindHideMessage=function(){$(window).click(function(){$("#message").hide(),$("#message1").hide()})},bindClose=function(){$(".formBox .close").click(function(e){e.stopPropagation(),$(".formBox").fadeOut()})};bindSubmit(),bindClose(),bindHideMessage()</script><span id=message data-message1='email is required!' data-message2='Please enter a valid email address!'></span></div><div class=right-div><ul class=common-flex-layout><li class=nowrap-li><div class=h3>Scenarios</div><a href=/devops/>Kubernetes DevOps and GitOps</a>
<a href=/service-mesh/>Microservices with Service Mesh</a>
<a href=/observability/>Cloud Native Observability</a>
<a href=https://github.com/OpenFunction/OpenFunction target=_blank rel="noopener noreferrer">Functions-as-a-Service Platform and Serverless</a>
<a href=https://github.com/openpitrix/openpitrix target=_blank rel="noopener noreferrer">Multi-cloud Apps Mgmt</a></li><li class=nowrap-li><div class=h3>Resources</div><a href=/projects/>Projects</a>
<a href=/blogs/>Blogs</a>
<a href=/conferences/>KubeCon & QCon</a>
<a href=/videos/>Videos</a></li><li class=nowrap-li><div class=h3>KubeSphere Docs</div><a href=/docs/v4.1/01-intro/01-introduction/>Introduction</a>
<a href=/docs/v4.1/03-installation-and-upgrade/02-install-kubesphere/02-install-kubernetes-and-kubesphere/>Installation</a>
<a href=/docs/v4.1/02-quickstart/>Tutorial</a>
<a href=/docs/v3.4/reference/api-docs/>API Documentation</a></li><li class=nowrap-li><div class=h3>Community</div><a href=/contribution/>Contribution</a>
<a href=/case/>Case Studies</a>
<a href=/partner/>Partners</a>
<a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">Roadmap</a>
<a href=https://kubesphere.io target=_blank rel="noopener noreferrer">Global Site</a>
<a href=https://kubesphere.com.cn/ target=_blank rel="noopener noreferrer">China Site</a></li><li class=nowrap-li><div class=h3>Products and Services</div><a href=https://aws.amazon.com/quickstart/architecture/qingcloud-kubesphere/ target=_blank rel="noopener noreferrer">KubeSphere on AWS</a>
<a href=https://market.azure.cn/marketplace/apps/qingcloud.kubesphere target=_blank rel="noopener noreferrer">KubeSphere on Azure</a>
<a href=https://marketplace.digitalocean.com/apps/kubesphere target=_blank rel="noopener noreferrer">KubeSphere on DigitalOcean</a>
<a href=https://www.qingcloud.com/products/kubesphereqke target=_blank rel="noopener noreferrer">KubeSphere on QingCloud(QKE)</a>
<a href=https://kubesphere.co/kse/ target=_blank rel="noopener noreferrer">KubeSphere Enterprise</a>
<a href=https://kubesphere.co/marketplace/ target=_blank rel="noopener noreferrer">KubeSphere Extensions Marketplace</a>
<a href=https://kubesphere.co/ksv/ target=_blank rel="noopener noreferrer">KubeSphere Virtualization Platform</a>
<a href=https://kubesphere.cloud target=_blank rel="noopener noreferrer">Cloud Native Services and Support</a>
<a href=https://jinshuju.net/f/bDS8me target=_blank rel="noopener noreferrer">Contact Us</a></li></ul></div></div><div class=down-main><div class=img-div><a class=wechat href=javascript:void(0); aria-label=wechat><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28"><defs><path id="a" d="M0 0h15.673v12.156H0z"/></defs><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="13" cy="13" r="13" stroke="#B6C2CD"/><g transform="translate(5 7)"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59.0-4.625 1.679-4.625 3.74.0 2.066 2.035 3.738 4.625 3.738.542.0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27.0-.541-.257-.541-.514.0-.256.27-.514.541-.514.41.0.681.258.681.514.0.257-.271.514-.681.514zm2.994.0c-.27.0-.541-.257-.541-.514.0-.256.27-.514.54-.514.41.0.681.258.681.514.0.257-.277.514-.68.514z" mask="url(#b)"/><path fill="currentColor" d="M10.602 3.674c.177.0.356.011.533.029C10.657 1.576 8.27.0 5.543.0 2.498.0.0 1.974.0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17.0.343-.005.515-.022a3.68 3.68.0 01-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417.0.693.263.693.66s-.276.66-.693.66c-.418.0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417.0-.834-.263-.834-.66s.417-.66.834-.66c.418.0.695.263.695.66.0.392-.277.66-.695.66z" mask="url(#b)"/></g></g></svg><div class=hide-div><img src=/images/home/wechat.svg alt></div></a><a class=facebook-a href=https://www.facebook.com/kubesphere target=_blank aria-label=facebook></a><a class=twitter-a href=https://x.com/KubeSphere target=_blank aria-label=twitter rel="noopener noreferrer"></a><a class=linkedin-a href=https://www.linkedin.com/company/kubesphere/ target=_blank aria-label=linkedin rel="noopener noreferrer"></a><a class=youtube-a href=https://www.youtube.com/c/KubeSphere target=_blank aria-label=youtube rel="noopener noreferrer"></a><a class=slack-a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank aria-label=slack rel="noopener noreferrer"></a><a class=github-a href=https://github.com/kubesphere/kubesphere target=_blank aria-label=github rel="noopener noreferrer"></a><a class=medium-a href=https://itnext.io/@kubesphere target=_blank aria-label=medium rel="noopener noreferrer"></a></div><p class=p1></p></div></div></div><div class=cookie><div class=common-layout><p>Your privacy is important to us. We use cookies to remember subscription details, optimize site functionality, and deliver content tailored to your interests. To find out more, see our <a href=/privacy>privacy policy</a>.</p><button>
Accept and continue</button></div></div></footer><script>var lazyLoad=function(e,t){for(var n,o,i,s=0;s<t;s++){if(n=e.eq(s),o=n.attr("data-loaded"),o)continue;n.offset().top<parseInt($(window).height())+parseInt($(window).scrollTop())&&(i=n.attr("src"),n.attr("src",i),n.attr("data-loaded",!0))}},bindLayLoad=function(){var e=$("img"),t=e.length;lazyLoad(e,t),$(window).scroll(function(){lazyLoad(e,t)})},bindAddPadding=function(){var e=$("#close-join");e.length>0&&$(".main-section").addClass("padding")},docCookies={getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t){return!!e&&!/^(?:expires|max-age|path|domain|secure)$/i.test(e)&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t),!0)}},bindHideCookie=function(){var t=docCookies.getItem("hasAuth"),e=$(".cookie");t?e.hide():e.show(),e.find("button").on("click",function(){docCookies.setItem("hasAuth","1"),e.hide()})};bindAddPadding(),bindHideCookie()</script><script type=text/javascript src=/js/aside.2d6977c0f16aef4ed3e886dd66675ce74bd0efcd467c2b2bcdb30b92d5e7c7c0e5c6e0c9d8f09a883c22f58df9e6b0b6347fcdd3c9a920b7faba6d7f91a201c3.js integrity="sha512-LWl3wPFq707T6IbdZmdc50vQ781GfCsrzbMLktXnx8DlxuDJ2PCaiDwi9Y355rC2NH/N08mpILf6um1/kaIBww=="></script><script type=text/javascript src=/js/markdown-tab.17f9f46b021adebc7250ce1b07134a577b307e7a436daa4aaf388f218e8463966f53770b26a64817c06c168738a887672d47fb4c29615adfc446e11d09a344cf.js integrity="sha512-F/n0awIa3rxyUM4bBxNKV3swfnpDbapKrziPIY6EY5ZvU3cLJqZIF8BsFoc4qIdnLUf7TClhWt/ERuEdCaNEzw=="></script><script>let forbidForm=!1;var viewer=new Viewer(document.querySelector(".md-body"),{url:"src"}),blogBindSubmit=function(){var e=$("#email-input-blog");$("#email-submit-blog").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message_blog").data("message1"),a=$("#message_blog").data("message2"),r=$("#message_blog").data("message3"),c=$("#message1_blog").data("success");if(n)if(validateEmail(n)){if(s=$("#blog_formAddress").data("usesendcloud"),!s)return;o=$("#blog_formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:n.toString()},success:function(){showSuccessMessage_blog(c),setTimeout(function(){window.onscroll="",$(".SubscribeForm").hide(),$("#email-input-blog").val("")},5e3)},error:function(){showMessage_blog(r)}})}else t.preventDefault(),$("#message_blog").html(a).show();else t.preventDefault(),$("#message_blog").html(i).show()})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},bindHideMessageBlog=function(){$(window).click(function(){$("#message_blog").hide()})},bindCloseBlog=function(){$(".SubscribeForm .close").click(function(e){e.stopPropagation(),$(".SubscribeForm").fadeOut(),window.onscroll=""})},showMessage_blog=function(e){$("#message_blog").html(e).show()},showSuccessMessage_blog=function(e){$("#message1_blog").html(e).show()};window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;forbidForm&&(window.onscroll=""),e+t>n-710?$(".SubscribeForm").hide():$(".SubscribeForm").show()},blogBindSubmit(),bindCloseBlog(),bindHideMessageBlog()</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>