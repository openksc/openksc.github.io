<!doctype html><html lang=en-US><head><meta charset=utf-8><title>Kubernetes Resource Requests and Limits Deep Dive</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Understand how Kubernetes requests and limits work and why they can work in the expected way."><meta name=keywords content="Kubernetes,requests,limits"><meta property="og:type" content="article"><meta property="og:title" content="Kubernetes Resource Requests and Limits Deep Dive"><meta property="og:description" content="Understand how Kubernetes requests and limits work and why they can work in the expected way."><meta property="og:image" content="https://openksc.github.io/images/blogs/en/understand-requests-and-limits-in-kubesphere/cover.png"><meta property="og:url" content="https://openksc.github.io/blogs/understand-requests-and-limits-in-kubernetes/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeSphere"><meta property="twitter:image" content="https://openksc.github.io/images/blogs/en/understand-requests-and-limits-in-kubesphere/cover.png"><meta name=docsearch:language content="en-US"><meta name=docsearch:version content><link rel=canonical href=https://kubesphere.io/blogs/understand-requests-and-limits-in-kubernetes/><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=apple-touch-icon href=/images/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/svg+xml href=/images/favicons/favicon.svg><link rel=icon type=image/png href=/images/favicons/favicon.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg color=#00ad6e><meta name=msapplication-config content='/images/favicons/browserconfig.xml'><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/fonts/Roboto/stylesheet.css><link rel=stylesheet href=/fonts/ProximaNova/stylesheet.css><link rel=stylesheet href=/css/jquery.modal.min.css><link rel=stylesheet href=/css/viewer.min.css><link rel=stylesheet href=/swiper/swiper-bundle.min.css><link rel=stylesheet href=/scss/common.min.0c3fdcc05ec210321169846714f74b11c4a1baf09a1833fa9273b2347c81e636.css><script src=/js/jquery-3.7.1.min.js></script><script src=/js/viewer.min.js></script><script src=/js/jquery.modal.min.js></script><script src=/swiper/swiper-bundle.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0888981f1fa45d241b1fb6962da2963e",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YYCVN36HT5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YYCVN36HT5")</script><script type=text/javascript>!function(e,t,n,s,o){e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=("https:"==document.location.protocol?"https://":"http://")+s,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio"),gio("init","8a24ae300cbf8b8c",{}),gio("send")</script><script type=text/javascript>_linkedin_partner_id="3131724",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id)</script><script type=text/javascript>(function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)})()</script><noscript>&lt; img height="1" width="1" style="display:none;" alt="" src="https://px.ads.linkedin.com/collect/?pid=3131724&fmt=gif" /></noscript><script>!function(e,t,n,s,o,i){e.twq||(s=e.twq=function(){s.exe?s.exe.apply(s,arguments):s.queue.push(arguments)},s.version="1.1",s.queue=[],o=t.createElement(n),o.async=!0,o.src="//static.ads-twitter.com/uwt.js",i=t.getElementsByTagName(n)[0],i.parentNode.insertBefore(o,i))}(window,document,"script"),twq("init","o65xa"),twq("track","PageView")</script><link rel=stylesheet href=/scss/content.min.f73b326fbf8c5bd331900b0de21c7dde608a4926f482f6465f9ae1d9049b83ad.css><link rel=stylesheet href=/scss/markdown.min.db47186481122431dffae72d17dbbd51f90b66f022cc163458645709924e4eac.css></head><body><header class=navigation><div class=join-div><div class=content>ðŸš€ KubeSphere v4.1.3 with Enhancements and Bug Fixes is available now. <a href=/docs/v4.1/20-release-notes/release-v413/ target=_blank rel="noopener noreferrer">Read the release notes â†’</a>
<img id=close-join src=/images/header/close.svg alt=close></div></div><div class=common-layout><div class=header-container><a href=/ aria-label=logo><img src=/images/header/logo.svg alt class=logo></a><ul class=nav><li class=menu-li><span class=menu-span>Scenarios</span><ul class="dropdown-menu menu-2"><li><a href=/devops/>Embracing One-stop DevOps Workflow</a></li><li><a href=/service-mesh/>Running Microservices on Kubernetes</a></li><li><a href=/observability/>Building Cloud Native Observability</a></li></ul></li><li class=menu-li><span class=menu-span>Resources</span><ul class="dropdown-menu menu-3"><li><a href=/projects/>Open Source Projects</a></li><li><a href=/conferences/>KubeCon & QCon</a></li><li><a href=/blogs/>Technology Blogs</a></li><li><a href=/videos/>Video Resources</a></li></ul></li><li class=menu-li><span class=menu-span>Documentation</span><ul class="dropdown-menu menu-4"><li><a href=/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/docs/v3.4>v3.4</a></li><li><a href=/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/en/%20 target=_blank rel="noopener noreferrer">Extension Development</a></li><li><a href=https://kube.design/ target=_blank rel="noopener noreferrer">Kube Design</a></li></ul></li><li class=menu-li><span class=menu-span>Community</span><ul class="dropdown-menu menu-5"><li><a href=/contribution/>Contribution</a></li><li><a href=/case/>Case Studies</a></li><li><a href=/partner/>Partner</a></li><li><a href=/news/>News</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">RoadMap</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025 target=_blank rel="noopener noreferrer">OSPP 2025</a></li></ul></li></ul><div class=right-menu><ul><li class=language-menu><div><img src=/images/header/black.svg alt>
<span>English</span></div><ul class=dropdown-menu><li onclick='handleLangClick("en","/blogs/understand-requests-and-limits-in-kubernetes/")'>English</li></ul></li><li class=github-li><div class=github-star><a class=star-btn href=https://github.com/kubesphere/kubesphere rel="noopener noreferrer" target=_blank><span class=star-img></span>&nbsp;<span>Star</span>
</a><a class=social-count href=https://github.com/kubesphere/kubesphere/stargazers rel="noopener noreferrer" target=_blank></a></div></li><li class=menu-icon><img src=/images/header/menu.svg alt></li></ul></div></div></div><div id=modal-for-menu class=modal><ul class=nav><li data-check=0 class=menu-li><span class=menu-span>Scenarios</span><ul class=dropdown-menu><li><a href=/devops/>Embracing One-stop DevOps Workflow</a></li><li><a href=/service-mesh/>Running Microservices on Kubernetes</a></li><li><a href=/observability/>Building Cloud Native Observability</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>Resources</span><ul class=dropdown-menu><li><a href=/projects/>Open Source Projects</a></li><li><a href=/conferences/>KubeCon & QCon</a></li><li><a href=/blogs/>Technology Blogs</a></li><li><a href=/videos/>Video Resources</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>Documentation</span><ul class=dropdown-menu><li><a href=/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/docs/v3.4>v3.4</a></li><li><a href=/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/en/%20>Extension Development</a></li><li><a href=https://kube.design/>Kube Design</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>Community</span><ul class=dropdown-menu><li><a href=/contribution/>Contribution</a></li><li><a href=/case/>Case Studies</a></li><li><a href=/partner/>Partner</a></li><li><a href=/news/>News</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md>RoadMap</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025>OSPP 2025</a></li></ul></li></ul><div class=link-div><a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank rel="noopener noreferrer" aria-label=slack><img src=/images/header/slack-hover.svg alt>
</a><a href=https://x.com/KubeSphere target=_blank rel="noopener noreferrer" aria-label=twitter><img src=/images/header/twitter-hover.svg alt>
</a><a href=https://github.com/kubesphere/kubesphere target=_blank rel="noopener noreferrer" aria-label=github><img src=/images/header/github-hover.svg alt></a></div></div></header><script>var bindNavMouseEvent,bindScrollChangeHeader,bindClickShowMenu,bindClickModalLi,bindClickClose,language,handleLangClick,githubApiLink="https://api.github.com/repos/kubesphere/kubesphere",getStar=function(){$(".social-count").hide(),$.getJSON(githubApiLink,function(e){$(".social-count").show().html(e.stargazers_count)})};getStar(),bindNavMouseEvent=function(e,t){t||(t=$(e));var n=!1;t.mouseenter(function(){if(n)return!1;n=!0,$(this).find(".dropdown-menu").fadeIn(200,function(){n=!1})}),t.mouseleave(function(){$(this).find(".dropdown-menu").fadeOut(200)})},bindScrollChangeHeader=function(){var t=100,e=$("header");window.addEventListener("scroll",function(){var t=window.scrollY;t>0?e.addClass("navigationScroll"):e.removeClass("navigationScroll")})},bindClickShowMenu=function(){$(".menu-icon").click(function(){$("#modal-for-menu").modal()})},bindClickModalLi=function(){$(".modal .menu-li").click(function(){var e=$(this).data("check");e===0?($(this).data("check",1),$(this).find(".dropdown-menu").slideDown(200)):($(this).data("check",0),$(this).find(".dropdown-menu").slideUp(200)),$(this).find(".menu-span").toggleClass("up")})},bindClickClose=function(){$("#close-join").click(function(){$(".navigation .join-div").hide(),$(".main-section").removeClass("padding")})},language="en",bindClickClose(),bindScrollChangeHeader(),$(".header-container .menu-li").each(function(){bindNavMouseEvent("",$(this))}),bindNavMouseEvent(".header-container .language-menu"),bindNavMouseEvent(".header-container .btn-li"),bindClickShowMenu(),bindClickModalLi(),handleLangClick=function(e,t){try{localStorage.setItem("lang",e)}catch{}location.href=t}</script><section class=main-section><div class=common-layout><div class=breadcrumb><span><a href=/blogs/>Technology Blogs</a> > </span><span>Kubernetes Resource Requests and Limits Deep Dive</span></div><div class='main-div middle-div'><div class=author>Yunkun, Sherlock</div><span class=date>Published onï¼š2021-04-14</span>&nbsp;&nbsp;&nbsp;
<span style=font-size:14px;color:#919aa3 id=busuanzi_container_page_pv>The number of views: <span id=busuanzi_value_page_pv></span></span><h1>Kubernetes Resource Requests and Limits Deep Dive</h1><div class=share-1><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fblogs%2funderstand-requests-and-limits-in-kubernetes%2f&text=Kubernetes%20Resource%20Requests%20and%20Limits%20Deep%20Dive" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fblogs%2funderstand-requests-and-limits-in-kubernetes%2f&title=Kubernetes%20Resource%20Requests%20and%20Limits%20Deep%20Dive" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fblogs%2funderstand-requests-and-limits-in-kubernetes%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fblogs%2funderstand-requests-and-limits-in-kubernetes%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fblogs%2funderstand-requests-and-limits-in-kubernetes%2f&t=Kubernetes%20Resource%20Requests%20and%20Limits%20Deep%20Dive" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div><div class=content><div class=md-body><p>As you create resources in a Kubernetes cluster, you may have encountered the following scenarios:</p><ol><li>No CPU requests or low CPU requests specified for workloads, which means more Pods "seem" to be able to work on the same node. During traffic bursts, your CPU is maxed out with a longer delay while some of your machines may have a CPU soft lockup.</li><li>Likewise, no memory requests or low memory requests specified for workloads. Some Pods, especially those running Java business apps, will keep restarting while they can actually run normally in local tests.</li><li>In a Kubernetes cluster, workloads are usually not scheduled evenly across nodes. In most cases, in particular, memory resources are unevenly distributed, which means some nodes can see much higher memory utilization than other nodes. As the de facto standard in container orchestration, Kubernetes should have an effective scheduler that ensures the even distribution of resources. But, is it really the case?</li></ol><p>Generally, cluster administrators can do nothing but restart the cluster if the above issues happen amid traffic bursts when all of your machines hang and SSH login fails. In this article, we will dive deep into Kubernetes requests and limits by analyzing possible issues and discussing the best practices for them. If you are also interested in the underlying mechanism, you can also find the analysis from the perspective of source code. Hopefully, this article will be helpful for you to understand how Kubernetes requests and limits work, and why they can work in the expected way.</p><h2 id=concepts-of-requests-and-limits>Concepts of Requests and Limits</h2><p>To make full use of resources in a Kubernetes cluster and improve scheduling efficiency, Kubernetes uses requests and limits to control resource allocation for containers. Each container can have its own requests and limits. These two parameters are specified by <code>resources.requests</code> and <code>resources.limits</code>. Generally speaking, requests are more important in scheduling while limits are more important in running.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>resources</span>:  
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests</span>:    
</span></span><span style=display:flex><span>        <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>50m</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>50Mi</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>limits</span>:    
</span></span><span style=display:flex><span>        <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>100m</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>100Mi</span>
</span></span></code></pre></div><p>Requests define the smallest amount of resources a container needs. For example, for a container running Spring Boot business, the requests specified must be the minimum amount of resources that a Java Virtual Machine (JVM) needs to consume in the container image. If you only specify a low memory request, the odds are that the Kubernetes scheduler tends to schedule the Pod to the node which doesnâ€™t have sufficient resources to run the JVM. Namely, the Pod cannot use more memory which the JVM bootup process needs. As a result, the Pod keeps restarting.</p><p>On the other hand, limits determine the maximum amount of resources that a container can use, preventing resource shortage or machine crashes due to excessive resource consumption. If it is set to <code>0</code>, it means no resource limit for the container. In particular, if you set <code>limits</code> without specifying <code>requests</code>, Kubernetes considers the value of <code>requests</code> is the same as that of <code>limits</code> by default.</p><p>Kubernetes requests and limits apply to two types of resources - compressible (for example, CPU) and incompressible (for example, memory). For incompressible resources, appropriate limits are extremely important.</p><p>Here is a brief summary of requests and limits:</p><ul><li>If services in a Pod are using more CPU resources than the limits specified, the Pod will be restricted but will not be killed. If no limit is set, a Pod can use all idle CPU resources.</li><li>If a Pod is using more memory resources than the limits specified, container processes in the Pod will be killed due to OOM. In this case, Kubernetes tends to restart the container on the original node or simply create another Pod.</li><li>0 &lt;= requests &lt;=Node Allocatable; requests &lt;= limits &lt;= Infinity.</li></ul><h2 id=scenario-analysis>Scenario Analysis</h2><p>After we look at the concepts of requests and limits, let's go back to the three scenarios mentioned at the beginning.</p><h3 id=scenario-1>Scenario 1</h3><p>First and foremost, you need to know that CPU resources and memory resources are completely different. CPU resources are compressible. The distribution and management of CPU are based on Completely Fair Scheduler (CFS) and Cgroups. To put it in a simple way, if the Service in a Pod is using more CPU resources than the CPU limits specified, it will be throttled by Kubernetes. For Pods without CPU limits, once idle CPU resources are running out, the amount of CPU resources allocated before will gradually decrease. In both situations, ultimately, Pods will be unable to handle external requests, resulting in a longer delay and response time.</p><h3 id=scenario-2>Scenario 2</h3><p>On the contrary, memory cannot be compressed and Pods cannot share memory resources. This means the allocation of new memory resources will definitely fail if memory is running out.</p><p>Some processes in a Pod need a certain amount of memory exclusively in initialization. For example, a JVM applies for a certain amount of memory upon start-up. If the specified memory request is less than the memory applied by the JVM, the memory application will fail (OOM-kill). As a result, the Pod will keep restarting and failing.</p><h3 id=scenario-3>Scenario 3</h3><p>When a Pod is being created, Kubernetes needs to allocate or provision different resources including CPU and memory in a balanced and comprehensive way. Meanwhile, the Kubernetes scheduling algorithm entails a variety of factors, such as <code>NodeResourcesLeastAllocated</code> and Pod affinity. The reason why memory resources are often unevenly distributed is that for apps, memory is considered scarcer than other resources.</p><p>Besides, a Kubernetes scheduler works based on the current status of a cluster. In other words, when new Pods are created, the scheduler selects an optimal node for Pods to run on according to the resource specification of the cluster at that moment. This is where potential issues may happen as Kubernetes clusters are highly dynamic. For example, to maintain a node, you may need to cordon it and all the Pods running on it will be scheduled to other nodes. The problem is, after the maintenance, these Pods will not be automatically scheduled back to the original node. This is because a running Pod cannot be rescheduled by Kubernetes itself to another node once it is bound to a node at the beginning.</p><h2 id=best-practices-for-configuring-kubernetes-resource-requests-and-limits>Best Practices for Configuring Kubernetes Resource Requests and Limits</h2><p>We can know from the above analysis that cluster stability has a direct bearing on your app's performance. Temporary resource shortage is often the major cause of cluster instability, which cloud mean app malfunctions or even node failures. Here, we would like to introduce two ways to improve cluster stability.</p><p>First, reserve a certain amount of system resources by <a href=https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/ target=_blank rel="noopener noreferrer">editing the kubelet configuration file</a>. This is especially important when you are dealing with incompressible compute resources, such as memory or disk space.</p><p>Second, configure appropriate <a href=https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/ target=_blank rel="noopener noreferrer">Quality of Service (QoS) classes</a> for Pods. Kubernetes uses QoS classes to determine the scheduling and eviction priority of Pods. Different Pods can be assigned different QoS classes, including <code>Guaranteed</code> (highest priority), <code>Burstable</code> and <code>BestEffort</code> (lowest priority).</p><ul><li><code>Guaranteed</code>. Every container in the Pod, including init containers, must have requests and limits specified for CPU and memory, and they must be equal.</li><li><code>Burstable</code>. At least one container in the Pod has requests specified for CPU or memory.</li><li><code>BestEffort</code>. No container in the Pod has requests and limits specified for CPU and memory.</li></ul><div class="notices note"><p>Note</p><div>With CPU management policies of Kubelet, you can set CPU affinity for a specific Pod. For more information, see <a href=https://kubernetes.io/docs/tasks/administer-cluster/cpu-management-policies/ target=_blank rel="noopener noreferrer">the Kubernetes documentation</a>.</div></div><p>When resources are running out, your cluster will first kill Pods with a QoS class of <code>BestEffort</code>, followed by <code>Burstable</code>. In other words, Pods that have the lowest priority are terminated first. If you have enough resources, you can assign all Pods the class of <code>Guaranteed</code>. This can be considered as a trade-off between compute resources and performance and stability. You may expect higher overheads but your cluster can work more efficiently. At the same time, to improve resource utilization, you can assign Pods running business services the class of <code>Guaranteed</code>. For other services, assign them the class of <code>Burstable</code> or <code>BestEffort</code> according to their priority.</p><p>Next, we will use the <a href=https://kubesphere.io/ target=_blank rel="noopener noreferrer">KubeSphere container platform</a> as an example to see how to gracefully configure resources for Pods.</p><h2 id=use-kubesphere-to-allocate-resources>Use KubeSphere to Allocate Resources</h2><p>As stated above, requests and limits are two important building blocks for cluster stability. As one of the major distributions of Kubernetes, KubeSphere boasts a concise, lucid, and interactive user interface, greatly reducing the learning curve of Kubernetes.</p><h3 id=before-you-begin>Before You Begin</h3><p>KubeSphere features a highly functional multi-tenant system for fine-grained access control of different users. In KubeSphere 3.0, you can set requests and limits for namespaces (ResourceQuotas) and containers (LimitRanges) respectively. To perform these operations, you need to create a workspace, a project (i.e. namespace) and a user (<code>ws-admin</code>). For more information, see <a href=https://kubesphere.io/docs/quick-start/create-workspace-and-project/ target=_blank rel="noopener noreferrer">Create Workspaces, Projects, Users and Roles</a>.</p><h3 id=set-resource-quotas>Set Resource Quotas</h3><ol><li><p>Go to the <strong>Overview</strong> page of your project, navigate to <strong>Basic Information</strong> in <strong>Project Settings</strong>, and select <strong>Edit Quotas</strong> from the <strong>Manage Project</strong> drop-down menu.</p><p><img src=/images/blogs/en/understand-requests-and-limits-in-kubesphere/edit-quota.png alt=edit-quota></p></li><li><p>In the dialog that appears, set requests and limits for your project.</p><p><img src=/images/blogs/en/understand-requests-and-limits-in-kubesphere/project-quota-page.png alt=project-quota-page></p><p>Keep in mind that:</p><ul><li>The requests or limits set on this page must be greater than the total requests or limits specified for all Pods in the project.</li><li>When you create a container in the project without specifying requests or limits, you will see an error message (recorded in events) upon creation.</li></ul><p>Once you have configured project quotas, <code>requests</code> and <code>limits</code> need to be specified for all containers created in the project. As we always put it, "code is law". Project quotas set a rule for all containers to obey.</p><div class="notices note"><p>Note</p><div>Project quotas in KubeSphere are the same as <a href=https://kubernetes.io/docs/concepts/policy/resource-quotas/ target=_blank rel="noopener noreferrer">ResourceQuotas</a> in Kubernetes. Besides CPU and memory, you can also set resource quotas for other objects separately such as Deployments and ConfigMaps. For more information, see <a href=https://kubesphere.io/docs/workspace-administration/project-quotas/ target=_blank rel="noopener noreferrer">Project Quotas</a>.</div></div></li></ol><h3 id=set-default-requests-and-limits>Set Default Requests and Limits</h3><p>As mentioned above, if project quotas are specified, you need to configure requests and limits for Pods accordingly. In fact, in testing or even production, the value of <code>requests</code> and the value of <code>limits</code> are very close, or even equivalent for most Pods. To simplify the process of creating workloads, KubeSphere allows users to set default requests and limits beforehand for containers. In this way, you do not need to set requests and limits every time when Pods are created.</p><p>To set default requests and limits, perform the following steps:</p><ol><li><p>Also on the <strong>Basic Information</strong> page, click <strong>Edit Resource Default Request</strong> from the <strong>Manage Project</strong> drop-down menu.</p></li><li><p>In the dialog that appears, configure default requests and limits for containers.</p><p><img src=/images/blogs/en/understand-requests-and-limits-in-kubesphere/default-requests-and-limits.png alt=default-requests-and-limits></p><div class="notices note"><p>Note</p><div>The default container requests and limits in KubeSphere are known as <a href=https://kubernetes.io/docs/concepts/policy/limit-range/ target=_blank rel="noopener noreferrer">LimitRanges</a> in Kubernetes. For more information, see <a href=https://kubesphere.io/docs/project-administration/container-limit-ranges/ target=_blank rel="noopener noreferrer">Container Limit Ranges</a>.</div></div></li><li><p>When you create workloads later, requests and limits will be prepopulated automatically. For more information about how to create workloads in KubeSphere, see <a href=https://kubesphere.io/docs/project-user-guide/application-workloads/deployments/ target=_blank rel="noopener noreferrer">the KubeSphere documentation</a>.</p><p><img src=/images/blogs/en/understand-requests-and-limits-in-kubesphere/workload-values.jpg alt=workload-values></p></li></ol><p>For containers running key business processes, they need to handle more traffic than other containers. In reality, there is no panacea and you need to make careful and comprehensive decisions on requests and limits of these containers. Think about the following questions:</p><ol><li>Are your containers CPU-intensive or IO-intensive?</li><li>Are they highly available?</li><li>What are the upstream and downstream objects of your service?</li></ol><p>If you look at the load of containers over a long period of time, you may find it periodic. In this connection, the historical monitoring data can serve as an important reference as you configure requests and limits. On the back of Prometheus, which is integrated into the platform, KubeSphere features a powerful and holistic observability system that monitors resources at a granular level. Vertically, it covers data from clusters to Pods. Horizontally, it tracks information about CPU, memory, network and storage. Generally, you can specify requests based on the average value of historical data while limits need to be higher than the average. That said, you may need to make some adjustments to your final decision as needed.</p><h2 id=source-code-analysis>Source Code Analysis</h2><p>Now that you know some best practices for configuring requests and limits, let's dive deeper into the source code.</p><h3 id=requests-and-scheduling>Requests and Scheduling</h3><p>The following code shows the relation between the requests of a Pod and the requests of containers in the Pod.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>computePodResourceRequest</span>(<span style=color:#a6e22e>pod</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>v1</span>.<span style=color:#a6e22e>Pod</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>preFilterState</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>preFilterState</span>{}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>container</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>pod</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>Containers</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>Resources</span>.<span style=color:#a6e22e>Requests</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// take max_resource(sum_pod, any_init_container)</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>container</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>pod</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>InitContainers</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>SetMaxResource</span>(<span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>Resources</span>.<span style=color:#a6e22e>Requests</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// If Overhead is being utilized, add to the total requests for the pod</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>pod</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>Overhead</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>utilfeature</span>.<span style=color:#a6e22e>DefaultFeatureGate</span>.<span style=color:#a6e22e>Enabled</span>(<span style=color:#a6e22e>features</span>.<span style=color:#a6e22e>PodOverhead</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>pod</span>.<span style=color:#a6e22e>Spec</span>.<span style=color:#a6e22e>Overhead</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>f</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Fit</span>) <span style=color:#a6e22e>PreFilter</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>cycleState</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>framework</span>.<span style=color:#a6e22e>CycleState</span>, <span style=color:#a6e22e>pod</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>v1</span>.<span style=color:#a6e22e>Pod</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>framework</span>.<span style=color:#a6e22e>Status</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cycleState</span>.<span style=color:#a6e22e>Write</span>(<span style=color:#a6e22e>preFilterStateKey</span>, <span style=color:#a6e22e>computePodResourceRequest</span>(<span style=color:#a6e22e>pod</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getPreFilterState</span>(<span style=color:#a6e22e>cycleState</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>framework</span>.<span style=color:#a6e22e>CycleState</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>preFilterState</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cycleState</span>.<span style=color:#a6e22e>Read</span>(<span style=color:#a6e22e>preFilterStateKey</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// preFilterState doesn&#39;t exist, likely PreFilter wasn&#39;t invoked.</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;error reading %q from cycleState: %v&#34;</span>, <span style=color:#a6e22e>preFilterStateKey</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>preFilterState</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;%+v  convert to NodeResourcesFit.preFilterState error&#34;</span>, <span style=color:#a6e22e>c</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>s</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>f</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Fit</span>) <span style=color:#a6e22e>Filter</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>cycleState</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>framework</span>.<span style=color:#a6e22e>CycleState</span>, <span style=color:#a6e22e>pod</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>v1</span>.<span style=color:#a6e22e>Pod</span>, <span style=color:#a6e22e>nodeInfo</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>framework</span>.<span style=color:#a6e22e>NodeInfo</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>framework</span>.<span style=color:#a6e22e>Status</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>getPreFilterState</span>(<span style=color:#a6e22e>cycleState</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>framework</span>.<span style=color:#a6e22e>NewStatus</span>(<span style=color:#a6e22e>framework</span>.<span style=color:#a6e22e>Error</span>, <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>insufficientResources</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fitsRequest</span>(<span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>nodeInfo</span>, <span style=color:#a6e22e>f</span>.<span style=color:#a6e22e>ignoredResources</span>, <span style=color:#a6e22e>f</span>.<span style=color:#a6e22e>ignoredResourceGroups</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>insufficientResources</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// We will keep all failure reasons.</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>failureReasons</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>string</span>, <span style=color:#ae81ff>0</span>, len(<span style=color:#a6e22e>insufficientResources</span>))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>insufficientResources</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>failureReasons</span> = append(<span style=color:#a6e22e>failureReasons</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Reason</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>framework</span>.<span style=color:#a6e22e>NewStatus</span>(<span style=color:#a6e22e>framework</span>.<span style=color:#a6e22e>Unschedulable</span>, <span style=color:#a6e22e>failureReasons</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>It can be seen from the code above that the scheduler (schedule thread) calculates the resources required by the Pod to be scheduled. Specifically, it calculates the total requests of init containers and the total requests of working containers respectively according to Pod specifications. The greater one will be used. Note that for lightweight virtual machines (e.g. kata-container), their own resource consumption of virtualization needs to be counted in caches. In the following <code>Filter</code> stage, all nodes will be checked to see if they meet the conditions.</p><div class="notices note"><p>Note</p><div>The scheduling process entails different stages, including <code>Pre filter</code>, <code>Filter</code>, <code>Post filter</code> and <code>Score</code>. For more information, see <a href=https://kubernetes.io/docs/concepts/scheduling-eviction/kube-scheduler/#kube-scheduler-implementation target=_blank rel="noopener noreferrer">filter and score nodes</a>.</div></div><p>After the filtering, if there is only one applicable node, the Pod will be scheduled to it. If there are multiple applicable Pods, the scheduler will select the node with the highest weighted scores sum. Scoring is based on a variety of factors as <a href=https://kubernetes.io/docs/reference/scheduling/config/#scheduling-plugins target=_blank rel="noopener noreferrer">scheduling plugins</a> implement one or more extension points. Note that the value of <code>requests</code> and the value of <code>limits</code> impact directly on the ultimate result of the plugin <code>NodeResourcesLeastAllocated</code>. Here is the source code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>leastResourceScorer</span>(<span style=color:#a6e22e>resToWeightMap</span> <span style=color:#a6e22e>resourceToWeightMap</span>) <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>resourceToValueMap</span>, <span style=color:#a6e22e>resourceToValueMap</span>, <span style=color:#66d9ef>bool</span>, <span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>int64</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>requested</span>, <span style=color:#a6e22e>allocable</span> <span style=color:#a6e22e>resourceToValueMap</span>, <span style=color:#a6e22e>includeVolumes</span> <span style=color:#66d9ef>bool</span>, <span style=color:#a6e22e>requestedVolumes</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>allocatableVolumes</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>int64</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>nodeScore</span>, <span style=color:#a6e22e>weightSum</span> <span style=color:#66d9ef>int64</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>resource</span>, <span style=color:#a6e22e>weight</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>resToWeightMap</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>resourceScore</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>leastRequestedScore</span>(<span style=color:#a6e22e>requested</span>[<span style=color:#a6e22e>resource</span>], <span style=color:#a6e22e>allocable</span>[<span style=color:#a6e22e>resource</span>])
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>nodeScore</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>resourceScore</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>weight</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>weightSum</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>weight</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>nodeScore</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>weightSum</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>leastRequestedScore</span>(<span style=color:#a6e22e>requested</span>, <span style=color:#a6e22e>capacity</span> <span style=color:#66d9ef>int64</span>) <span style=color:#66d9ef>int64</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>capacity</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>requested</span> &gt; <span style=color:#a6e22e>capacity</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> ((<span style=color:#a6e22e>capacity</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>requested</span>) <span style=color:#f92672>*</span> int64(<span style=color:#a6e22e>framework</span>.<span style=color:#a6e22e>MaxNodeScore</span>)) <span style=color:#f92672>/</span> <span style=color:#a6e22e>capacity</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>For <code>NodeResourcesLeastAllocated</code>, a node will get higher scores if it has more resources for the same Pod. In other words, a Pod will be more likely to be scheduled to the node with sufficient resources.</p><p>When a Pod is being created, Kubernetes needs to allocate different resources including CPU and memory. Each kind of resources has a weight (the <code>resToWeightMap</code> structure in the source code). As a whole, they tell the Kubernetes scheduler what the best decision may be to achieve resource balance. In the <code>Score</code> stage, the scheduler also uses other plugins for scoring in addition to <code>NodeResourcesLeastAllocated</code>, such as <code>InterPodAffinity</code>.</p><h3 id=qos-and-scheduling>QoS and Scheduling</h3><p>As a resource protection mechanism in Kubernetes, QoS is mainly used to control incompressible resources such as memory. It also impacts the OOM score of different Pods and containers. When a node is running out of memory, the kernel (OOM Killer) kills Pods of low priority (higher scores means lower priority). Here is the source code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>GetContainerOOMScoreAdjust</span>(<span style=color:#a6e22e>pod</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>v1</span>.<span style=color:#a6e22e>Pod</span>, <span style=color:#a6e22e>container</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>v1</span>.<span style=color:#a6e22e>Container</span>, <span style=color:#a6e22e>memoryCapacity</span> <span style=color:#66d9ef>int64</span>) <span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>types</span>.<span style=color:#a6e22e>IsCriticalPod</span>(<span style=color:#a6e22e>pod</span>) {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Critical pods should be the last to get killed.</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>guaranteedOOMScoreAdj</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>v1qos</span>.<span style=color:#a6e22e>GetPodQOS</span>(<span style=color:#a6e22e>pod</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>v1</span>.<span style=color:#a6e22e>PodQOSGuaranteed</span>:
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Guaranteed containers should be the last to get killed.</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>guaranteedOOMScoreAdj</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>v1</span>.<span style=color:#a6e22e>PodQOSBestEffort</span>:
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>besteffortOOMScoreAdj</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Burstable containers are a middle tier, between Guaranteed and Best-Effort. Ideally,</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// we want to protect Burstable containers that consume less memory than requested.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// The formula below is a heuristic. A container requesting for 10% of a system&#39;s</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// memory will have an OOM score adjust of 900. If a process in container Y</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// uses over 10% of memory, its OOM score will be 1000. The idea is that containers</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// which use more than their request will have an OOM score of 1000 and will be prime</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// targets for OOM kills.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Note that this is a heuristic, it won&#39;t work if a container has many small processes.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>memoryRequest</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>Resources</span>.<span style=color:#a6e22e>Requests</span>.<span style=color:#a6e22e>Memory</span>().<span style=color:#a6e22e>Value</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>oomScoreAdjust</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1000</span> <span style=color:#f92672>-</span> (<span style=color:#ae81ff>1000</span><span style=color:#f92672>*</span><span style=color:#a6e22e>memoryRequest</span>)<span style=color:#f92672>/</span><span style=color:#a6e22e>memoryCapacity</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// A guaranteed pod using 100% of memory can have an OOM score of 10. Ensure</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// that burstable pods have a higher OOM score adjustment.</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> int(<span style=color:#a6e22e>oomScoreAdjust</span>) &lt; (<span style=color:#ae81ff>1000</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>guaranteedOOMScoreAdj</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> (<span style=color:#ae81ff>1000</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>guaranteedOOMScoreAdj</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Give burstable pods a higher chance of survival over besteffort pods.</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> int(<span style=color:#a6e22e>oomScoreAdjust</span>) <span style=color:#f92672>==</span> <span style=color:#a6e22e>besteffortOOMScoreAdj</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> int(<span style=color:#a6e22e>oomScoreAdjust</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> int(<span style=color:#a6e22e>oomScoreAdjust</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=summary>Summary</h2><p>As a portable and extensible open-source platform, Kubernetes is born for managing containerized workloads and Services. It boasts a comprehensive, fast-growing ecosystem that has helped it secure its position as the de facto standard in container orchestration. That being said, it is not always easy for users to learn Kubernetes and this is where KubeSphere comes to play its part. KubeSphere empowers users to perform virtually all the operations on its dashboard while they also have the option to use the built-in web kubectl tool to run commands. This article focuses on Kubernetes resource requests and limits, their underlying logic in Kubernetes, as well as how to use KubeSphere to configure them for easy operation and maintenance of your cluster.</p><h2 id=reference>Reference</h2><ul><li><a href=https://learnk8s.io/setting-cpu-memory-limits-requests target=_blank rel="noopener noreferrer">https://learnk8s.io/setting-cpu-memory-limits-requests</a></li><li><a href=https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/ target=_blank rel="noopener noreferrer">https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/</a></li><li><a href=https://docs.oracle.com/cd/E13150_01/jrockit_jvm/jrockit/jrdocs/refman/optionX.html target=_blank rel="noopener noreferrer">https://docs.oracle.com/cd/E13150_01/jrockit_jvm/jrockit/jrdocs/refman/optionX.html</a></li><li><a href=https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/ target=_blank rel="noopener noreferrer">https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/</a></li><li><a href=https://kubernetes.io/docs/concepts/policy/limit-range/ target=_blank rel="noopener noreferrer">https://kubernetes.io/docs/concepts/policy/limit-range/</a></li><li><a href=https://www.kernel.org/doc/Documentation/scheduler/sched-bwc.txt target=_blank rel="noopener noreferrer">https://www.kernel.org/doc/Documentation/scheduler/sched-bwc.txt</a></li><li><a href=https://www.kernel.org/doc/Documentation/scheduler/sched-design-CFS.txt target=_blank rel="noopener noreferrer">https://www.kernel.org/doc/Documentation/scheduler/sched-design-CFS.txt</a></li><li><a href=https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/resource_management_guide/sec-cpu target=_blank rel="noopener noreferrer">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/resource_management_guide/sec-cpu</a></li><li><a href=https://medium.com/omio-engineering/cpu-limits-and-aggressive-throttling-in-kubernetes-c5b20bd8a718 target=_blank rel="noopener noreferrer">https://medium.com/omio-engineering/cpu-limits-and-aggressive-throttling-in-kubernetes-c5b20bd8a718</a></li></ul></div></div><div class=share-2><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fblogs%2funderstand-requests-and-limits-in-kubernetes%2f&text=Kubernetes%20Resource%20Requests%20and%20Limits%20Deep%20Dive" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fblogs%2funderstand-requests-and-limits-in-kubernetes%2f&title=Kubernetes%20Resource%20Requests%20and%20Limits%20Deep%20Dive" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fblogs%2funderstand-requests-and-limits-in-kubernetes%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fblogs%2funderstand-requests-and-limits-in-kubernetes%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fblogs%2funderstand-requests-and-limits-in-kubernetes%2f&t=Kubernetes%20Resource%20Requests%20and%20Limits%20Deep%20Dive" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div></div><div class=aside><div class=inner-div><div class=title>Table of Contents</div><div class=tabs><nav id=TableOfContents><ul><li><a href=#concepts-of-requests-and-limits>Concepts of Requests and Limits</a></li><li><a href=#scenario-analysis>Scenario Analysis</a><ul><li><a href=#scenario-1>Scenario 1</a></li><li><a href=#scenario-2>Scenario 2</a></li><li><a href=#scenario-3>Scenario 3</a></li></ul></li><li><a href=#best-practices-for-configuring-kubernetes-resource-requests-and-limits>Best Practices for Configuring Kubernetes Resource Requests and Limits</a></li><li><a href=#use-kubesphere-to-allocate-resources>Use KubeSphere to Allocate Resources</a><ul><li><a href=#before-you-begin>Before You Begin</a></li><li><a href=#set-resource-quotas>Set Resource Quotas</a></li><li><a href=#set-default-requests-and-limits>Set Default Requests and Limits</a></li></ul></li><li><a href=#source-code-analysis>Source Code Analysis</a><ul><li><a href=#requests-and-scheduling>Requests and Scheduling</a></li><li><a href=#qos-and-scheduling>QoS and Scheduling</a></li></ul></li><li><a href=#summary>Summary</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></div></div></div></section><div class=SubscribeForm><div class=innerBox><img class=close src=/images/home/close.svg alt=close><p class=description>Receive the latest news, articles and updates from KubeSphere</p><div id=blog_formAddress data-usesendcloud=false><form action="https://kubesphere.us10.list-manage.com/subscribe/post?u=c85ea2b944b08b951f607bdd4&amp;id=83f673a2d9" method=post target=_blank novalidate><input name=EMAIL id=email-input-blog type=text placeholder='Please enter your email address'>
<button type=submit id=email-submit-blog>Subscribe</button></form><span id=message_blog data-message1='email is required!' data-message2='Please enter a valid email address!'></span></div></div></div><footer><div class=footer><div class="footer-main common-layout"><div class=up-main><div class=left-div><img src=/images/logo.svg alt class=foot-logo><p>Receive the latest news, articles and updates from KubeSphere</p><div id=formAddress data-usesendcloud=false><form action="https://kubesphere.us10.list-manage.com/subscribe/post?u=c85ea2b944b08b951f607bdd4&amp;id=83f673a2d9" method=post target=_blank novalidate><input name=EMAIL id=email-input type=text placeholder='Please enter your email address'>
<button type=submit id=email-submit>Subscribe</button></form></div><span id=message data-message1='email is required!' data-message2='Please enter a valid email address!'></span>
<script>var bindSubmit=function(){var e=$("#email-input");$("#email-submit").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message").data("message1"),a=$("#message").data("message2"),r=$("#message").data("message3"),c=$("#message1").data("success");if(n)if(validateEmail(n)){if(s=$("#formAddress").data("usesendcloud"),!s)return;o=$("#formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:$("#email-input").val().toString()},success:function(){showSuccessMessage(c),setTimeout(function(){$("#email-input").val("")},1e3)},error:function(){showMessage(r)}})}else t.preventDefault(),showMessage(a);else t.preventDefault(),showMessage(i)})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},showMessage=function(e){$("#message").html(e).show()},showSuccessMessage=function(e){$("#message1").html(e).show()},bindHideMessage=function(){$(window).click(function(){$("#message").hide(),$("#message1").hide()})},bindClose=function(){$(".formBox .close").click(function(e){e.stopPropagation(),$(".formBox").fadeOut()})};bindSubmit(),bindClose(),bindHideMessage()</script><span id=message data-message1='email is required!' data-message2='Please enter a valid email address!'></span></div><div class=right-div><ul class=common-flex-layout><li class=nowrap-li><div class=h3>Scenarios</div><a href=/devops/>Kubernetes DevOps and GitOps</a>
<a href=/service-mesh/>Microservices with Service Mesh</a>
<a href=/observability/>Cloud Native Observability</a>
<a href=https://github.com/OpenFunction/OpenFunction target=_blank rel="noopener noreferrer">Functions-as-a-Service Platform and Serverless</a>
<a href=https://github.com/openpitrix/openpitrix target=_blank rel="noopener noreferrer">Multi-cloud Apps Mgmt</a></li><li class=nowrap-li><div class=h3>Resources</div><a href=/projects/>Projects</a>
<a href=/blogs/>Blogs</a>
<a href=/conferences/>KubeCon & QCon</a>
<a href=/videos/>Videos</a></li><li class=nowrap-li><div class=h3>KubeSphere Docs</div><a href=/docs/v4.1/01-intro/01-introduction/>Introduction</a>
<a href=/docs/v4.1/03-installation-and-upgrade/02-install-kubesphere/02-install-kubernetes-and-kubesphere/>Installation</a>
<a href=/docs/v4.1/02-quickstart/>Tutorial</a>
<a href=/docs/v3.4/reference/api-docs/>API Documentation</a></li><li class=nowrap-li><div class=h3>Community</div><a href=/contribution/>Contribution</a>
<a href=/case/>Case Studies</a>
<a href=/partner/>Partners</a>
<a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">Roadmap</a>
<a href=https://kubesphere.io target=_blank rel="noopener noreferrer">Global Site</a>
<a href=https://kubesphere.com.cn/ target=_blank rel="noopener noreferrer">China Site</a></li><li class=nowrap-li><div class=h3>Products and Services</div><a href=https://aws.amazon.com/quickstart/architecture/qingcloud-kubesphere/ target=_blank rel="noopener noreferrer">KubeSphere on AWS</a>
<a href=https://market.azure.cn/marketplace/apps/qingcloud.kubesphere target=_blank rel="noopener noreferrer">KubeSphere on Azure</a>
<a href=https://marketplace.digitalocean.com/apps/kubesphere target=_blank rel="noopener noreferrer">KubeSphere on DigitalOcean</a>
<a href=https://www.qingcloud.com/products/kubesphereqke target=_blank rel="noopener noreferrer">KubeSphere on QingCloud(QKE)</a>
<a href=https://kubesphere.co/kse/ target=_blank rel="noopener noreferrer">KubeSphere Enterprise</a>
<a href=https://kubesphere.co/marketplace/ target=_blank rel="noopener noreferrer">KubeSphere Extensions Marketplace</a>
<a href=https://kubesphere.co/ksv/ target=_blank rel="noopener noreferrer">KubeSphere Virtualization Platform</a>
<a href=https://kubesphere.cloud target=_blank rel="noopener noreferrer">Cloud Native Services and Support</a>
<a href=https://jinshuju.net/f/bDS8me target=_blank rel="noopener noreferrer">Contact Us</a></li></ul></div></div><div class=down-main><div class=img-div><a class=wechat href=javascript:void(0); aria-label=wechat><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28"><defs><path id="a" d="M0 0h15.673v12.156H0z"/></defs><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="13" cy="13" r="13" stroke="#B6C2CD"/><g transform="translate(5 7)"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59.0-4.625 1.679-4.625 3.74.0 2.066 2.035 3.738 4.625 3.738.542.0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27.0-.541-.257-.541-.514.0-.256.27-.514.541-.514.41.0.681.258.681.514.0.257-.271.514-.681.514zm2.994.0c-.27.0-.541-.257-.541-.514.0-.256.27-.514.54-.514.41.0.681.258.681.514.0.257-.277.514-.68.514z" mask="url(#b)"/><path fill="currentColor" d="M10.602 3.674c.177.0.356.011.533.029C10.657 1.576 8.27.0 5.543.0 2.498.0.0 1.974.0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17.0.343-.005.515-.022a3.68 3.68.0 01-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417.0.693.263.693.66s-.276.66-.693.66c-.418.0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417.0-.834-.263-.834-.66s.417-.66.834-.66c.418.0.695.263.695.66.0.392-.277.66-.695.66z" mask="url(#b)"/></g></g></svg><div class=hide-div><img src=/images/home/wechat.svg alt></div></a><a class=facebook-a href=https://www.facebook.com/kubesphere target=_blank aria-label=facebook></a><a class=twitter-a href=https://x.com/KubeSphere target=_blank aria-label=twitter rel="noopener noreferrer"></a><a class=linkedin-a href=https://www.linkedin.com/company/kubesphere/ target=_blank aria-label=linkedin rel="noopener noreferrer"></a><a class=youtube-a href=https://www.youtube.com/c/KubeSphere target=_blank aria-label=youtube rel="noopener noreferrer"></a><a class=slack-a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank aria-label=slack rel="noopener noreferrer"></a><a class=github-a href=https://github.com/kubesphere/kubesphere target=_blank aria-label=github rel="noopener noreferrer"></a><a class=medium-a href=https://itnext.io/@kubesphere target=_blank aria-label=medium rel="noopener noreferrer"></a></div><p class=p1></p></div></div></div><div class=cookie><div class=common-layout><p>Your privacy is important to us. We use cookies to remember subscription details, optimize site functionality, and deliver content tailored to your interests. To find out more, see our <a href=/privacy>privacy policy</a>.</p><button>
Accept and continue</button></div></div></footer><script>var lazyLoad=function(e,t){for(var n,o,i,s=0;s<t;s++){if(n=e.eq(s),o=n.attr("data-loaded"),o)continue;n.offset().top<parseInt($(window).height())+parseInt($(window).scrollTop())&&(i=n.attr("src"),n.attr("src",i),n.attr("data-loaded",!0))}},bindLayLoad=function(){var e=$("img"),t=e.length;lazyLoad(e,t),$(window).scroll(function(){lazyLoad(e,t)})},bindAddPadding=function(){var e=$("#close-join");e.length>0&&$(".main-section").addClass("padding")},docCookies={getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t){return!!e&&!/^(?:expires|max-age|path|domain|secure)$/i.test(e)&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t),!0)}},bindHideCookie=function(){var t=docCookies.getItem("hasAuth"),e=$(".cookie");t?e.hide():e.show(),e.find("button").on("click",function(){docCookies.setItem("hasAuth","1"),e.hide()})};bindAddPadding(),bindHideCookie()</script><script type=text/javascript src=/js/aside.2d6977c0f16aef4ed3e886dd66675ce74bd0efcd467c2b2bcdb30b92d5e7c7c0e5c6e0c9d8f09a883c22f58df9e6b0b6347fcdd3c9a920b7faba6d7f91a201c3.js integrity="sha512-LWl3wPFq707T6IbdZmdc50vQ781GfCsrzbMLktXnx8DlxuDJ2PCaiDwi9Y355rC2NH/N08mpILf6um1/kaIBww=="></script><script type=text/javascript src=/js/markdown-tab.17f9f46b021adebc7250ce1b07134a577b307e7a436daa4aaf388f218e8463966f53770b26a64817c06c168738a887672d47fb4c29615adfc446e11d09a344cf.js integrity="sha512-F/n0awIa3rxyUM4bBxNKV3swfnpDbapKrziPIY6EY5ZvU3cLJqZIF8BsFoc4qIdnLUf7TClhWt/ERuEdCaNEzw=="></script><script>let forbidForm=!1;var viewer=new Viewer(document.querySelector(".md-body"),{url:"src"}),blogBindSubmit=function(){var e=$("#email-input-blog");$("#email-submit-blog").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message_blog").data("message1"),a=$("#message_blog").data("message2"),r=$("#message_blog").data("message3"),c=$("#message1_blog").data("success");if(n)if(validateEmail(n)){if(s=$("#blog_formAddress").data("usesendcloud"),!s)return;o=$("#blog_formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:n.toString()},success:function(){showSuccessMessage_blog(c),setTimeout(function(){window.onscroll="",$(".SubscribeForm").hide(),$("#email-input-blog").val("")},5e3)},error:function(){showMessage_blog(r)}})}else t.preventDefault(),$("#message_blog").html(a).show();else t.preventDefault(),$("#message_blog").html(i).show()})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},bindHideMessageBlog=function(){$(window).click(function(){$("#message_blog").hide()})},bindCloseBlog=function(){$(".SubscribeForm .close").click(function(e){e.stopPropagation(),$(".SubscribeForm").fadeOut(),window.onscroll=""})},showMessage_blog=function(e){$("#message_blog").html(e).show()},showSuccessMessage_blog=function(e){$("#message1_blog").html(e).show()};window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;forbidForm&&(window.onscroll=""),e+t>n-710?$(".SubscribeForm").hide():$(".SubscribeForm").show()},blogBindSubmit(),bindCloseBlog(),bindHideMessageBlog()</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>