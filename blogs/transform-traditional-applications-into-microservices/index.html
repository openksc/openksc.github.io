<!doctype html><html lang=en-US><head><meta charset=utf-8><title>Transform Traditional Applications into Microservices to Enable the Traffic Monitoring Feature</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This article describes how to transform a traditional application into microservices to use service mesh features, such as grayscale release, traffic monitoring, and tracing."><meta name=keywords content="KubeSphere,Kubernetes,Microservices,Traffic Monitoring,Service Mesh"><meta property="og:type" content="article"><meta property="og:title" content="Transform Traditional Applications into Microservices to Enable the Traffic Monitoring Feature"><meta property="og:description" content="This article describes how to transform a traditional application into microservices to use service mesh features, such as grayscale release, traffic monitoring, and tracing."><meta property="og:image" content="https://openksc.github.io/images/blogs/transform-traditional-applications-into-microservices/traffic-monitoring-cover.png"><meta property="og:url" content="https://openksc.github.io/blogs/transform-traditional-applications-into-microservices/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeSphere"><meta property="twitter:image" content="https://openksc.github.io/images/blogs/transform-traditional-applications-into-microservices/traffic-monitoring-cover.png"><meta name=docsearch:language content="en-US"><meta name=docsearch:version content><link rel=canonical href=https://kubesphere.io/blogs/transform-traditional-applications-into-microservices/><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=apple-touch-icon href=/images/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/svg+xml href=/images/favicons/favicon.svg><link rel=icon type=image/png href=/images/favicons/favicon.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg color=#00ad6e><meta name=msapplication-config content='/images/favicons/browserconfig.xml'><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/fonts/Roboto/stylesheet.css><link rel=stylesheet href=/fonts/ProximaNova/stylesheet.css><link rel=stylesheet href=/css/jquery.modal.min.css><link rel=stylesheet href=/css/viewer.min.css><link rel=stylesheet href=/swiper/swiper-bundle.min.css><link rel=stylesheet href=/scss/common.min.0c3fdcc05ec210321169846714f74b11c4a1baf09a1833fa9273b2347c81e636.css><script src=/js/jquery-3.7.1.min.js></script><script src=/js/viewer.min.js></script><script src=/js/jquery.modal.min.js></script><script src=/swiper/swiper-bundle.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0888981f1fa45d241b1fb6962da2963e",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YYCVN36HT5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YYCVN36HT5")</script><script type=text/javascript>!function(e,t,n,s,o){e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=("https:"==document.location.protocol?"https://":"http://")+s,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio"),gio("init","8a24ae300cbf8b8c",{}),gio("send")</script><script type=text/javascript>_linkedin_partner_id="3131724",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id)</script><script type=text/javascript>(function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)})()</script><noscript>&lt; img height="1" width="1" style="display:none;" alt="" src="https://px.ads.linkedin.com/collect/?pid=3131724&fmt=gif" /></noscript><script>!function(e,t,n,s,o,i){e.twq||(s=e.twq=function(){s.exe?s.exe.apply(s,arguments):s.queue.push(arguments)},s.version="1.1",s.queue=[],o=t.createElement(n),o.async=!0,o.src="//static.ads-twitter.com/uwt.js",i=t.getElementsByTagName(n)[0],i.parentNode.insertBefore(o,i))}(window,document,"script"),twq("init","o65xa"),twq("track","PageView")</script><link rel=stylesheet href=/scss/content.min.f73b326fbf8c5bd331900b0de21c7dde608a4926f482f6465f9ae1d9049b83ad.css><link rel=stylesheet href=/scss/markdown.min.db47186481122431dffae72d17dbbd51f90b66f022cc163458645709924e4eac.css></head><body><header class=navigation><div class=join-div><div class=content>ðŸš€ KubeSphere v4.1.3 with Enhancements and Bug Fixes is available now. <a href=/docs/v4.1/20-release-notes/release-v413/ target=_blank rel="noopener noreferrer">Read the release notes â†’</a>
<img id=close-join src=/images/header/close.svg alt=close></div></div><div class=common-layout><div class=header-container><a href=/ aria-label=logo><img src=/images/header/logo.svg alt class=logo></a><ul class=nav><li class=menu-li><span class=menu-span>Scenarios</span><ul class="dropdown-menu menu-2"><li><a href=/devops/>Embracing One-stop DevOps Workflow</a></li><li><a href=/service-mesh/>Running Microservices on Kubernetes</a></li><li><a href=/observability/>Building Cloud Native Observability</a></li></ul></li><li class=menu-li><span class=menu-span>Resources</span><ul class="dropdown-menu menu-3"><li><a href=/projects/>Open Source Projects</a></li><li><a href=/conferences/>KubeCon & QCon</a></li><li><a href=/blogs/>Technology Blogs</a></li><li><a href=/videos/>Video Resources</a></li></ul></li><li class=menu-li><span class=menu-span>Documentation</span><ul class="dropdown-menu menu-4"><li><a href=/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/docs/v3.4>v3.4</a></li><li><a href=/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/en/%20 target=_blank rel="noopener noreferrer">Extension Development</a></li><li><a href=https://kube.design/ target=_blank rel="noopener noreferrer">Kube Design</a></li></ul></li><li class=menu-li><span class=menu-span>Community</span><ul class="dropdown-menu menu-5"><li><a href=/contribution/>Contribution</a></li><li><a href=/case/>Case Studies</a></li><li><a href=/partner/>Partner</a></li><li><a href=/news/>News</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">RoadMap</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025 target=_blank rel="noopener noreferrer">OSPP 2025</a></li></ul></li></ul><div class=right-menu><ul><li class=language-menu><div><img src=/images/header/black.svg alt>
<span>English</span></div><ul class=dropdown-menu><li onclick='handleLangClick("en","/blogs/transform-traditional-applications-into-microservices/")'>English</li><li onclick='handleLangClick("zh","/zh/blogs/transform-traditional-applications-into-microservices/")'>ç®€ä½“ä¸­æ–‡</li></ul></li><li class=github-li><div class=github-star><a class=star-btn href=https://github.com/kubesphere/kubesphere rel="noopener noreferrer" target=_blank><span class=star-img></span>&nbsp;<span>Star</span>
</a><a class=social-count href=https://github.com/kubesphere/kubesphere/stargazers rel="noopener noreferrer" target=_blank></a></div></li><li class=menu-icon><img src=/images/header/menu.svg alt></li></ul></div></div></div><div id=modal-for-menu class=modal><ul class=nav><li data-check=0 class=menu-li><span class=menu-span>Scenarios</span><ul class=dropdown-menu><li><a href=/devops/>Embracing One-stop DevOps Workflow</a></li><li><a href=/service-mesh/>Running Microservices on Kubernetes</a></li><li><a href=/observability/>Building Cloud Native Observability</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>Resources</span><ul class=dropdown-menu><li><a href=/projects/>Open Source Projects</a></li><li><a href=/conferences/>KubeCon & QCon</a></li><li><a href=/blogs/>Technology Blogs</a></li><li><a href=/videos/>Video Resources</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>Documentation</span><ul class=dropdown-menu><li><a href=/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/docs/v3.4>v3.4</a></li><li><a href=/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/en/%20>Extension Development</a></li><li><a href=https://kube.design/>Kube Design</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>Community</span><ul class=dropdown-menu><li><a href=/contribution/>Contribution</a></li><li><a href=/case/>Case Studies</a></li><li><a href=/partner/>Partner</a></li><li><a href=/news/>News</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md>RoadMap</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025>OSPP 2025</a></li></ul></li></ul><div class=link-div><a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank rel="noopener noreferrer" aria-label=slack><img src=/images/header/slack-hover.svg alt>
</a><a href=https://x.com/KubeSphere target=_blank rel="noopener noreferrer" aria-label=twitter><img src=/images/header/twitter-hover.svg alt>
</a><a href=https://github.com/kubesphere/kubesphere target=_blank rel="noopener noreferrer" aria-label=github><img src=/images/header/github-hover.svg alt></a></div></div></header><script>var bindNavMouseEvent,bindScrollChangeHeader,bindClickShowMenu,bindClickModalLi,bindClickClose,language,handleLangClick,githubApiLink="https://api.github.com/repos/kubesphere/kubesphere",getStar=function(){$(".social-count").hide(),$.getJSON(githubApiLink,function(e){$(".social-count").show().html(e.stargazers_count)})};getStar(),bindNavMouseEvent=function(e,t){t||(t=$(e));var n=!1;t.mouseenter(function(){if(n)return!1;n=!0,$(this).find(".dropdown-menu").fadeIn(200,function(){n=!1})}),t.mouseleave(function(){$(this).find(".dropdown-menu").fadeOut(200)})},bindScrollChangeHeader=function(){var t=100,e=$("header");window.addEventListener("scroll",function(){var t=window.scrollY;t>0?e.addClass("navigationScroll"):e.removeClass("navigationScroll")})},bindClickShowMenu=function(){$(".menu-icon").click(function(){$("#modal-for-menu").modal()})},bindClickModalLi=function(){$(".modal .menu-li").click(function(){var e=$(this).data("check");e===0?($(this).data("check",1),$(this).find(".dropdown-menu").slideDown(200)):($(this).data("check",0),$(this).find(".dropdown-menu").slideUp(200)),$(this).find(".menu-span").toggleClass("up")})},bindClickClose=function(){$("#close-join").click(function(){$(".navigation .join-div").hide(),$(".main-section").removeClass("padding")})},language="en",bindClickClose(),bindScrollChangeHeader(),$(".header-container .menu-li").each(function(){bindNavMouseEvent("",$(this))}),bindNavMouseEvent(".header-container .language-menu"),bindNavMouseEvent(".header-container .btn-li"),bindClickShowMenu(),bindClickModalLi(),handleLangClick=function(e,t){try{localStorage.setItem("lang",e)}catch{}location.href=t}</script><section class=main-section><div class=common-layout><div class=breadcrumb><span><a href=/blogs/>Technology Blogs</a> > </span><span>Transform Traditional Applications into Microservices to Enable the Traffic Monitoring Feature</span></div><div class='main-div middle-div'><div class=author>Zackzhang, Bettygogo</div><span class=date>Published onï¼š2021-12-21</span>&nbsp;&nbsp;&nbsp;
<span style=font-size:14px;color:#919aa3 id=busuanzi_container_page_pv>The number of views: <span id=busuanzi_value_page_pv></span></span><h1>Transform Traditional Applications into Microservices to Enable the Traffic Monitoring Feature</h1><div class=share-1><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fblogs%2ftransform-traditional-applications-into-microservices%2f&text=Transform%20Traditional%20Applications%20into%20Microservices%20to%20Enable%20the%20Traffic%20Monitoring%20Feature" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fblogs%2ftransform-traditional-applications-into-microservices%2f&title=Transform%20Traditional%20Applications%20into%20Microservices%20to%20Enable%20the%20Traffic%20Monitoring%20Feature" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fblogs%2ftransform-traditional-applications-into-microservices%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fblogs%2ftransform-traditional-applications-into-microservices%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fblogs%2ftransform-traditional-applications-into-microservices%2f&t=Transform%20Traditional%20Applications%20into%20Microservices%20to%20Enable%20the%20Traffic%20Monitoring%20Feature" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div><div class=content><div class=md-body><h2 id=challenges>Challenges</h2><p>When trying to use service mesh of Kubernetes, most of KubeSphere users only manage to deploy a Bookinfo sample on KubeSphere. They are also struggling in understanding how to explore the full capabilities of service mesh, let alone transform traditional applications into microservices.</p><p>This article describes how to transform a traditional application into microservices to use service mesh features, such as grayscale release, traffic monitoring, and tracing.</p><h2 id=kubesphere-microservices>KubeSphere Microservices</h2><p>KubeSphere microservices use the application CRD to abstract associated resources into a concrete application, and provide traffic monitoring, grayscale release, and tracing features with the help of Istio's application features. Moreover, KubeSphere microservices shield complex DestinationRule and VirtualService of Istio and automatically update resources according to traffic monitoring settings and grayscale release policies.</p><p>Prerequisites for using KubeSphere microservices are as follows:</p><ol><li><p>A deployment must contain labels <code>app</code> and <code>version</code>, and a service must contain the <code>app</code> label. The app labels (equivalent to a service name) of the deployment and the service must be the same (required by Istio).</p></li><li><p>All resources of an application must contain labels app.kubernetes.io/name=<applicationname> and app.kubernetes.io/version=<version> (required by the application).</p></li><li><p>A deployment name must consist of a service name followed by v1. For example, when the service name is nginx, the deployment name is nginx-v1.</p></li><li><p>The deployment template must contain annotations (required during automatic sidecar injection of Istio).</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  template:
</span></span><span style=display:flex><span>    metadata:
</span></span><span style=display:flex><span>      annotations:
</span></span><span style=display:flex><span>        sidecar.istio.io/inject: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span></code></pre></div><ol start=5><li>The service and deployment contain annotations. The KubeSphere CRD Controller automatically matches VirtualService and DestinationRules to the service.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Service</span>
</span></span><span style=display:flex><span>kind: Service
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  annotations:
</span></span><span style=display:flex><span>    servicemesh.kubesphere.io/enabled: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Deployment</span>
</span></span><span style=display:flex><span>kind: Deployment
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  annotations:
</span></span><span style=display:flex><span>    servicemesh.kubesphere.io/enabled: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span></code></pre></div><h2 id=example>Example</h2><p>To implement traffic monitoring, two independent applications are required (for example, WordPress and MySQL). After the two applications work properly, we then transform them into KubeSphere microservices and inject the sidecar.</p><p>Open the <a href=https://hub.docker.com/_/mysql title="mysql dockerhub" target=_blank rel="noopener noreferrer">MySQL Docker Hub</a> page, and you can see explanation of the <code>MYSQL_ROOT_PASSWORD</code> variable. On the KubeSphere web console, set the default MySQL password.</p><p>Open the <a href=https://hub.docker.com/_/wordpress title="wordpress dockerhub" target=_blank rel="noopener noreferrer">WordPress Docker Hub</a> page, and you can see three database variables <code>WORDPRESS_DB_PASSWORD</code> <code>WORDPRESS_DB_USER</code> <code>WORDPRESS_DB_HOST</code>. On the KubeSphere web console, set values of the three variables to connect Wordpress to MySQL.</p><h2 id=create-a-traditional-application>Create a Traditional Application</h2><p>First, create a workspace and a project with the gateway and tracing features enabled.</p><p><img src=/images/blogs/transform-traditional-applications-into-microservices/00-enable-gateway.png alt=00-enable-gateway></p><p>Select <strong>Application Workloads</strong> > <strong>Service</strong>. On the <strong>Service</strong> page, click <strong>Create</strong>. On the <strong>Create Service</strong> page, click <strong>Stateful Service</strong> to create a MySQL service.</p><p><img src=/images/blogs/transform-traditional-applications-into-microservices/01-create-mysql.png alt=01-create-mysql></p><p><img src=/images/blogs/transform-traditional-applications-into-microservices/02-create-mysql.png alt=02-create-mysql></p><p>In <strong>Environment Variables</strong>, set the default password.</p><p><img src=/images/blogs/transform-traditional-applications-into-microservices/03-set-password.png alt=03-set-password></p><p>Likewise, create a stateless WordPress service.</p><p><img src=/images/blogs/transform-traditional-applications-into-microservices/04-create-wp.png alt=04-create-wp></p><p><img src=/images/blogs/transform-traditional-applications-into-microservices/05-create-wp.png alt=05-create-wp></p><p>The following variables are for demonstration only. In production, select <strong>Use ConfigMap or Secret</strong>.</p><p><img src=/images/blogs/transform-traditional-applications-into-microservices/06-create-wp.png alt=06-create-wp></p><p>Select <strong>Edit External Access</strong>, and then change the access mode to <strong>NodePort</strong>.</p><p><img src=/images/blogs/transform-traditional-applications-into-microservices/07-nodeport.png alt=07-nodeport></p><p>After the pods run properly, access the service page at <code>&lt;Service IP address>:&lt;Node port></code>. It can be seen that the application runs properly.</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/1607078616-495561-image.png alt></p><p>Check the pods. It is found that the sidecar is not enabled, and each pod contains only one container.</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/1607078689-536270-image.png alt></p><p>The traffic topology is not displayed because service mesh is not enabled. The following describes how to enable service mesh.</p><h2 id=deploy-an-application>Deploy an Application</h2><ol><li>Apply the following YAML file to deploy an application.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># wordpress.yaml</span>
</span></span><span style=display:flex><span>apiVersion: app.k8s.io/v1beta1
</span></span><span style=display:flex><span>kind: Application
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  annotations:
</span></span><span style=display:flex><span>    kubesphere.io/creator: admin
</span></span><span style=display:flex><span>    servicemesh.kubesphere.io/enabled: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    app.kubernetes.io/name: wordpress-app
</span></span><span style=display:flex><span>    app.kubernetes.io/version: v1
</span></span><span style=display:flex><span>  name: wordpress-app  <span style=color:#75715e># The name of the application must be the same as that defined in label app.kubernetes.io/name.</span>
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  addOwnerRef: true
</span></span><span style=display:flex><span>  componentKinds:
</span></span><span style=display:flex><span>  - group: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    kind: Service
</span></span><span style=display:flex><span>  - group: apps
</span></span><span style=display:flex><span>    kind: Deployment
</span></span><span style=display:flex><span>  - group: apps
</span></span><span style=display:flex><span>    kind: StatefulSet
</span></span><span style=display:flex><span>  - group: extensions
</span></span><span style=display:flex><span>    kind: Ingress
</span></span><span style=display:flex><span>  - group: servicemesh.kubesphere.io
</span></span><span style=display:flex><span>    kind: Strategy
</span></span><span style=display:flex><span>  - group: servicemesh.kubesphere.io
</span></span><span style=display:flex><span>    kind: ServicePolicy
</span></span><span style=display:flex><span>  selector:
</span></span><span style=display:flex><span>    matchLabels:
</span></span><span style=display:flex><span>      <span style=color:#75715e># Tag resources with the following two labels to specify their relationships.</span>
</span></span><span style=display:flex><span>      app.kubernetes.io/name: wordpress-app
</span></span><span style=display:flex><span>      app.kubernetes.io/version: v1
</span></span></code></pre></div><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/1607079099-328486-image.png alt></p><p>The application state is 0/0, which indicates that no applications are associated.</p><blockquote><p>If the application state is not displayed and running the <code>kubectl get app</code> command does not work, it indicates that the CRD of your application is legacy. Run the following command to update the CRD:</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/kubesphere/ks-installer/master/roles/common/files/ks-crds/app.k8s.io_applications.yaml
</span></span></code></pre></div><ol start=2><li>Add labels for the target application to declare services that belong to the application.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n sample label deploy/wordpress-v1 app.kubernetes.io/name<span style=color:#f92672>=</span>wordpress-app app.kubernetes.io/version<span style=color:#f92672>=</span>v1
</span></span><span style=display:flex><span>kubectl -n sample label svc/wordpress app.kubernetes.io/name<span style=color:#f92672>=</span>wordpress-app app.kubernetes.io/version<span style=color:#f92672>=</span>v1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl -n sample label sts/mysql-v1 app.kubernetes.io/name<span style=color:#f92672>=</span>wordpress-app app.kubernetes.io/version<span style=color:#f92672>=</span>v1
</span></span><span style=display:flex><span>kubectl -n sample label svc/wordpress app.kubernetes.io/name<span style=color:#f92672>=</span>wordpress-app app.kubernetes.io/version<span style=color:#f92672>=</span>v1
</span></span></code></pre></div><p>Then, check the application, and you can find that the number of services associated with the application is no longer 0.</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/1607087747-296599-image.png alt></p><ol start=3><li>Add annotations to the target deployment and service.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n sample annotate svc/wordpress servicemesh.kubesphere.io/enabled<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>kubectl -n sample annotate deploy/wordpress-v1 servicemesh.kubesphere.io/enabled<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>kubectl -n sample annotate svc/mysql servicemesh.kubesphere.io/enabled<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>kubectl -n sample annotate sts/mysql-v1 servicemesh.kubesphere.io/enabled<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span>
</span></span></code></pre></div><ol start=4><li>Add annotations to the deploy and sts templates to enable the sidecar.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> kubectl -n sample edit deploy/wordpress-v1
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>  template:
</span></span><span style=display:flex><span>    metadata:
</span></span><span style=display:flex><span>      annotations:
</span></span><span style=display:flex><span>        sidecar.istio.io/inject: <span style=color:#e6db74>&#34;true&#34;</span>  <span style=color:#75715e># Add the row.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl -n sample edit sts/mysql-v1
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>  template:
</span></span><span style=display:flex><span>    metadata:
</span></span><span style=display:flex><span>      annotations:
</span></span><span style=display:flex><span>        sidecar.istio.io/inject: <span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#75715e># Add the row.</span>
</span></span></code></pre></div><blockquote><p>Note: You can inject the sidebar by simply adding annotations to the template.</p></blockquote><p>Check whether the sidecar has been injected.</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/1607088879-407091-image.png alt></p><ol start=5><li>Istio-relevant labels and naming rules must meet the requirements. If you create the service on KubeSphere, you don't need to modify the labels and naming rules.</li></ol><p>For labels relevant to the app version, if you create the service on KubeSphere, labels in the following red boxes are added by default.</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/1607088007-59417-image.png alt></p><h2 id=check-the-transformation-result>Check the Transformation Result</h2><p>After the transformation is completed, check the application page.</p><p><img src=/images/blogs/transform-traditional-applications-into-microservices/08-check-app.png alt=08-check-app></p><p>Expose the WordPress service.</p><p><img src=/images/blogs/transform-traditional-applications-into-microservices/09-expose-port.png alt=09-expose-port></p><p>Access the service, and it can be found that the application works properly.</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/1607089124-868165-image.png alt></p><p>It can be found that the traffic has been visualized, and the data shows that the traffic flows properly.</p><p><img src=/images/blogs/transform-traditional-applications-into-microservices/10-traffic-topology.png alt=10-traffic-topology></p><p>Also, the grayscale release and tracing features function well.</p><p>Note that you need to enable the route feature before using the tracing feature.</p><h2 id=summary>Summary</h2><p>We can successfully transform the application into microservices by performing the previous steps. As the transformation process is tedious, the KubeSphere team will continuously optimize this feature to make transformation easier.</p></div></div><div class=share-2><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fblogs%2ftransform-traditional-applications-into-microservices%2f&text=Transform%20Traditional%20Applications%20into%20Microservices%20to%20Enable%20the%20Traffic%20Monitoring%20Feature" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fblogs%2ftransform-traditional-applications-into-microservices%2f&title=Transform%20Traditional%20Applications%20into%20Microservices%20to%20Enable%20the%20Traffic%20Monitoring%20Feature" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fblogs%2ftransform-traditional-applications-into-microservices%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fblogs%2ftransform-traditional-applications-into-microservices%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fblogs%2ftransform-traditional-applications-into-microservices%2f&t=Transform%20Traditional%20Applications%20into%20Microservices%20to%20Enable%20the%20Traffic%20Monitoring%20Feature" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div></div><div class=aside><div class=inner-div><div class=title>Table of Contents</div><div class=tabs><nav id=TableOfContents><ul><li><a href=#challenges>Challenges</a></li><li><a href=#kubesphere-microservices>KubeSphere Microservices</a></li><li><a href=#example>Example</a></li><li><a href=#create-a-traditional-application>Create a Traditional Application</a></li><li><a href=#deploy-an-application>Deploy an Application</a></li><li><a href=#check-the-transformation-result>Check the Transformation Result</a></li><li><a href=#summary>Summary</a></li></ul></nav></div></div></div></div></section><div class=SubscribeForm><div class=innerBox><img class=close src=/images/home/close.svg alt=close><p class=description>Receive the latest news, articles and updates from KubeSphere</p><div id=blog_formAddress data-usesendcloud=false><form action="https://kubesphere.us10.list-manage.com/subscribe/post?u=c85ea2b944b08b951f607bdd4&amp;id=83f673a2d9" method=post target=_blank novalidate><input name=EMAIL id=email-input-blog type=text placeholder='Please enter your email address'>
<button type=submit id=email-submit-blog>Subscribe</button></form><span id=message_blog data-message1='email is required!' data-message2='Please enter a valid email address!'></span></div></div></div><footer><div class=footer><div class="footer-main common-layout"><div class=up-main><div class=left-div><img src=/images/logo.svg alt class=foot-logo><p>Receive the latest news, articles and updates from KubeSphere</p><div id=formAddress data-usesendcloud=false><form action="https://kubesphere.us10.list-manage.com/subscribe/post?u=c85ea2b944b08b951f607bdd4&amp;id=83f673a2d9" method=post target=_blank novalidate><input name=EMAIL id=email-input type=text placeholder='Please enter your email address'>
<button type=submit id=email-submit>Subscribe</button></form></div><span id=message data-message1='email is required!' data-message2='Please enter a valid email address!'></span>
<script>var bindSubmit=function(){var e=$("#email-input");$("#email-submit").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message").data("message1"),a=$("#message").data("message2"),r=$("#message").data("message3"),c=$("#message1").data("success");if(n)if(validateEmail(n)){if(s=$("#formAddress").data("usesendcloud"),!s)return;o=$("#formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:$("#email-input").val().toString()},success:function(){showSuccessMessage(c),setTimeout(function(){$("#email-input").val("")},1e3)},error:function(){showMessage(r)}})}else t.preventDefault(),showMessage(a);else t.preventDefault(),showMessage(i)})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},showMessage=function(e){$("#message").html(e).show()},showSuccessMessage=function(e){$("#message1").html(e).show()},bindHideMessage=function(){$(window).click(function(){$("#message").hide(),$("#message1").hide()})},bindClose=function(){$(".formBox .close").click(function(e){e.stopPropagation(),$(".formBox").fadeOut()})};bindSubmit(),bindClose(),bindHideMessage()</script><span id=message data-message1='email is required!' data-message2='Please enter a valid email address!'></span></div><div class=right-div><ul class=common-flex-layout><li class=nowrap-li><div class=h3>Scenarios</div><a href=/devops/>Kubernetes DevOps and GitOps</a>
<a href=/service-mesh/>Microservices with Service Mesh</a>
<a href=/observability/>Cloud Native Observability</a>
<a href=https://github.com/OpenFunction/OpenFunction target=_blank rel="noopener noreferrer">Functions-as-a-Service Platform and Serverless</a>
<a href=https://github.com/openpitrix/openpitrix target=_blank rel="noopener noreferrer">Multi-cloud Apps Mgmt</a></li><li class=nowrap-li><div class=h3>Resources</div><a href=/projects/>Projects</a>
<a href=/blogs/>Blogs</a>
<a href=/conferences/>KubeCon & QCon</a>
<a href=/videos/>Videos</a></li><li class=nowrap-li><div class=h3>KubeSphere Docs</div><a href=/docs/v4.1/01-intro/01-introduction/>Introduction</a>
<a href=/docs/v4.1/03-installation-and-upgrade/02-install-kubesphere/02-install-kubernetes-and-kubesphere/>Installation</a>
<a href=/docs/v4.1/02-quickstart/>Tutorial</a>
<a href=/docs/v3.4/reference/api-docs/>API Documentation</a></li><li class=nowrap-li><div class=h3>Community</div><a href=/contribution/>Contribution</a>
<a href=/case/>Case Studies</a>
<a href=/partner/>Partners</a>
<a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">Roadmap</a>
<a href=https://kubesphere.io target=_blank rel="noopener noreferrer">Global Site</a>
<a href=https://kubesphere.com.cn/ target=_blank rel="noopener noreferrer">China Site</a></li><li class=nowrap-li><div class=h3>Products and Services</div><a href=https://aws.amazon.com/quickstart/architecture/qingcloud-kubesphere/ target=_blank rel="noopener noreferrer">KubeSphere on AWS</a>
<a href=https://market.azure.cn/marketplace/apps/qingcloud.kubesphere target=_blank rel="noopener noreferrer">KubeSphere on Azure</a>
<a href=https://marketplace.digitalocean.com/apps/kubesphere target=_blank rel="noopener noreferrer">KubeSphere on DigitalOcean</a>
<a href=https://www.qingcloud.com/products/kubesphereqke target=_blank rel="noopener noreferrer">KubeSphere on QingCloud(QKE)</a>
<a href=https://kubesphere.co/kse/ target=_blank rel="noopener noreferrer">KubeSphere Enterprise</a>
<a href=https://kubesphere.co/marketplace/ target=_blank rel="noopener noreferrer">KubeSphere Extensions Marketplace</a>
<a href=https://kubesphere.co/ksv/ target=_blank rel="noopener noreferrer">KubeSphere Virtualization Platform</a>
<a href=https://kubesphere.cloud target=_blank rel="noopener noreferrer">Cloud Native Services and Support</a>
<a href=https://jinshuju.net/f/bDS8me target=_blank rel="noopener noreferrer">Contact Us</a></li></ul></div></div><div class=down-main><div class=img-div><a class=wechat href=javascript:void(0); aria-label=wechat><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28"><defs><path id="a" d="M0 0h15.673v12.156H0z"/></defs><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="13" cy="13" r="13" stroke="#B6C2CD"/><g transform="translate(5 7)"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59.0-4.625 1.679-4.625 3.74.0 2.066 2.035 3.738 4.625 3.738.542.0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27.0-.541-.257-.541-.514.0-.256.27-.514.541-.514.41.0.681.258.681.514.0.257-.271.514-.681.514zm2.994.0c-.27.0-.541-.257-.541-.514.0-.256.27-.514.54-.514.41.0.681.258.681.514.0.257-.277.514-.68.514z" mask="url(#b)"/><path fill="currentColor" d="M10.602 3.674c.177.0.356.011.533.029C10.657 1.576 8.27.0 5.543.0 2.498.0.0 1.974.0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17.0.343-.005.515-.022a3.68 3.68.0 01-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417.0.693.263.693.66s-.276.66-.693.66c-.418.0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417.0-.834-.263-.834-.66s.417-.66.834-.66c.418.0.695.263.695.66.0.392-.277.66-.695.66z" mask="url(#b)"/></g></g></svg><div class=hide-div><img src=/images/home/wechat.svg alt></div></a><a class=facebook-a href=https://www.facebook.com/kubesphere target=_blank aria-label=facebook></a><a class=twitter-a href=https://x.com/KubeSphere target=_blank aria-label=twitter rel="noopener noreferrer"></a><a class=linkedin-a href=https://www.linkedin.com/company/kubesphere/ target=_blank aria-label=linkedin rel="noopener noreferrer"></a><a class=youtube-a href=https://www.youtube.com/c/KubeSphere target=_blank aria-label=youtube rel="noopener noreferrer"></a><a class=slack-a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank aria-label=slack rel="noopener noreferrer"></a><a class=github-a href=https://github.com/kubesphere/kubesphere target=_blank aria-label=github rel="noopener noreferrer"></a><a class=medium-a href=https://itnext.io/@kubesphere target=_blank aria-label=medium rel="noopener noreferrer"></a></div><p class=p1></p></div></div></div><div class=cookie><div class=common-layout><p>Your privacy is important to us. We use cookies to remember subscription details, optimize site functionality, and deliver content tailored to your interests. To find out more, see our <a href=/privacy>privacy policy</a>.</p><button>
Accept and continue</button></div></div></footer><script>var lazyLoad=function(e,t){for(var n,o,i,s=0;s<t;s++){if(n=e.eq(s),o=n.attr("data-loaded"),o)continue;n.offset().top<parseInt($(window).height())+parseInt($(window).scrollTop())&&(i=n.attr("src"),n.attr("src",i),n.attr("data-loaded",!0))}},bindLayLoad=function(){var e=$("img"),t=e.length;lazyLoad(e,t),$(window).scroll(function(){lazyLoad(e,t)})},bindAddPadding=function(){var e=$("#close-join");e.length>0&&$(".main-section").addClass("padding")},docCookies={getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t){return!!e&&!/^(?:expires|max-age|path|domain|secure)$/i.test(e)&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t),!0)}},bindHideCookie=function(){var t=docCookies.getItem("hasAuth"),e=$(".cookie");t?e.hide():e.show(),e.find("button").on("click",function(){docCookies.setItem("hasAuth","1"),e.hide()})};bindAddPadding(),bindHideCookie()</script><script type=text/javascript src=/js/aside.2d6977c0f16aef4ed3e886dd66675ce74bd0efcd467c2b2bcdb30b92d5e7c7c0e5c6e0c9d8f09a883c22f58df9e6b0b6347fcdd3c9a920b7faba6d7f91a201c3.js integrity="sha512-LWl3wPFq707T6IbdZmdc50vQ781GfCsrzbMLktXnx8DlxuDJ2PCaiDwi9Y355rC2NH/N08mpILf6um1/kaIBww=="></script><script type=text/javascript src=/js/markdown-tab.17f9f46b021adebc7250ce1b07134a577b307e7a436daa4aaf388f218e8463966f53770b26a64817c06c168738a887672d47fb4c29615adfc446e11d09a344cf.js integrity="sha512-F/n0awIa3rxyUM4bBxNKV3swfnpDbapKrziPIY6EY5ZvU3cLJqZIF8BsFoc4qIdnLUf7TClhWt/ERuEdCaNEzw=="></script><script>let forbidForm=!1;var viewer=new Viewer(document.querySelector(".md-body"),{url:"src"}),blogBindSubmit=function(){var e=$("#email-input-blog");$("#email-submit-blog").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message_blog").data("message1"),a=$("#message_blog").data("message2"),r=$("#message_blog").data("message3"),c=$("#message1_blog").data("success");if(n)if(validateEmail(n)){if(s=$("#blog_formAddress").data("usesendcloud"),!s)return;o=$("#blog_formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:n.toString()},success:function(){showSuccessMessage_blog(c),setTimeout(function(){window.onscroll="",$(".SubscribeForm").hide(),$("#email-input-blog").val("")},5e3)},error:function(){showMessage_blog(r)}})}else t.preventDefault(),$("#message_blog").html(a).show();else t.preventDefault(),$("#message_blog").html(i).show()})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},bindHideMessageBlog=function(){$(window).click(function(){$("#message_blog").hide()})},bindCloseBlog=function(){$(".SubscribeForm .close").click(function(e){e.stopPropagation(),$(".SubscribeForm").fadeOut(),window.onscroll=""})},showMessage_blog=function(e){$("#message_blog").html(e).show()},showSuccessMessage_blog=function(e){$("#message1_blog").html(e).show()};window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;forbidForm&&(window.onscroll=""),e+t>n-710?$(".SubscribeForm").hide():$(".SubscribeForm").show()},blogBindSubmit(),bindCloseBlog(),bindHideMessageBlog()</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>