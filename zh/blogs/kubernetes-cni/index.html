<!doctype html><html lang=en-US><head><meta charset=utf-8><title>Kubernetes CNI æ’ä»¶é€‰å‹å’Œåº”ç”¨åœºæ™¯æ¢è®¨</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="æœ¬æ–‡ä»‹ç»å®¹å™¨ç¯å¢ƒå¸¸è§ç½‘ç»œåº”ç”¨åœºæ™¯åŠå¯¹åº”åœºæ™¯çš„ Kubernetes CNI æ’ä»¶åŠŸèƒ½å®ç°,å¸®åŠ©æ­å»ºå’Œä½¿ç”¨äº‘åŸç”Ÿç¯å¢ƒçš„å°ä¼™ä¼´å¿«é€Ÿé€‰æ‹©å¿ƒä»ªçš„ç½‘ç»œå·¥å…·ã€‚"><meta name=keywords content="KubeSphere,Kubernetes,CNI,Cilium,Calico,Kube-OVN,Antrea,Submariner"><meta property="og:type" content="article"><meta property="og:title" content="Kubernetes CNI æ’ä»¶é€‰å‹å’Œåº”ç”¨åœºæ™¯æ¢è®¨"><meta property="og:description" content="æœ¬æ–‡ä»‹ç»å®¹å™¨ç¯å¢ƒå¸¸è§ç½‘ç»œåº”ç”¨åœºæ™¯åŠå¯¹åº”åœºæ™¯çš„ Kubernetes CNI æ’ä»¶åŠŸèƒ½å®ç°,å¸®åŠ©æ­å»ºå’Œä½¿ç”¨äº‘åŸç”Ÿç¯å¢ƒçš„å°ä¼™ä¼´å¿«é€Ÿé€‰æ‹©å¿ƒä»ªçš„ç½‘ç»œå·¥å…·ã€‚"><meta property="og:image" content="https://pek3b.qingstor.com/kubesphere-community/images/202211081650620.jpg"><meta property="og:url" content="https://openksc.github.io/zh/blogs/kubernetes-cni/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeSphere"><meta property="twitter:image" content="https://pek3b.qingstor.com/kubesphere-community/images/202211081650620.jpg"><meta name=docsearch:language content="zh-CN"><meta name=docsearch:version content><link rel=canonical href=https://kubesphere.io/zh/blogs/kubernetes-cni/><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=apple-touch-icon href=/images/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/svg+xml href=/images/favicons/favicon.svg><link rel=icon type=image/png href=/images/favicons/favicon.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg color=#00ad6e><meta name=msapplication-config content='/images/favicons/browserconfig.xml'><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/fonts/Roboto/stylesheet.css><link rel=stylesheet href=/fonts/ProximaNova/stylesheet.css><link rel=stylesheet href=/css/jquery.modal.min.css><link rel=stylesheet href=/css/viewer.min.css><link rel=stylesheet href=/swiper/swiper-bundle.min.css><link rel=stylesheet href=/scss/common.min.0c3fdcc05ec210321169846714f74b11c4a1baf09a1833fa9273b2347c81e636.css><script src=/js/jquery-3.7.1.min.js></script><script src=/js/viewer.min.js></script><script src=/js/jquery.modal.min.js></script><script src=/swiper/swiper-bundle.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0888981f1fa45d241b1fb6962da2963e",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YYCVN36HT5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YYCVN36HT5")</script><script type=text/javascript>!function(e,t,n,s,o){e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=("https:"==document.location.protocol?"https://":"http://")+s,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio"),gio("init","8a24ae300cbf8b8c",{}),gio("send")</script><link rel=stylesheet href=/scss/content.min.f73b326fbf8c5bd331900b0de21c7dde608a4926f482f6465f9ae1d9049b83ad.css><link rel=stylesheet href=/scss/markdown.min.db47186481122431dffae72d17dbbd51f90b66f022cc163458645709924e4eac.css></head><body><header class=navigation><div class=join-div><div class=content>ğŸš€ KubeSphere v4.1.3 å‘å¸ƒï¼Œå¤šé¡¹ä¼˜åŒ–ä¸æ”¹è¿›ï¼Œæ¬¢è¿ä½“éªŒï¼<a href=/zh/docs/v4.1/20-release-notes/release-v413/ target=_blank rel="noopener noreferrer">è¯·æŸ¥çœ‹ Release notes â†’</a>
<img id=close-join src=/images/header/close.svg alt=close></div></div><div class=common-layout><div class=header-container><a href=/zh/ aria-label=logo><img src=/images/header/logo.svg alt class=logo></a><ul class=nav><li class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class="dropdown-menu menu-2"><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li class=menu-li><span class=menu-span>èµ„æº</span><ul class="dropdown-menu menu-3"><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class="dropdown-menu menu-4"><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/ target=_blank rel="noopener noreferrer">æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/ target=_blank rel="noopener noreferrer">Kube Design</a></li></ul></li><li class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class="dropdown-menu menu-5"><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025 target=_blank rel="noopener noreferrer">å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/ target=_blank rel="noopener noreferrer">è®¤è¯</a></li></ul><div class=right-menu><ul><li class=language-menu><div><img src=/images/header/black.svg alt>
<span>ç®€ä½“ä¸­æ–‡</span></div><ul class=dropdown-menu><li onclick='handleLangClick("zh","/zh/blogs/kubernetes-cni/")'>ç®€ä½“ä¸­æ–‡</li></ul></li><li class=github-li><div class=github-star><a class=star-btn href=https://github.com/kubesphere/kubesphere rel="noopener noreferrer" target=_blank><span class=star-img></span>&nbsp;<span>Star</span>
</a><a class=social-count href=https://github.com/kubesphere/kubesphere/stargazers rel="noopener noreferrer" target=_blank></a></div></li><li class=menu-icon><img src=/images/header/menu.svg alt></li></ul></div></div></div><div id=modal-for-menu class=modal><ul class=nav><li data-check=0 class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class=dropdown-menu><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>èµ„æº</span><ul class=dropdown-menu><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class=dropdown-menu><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/>æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/>Kube Design</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class=dropdown-menu><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md>ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/>ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025>å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum>ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/>è®¤è¯</a></li></ul><div class=link-div><a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank rel="noopener noreferrer" aria-label=slack><img src=/images/header/slack-hover.svg alt>
</a><a href=https://x.com/KubeSphere target=_blank rel="noopener noreferrer" aria-label=twitter><img src=/images/header/twitter-hover.svg alt>
</a><a href=https://github.com/kubesphere/kubesphere target=_blank rel="noopener noreferrer" aria-label=github><img src=/images/header/github-hover.svg alt></a></div></div></header><script>var bindNavMouseEvent,bindScrollChangeHeader,bindClickShowMenu,bindClickModalLi,bindClickClose,language,handleLangClick,githubApiLink="https://api.github.com/repos/kubesphere/kubesphere",getStar=function(){$(".social-count").hide(),$.getJSON(githubApiLink,function(e){$(".social-count").show().html(e.stargazers_count)})};getStar(),bindNavMouseEvent=function(e,t){t||(t=$(e));var n=!1;t.mouseenter(function(){if(n)return!1;n=!0,$(this).find(".dropdown-menu").fadeIn(200,function(){n=!1})}),t.mouseleave(function(){$(this).find(".dropdown-menu").fadeOut(200)})},bindScrollChangeHeader=function(){var t=100,e=$("header");window.addEventListener("scroll",function(){var t=window.scrollY;t>0?e.addClass("navigationScroll"):e.removeClass("navigationScroll")})},bindClickShowMenu=function(){$(".menu-icon").click(function(){$("#modal-for-menu").modal()})},bindClickModalLi=function(){$(".modal .menu-li").click(function(){var e=$(this).data("check");e===0?($(this).data("check",1),$(this).find(".dropdown-menu").slideDown(200)):($(this).data("check",0),$(this).find(".dropdown-menu").slideUp(200)),$(this).find(".menu-span").toggleClass("up")})},bindClickClose=function(){$("#close-join").click(function(){$(".navigation .join-div").hide(),$(".main-section").removeClass("padding")})},language="zh",bindClickClose(),bindScrollChangeHeader(),$(".header-container .menu-li").each(function(){bindNavMouseEvent("",$(this))}),bindNavMouseEvent(".header-container .language-menu"),bindNavMouseEvent(".header-container .btn-li"),bindClickShowMenu(),bindClickModalLi(),handleLangClick=function(e,t){try{localStorage.setItem("lang",e)}catch{}location.href=t}</script><section class=main-section><div class=common-layout><div class=breadcrumb><span><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a> > </span><span>Kubernetes CNI æ’ä»¶é€‰å‹å’Œåº”ç”¨åœºæ™¯æ¢è®¨</span></div><div class='main-div middle-div'><div class=author>é©¬ä¼Ÿ</div><span class=date>å‘å¸ƒäºï¼š2022-11-02</span>&nbsp;&nbsp;&nbsp;
<span style=font-size:14px;color:#919aa3 id=busuanzi_container_page_pv>æœ¬æ–‡æ€»é˜…è¯»é‡ï¼š<span id=busuanzi_value_page_pv></span></span><h1>Kubernetes CNI æ’ä»¶é€‰å‹å’Œåº”ç”¨åœºæ™¯æ¢è®¨</h1><div class=share-1><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-cni%2f&text=Kubernetes%20CNI%20%e6%8f%92%e4%bb%b6%e9%80%89%e5%9e%8b%e5%92%8c%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af%e6%8e%a2%e8%ae%a8" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-cni%2f&title=Kubernetes%20CNI%20%e6%8f%92%e4%bb%b6%e9%80%89%e5%9e%8b%e5%92%8c%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af%e6%8e%a2%e8%ae%a8" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-cni%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-cni%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-cni%2f&t=Kubernetes%20CNI%20%e6%8f%92%e4%bb%b6%e9%80%89%e5%9e%8b%e5%92%8c%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af%e6%8e%a2%e8%ae%a8" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div><div class=content><div class=md-body><blockquote><p>ä½œè€…ï¼šé©¬ä¼Ÿï¼Œé’äº‘ç§‘æŠ€å®¹å™¨é¡¾é—®ï¼Œäº‘åŸç”Ÿçˆ±å¥½è€…ï¼Œç›®å‰ä¸“æ³¨äºäº‘åŸç”ŸæŠ€æœ¯ï¼Œäº‘åŸç”Ÿé¢†åŸŸæŠ€æœ¯æ ˆæ¶‰åŠ Kubernetesã€KubeSphereã€KubeKey ç­‰ã€‚</p></blockquote><p>æœ¬æ–‡ä»‹ç»å®¹å™¨ç¯å¢ƒå¸¸è§ç½‘ç»œåº”ç”¨åœºæ™¯åŠå¯¹åº”åœºæ™¯çš„ Kubernetes CNI æ’ä»¶åŠŸèƒ½å®ç°ã€‚å¸®åŠ©æ­å»ºå’Œä½¿ç”¨äº‘åŸç”Ÿç¯å¢ƒçš„å°ä¼™ä¼´å¿«é€Ÿé€‰æ‹©å¿ƒä»ªçš„ç½‘ç»œå·¥å…·ã€‚</p><h2 id=å¸¸è§ç½‘ç»œæ’ä»¶>å¸¸è§ç½‘ç»œæ’ä»¶</h2><p>æˆ‘ä»¬åœ¨å­¦ä¹ å®¹å™¨ç½‘ç»œçš„æ—¶å€™ï¼Œè‚¯å®šéƒ½å¬è¯´è¿‡ Docker çš„ bridge ç½‘ç»œï¼ŒVethpairï¼ŒVxLAN ç­‰æœ¯è¯­ï¼Œä» Docker åˆ° kubernetes åï¼Œå­¦ä¹ äº† Flannelã€Calico ç­‰ä¸»æµç½‘ç»œæ’ä»¶ï¼Œåˆ†åˆ«ä»£è¡¨äº† Overlay å’Œ Underlay çš„ä¸¤ç§ç½‘ç»œä¼ è¾“æ¨¡å¼ï¼Œä¹Ÿæ˜¯å¾ˆç»å…¸çš„ä¸¤æ¬¾ CNI ç½‘ç»œæ’ä»¶ã€‚é‚£ä¹ˆï¼Œè¿˜æœ‰å“ªäº›å¥½ç”¨çš„ CNI æ’ä»¶å‘¢ ? æˆ‘ä»¬çœ‹çœ‹ CNCF Landscape:</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/202211021601323.png alt></p><p>æŠ›å»å•†ä¸šç‰ˆ CNIï¼Œæ­¤æ¬¡åˆ†äº«æ¥èŠèŠå‡ æ¬¾çƒ­é—¨å¼€æº CNI æ’ä»¶ï¼Œåˆ†åˆ«ä¸º <a href=https://www.kube-ovn.io/ target=_blank rel="noopener noreferrer">Kube-OVN</a>ã€<a href=https://antrea.io/ target=_blank rel="noopener noreferrer">Antrea</a>ã€<a href=https://cilium.io/ target=_blank rel="noopener noreferrer">Cilium</a>ã€‚Kube-OVN å’Œ Antrea éƒ½æ˜¯åŸºäº OpenvSwitch çš„é¡¹ç›®ï¼ŒCilium ä½¿ç”¨ eBPF è¿™æ¬¾é©å‘½æ€§çš„æŠ€æœ¯ä½œä¸ºæ•°æ®è·¯å¾„ï¼Œäº¦æ˜¯è¿™ä¸¤å¹´å¾ˆç«çƒ­çš„ä¸€ä¸ªå¼€æºå®¹å™¨é¡¹ç›®ã€‚</p><p>é‚£ä¹ˆï¼Œåˆå›åˆ°å­¦ä¹ æ–°äº§å“çš„ç¬¬ä¸€æ­¥ï¼Œå¦‚ä½•å¿«é€Ÿéƒ¨ç½² K8s ä½“éªŒä¸åŒåœ° CNI æ’ä»¶å‘¢ï¼Ÿè¿˜æ˜¯äº¤ç»™æˆ‘ä»¬äº²çˆ±çš„ Kubekey å§ã€‚</p><p><a href=https://github.com/kubesphere/kubekey target=_blank rel="noopener noreferrer">Kubekey</a> ä½œä¸ºä¸€ä¸ªå¼€æºçš„ Kubernetes å’Œ <a href=https://kubesphere.com.cn/ target=_blank rel="noopener noreferrer">KubeSphere</a> é›†ç¾¤éƒ¨ç½²å·¥å…·ï¼Œå¯ä»¥è½»æ¾çš„éƒ¨ç½² Kubernetes é›†ç¾¤ï¼Œæä¾›èŠ‚ç‚¹ç®¡ç†ã€æ“ä½œç³»ç»Ÿå®‰å…¨åŠ å›ºã€å®¹å™¨è¿è¡Œæ—¶ç®¡ç†ã€ç½‘ç»œå­˜å‚¨å®‰è£…ã€Etcd ç®¡ç†ç­‰ã€‚Kubekey æ”¯æŒä¸€é”®éƒ¨ç½² Calico / Flannel / Cilium / Kube-OVN ç­‰ç½‘ç»œæ’ä»¶ï¼Œåªéœ€åœ¨ kk çš„é…ç½®æ–‡ä»¶ä¸­æ³¨æ˜ network çš„ plugin å€¼å³å¯ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>  <span style=color:#f92672>network</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>plugin</span>: <span style=color:#ae81ff>calico/kubeovn/cilium</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kubePodsCIDR</span>: <span style=color:#ae81ff>10.233.64.0</span><span style=color:#ae81ff>/18</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kubeServiceCIDR</span>: <span style=color:#ae81ff>10.233.0.0</span><span style=color:#ae81ff>/18</span>
</span></span></code></pre></div><p>å¯¹äº antreaï¼Œç”±äºç‰ˆæœ¬è¾ƒæ–°ï¼Œç›®å‰å¯é€šè¿‡ addon çš„å½¢å¼æ·»åŠ  helm æ–‡ä»¶çš„å½¢å¼è¿›è¡Œä¸€é”®å®‰è£…ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>  <span style=color:#f92672>addons</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>antrea</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>kube-system</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>sources</span>: 
</span></span><span style=display:flex><span>      <span style=color:#f92672>chart</span>: 
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#ae81ff>antrea</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>repo</span>: <span style=color:#ae81ff>https://charts.antrea.io</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># values:</span>
</span></span></code></pre></div><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸€æ¡å‘½ä»¤</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ğŸ³  â†’ kk create cluster --with-kubernetes --with-kubesphere
</span></span></code></pre></div><p>åˆ›å»ºä¸€ä¸ª kubernetes é›†ç¾¤å¹¶å®‰è£… KubeSphereï¼Œåœ¨æ­¤ä¹‹ä¸Šä½“éªŒä¸åŒçš„ CNI åœ¨ Kubernetes çš„åŠŸèƒ½åº”ç”¨ã€‚æ¯•ç«Ÿï¼Œå“ªä¸ªè¿ç»´äººå‘˜ä¸å–œæ¬¢é¡µé¢å‹å¥½çš„å®¹å™¨ç®¡ç†å¹³å°å‘¢ï¼Ÿ</p><p><img src=https://files.mdnice.com/user/2166/0bc316fd-d837-4199-9b7d-3f483a5051c3.png alt></p><h2 id=ç½‘ç»œåº”ç”¨åœºæ™¯>ç½‘ç»œåº”ç”¨åœºæ™¯</h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ª Kubernetes é›†ç¾¤ï¼Œå…ˆæ¥æ€è€ƒä¸€ä¸‹ï¼Œå®¹å™¨ç½‘ç»œé™¤äº†è®©é›†ç¾¤æ­£å¸¸è¿è¡Œï¼Œèƒ½è®©å®‰è£… Kubernetes å Pending çš„ CoreDNS running èµ·æ¥ï¼ˆæŠ–ä¸ªé¸¡çµ-_-ï¼‰ä»¥å¤–è¿˜æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/202211021602337.png alt></p><p>è¿™é‡Œæˆ‘é€šè¿‡ä¸€å¼ å›¾æ€»ç»“äº†ä¸ƒä¸ªä¸»è¦ä½¿ç”¨çš„åœºæ™¯ï¼Œåº”è¯¥ä¹Ÿæ¶µç›–å¤§éƒ¨åˆ†è¿ç»´äººå‘˜ç½‘ç»œéœ€æ±‚ã€‚</p><ul><li><strong>å›ºå®š IP</strong>ã€‚å¯¹äºç°å­˜è™šæ‹ŸåŒ– / è£¸æœºä¸šåŠ¡ / å•ä½“åº”ç”¨è¿ç§»åˆ°å®¹å™¨ç¯å¢ƒåï¼Œéƒ½æ˜¯é€šè¿‡ IP è€ŒéåŸŸåè¿›è¡ŒæœåŠ¡é—´è°ƒç”¨ï¼Œæ­¤æ—¶å°±éœ€è¦ CNI æ’ä»¶æœ‰å›ºå®š IP çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ Pod/Deployment/Statefulsetã€‚</li><li><strong>ç½‘ç»œéš”ç¦»</strong>ã€‚ä¸åŒç§Ÿæˆ·æˆ–ä¸åŒåº”ç”¨ä¹‹é—´ï¼Œå®¹å™¨ç»„åº”è¯¥æ˜¯ä¸èƒ½äº’ç›¸è°ƒç”¨æˆ–é€šä¿¡çš„ã€‚</li><li><strong>å¤šé›†ç¾¤ç½‘ç»œäº’è”</strong>ã€‚ å¯¹äºä¸åŒçš„ Kubernetes é›†ç¾¤ä¹‹é—´çš„å¾®æœåŠ¡è¿›è¡Œäº’ç›¸è°ƒç”¨çš„åœºæ™¯ï¼Œéœ€è¦å¤šé›†ç¾¤ç½‘ç»œäº’è”ã€‚è¿™ç§åœºæ™¯ä¸€èˆ¬åˆ†ä¸º IP å¯è¾¾å’Œ Service äº’é€šï¼Œæ»¡è¶³ä¸åŒçš„å¾®æœåŠ¡å®ä¾‹äº’ç›¸è°ƒç”¨éœ€æ±‚ã€‚</li><li><strong>å‡ºå‘é™åˆ¶</strong>ã€‚å¯¹äºå®¹å™¨é›†ç¾¤å¤–çš„æ•°æ®åº“ / ä¸­é—´ä»¶ï¼Œéœ€èƒ½æ§åˆ¶ç‰¹å®šå±æ€§çš„å®¹å™¨åº”ç”¨æ‰å¯è®¿é—®ï¼Œæ‹’ç»å…¶ä»–è¿æ¥è¯·æ±‚ã€‚</li><li><strong>å…¥å‘é™åˆ¶</strong>ã€‚é™åˆ¶é›†ç¾¤å¤–åº”ç”¨å¯¹ç‰¹å®šå®¹å™¨åº”ç”¨çš„è®¿é—®ã€‚</li><li><strong>å¸¦å®½é™åˆ¶</strong>ã€‚å®¹å™¨åº”ç”¨ä¹‹é—´çš„ç½‘ç»œè®¿é—®åŠ ä»¥å¸¦å®½é™åˆ¶ã€‚</li><li><strong>å‡ºå£ç½‘å…³è®¿é—®</strong>ã€‚å¯¹äºè®¿é—®é›†ç¾¤å¤–ç‰¹å®šåº”ç”¨çš„å®¹å™¨ï¼Œè®¾ç½®å‡ºå£ç½‘å…³å¯¹å…¶è¿›è¡Œ SNAT ä»¥è¾¾åˆ°ç»Ÿä¸€å‡ºå£è®¿é—®çš„å®¡è®¡å’Œå®‰å…¨éœ€æ±‚ã€‚
ç†å®Œéœ€æ±‚å’Œåº”ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡ä¸åŒçš„ CNI æ’ä»¶è§£å†³ä»¥ä¸Šç—›ç‚¹ã€‚</li></ul><h2 id=ç½‘ç»œæ’ä»¶åŠŸèƒ½å®ç°>ç½‘ç»œæ’ä»¶åŠŸèƒ½å®ç°</h2><h3 id=å›ºå®š-ip>å›ºå®š IP</h3><p>åŸºæœ¬ä¸Šä¸»æµ CNI æ’ä»¶éƒ½æœ‰è‡ªå·±çš„ IPAM æœºåˆ¶ï¼Œéƒ½æ”¯æŒå›ºå®š IP åŠ IP Pool çš„åˆ†é…ï¼Œå¹¶ä¸”å„ä¸ª CNI æ’ä»¶æ®Šé€”åŒå½’çš„éƒ½ä½¿ç”¨äº† Annotation çš„æ–¹å¼æŒ‡å®šå›ºå®š IPã€‚å¯¹äº Podï¼Œåˆ†é…å›ºå®š IPï¼Œå¯¹äº Deploymentï¼Œä½¿ç”¨ IP Pool çš„æ–¹å¼åˆ†é…ã€‚å¯¹äºæœ‰çŠ¶æ€çš„ Statefulsetï¼Œä½¿ç”¨ IP Pool åˆ†é…åï¼Œä¼šæ ¹æ® Pool çš„åˆ†é…é¡ºåºè®°å¥½ Pod çš„ IPï¼Œä»¥ä¿è¯åœ¨ Pod é‡å¯åä»èƒ½æ‹¿åˆ°åŒæ ·çš„ IPã€‚</p><h4 id=calico>Calico</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>  <span style=color:#f92672>&#34;cni.projectcalico.org/ipAddrs&#34;: </span><span style=color:#e6db74>&#34;[\&#34;192.168.0.1\&#34;]&#34;</span>
</span></span></code></pre></div><h4 id=kube-ovn>Kube-OVN</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>ovn.kubernetes.io/ip_address</span>: <span style=color:#ae81ff>192.168.100.100</span>
</span></span><span style=display:flex><span><span style=color:#f92672>ovn.kubernetes.io/ip_pool</span>: <span style=color:#ae81ff>192.168.100.201</span>,<span style=color:#ae81ff>192.168.100.202</span>
</span></span></code></pre></div><h4 id=antrea>Antrea</h4><p>Antrea IPAM åªèƒ½åœ¨ Bridge æ¨¡å¼ä¸‹ä½¿ç”¨ï¼Œå› æ­¤å¯ä»¥åœ¨ Multus çš„è¾…ä½ä¸‹ï¼Œä¸»ç½‘å¡ä½¿ç”¨ NodeIPAM åˆ†é…ï¼Œå‰¯ç½‘å¡ä½¿ç”¨ Antrea IPAM åˆ†é… VLAN ç±»å‹ç½‘ç»œåœ°å€ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>    <span style=color:#f92672>ipam.antrea.io/ippools</span>: <span style=color:#e6db74>&#39;pod-ip-pool1&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ipam.antrea.io/pod-ips</span>: <span style=color:#e6db74>&#39;&lt;ip-in-pod-ip-pool1&gt;&#39;</span>
</span></span></code></pre></div><h4 id=cilium>Cilium</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>Not Yet!</span>
</span></span></code></pre></div><h3 id=å¤šé›†ç¾¤ç½‘ç»œäº’è”>å¤šé›†ç¾¤ç½‘ç»œäº’è”</h3><p>å¯¹äºå¤šé›†ç¾¤ç½‘ç»œäº’è”ï¼Œå‡è®¾æœ‰ç°æœ‰å¤šä¸ªé›†ç¾¤ï¼Œä¸åŒçš„å¾®æœåŠ¡è¿è¡Œåœ¨ä¸åŒçš„é›†ç¾¤ä¸­ï¼Œé›†ç¾¤ 1 çš„ App01 éœ€è¦å’Œé›†ç¾¤ 2 çš„ App02 è¿›è¡Œé€šä¿¡ï¼Œç”±äºä»–ä»¬éƒ½æ˜¯é€šè¿‡ IP æ³¨å†Œåœ¨é›†ç¾¤å¤–çš„ VM æ³¨å†Œä¸­å¿ƒçš„ï¼Œæ‰€ä»¥ App01 å’Œ App02 åªèƒ½é€šè¿‡ IP é€šä¿¡ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå°±éœ€è¦å¤šé›†ç¾¤ Pod äº’è”äº’é€šã€‚</p><h4 id=calico-1>Calico</h4><p>å¯¹äº Calico è¿™ç§åŸç”Ÿå¯¹ BGP æ”¯æŒå¾ˆå¥½çš„ CNI æ’ä»¶æ¥è¯´ï¼Œå¾ˆå®¹æ˜“å®ç°è¿™ä¸€ç‚¹ï¼Œåªè¦ä¸¤ä¸ªé›†ç¾¤é€šè¿‡ BGP å»ºç«‹é‚»å±…ï¼Œå°†å„è‡ªçš„è·¯ç”±å®£å‘Šç»™å¯¹æ–¹å³å¯å®ç°åŠ¨æ€è·¯ç”±çš„å»ºç«‹ã€‚è‹¥å­˜åœ¨å¤šä¸ªé›†ç¾¤ï¼Œä½¿ç”¨ BGP RR çš„å½¢å¼ä¹Ÿå¾ˆå¥½è§£å†³ã€‚ä½†è¿™ç§è§£å†³æ–¹å¼å¯èƒ½ä¸æ˜¯æœ€ç†æƒ³çš„ï¼Œå› ä¸ºéœ€è¦å’Œç‰©ç†ç½‘ç»œç¯å¢ƒè¿›è¡Œé…åˆå’Œè”è°ƒï¼Œè¿™å°±éœ€è¦ç½‘ç»œäººå‘˜å’Œå®¹å™¨è¿ç»´äººå‘˜ä¸€åŒè¿›è¡Œå¤šé›†ç¾¤ç½‘ç»œçš„å»ºè®¾ï¼Œåœ¨åæœŸè¿ç»´å’Œç®¡ç†ä¸Šéƒ½æœ‰ä¸å¤§æ–¹ä¾¿å’Œæ•æ·çš„æ„Ÿè§‰ã€‚</p><p>é‚£ Calico VxLAN æ¨¡å¼å‘¢ï¼Ÿ</p><p>æ—¢ç„¶è¯´åˆ° VxLANï¼Œå¯ä»¥å’Œ Kube-OVNã€Antreaã€Cilium æ”¾åˆ°ä¸€èµ·æ¥çœ‹ï¼Œå››ç§ CNI éƒ½æ”¯æŒ Overlay çš„ç½‘ç»œæ¨¡å‹ï¼Œéƒ½æ”¯æŒé€šè¿‡ VxLAN/GENEVE çš„å½¢å¼å»ºç«‹éš§é“ç½‘ç»œæ‰“é€šå®¹å™¨ç½‘ç»œé€šä¿¡ã€‚è¿™å°±èµ‹äºˆè¿ç»´äººå‘˜è¾ƒé«˜çš„çµæ´»æ€§ï¼Œå¯¹äºå®¹å™¨ç½‘ç»œçš„è°ƒæ•™ã€IPAM åˆ†é…ã€ç½‘ç»œç›‘æ§å’Œå¯è§‚å¯Ÿæ€§ã€ç½‘ç»œç­–ç•¥è°ƒæ•´éƒ½ç”±å®¹å™¨é›†ç¾¤è¿ç»´äººå‘˜è´Ÿè´£ï¼Œè€Œç½‘ç»œäººå‘˜åˆ™åªéœ€è¦æå‰åˆ’å¥½ç‰©ç†ç½‘ç»œå¤§æ®µï¼Œä¿è¯å®¹å™¨é›†ç¾¤ Node ä¹‹é—´ç½‘ç»œäº’é€šå³å¯ã€‚</p><p>é‚£å¦‚ä½•å»å®ç° overlay ç½‘ç»œçš„å¤šé›†ç¾¤äº’è”å‘¢ï¼Ÿ</p><h4 id=submariner>Submariner</h4><p>CNCF æœ‰ä¸ªæ²™ç®±é¡¹ç›®å« Submarinerï¼Œå®ƒé€šè¿‡åœ¨ä¸åŒé›†ç¾¤å»ºç«‹ä¸åŒçš„ç½‘å…³èŠ‚ç‚¹å¹¶æ‰“é€šéš§é“çš„å½¢å¼å®ç°å¤šé›†ç¾¤é€šä¿¡ã€‚ä»å®˜æ–¹è¿™å¼ æ¶æ„å›¾æ¥è¯´æ˜ï¼š</p><p><img src=https://files.mdnice.com/user/2166/7add318a-cef0-4ecb-bd03-3e2c40c54160.png alt></p><p>ç®€å•æ¥è¯´ï¼ŒSubmariner ç”±ä¸€ä¸ªé›†ç¾¤å…ƒæ•°æ®ä¸­ä»‹æœåŠ¡ï¼ˆbrokerï¼‰æŒæ¡ä¸åŒé›†ç¾¤çš„ä¿¡æ¯ï¼ˆPod/Service CIDRï¼‰ï¼Œé€šè¿‡ Route Agent å°† Pod æµé‡ä» Node å¯¼å‘ç½‘å…³èŠ‚ç‚¹ï¼ˆGateway Engineï¼‰ï¼Œç„¶åç”±ç½‘å…³èŠ‚ç‚¹æ‰“é€šéš§é“ä¸¢åˆ°å¦ä¸€ä¸ªé›†ç¾¤ä¸­å»ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å’Œä¸åŒä¸»æœºçš„å®¹å™¨ä¹‹é—´ä½¿ç”¨ VxLAN ç½‘ç»œé€šä¿¡çš„æ¦‚å¿µæ˜¯ä¸€è‡´çš„ã€‚
è¦è¾¾æˆé›†ç¾¤è¿æ¥ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨å…¶ä¸­ä¸€ä¸ªé›†ç¾¤éƒ¨ç½² Brokerï¼Œç„¶åé€šè¿‡ kubeconfig æˆ– context åˆ†åˆ«è¿›è¡Œæ³¨å†Œå³å¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ğŸ³  â†’ subctl deploy-broker --kubeconfig ~/.kube/config1
</span></span><span style=display:flex><span>ğŸ³  â†’ subctl join --kubeconfig ~/.kube/config1 broker-info.subm --clusterid ks1 --natt<span style=color:#f92672>=</span>false --cable-driver vxlan --health-check<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>ğŸ³  â†’ subctl join --kubeconfig ~/.kube/config2 broker-info.subm --clusterid ks2 --natt<span style=color:#f92672>=</span>false --cable-driver vxlan --health-check<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>ğŸ³  â†’ subctl show all
</span></span><span style=display:flex><span>âœ“ Showing Endpoints
</span></span><span style=display:flex><span>CLUSTER ID                    ENDPOINT IP     PUBLIC IP       CABLE DRIVER        TYPE
</span></span><span style=display:flex><span>ks1                           192.168.100.10  139.198.21.149  vxlan               local
</span></span><span style=display:flex><span>ks2                           192.168.100.20  139.198.21.149  vxlan               remote
</span></span></code></pre></div><h4 id=cilium-1>Cilium</h4><p>Cilium Cluster Mesh å’Œ Submariner æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œå¯ä»¥é€šè¿‡éš§é“å½¢å¼æˆ– NativeRoute å½¢å¼å®ç°é›†ç¾¤äº’è”ã€‚</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/202211021603275.png alt>
<img src=https://pek3b.qingstor.com/kubesphere-community/images/202211021603503.png alt></p><p>Cilium å¼€å¯å¤šé›†ç¾¤ç½‘ç»œè¿æ¥ä¹Ÿå¾ˆç®€å•ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ğŸ³  â†’ cilium clustermesh enable --context $CLUSTER1
</span></span><span style=display:flex><span>ğŸ³  â†’ cilium clustermesh enable --context $CLUSTER2
</span></span></code></pre></div><h4 id=kubeovn>KubeOVN</h4><p>Kube-OVN è¿˜æä¾›ä¸€ä¸ª OVNIC çš„ç»„ä»¶ï¼Œå®ƒè¿è¡Œä¸€ä¸ªè·¯ç”±ä¸­ç»§çš„ OVN-IC çš„ Docker å®¹å™¨ï¼Œä½œä¸ºä¸¤ä¸ªé›†ç¾¤çš„ç½‘å…³èŠ‚ç‚¹ï¼Œå°†ä¸åŒé›†ç¾¤çš„ Pod ç½‘ç»œè¿›è¡Œè¿é€šã€‚</p><h3 id=å¤šé›†ç¾¤æœåŠ¡äº’è®¿>å¤šé›†ç¾¤æœåŠ¡äº’è®¿</h3><p>é™¤äº† Pod IP çš„äº’è”äº’é€šï¼Œå¤šé›†ç¾¤ç½‘ç»œè¿˜å¯è€ƒè™‘é›†ç¾¤é—´çš„ Service äº’è®¿ï¼ŒSubmarinerã€Ciliumï¼ŒAntrea éƒ½èƒ½å®ç°ã€‚Submariner å’Œ Antrea éƒ½ä½¿ç”¨äº† Kubernetes ç¤¾åŒºçš„ MultiCluster Service å¹¶åœ¨æ­¤ä¹‹ä¸Šç»“åˆè‡ªèº«ç»„ä»¶å®ç°å¤šé›†ç¾¤çš„æœåŠ¡è®¿é—®ã€‚MultiCluster Service é€šè¿‡ ServiceExport å’Œ ServiceImport çš„ CRDï¼ŒServiceExport å°†éœ€è¦å…¬å¼€çš„æœåŠ¡å¯¼å‡ºï¼Œç„¶åé€šè¿‡ ServiceImport å°†æ­¤æœåŠ¡å¯¼å…¥åˆ°å¦ä¸€ä¸ªé›†ç¾¤ã€‚</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/202211021604841.png alt></p><h4 id=submariner-1>Submariner</h4><p>æ‹¿ <a href=https://submariner.io/ target=_blank rel="noopener noreferrer">Submariner</a> å®ç°ä¸¾ä¾‹ï¼Œæœ‰ä¸¤ä¸ªé›†ç¾¤ ks1 å’Œ ks2ï¼Œks1 åœ¨ test å‘½åç©ºé—´æœ‰ä¸€ä¸ªæœåŠ¡ nginxï¼Œæ­¤æ—¶é€šè¿‡ ServiceExport å°† nginx æœåŠ¡è¿›è¡Œå¯¼å‡ºï¼ŒSubmariner ä¼šæŠŠè¿™ä¸ª nginx.test.svc.<strong>cluster.local</strong> æœåŠ¡å‘ç°ä¸º nginx.test.svc.<strong>clusterset.local</strong>ï¼Œä¸¤ä¸ªé›†ç¾¤çš„ coredns éƒ½ä¼šå»ºç«‹ä¸€ä¸ªæ–°çš„ clusterset.local çš„å­˜æ ¹åŸŸï¼Œå°†æ‰€æœ‰åŒ¹é… cluster.set çš„è¯·æ±‚å‘é€ç»™ submariner çš„æœåŠ¡å‘ç°çš„ç»„ä»¶ã€‚åŒæ—¶ ServiceImport å¯¼å…¥åˆ° ks2 é›†ç¾¤ï¼Œks2 é›†ç¾¤çš„ Pod å°±å¯ä»¥é€šè¿‡ nginx.test.svc.<strong>clusterset.local</strong> è§£æåˆ° ks1 é›†ç¾¤çš„ nginx Serviceã€‚å¦‚æœä¸¤ä¸ªé›†ç¾¤éƒ½æœ‰ nginx çš„åŒåæœåŠ¡ï¼Œæ­¤æ—¶ submariner å°±å¯ä»¥ä¼˜å…ˆæœ¬åœ°è¿›è¡Œè®¿é—®ï¼Œæœ¬åœ°æœåŠ¡ç«¯ç‚¹æœ‰æ•…éšœåå†è®¿é—®å…¶ä»–é›†ç¾¤çš„ nginx æœåŠ¡ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥å¼€å§‹æ„å»ºåŒæ´»æœåŠ¡äº†å“ˆå“ˆã€‚</p><h4 id=antrea-1>Antrea</h4><p>Antrea å®ç°æ–¹å¼ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç»“åˆ ServiceExport å’Œ ServiceImport å¹¶è¿›è¡Œå°è£…æˆ ResourceExport å’Œ ResourceImport æ„å»ºå¤šé›†ç¾¤æœåŠ¡ï¼Œåœ¨æ¯ä¸ªé›†ç¾¤é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºç½‘å…³ï¼Œé€šè¿‡ç½‘å…³æ‰“é€šä¸åŒé›†ç¾¤éš§é“æ¥å®ç°å¤šé›†ç¾¤æœåŠ¡çš„è®¿é—®ã€‚</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/202211021604884.png alt></p><h4 id=cilium-2>Cilium</h4><p>Cilium æ²¡æœ‰ç”¨ MultiService çš„æ¦‚å¿µï¼ŒCilium é€šè¿‡ Global Service çš„æ¦‚å¿µæ„å»ºå¤šé›†ç¾¤è®¿é—®æœåŠ¡è®¿é—®ã€‚</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/202211021604699.png alt></p><p>ä»è¿™å¼ å›¾å¯ä»¥çœ‹å‡ºï¼ŒCilium æ›´é€‚åˆåšå¤šæ´»é›†ç¾¤çš„å¤šé›†ç¾¤æœåŠ¡è®¿é—®éœ€æ±‚ï¼Œé€šè¿‡å¯¹ç›¸åº”çš„æœåŠ¡æ·»åŠ  Annotation çš„åšæ³•ï¼ŒæŠŠä¸åŒé›†ç¾¤çš„æœåŠ¡è®¾å®šä¸º global-serviceï¼Œå¹¶é€šè¿‡ shared-service å’Œ service-affinity æ¥æ§åˆ¶æœåŠ¡æ˜¯å¦èƒ½è¢«å…¶ä»–é›†ç¾¤è®¿é—®åŠæœåŠ¡äº²å’Œæ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>io.cilium/global-service</span>: <span style=color:#e6db74>&#39;true&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>io.cilium/shared-service</span>: <span style=color:#e6db74>&#39;true&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>io.cilium/service-affinity</span>: <span style=color:#e6db74>&#39;local&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Possible values:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># - local</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#    preferred endpoints from local cluster if available</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># - remote</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#    preferred endpoints from remote cluster if available</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># none (default)</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#    no preference. Default behavior if this annotation does not exist   </span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>ClusterIP</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
</span></span></code></pre></div><p>ä»¥ä¸Šï¼Œå½“æœ‰å¤šé›†ç¾¤äº’è®¿éœ€æ±‚åˆä¸æƒ³ CNI å¼ºç›¸å…³æ—¶ï¼Œå¯ä»¥å°è¯•ç©ä¸€ä¸‹ Submarinerï¼Œä½œä¸º CNCF Landscape Network ä¸­ä¸€ä¸ªä¸“æ³¨äºå¤šé›†ç¾¤äº’è®¿çš„ SandBox é¡¹ç›®ï¼ŒSubmariner æä¾›å¤šé›†ç¾¤ç½‘ç»œé€šä¿¡ï¼ŒæœåŠ¡å‘ç°ï¼Œä»¥åŠå®‰å…¨åŠ å¯†ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p><h3 id=ç½‘ç»œç­–ç•¥>ç½‘ç»œç­–ç•¥</h3><p>å¯¹äº Pod ç½‘ç»œéš”ç¦»ã€å…¥å‘é™åˆ¶ã€å‡ºå‘é™åˆ¶çš„ç½‘ç»œåœºæ™¯ï¼Œå¯ä»¥æ•´åˆæˆç½‘ç»œç­–ç•¥ä¸€åŒæ¥è¯´ã€‚ä¸»æµå¼€æº CNI éƒ½æ”¯æŒ Kubernetes NetworkPolicyï¼Œé€šè¿‡ Network Policyï¼Œå¯ä»¥åœ¨ 3 å±‚æˆ– 4 å±‚åšç›¸åº”çš„ç½‘ç»œå®‰å…¨é™åˆ¶ã€‚Network Policy é€šè¿‡ Ingress å’Œ Egress ä¸¤ç§è¿›è¡Œç½‘ç»œé™åˆ¶ï¼Œé»˜è®¤éƒ½æ˜¯æ”¾è¡Œçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè®¾ç½® Kubernetes ç½‘ç»œç­–ç•¥ï¼Œä¸»è¦ä»¥ç™½åå•çš„å½¢å¼å¯¹é›†ç¾¤å†…çš„æµé‡è¿›è¡Œå®‰å…¨é™åˆ¶ã€‚</p><p>æ¯”å¦‚åªå…è®¸æŒ‡å®š label çš„ Pod è®¿é—®é›†ç¾¤å¤–æ•°æ®åº“ï¼ˆé€šè¿‡ CIDR æŒ‡å®šï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.K8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>NetworkPolicy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ingress-allow</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>podSelector</span>: 
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>role</span>: <span style=color:#ae81ff>db</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>policyTypes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Egress</span>
</span></span><span style=display:flex><span><span style=color:#f92672>egress</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>to</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>ipBlock</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cidr</span>: <span style=color:#ae81ff>192.168.100.40</span><span style=color:#ae81ff>/24</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>port</span>: <span style=color:#ae81ff>3306</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.K8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>NetworkPolicy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ingress-allow</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>podSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>role</span>: <span style=color:#ae81ff>app</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>policyTypes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>Ingress</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ingress</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>from</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>ipBlock</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cidr</span>: <span style=color:#ae81ff>172.17.0.0</span><span style=color:#ae81ff>/16</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>except</span>:
</span></span><span style=display:flex><span>              - <span style=color:#ae81ff>172.17.1.0</span><span style=color:#ae81ff>/24</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>namespaceSelector</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>project</span>: <span style=color:#ae81ff>web-project</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>podSelector</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>role</span>: <span style=color:#ae81ff>web</span>
</span></span></code></pre></div><p>è™½ç„¶ Network Policy èƒ½æ»¡è¶³å¤§å¤šåœºæ™¯ï¼Œä½†æ˜¯ä¸æ˜¯æ„Ÿè§‰è¿˜æ˜¯å°‘äº†ç‚¹ä¸œè¥¿ï¼Ÿæ¯”å¦‚ 7 å±‚ç­–ç•¥ã€åŸºäº NodeSelectorã€Drop/Reject ç±»å‹çš„ç­–ç•¥æŒ‡å®šã€æŒ‡å®š Egress èŠ‚ç‚¹è¿›è¡Œæ§åˆ¶ç­‰é«˜çº§èƒ½åŠ›ã€‚è¿™ä¸ªæ—¶å€™ Cilium å’Œ Antrea å°±å¤§æ”¾å¼‚å½©äº†ã€‚</p><h4 id=cilium-3>Cilium</h4><p>Cilium æœ‰ä¸¤ä¸ª CRDï¼ŒCiliumNetworkPolicy å’Œ CiliumClusterwideNetworkPolicyï¼Œæ¥å®ç°å•é›†ç¾¤å’Œå¤šé›†ç¾¤çš„ç½‘ç»œç­–ç•¥èƒ½åŠ›ã€‚Cilium æ”¯æŒ 3ã€4ã€7 å±‚ç½‘ç»œç­–ç•¥ã€‚å¹¶å¢åŠ  EndPoint Selector å’Œ Node Selectorã€‚é™¤äº†æ™®é€šçš„åŸºäº PodSelector å’Œ CIDR çš„é™åˆ¶ï¼ŒCilium å¯ä»¥æ”¯æŒæ›´å¤šç§ç­–ç•¥ï¼Œæ¯”å¦‚ï¼š</p><p>DNS é™åˆ¶ç­–ç•¥ï¼Œåªå…è®¸ app: test-app çš„ç«¯ç‚¹é€šè¿‡ 53 ç«¯å£å» kube-system å‘½åç©ºé—´çš„ "K8s:K8s-app": kube-dns æ ‡ç­¾çš„ DNS æœåŠ¡å™¨è®¿é—® my-remote-service.comï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#e6db74>&#34;cilium.io/v2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>CiliumNetworkPolicy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;to-fqdn&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>endpointSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>test-app</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>egress</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>toEndpoints</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;K8s:io.kubernetes.pod.namespace&#34;: </span><span style=color:#ae81ff>kube-system</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;K8s:K8s-app&#34;: </span><span style=color:#ae81ff>kube-dns</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>toPorts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>           - <span style=color:#f92672>port</span>: <span style=color:#e6db74>&#34;53&#34;</span>
</span></span><span style=display:flex><span>             <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>ANY</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>dns</span>:
</span></span><span style=display:flex><span>              - <span style=color:#f92672>matchPattern</span>: <span style=color:#e6db74>&#34;*&#34;</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>toFQDNs</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>matchName</span>: <span style=color:#e6db74>&#34;my-remote-service.com&#34;</span>
</span></span></code></pre></div><p>Http é™åˆ¶ç­–ç•¥ , åªå…è®¸ org: empire æ ‡ç­¾çš„ç«¯ç‚¹å¯¹ deathstar çš„ /v1/request-landing è¿›è¡Œ POST æ“ä½œï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#e6db74>&#34;cilium.io/v2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>CiliumNetworkPolicy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;rule&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;L7 policy to restrict access to specific HTTP call&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>endpointSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>org</span>: <span style=color:#ae81ff>empire</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>class</span>: <span style=color:#ae81ff>deathstar</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ingress</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>fromEndpoints</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>org</span>: <span style=color:#ae81ff>empire</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>toPorts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>port</span>: <span style=color:#e6db74>&#34;80&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>method</span>: <span style=color:#e6db74>&#34;POST&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>path</span>: <span style=color:#e6db74>&#34;/v1/request-landing&#34;</span>
</span></span></code></pre></div><p>kafka ç­–ç•¥æ§åˆ¶ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#e6db74>&#34;cilium.io/v2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>CiliumNetworkPolicy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;rule1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;enable empire-hq to produce to empire-announce and deathstar-plans&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>endpointSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>kafka</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ingress</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>fromEndpoints</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>empire-hq</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>toPorts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>port</span>: <span style=color:#e6db74>&#34;9092&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>kafka</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>role</span>: <span style=color:#e6db74>&#34;produce&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>topic</span>: <span style=color:#e6db74>&#34;deathstar-plans&#34;</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>role</span>: <span style=color:#e6db74>&#34;produce&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>topic</span>: <span style=color:#e6db74>&#34;empire-announce&#34;</span>
</span></span></code></pre></div><h4 id=antrea-2>Antrea</h4><p>Antrea é™¤äº†å¢åŠ ç°æœ‰ NetworkPolicy åŠŸèƒ½å¤–ï¼ŒæŠ½è±¡äº† Antrea NetworkPolicy å’Œ Antrea ClusterNetworkPolicy ä¸¤ä¸ª CRD å®ç°å‘½åç©ºé—´çº§åˆ«å’Œé›†ç¾¤çº§åˆ«çš„å®‰å…¨ç®¡ç†ã€‚ï¼Œè¿˜æä¾›äº† Groupï¼ŒTier çš„æ¦‚å¿µï¼Œç”¨äºèµ„æºåˆ†ç»„å’Œä¼˜å…ˆçº§è®¾è®¡ï¼Œå—¯ï¼ŒæœçœŸæ˜¯ NSX çš„äº²å…„å¼Ÿã€‚å› æ­¤ Antrea æœ‰é›¶ä¿¡ä»»çš„ç½‘ç»œç­–ç•¥å®‰å…¨é˜²æŠ¤æ‰‹æ®µï¼Œå¯ä»¥å®ç°ä¸¥æ ¼çš„ pod å’Œå‘½åç©ºé—´éš”ç¦»ã€‚</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/202211021605475.png alt></p><p>ç½‘ç»œå±‚ Antrea å¢åŠ äº†å¯¹ ICMP å’Œ IGMPï¼ŒMutlicast çš„é™åˆ¶ï¼Œç¦ ping äººå‘˜ç‹‚å–œã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>crd.antrea.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterNetworkPolicy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>acnp-reject-ping-request</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>priority</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tier</span>: <span style=color:#ae81ff>securityops</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>appliedTo</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>podSelector</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>role</span>: <span style=color:#ae81ff>server</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>namespaceSelector</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>env</span>: <span style=color:#ae81ff>prod</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>egress</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>action</span>: <span style=color:#ae81ff>Reject</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>protocols</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>icmp</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>icmpType</span>: <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>icmpCode</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#ae81ff>DropPingRequest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>enableLogging</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>åŸºäº FQDN çš„è¿‡æ»¤ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>crd.antrea.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterNetworkPolicy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>acnp-fqdn-all-foobar</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>priority</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>appliedTo</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>podSelector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>client</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>egress</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>action</span>: <span style=color:#ae81ff>Allow</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>to</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>fqdn</span>: <span style=color:#e6db74>&#34;*foobar.com&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>action</span>: <span style=color:#ae81ff>Drop </span>
</span></span></code></pre></div><p>è®¾ç½®ä¸åŒç±»å‹çš„ Groupï¼ŒåŸºäº Group è®¾ç½®ç½‘ç»œç­–ç•¥ï¼Œå°±ä¸ç”¨å¯¹åŒç±»ä¸šåŠ¡å†™ä¸€å † Label äº†</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>crd.antrea.io/v1alpha3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Group</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>test-grp-with-namespace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>podSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>role</span>: <span style=color:#ae81ff>db</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespaceSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>env</span>: <span style=color:#ae81ff>prod</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># Group that selects IP block 10.0.10.0/24.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>crd.antrea.io/v1alpha3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Group</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>test-grp-ip-block</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ipBlocks</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>cidr</span>: <span style=color:#ae81ff>10.0.10.0</span><span style=color:#ae81ff>/24</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>crd.antrea.io/v1alpha3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Group</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>test-grp-svc-ref</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>serviceReference</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>test-service</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># Group that includes the previous Groups as childGroups.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>crd.antrea.io/v1alpha3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Group</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>test-grp-nested</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>childGroups</span>: [<span style=color:#ae81ff>test-grp-sel, test-grp-ip-blocks, test-grp-svc-ref]</span>
</span></span></code></pre></div><h3 id=egress>Egress</h3><p>å¯¹äºç‰¹å®šä¸šåŠ¡å‡ºé›†ç¾¤éœ€ä¸æš´éœ² IP æˆ–ç¬¦åˆå®‰å…¨å®¡è®¡éœ€æ±‚çš„åœºæ™¯ï¼Œéœ€è¦ Pod IP -> External IP å¯¹å¤–éƒ¨ä¸šåŠ¡è¿›è¡Œè®¿é—®ã€‚Ciliumï¼ŒKube-OVNï¼ŒAntrea éƒ½æœ‰ç±»ä¼¼ Egress Gateway/Egress IP çš„åŠŸèƒ½ï¼Œç‰¹å®šæ ‡ç­¾çš„ Pod é€šè¿‡ SNAT ä¸º Egress IP è®¿é—®é›†ç¾¤å¤–æœåŠ¡ã€‚</p><h4 id=cilium-4>Cilium</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>cilium.io/v2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>CiliumEgressGatewayPolicy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>egress-sample</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selectors</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>podSelector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>snat-pod</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>io.kubernetes.pod.namespace</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>destinationCIDRs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>egressGateway</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nodeSelector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>node.kubernetes.io/name</span>: <span style=color:#ae81ff>node1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>egressIP</span>: <span style=color:#ae81ff>10.168.60.100</span>
</span></span></code></pre></div><h4 id=kubeovn-1>KubeOVN</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pod-gw</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>ovn.kubernetes.io/eip</span>: <span style=color:#ae81ff>172.10.0.1</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#æˆ–ovn.kubernetes.io/snat: 172.10.0.1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>eip-pod</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:alpine</span>
</span></span></code></pre></div><h4 id=antrea-3>Antrea:</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>crd.antrea.io/v1alpha2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Egress</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>egress-staging-web</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>appliedTo</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespaceSelector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>kubernetes.io/metadata.name</span>: <span style=color:#ae81ff>staging</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>podSelector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>web</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>externalIPPool</span>: <span style=color:#ae81ff>external-ip-pool</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#æˆ–IPå½¢å¼ egressIP: 10.10.10.1</span>
</span></span></code></pre></div><h3 id=å¸¦å®½ç®¡ç†>å¸¦å®½ç®¡ç†</h3><p>kube-ovn å’Œ Clium éƒ½æ”¯æŒå¸¦å®½ç®¡ç†ï¼Œkube-ovn è¿˜æ”¯æŒ QoS è°ƒæ•´ï¼Œåªéœ€è¦ Annotation ä¸€ä¸‹å³å¯æå®šï¼š</p><h4 id=kube-ovn-1>Kube-OVN</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>qos</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>ls1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>ovn.kubernetes.io/ingress_rate</span>: <span style=color:#e6db74>&#34;3&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ovn.kubernetes.io/egress_rate</span>: <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ovn.kubernetes.io/latency</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ovn.kubernetes.io/loss</span>: <span style=color:#ae81ff>20</span>
</span></span></code></pre></div><h4 id=cilium-5>Cilium</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>kubernetes.io/egress-bandwidth</span>: <span style=color:#ae81ff>10M</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>ä»¥ä¸Šã€‚å°±æ˜¯æ­¤æ¬¡åˆ†äº«çš„å…¨éƒ¨å†…å®¹äº†ï¼Œè¯»åˆ°è¿™é‡Œä½ å¯ä»¥ä¹Ÿä¼šæ„Ÿæ…¨ï¼Œä»æœ€æ—©å­¦ docker0ï¼ŒVethpair ç†Ÿæ‚‰å®¹å™¨ç½‘ç»œåŸç†ï¼Œåˆ°æ­å»º K8s åèŠ‚ç‚¹ NotReady å°± apply ä¸ª Flannel é€æ­¥äº†è§£ CNI æ’ä»¶æœºåˆ¶ï¼Œåˆ°ä»Šå¤©çš„ CNCF Network&amp;Service Proxy ç”Ÿæ€çš„èŠ±å›¢é”¦ç°‡ï¼Œäº‘åŸç”Ÿç½‘ç»œåœ¨æ—¥æ–°æœˆå¼‚çš„å‘å±•ç€ï¼Œå®¹å™¨ç½‘ç»œä»æœ€åˆçš„è¿é€šæ€§åˆ°ç°åœ¨æ¼”å˜å‡ºæ›´å¤šçš„ç©æ³•å’Œé€‚ç”¨æ€§ï¼Œä¸è®ºæ˜¯ç½‘ç»œåŠŸèƒ½ã€å®‰å…¨æ§åˆ¶ã€ç½‘ç»œæ´å¯Ÿå’Œå¯è§‚æµ‹æ€§ï¼Œéƒ½åœ¨æ›´å¥½åœ°ä¸ºè¿ç»´äººå‘˜æœåŠ¡ã€‚è‹¥è¦ä½“éªŒæ›´å¤šåŠŸèƒ½ï¼Œå¿«åˆ°å¼€æºç¤¾åŒºé€‰æ‹©å–œæ¬¢çš„å®¹å™¨ç½‘ç»œé¡¹ç›® Hands on Lab å§ï¼</p></div></div><div class=share-2><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-cni%2f&text=Kubernetes%20CNI%20%e6%8f%92%e4%bb%b6%e9%80%89%e5%9e%8b%e5%92%8c%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af%e6%8e%a2%e8%ae%a8" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-cni%2f&title=Kubernetes%20CNI%20%e6%8f%92%e4%bb%b6%e9%80%89%e5%9e%8b%e5%92%8c%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af%e6%8e%a2%e8%ae%a8" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-cni%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-cni%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-cni%2f&t=Kubernetes%20CNI%20%e6%8f%92%e4%bb%b6%e9%80%89%e5%9e%8b%e5%92%8c%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af%e6%8e%a2%e8%ae%a8" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div></div><div class=aside><div class=inner-div><div class=title>ç›®å½•</div><div class=tabs><nav id=TableOfContents><ul><li><a href=#å¸¸è§ç½‘ç»œæ’ä»¶>å¸¸è§ç½‘ç»œæ’ä»¶</a></li><li><a href=#ç½‘ç»œåº”ç”¨åœºæ™¯>ç½‘ç»œåº”ç”¨åœºæ™¯</a></li><li><a href=#ç½‘ç»œæ’ä»¶åŠŸèƒ½å®ç°>ç½‘ç»œæ’ä»¶åŠŸèƒ½å®ç°</a><ul><li><a href=#å›ºå®š-ip>å›ºå®š IP</a></li><li><a href=#å¤šé›†ç¾¤ç½‘ç»œäº’è”>å¤šé›†ç¾¤ç½‘ç»œäº’è”</a></li><li><a href=#å¤šé›†ç¾¤æœåŠ¡äº’è®¿>å¤šé›†ç¾¤æœåŠ¡äº’è®¿</a></li><li><a href=#ç½‘ç»œç­–ç•¥>ç½‘ç»œç­–ç•¥</a></li><li><a href=#egress>Egress</a></li><li><a href=#å¸¦å®½ç®¡ç†>å¸¦å®½ç®¡ç†</a></li></ul></li></ul></nav></div></div></div></div></section><div class=SubscribeForm><div class=innerBox><img class=close src=/images/home/close.svg alt=close><p class=description>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=blog_formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input-blog type=text placeholder>
<button id=email-submit-blog>è®¢é˜…</button>
<span id=message_blog data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨ style=color:red></span><span id=message1_blog style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span></div></div></div><footer><div class=footer><div class="footer-main common-layout"><div class=up-main><div class=left-div><img src=/images/logo.svg alt class=foot-logo><p>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input type=text placeholder=è¯·è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€>
<button id=email-submit>è®¢é˜…</button></div><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨></span><span id=message1 style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span><script>var bindSubmit=function(){var e=$("#email-input");$("#email-submit").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message").data("message1"),a=$("#message").data("message2"),r=$("#message").data("message3"),c=$("#message1").data("success");if(n)if(validateEmail(n)){if(s=$("#formAddress").data("usesendcloud"),!s)return;o=$("#formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:$("#email-input").val().toString()},success:function(){showSuccessMessage(c),setTimeout(function(){$("#email-input").val("")},1e3)},error:function(){showMessage(r)}})}else t.preventDefault(),showMessage(a);else t.preventDefault(),showMessage(i)})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},showMessage=function(e){$("#message").html(e).show()},showSuccessMessage=function(e){$("#message1").html(e).show()},bindHideMessage=function(){$(window).click(function(){$("#message").hide(),$("#message1").hide()})},bindClose=function(){$(".formBox .close").click(function(e){e.stopPropagation(),$(".formBox").fadeOut()})};bindSubmit(),bindClose(),bindHideMessage()</script><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€!></span></div><div class=right-div><ul class=common-flex-layout><li class=nowrap-li><div class=h3>åº”ç”¨åœºæ™¯</div><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps</a>
<a href=/zh/service-mesh/>åœ¨ K8s è¿è¡Œå¾®æœåŠ¡</a>
<a href=/zh/observability/>æ„å»ºäº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a>
<a href=https://github.com/kubesphere/kubekey target=_blank rel="noopener noreferrer">K8s ä¸€é”®éƒ¨ç½²ä¸è¿ç»´</a>
<a href=https://github.com/OpenFunction/OpenFunction target=_blank rel="noopener noreferrer">æ„å»º FaaS å¹³å°ä¸ Serverless æ¶æ„</a>
<a href=https://github.com/openpitrix/openpitrix target=_blank rel="noopener noreferrer">å¤šäº‘åº”ç”¨ç®¡ç†å¹³å°</a></li><li class=nowrap-li><div class=h3>èµ„æº</div><a href=/zh/projects/>å¼€æºé¡¹ç›®</a>
<a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a>
<a href=/zh/conferences/>å¼€æºå³°ä¼š</a>
<a href=/zh/videos/>è§†é¢‘èµ„æº</a>
<a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li><li class=nowrap-li><div class=h3>æ–‡æ¡£ä¸­å¿ƒ</div><a href=/zh/docs/v4.1/01-intro/01-introduction/>äº§å“ä»‹ç»</a>
<a href=/zh/docs/v4.1/03-installation-and-upgrade/02-install-kubesphere/02-install-kubernetes-and-kubesphere/>å¦‚ä½•å®‰è£…</a>
<a href=/zh/docs/v4.1/02-quickstart/>å¿«é€Ÿå…¥é—¨</a>
<a href=/zh/docs/v3.4/reference/api-docs/>API æ–‡æ¡£</a></li><li class=nowrap-li><div class=h3>å¼€æºç¤¾åŒº</div><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a>
<a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a>
<a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a>
<a href=/zh/partner/>åˆä½œä¼™ä¼´</a>
<a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a>
<a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a>
<a href=https://kubesphere.com.cn/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a>
<a href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ä¸­æ–‡è®ºå›</a>
<a href=https://kubesphere.io target=_blank rel="noopener noreferrer">å…¨çƒç«™</a></li><li class=nowrap-li><div class=h3>äº§å“ä¸æœåŠ¡</div><a href=https://aws.amazon.com/cn/quickstart/architecture/qingcloud-kubesphere/ target=_blank rel="noopener noreferrer">KubeSphere on AWS</a>
<a href=https://market.azure.cn/marketplace/apps/qingcloud.kubesphere target=_blank rel="noopener noreferrer">KubeSphere on Azure</a>
<a href=https://marketplace.digitalocean.com/apps/kubesphere target=_blank rel="noopener noreferrer">KubeSphere on DigitalOcean</a>
<a href=https://www.qingcloud.com/products/kubesphereqke target=_blank rel="noopener noreferrer">KubeSphere on QingCloud(QKE)</a>
<a href=https://kubesphere.com.cn/kse/ target=_blank rel="noopener noreferrer">KubeSphere ä¼ä¸šç‰ˆ</a>
<a href=https://kubesphere.cloud/ksv/ target=_blank rel="noopener noreferrer">KubeSphere è™šæ‹ŸåŒ–å¹³å°</a>
<a href=https://kubesphere.com.cn/marketplace/ target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿæ‰©å±•ç»„ä»¶å¸‚åœº</a>
<a href=https://kubesphere.cloud target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿåº”ç”¨æœåŠ¡å¹³å°</a>
<a href=https://m.qingcloud.com/p/aec50 target=_blank rel="noopener noreferrer">äº†è§£å•†ä¸šäº§å“ä¸å’¨è¯¢åˆä½œ</a></li></ul></div></div><div class=down-main><div class=img-div><a class=wechat href=javascript:void(0); aria-label=wechat><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28"><defs><path id="a" d="M0 0h15.673v12.156H0z"/></defs><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="13" cy="13" r="13" stroke="#B6C2CD"/><g transform="translate(5 7)"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59.0-4.625 1.679-4.625 3.74.0 2.066 2.035 3.738 4.625 3.738.542.0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27.0-.541-.257-.541-.514.0-.256.27-.514.541-.514.41.0.681.258.681.514.0.257-.271.514-.681.514zm2.994.0c-.27.0-.541-.257-.541-.514.0-.256.27-.514.54-.514.41.0.681.258.681.514.0.257-.277.514-.68.514z" mask="url(#b)"/><path fill="currentColor" d="M10.602 3.674c.177.0.356.011.533.029C10.657 1.576 8.27.0 5.543.0 2.498.0.0 1.974.0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17.0.343-.005.515-.022a3.68 3.68.0 01-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417.0.693.263.693.66s-.276.66-.693.66c-.418.0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417.0-.834-.263-.834-.66s.417-.66.834-.66c.418.0.695.263.695.66.0.392-.277.66-.695.66z" mask="url(#b)"/></g></g></svg><div class=hide-div><img src=/images/home/wechat.svg alt></div></a><a class=facebook-a href=https://www.facebook.com/kubesphere target=_blank aria-label=facebook></a><a class=twitter-a href=https://x.com/KubeSphere target=_blank aria-label=twitter rel="noopener noreferrer"></a><a class=linkedin-a href=https://www.linkedin.com/company/kubesphere/ target=_blank aria-label=linkedin rel="noopener noreferrer"></a><a class=bilibili-a href=https://space.bilibili.com/438908638 target=_blank aria-label=bilibili rel="noopener noreferrer"></a><a class=slack-a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank aria-label=slack rel="noopener noreferrer"></a><a class=github-a href=https://github.com/kubesphere/kubesphere target=_blank aria-label=github rel="noopener noreferrer"></a><a class=medium-a href=https://itnext.io/@kubesphere target=_blank aria-label=medium rel="noopener noreferrer"></a></div><p class=p1></p><p class=case><a href=http://www.beian.miit.gov.cn/ target=_blank rel="noopener noreferrer"><span>äº¬ICPå¤‡13019086å·</span>
</a><a target=_blank rel="noopener noreferrer" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502041003"><img src=/images/footer/case-icon.png alt=å¤‡æ¡ˆå›¾æ ‡>
<span>äº¬å…¬ç½‘å®‰å¤‡ 11010502041003å·</span></a></p></div></div></div><div class=cookie><div class=common-layout><p>æ‚¨çš„éšç§å¯¹æˆ‘ä»¬å¾ˆé‡è¦ã€‚æˆ‘ä»¬ä½¿ç”¨Cookieæ¥è®°ä½è®¢é˜…è¯¦ç»†ä¿¡æ¯ï¼Œä¼˜åŒ–ç½‘ç«™åŠŸèƒ½å¹¶äº¤ä»˜æ ¹æ®æ‚¨çš„å…´è¶£é‡èº«å®šåˆ¶çš„å†…å®¹ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„<a href=/zh/privacy>éšç§æ”¿ç­–</a>.</p><button>
æ¥å—å¹¶ç»§ç»­</button></div></div></footer><script>var lazyLoad=function(e,t){for(var n,o,i,s=0;s<t;s++){if(n=e.eq(s),o=n.attr("data-loaded"),o)continue;n.offset().top<parseInt($(window).height())+parseInt($(window).scrollTop())&&(i=n.attr("src"),n.attr("src",i),n.attr("data-loaded",!0))}},bindLayLoad=function(){var e=$("img"),t=e.length;lazyLoad(e,t),$(window).scroll(function(){lazyLoad(e,t)})},bindAddPadding=function(){var e=$("#close-join");e.length>0&&$(".main-section").addClass("padding")},docCookies={getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t){return!!e&&!/^(?:expires|max-age|path|domain|secure)$/i.test(e)&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t),!0)}},bindHideCookie=function(){var t=docCookies.getItem("hasAuth"),e=$(".cookie");t?e.hide():e.show(),e.find("button").on("click",function(){docCookies.setItem("hasAuth","1"),e.hide()})};bindAddPadding(),bindHideCookie()</script><script type=text/javascript src=/js/aside.2d6977c0f16aef4ed3e886dd66675ce74bd0efcd467c2b2bcdb30b92d5e7c7c0e5c6e0c9d8f09a883c22f58df9e6b0b6347fcdd3c9a920b7faba6d7f91a201c3.js integrity="sha512-LWl3wPFq707T6IbdZmdc50vQ781GfCsrzbMLktXnx8DlxuDJ2PCaiDwi9Y355rC2NH/N08mpILf6um1/kaIBww=="></script><script type=text/javascript src=/js/markdown-tab.17f9f46b021adebc7250ce1b07134a577b307e7a436daa4aaf388f218e8463966f53770b26a64817c06c168738a887672d47fb4c29615adfc446e11d09a344cf.js integrity="sha512-F/n0awIa3rxyUM4bBxNKV3swfnpDbapKrziPIY6EY5ZvU3cLJqZIF8BsFoc4qIdnLUf7TClhWt/ERuEdCaNEzw=="></script><script>let forbidForm=!1;var viewer=new Viewer(document.querySelector(".md-body"),{url:"src"}),blogBindSubmit=function(){var e=$("#email-input-blog");$("#email-submit-blog").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message_blog").data("message1"),a=$("#message_blog").data("message2"),r=$("#message_blog").data("message3"),c=$("#message1_blog").data("success");if(n)if(validateEmail(n)){if(s=$("#blog_formAddress").data("usesendcloud"),!s)return;o=$("#blog_formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:n.toString()},success:function(){showSuccessMessage_blog(c),setTimeout(function(){window.onscroll="",$(".SubscribeForm").hide(),$("#email-input-blog").val("")},5e3)},error:function(){showMessage_blog(r)}})}else t.preventDefault(),$("#message_blog").html(a).show();else t.preventDefault(),$("#message_blog").html(i).show()})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},bindHideMessageBlog=function(){$(window).click(function(){$("#message_blog").hide()})},bindCloseBlog=function(){$(".SubscribeForm .close").click(function(e){e.stopPropagation(),$(".SubscribeForm").fadeOut(),window.onscroll=""})},showMessage_blog=function(e){$("#message_blog").html(e).show()},showSuccessMessage_blog=function(e){$("#message1_blog").html(e).show()};window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;forbidForm&&(window.onscroll=""),e+t>n-710?$(".SubscribeForm").hide():$(".SubscribeForm").show()},blogBindSubmit(),bindCloseBlog(),bindHideMessageBlog()</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>