<!doctype html><html lang=en-US><head><meta charset=utf-8><title>KubeKey ç¦»çº¿éƒ¨ç½² KubeSphere v3.4.1 å’Œ K8s v1.26 å®æˆ˜æŒ‡å—</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ KubeKey **v3.0.13** ç¦»çº¿éƒ¨ç½² KubeSphere å’Œ K8s é›†ç¾¤ã€‚"><meta name=keywords content="Kubernetes,KubeSphere,KubeKey"><meta property="og:type" content="article"><meta property="og:title" content="KubeKey ç¦»çº¿éƒ¨ç½² KubeSphere v3.4.1 å’Œ K8s v1.26 å®æˆ˜æŒ‡å—"><meta property="og:description" content="è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ KubeKey **v3.0.13** ç¦»çº¿éƒ¨ç½² KubeSphere å’Œ K8s é›†ç¾¤ã€‚"><meta property="og:image" content="https://pek3b.qingstor.com/kubesphere-community/images/deploying-kubesphere-and-k8s-offline-with-kubekey-cover.png"><meta property="og:url" content="https://openksc.github.io/zh/blogs/deploying-kubesphere-and-k8s-offline-with-kubekey/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeSphere"><meta property="twitter:image" content="https://pek3b.qingstor.com/kubesphere-community/images/deploying-kubesphere-and-k8s-offline-with-kubekey-cover.png"><meta name=docsearch:language content="zh-CN"><meta name=docsearch:version content><link rel=canonical href=https://kubesphere.io/zh/blogs/deploying-kubesphere-and-k8s-offline-with-kubekey/><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=apple-touch-icon href=/images/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/svg+xml href=/images/favicons/favicon.svg><link rel=icon type=image/png href=/images/favicons/favicon.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg color=#00ad6e><meta name=msapplication-config content='/images/favicons/browserconfig.xml'><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/fonts/Roboto/stylesheet.css><link rel=stylesheet href=/fonts/ProximaNova/stylesheet.css><link rel=stylesheet href=/css/jquery.modal.min.css><link rel=stylesheet href=/css/viewer.min.css><link rel=stylesheet href=/swiper/swiper-bundle.min.css><link rel=stylesheet href=/scss/common.min.0c3fdcc05ec210321169846714f74b11c4a1baf09a1833fa9273b2347c81e636.css><script src=/js/jquery-3.7.1.min.js></script><script src=/js/viewer.min.js></script><script src=/js/jquery.modal.min.js></script><script src=/swiper/swiper-bundle.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0888981f1fa45d241b1fb6962da2963e",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YYCVN36HT5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YYCVN36HT5")</script><script type=text/javascript>!function(e,t,n,s,o){e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=("https:"==document.location.protocol?"https://":"http://")+s,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio"),gio("init","8a24ae300cbf8b8c",{}),gio("send")</script><link rel=stylesheet href=/scss/content.min.f73b326fbf8c5bd331900b0de21c7dde608a4926f482f6465f9ae1d9049b83ad.css><link rel=stylesheet href=/scss/markdown.min.db47186481122431dffae72d17dbbd51f90b66f022cc163458645709924e4eac.css></head><body><header class=navigation><div class=join-div><div class=content>ğŸš€ KubeSphere v4.1.3 å‘å¸ƒï¼Œå¤šé¡¹ä¼˜åŒ–ä¸æ”¹è¿›ï¼Œæ¬¢è¿ä½“éªŒï¼<a href=/zh/docs/v4.1/20-release-notes/release-v413/ target=_blank rel="noopener noreferrer">è¯·æŸ¥çœ‹ Release notes â†’</a>
<img id=close-join src=/images/header/close.svg alt=close></div></div><div class=common-layout><div class=header-container><a href=/zh/ aria-label=logo><img src=/images/header/logo.svg alt class=logo></a><ul class=nav><li class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class="dropdown-menu menu-2"><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li class=menu-li><span class=menu-span>èµ„æº</span><ul class="dropdown-menu menu-3"><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class="dropdown-menu menu-4"><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/ target=_blank rel="noopener noreferrer">æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/ target=_blank rel="noopener noreferrer">Kube Design</a></li></ul></li><li class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class="dropdown-menu menu-5"><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025 target=_blank rel="noopener noreferrer">å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/ target=_blank rel="noopener noreferrer">è®¤è¯</a></li></ul><div class=right-menu><ul><li class=language-menu><div><img src=/images/header/black.svg alt>
<span>ç®€ä½“ä¸­æ–‡</span></div><ul class=dropdown-menu><li onclick='handleLangClick("zh","/zh/blogs/deploying-kubesphere-and-k8s-offline-with-kubekey/")'>ç®€ä½“ä¸­æ–‡</li></ul></li><li class=github-li><div class=github-star><a class=star-btn href=https://github.com/kubesphere/kubesphere rel="noopener noreferrer" target=_blank><span class=star-img></span>&nbsp;<span>Star</span>
</a><a class=social-count href=https://github.com/kubesphere/kubesphere/stargazers rel="noopener noreferrer" target=_blank></a></div></li><li class=menu-icon><img src=/images/header/menu.svg alt></li></ul></div></div></div><div id=modal-for-menu class=modal><ul class=nav><li data-check=0 class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class=dropdown-menu><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>èµ„æº</span><ul class=dropdown-menu><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class=dropdown-menu><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/>æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/>Kube Design</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class=dropdown-menu><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md>ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/>ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025>å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum>ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/>è®¤è¯</a></li></ul><div class=link-div><a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank rel="noopener noreferrer" aria-label=slack><img src=/images/header/slack-hover.svg alt>
</a><a href=https://x.com/KubeSphere target=_blank rel="noopener noreferrer" aria-label=twitter><img src=/images/header/twitter-hover.svg alt>
</a><a href=https://github.com/kubesphere/kubesphere target=_blank rel="noopener noreferrer" aria-label=github><img src=/images/header/github-hover.svg alt></a></div></div></header><script>var bindNavMouseEvent,bindScrollChangeHeader,bindClickShowMenu,bindClickModalLi,bindClickClose,language,handleLangClick,githubApiLink="https://api.github.com/repos/kubesphere/kubesphere",getStar=function(){$(".social-count").hide(),$.getJSON(githubApiLink,function(e){$(".social-count").show().html(e.stargazers_count)})};getStar(),bindNavMouseEvent=function(e,t){t||(t=$(e));var n=!1;t.mouseenter(function(){if(n)return!1;n=!0,$(this).find(".dropdown-menu").fadeIn(200,function(){n=!1})}),t.mouseleave(function(){$(this).find(".dropdown-menu").fadeOut(200)})},bindScrollChangeHeader=function(){var t=100,e=$("header");window.addEventListener("scroll",function(){var t=window.scrollY;t>0?e.addClass("navigationScroll"):e.removeClass("navigationScroll")})},bindClickShowMenu=function(){$(".menu-icon").click(function(){$("#modal-for-menu").modal()})},bindClickModalLi=function(){$(".modal .menu-li").click(function(){var e=$(this).data("check");e===0?($(this).data("check",1),$(this).find(".dropdown-menu").slideDown(200)):($(this).data("check",0),$(this).find(".dropdown-menu").slideUp(200)),$(this).find(".menu-span").toggleClass("up")})},bindClickClose=function(){$("#close-join").click(function(){$(".navigation .join-div").hide(),$(".main-section").removeClass("padding")})},language="zh",bindClickClose(),bindScrollChangeHeader(),$(".header-container .menu-li").each(function(){bindNavMouseEvent("",$(this))}),bindNavMouseEvent(".header-container .language-menu"),bindNavMouseEvent(".header-container .btn-li"),bindClickShowMenu(),bindClickModalLi(),handleLangClick=function(e,t){try{localStorage.setItem("lang",e)}catch{}location.href=t}</script><section class=main-section><div class=common-layout><div class=breadcrumb><span><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a> > </span><span>KubeKey ç¦»çº¿éƒ¨ç½² KubeSphere v3.4.1 å’Œ K8s v1.26 å®æˆ˜æŒ‡å—</span></div><div class='main-div middle-div'><div class=author>è¿ç»´æœ‰æœ¯</div><span class=date>å‘å¸ƒäºï¼š2023-12-13</span>&nbsp;&nbsp;&nbsp;
<span style=font-size:14px;color:#919aa3 id=busuanzi_container_page_pv>æœ¬æ–‡æ€»é˜…è¯»é‡ï¼š<span id=busuanzi_value_page_pv></span></span><h1>KubeKey ç¦»çº¿éƒ¨ç½² KubeSphere v3.4.1 å’Œ K8s v1.26 å®æˆ˜æŒ‡å—</h1><div class=share-1><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploying-kubesphere-and-k8s-offline-with-kubekey%2f&text=KubeKey%20%e7%a6%bb%e7%ba%bf%e9%83%a8%e7%bd%b2%20KubeSphere%20v3.4.1%20%e5%92%8c%20K8s%20v1.26%20%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploying-kubesphere-and-k8s-offline-with-kubekey%2f&title=KubeKey%20%e7%a6%bb%e7%ba%bf%e9%83%a8%e7%bd%b2%20KubeSphere%20v3.4.1%20%e5%92%8c%20K8s%20v1.26%20%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploying-kubesphere-and-k8s-offline-with-kubekey%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploying-kubesphere-and-k8s-offline-with-kubekey%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploying-kubesphere-and-k8s-offline-with-kubekey%2f&t=KubeKey%20%e7%a6%bb%e7%ba%bf%e9%83%a8%e7%bd%b2%20KubeSphere%20v3.4.1%20%e5%92%8c%20K8s%20v1.26%20%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div><div class=content><div class=md-body><h2 id=å‰è¨€>å‰è¨€</h2><h3 id=çŸ¥è¯†ç‚¹>çŸ¥è¯†ç‚¹</h3><ul><li>å®šçº§ï¼š<strong>å…¥é—¨çº§</strong></li><li>äº†è§£æ¸…å• (manifest) å’Œåˆ¶å“ (artifact) çš„æ¦‚å¿µ</li><li>æŒæ¡ manifest æ¸…å•çš„ç¼–å†™æ–¹æ³•</li><li>æ ¹æ® manifest æ¸…å•åˆ¶ä½œ artifact</li><li>KubeKey ç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶ç¼–å†™</li><li>KubeKey ç¦»çº¿éƒ¨ç½² Harbor</li><li>KubeKey ç¦»çº¿éƒ¨ç½² KubeSphere å’Œ K8s</li><li>KubeKey ç¦»çº¿éƒ¨ç½²å¸¸è§é—®é¢˜æ’æŸ¥å¤„ç†</li></ul><h3 id=å®æˆ˜æœåŠ¡å™¨é…ç½®>å®æˆ˜æœåŠ¡å™¨é…ç½®</h3><table><thead><tr><th style=text-align:center>ä¸»æœºå</th><th style=text-align:center>IP</th><th style=text-align:center>CPU</th><th style=text-align:center>å†…å­˜</th><th style=text-align:center>ç³»ç»Ÿç›˜</th><th style=text-align:center>æ•°æ®ç›˜</th><th style=text-align:center>ç”¨é€”</th></tr></thead><tbody><tr><td style=text-align:center>ksp-master-1</td><td style=text-align:center>192.168.9.91</td><td style=text-align:center>8</td><td style=text-align:center>16</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>ç¦»çº¿ç¯å¢ƒ KubeSphere/k8s-master</td></tr><tr><td style=text-align:center>ksp-master-2</td><td style=text-align:center>192.168.9.92</td><td style=text-align:center>8</td><td style=text-align:center>16</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>ç¦»çº¿ç¯å¢ƒ KubeSphere/k8s-master</td></tr><tr><td style=text-align:center>ksp-master-3</td><td style=text-align:center>192.168.9.93</td><td style=text-align:center>8</td><td style=text-align:center>16</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>ç¦»çº¿ç¯å¢ƒ KubeSphere/k8s-master</td></tr><tr><td style=text-align:center>ksp-registry</td><td style=text-align:center>192.168.9.90</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>ç¦»çº¿ç¯å¢ƒé•œåƒä»“åº“èŠ‚ç‚¹ï¼ˆHarborï¼‰</td></tr><tr><td style=text-align:center>ksp-deploy</td><td style=text-align:center>192.168.9.89</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>è”ç½‘ä¸»æœºç”¨äºåˆ¶ä½œç¦»çº¿åŒ…</td></tr><tr><td style=text-align:center>åˆè®¡</td><td style=text-align:center>4</td><td style=text-align:center>32</td><td style=text-align:center>64</td><td style=text-align:center>200</td><td style=text-align:center>500</td><td style=text-align:center></td></tr></tbody></table><h3 id=å®æˆ˜ç¯å¢ƒæ¶‰åŠè½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯>å®æˆ˜ç¯å¢ƒæ¶‰åŠè½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯</h3><ul><li>æ“ä½œç³»ç»Ÿï¼š<strong>CentOS 7.9 x86_64</strong></li><li>KubeSphereï¼š<strong>v3.4.1</strong></li><li>K8sï¼š<strong>v1.26.5</strong></li><li>Containerdï¼š<strong>1.6.4</strong></li><li>KubeKey: <strong>v3.0.13</strong></li><li>Harborï¼š<strong>2.5.3</strong></li></ul><h2 id=1-ç®€ä»‹>1. ç®€ä»‹</h2><p>KubeKey ä» v2.1.0 ç‰ˆå¼€å§‹æ–°å¢äº†æ¸…å• (manifest) å’Œåˆ¶å“ (artifact) çš„æ¦‚å¿µï¼Œä¸ºç”¨æˆ·ç¦»çº¿éƒ¨ç½² KubeSphere å’Œ K8s é›†ç¾¤æä¾›äº†ä¸€ç§ç®€å•ä¾¿æ·çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>manifest æ˜¯ä¸€ä¸ªæè¿°å½“å‰ Kubernetes é›†ç¾¤ä¿¡æ¯å’Œå®šä¹‰ artifact åˆ¶å“ä¸­éœ€è¦åŒ…å«å“ªäº›å†…å®¹çš„æ–‡æœ¬æ–‡ä»¶ã€‚</p><p>ä½¿ç”¨ KubeKeyï¼Œç”¨æˆ·åªéœ€ä½¿ç”¨æ¸…å• manifest æ–‡ä»¶æ¥å®šä¹‰å°†è¦ç¦»çº¿éƒ¨ç½²çš„é›†ç¾¤ç¯å¢ƒéœ€è¦çš„å†…å®¹ï¼Œå†é€šè¿‡è¯¥ manifest æ¥å¯¼å‡ºåˆ¶å“ artifact æ–‡ä»¶å³å¯å®Œæˆå‡†å¤‡å·¥ä½œã€‚ç¦»çº¿éƒ¨ç½²æ—¶åªéœ€è¦ KubeKey å’Œ artifact å°±å¯å¿«é€Ÿã€ç®€å•çš„åœ¨ç¯å¢ƒä¸­éƒ¨ç½²é•œåƒä»“åº“ Harbor å’Œ KubeSphere ä»¥åŠ K8s é›†ç¾¤ã€‚</p><p>KubeKey ç”Ÿæˆ manifest æ–‡ä»¶æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>åˆ©ç”¨ç°æœ‰è¿è¡Œä¸­çš„é›†ç¾¤ä½œä¸ºæºç”Ÿæˆ manifest æ–‡ä»¶ï¼Œä¹Ÿæ˜¯å®˜æ–¹æ¨èçš„ä¸€ç§æ–¹å¼ï¼Œå…·ä½“å‚è€ƒ KubeSphere <a href=https://www.kubesphere.io/zh/docs/v3.4/installing-on-linux/introduction/air-gapped-installation/ target=_blank rel="noopener noreferrer">å®˜ç½‘çš„ç¦»çº¿éƒ¨ç½²æ–‡æ¡£</a>ã€‚</li><li>æ ¹æ® <a href=https://github.com/kubesphere/kubekey/blob/master/docs/manifest-example.md target=_blank rel="noopener noreferrer">manifest æ¨¡æ¿æ–‡ä»¶</a> æ‰‹åŠ¨ç¼–å†™ manifest æ–‡ä»¶ã€‚</li></ul><p>ç¬¬ä¸€ç§æ–¹å¼çš„å¥½å¤„æ˜¯å¯ä»¥æ ¹æ® 1:1 çš„è¿è¡Œé›†ç¾¤æ„å»ºç¦»çº¿é›†ç¾¤ï¼Œä¾èµ–äºå·²æœ‰é›†ç¾¤ï¼Œçµæ´»åº¦ä¸å¤Ÿï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰äººéƒ½å…·å¤‡è¿™ç§æ¡ä»¶ã€‚</p><p>å› æ­¤ï¼Œæœ¬æ–‡å‚è€ƒå®˜æ–¹çš„ç¦»çº¿æ–‡æ¡£ï¼Œé‡‡ç”¨<strong>æ‰‹å†™ manifest</strong> æ¸…å•æ–‡ä»¶çš„æ–¹å¼ï¼Œå®ç°ç¦»çº¿ç¯å¢ƒçš„å®‰è£…éƒ¨ç½²ã€‚</p><h2 id=2-ç¦»çº¿éƒ¨ç½²èµ„æºåˆ¶ä½œ>2. ç¦»çº¿éƒ¨ç½²èµ„æºåˆ¶ä½œ</h2><p>åˆ¶ä½œç¦»çº¿éƒ¨ç½²èµ„æºéœ€è¦æ‰¾ä¸€å°èƒ½è”é€šäº’è”ç½‘çš„èŠ‚ç‚¹ï¼Œæœ¬æ–‡ä¸ºäº†èµ„æºçš„åˆ¶ä½œå’Œç¦»çº¿éƒ¨ç½²éªŒè¯ï¼Œå•ç‹¬å¢åŠ äº†ä¸€ä¸ªèƒ½è”ç½‘çš„ <strong>ksp-deploy</strong> èŠ‚ç‚¹ã€‚</p><p>åœ¨è¯¥èŠ‚ç‚¹ä¸‹è½½ KubeKey ï¼ˆä¸‹æ–‡ç®€ç§° KKï¼‰æœ€æ–°ç‰ˆï¼ˆ<strong>v3.0.13</strong>ï¼‰ã€‚å…·ä½“ KK ç‰ˆæœ¬å·å¯ä»¥åœ¨ <a href=https://github.com/kubesphere/kubekey/releases target=_blank rel="noopener noreferrer">KubeKey å‘è¡Œé¡µé¢</a> æŸ¥çœ‹ã€‚</p><h3 id=21-ä¸‹è½½-kubekey>2.1. ä¸‹è½½ KubeKey</h3><ul><li>ä¸‹è½½æœ€æ–°ç‰ˆçš„ KubeKey</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd ~
</span></span><span style=display:flex><span>mkdir kubekey
</span></span><span style=display:flex><span>cd kubekey/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é€‰æ‹©ä¸­æ–‡åŒºä¸‹è½½(è®¿é—® GitHub å—é™æ—¶ä½¿ç”¨)</span>
</span></span><span style=display:flex><span>export KKZONE<span style=color:#f92672>=</span>cn
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œä¸‹è½½å‘½ä»¤ï¼Œè·å–æœ€æ–°ç‰ˆçš„ kkï¼ˆå—é™äºç½‘ç»œï¼Œæœ‰æ—¶éœ€è¦æ‰§è¡Œå¤šæ¬¡ï¼‰</span>
</span></span><span style=display:flex><span>curl -sfL https://get-kk.kubesphere.io | sh -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŒ‡å®šå…·ä½“ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>curl -sfL https://get-kk.kubesphere.io | VERSION<span style=color:#f92672>=</span>v3.0.13 sh -
</span></span></code></pre></div><h3 id=22-è·å–-manifest-æ¨¡æ¿>2.2. è·å– manifest æ¨¡æ¿</h3><p>manifest æ–‡ä»¶çš„ç¼–å†™å¯ä»¥å‚è€ƒ <a href=https://github.com/kubesphere/kubekey/blob/master/docs/manifest-example.md target=_blank rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹æ–‡æ¡£</a>ã€‚æœ‰ä¸¤ä¸ªå¯ç”¨å‚è€ƒç”¨ä¾‹ï¼Œä¸€ä¸ªç®€å•ç‰ˆï¼Œä¸€ä¸ªå®Œæ•´ç‰ˆã€‚å‚è€ƒç®€å•ç‰ˆå³å¯ã€‚</p><p>å—é™äºç¯‡å¹…ï¼Œæœ¬æ–‡ä¸å±•ç¤ºåŸå§‹çš„ç¤ºä¾‹æ–‡ä»¶ï¼Œå»ºè®®è¯»è€…ä»”ç»†é˜…è¯»å®˜æ–¹ç¤ºä¾‹ï¼Œç†è§£æ¯ä¸€é¡¹é…ç½®çš„å«ä¹‰åæ ¹æ®éœ€æ±‚æ”¹å†™ï¼ˆ<strong>æš‚æ—¶æ— æ³•ç†è§£çš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹æ–‡æä¾›çš„æˆå“é…ç½®æ–‡ä»¶</strong>ï¼‰ã€‚</p><h3 id=23-è·å–-images-list-åŠå¯è£å‰ªæ€§åˆ†æ>2.3. è·å– images-list åŠå¯è£å‰ªæ€§åˆ†æ</h3><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è·å–å®˜æ–¹ releases v3.4.1 å¯¹åº”çš„ images-listï¼ˆæœ€ç»ˆå®éªŒç»“æœï¼Œä¸€äº›é•œåƒéœ€è¦è‡ªè¡Œæ•´ç†ï¼Œå®Œæ•´çš„é•œåƒåˆ—è¡¨å¯å‚è€ƒä¸‹æ–‡ä¸­çš„ manifest æ–‡ä»¶ï¼‰ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wget https://github.com/kubesphere/ks-installer/releases/download/v3.4.1/images-list.txt
</span></span></code></pre></div><p>å®Œæ•´çš„ Imageï¼ˆ<strong>136 ä¸ª</strong>ï¼‰ åˆ†ç±»åŠå¯è£å‰ªæ€§ï¼ˆ<strong>å¿…é¡»ç•™çš„æœ‰æ ‡ç²—ï¼Œä¸ªäººåˆ¤æ–­ï¼Œæœªå¿…ç²¾å‡†</strong>ï¼‰ï¼š</p><ul><li>kubesphere-imagesï¼ˆ<strong>18 ä¸ªï¼Œä¸å¯è£å‰ª</strong>ï¼‰</li><li>kubeedge-imagesï¼ˆ3 ä¸ªï¼Œå¯è£å‰ªï¼Œå–å†³äºæ˜¯å¦å¯ç”¨ kubeedgeï¼‰</li><li>gatekeeper-imagesï¼ˆ1 ä¸ªï¼Œå¯è£å‰ªï¼Œå–å†³äºæ˜¯å¦å¯ç”¨ gatekeeperï¼Œå»ºè®®ä¿ç•™ï¼‰</li><li>openpitrix-imagesï¼ˆ<strong>1 ä¸ªï¼Œå¯è£å‰ªä½†æ˜¯åŸºæœ¬éƒ½ä¼šç”¨åˆ°ï¼Œå»ºè®®ä¿ç•™</strong>ï¼‰</li><li>kubesphere-devops-imagesï¼ˆ45 ä¸ªï¼Œæ„å»ºç”¨çš„å¼€å‘ç¯å¢ƒé•œåƒå¯è£å‰ªï¼Œå‰ç¼€å¸¦ builder-ã€tomcat85-ã€java-ã€nodejs-ã€python- è¿™ä¸€ç±»çš„éƒ½å¯ä»¥é…Œæƒ…å¤„ç†ï¼‰</li><li>kubesphere-monitoring-imagesï¼ˆ<strong>14 ä¸ªï¼Œä¸å¯è£å‰ª</strong>ï¼‰</li><li>kubesphere-logging-imagesï¼ˆ15 ä¸ªï¼Œèƒ½è£å‰ªçš„ä¹Ÿå°±æ˜¯ elasticsearch- å’Œ opensearch å¼€å¤´çš„ï¼ŒKubeSphere v3.4.1 é»˜è®¤é€‰æ‹© opensearchï¼Œå»ºè®®éƒ½ä¿ç•™ï¼‰</li><li>istio-imagesï¼ˆ9 ä¸ªï¼Œå¯è£å‰ªï¼Œå–å†³äºæ˜¯å¦å¯ç”¨ istioï¼Œå»ºè®®ä¿ç•™ï¼‰</li><li>example-imagesï¼ˆ13 ä¸ªï¼Œå¯è£å‰ªï¼‰</li><li>weave-scope-imagesï¼ˆ1 ä¸ªï¼Œå¯è£å‰ªï¼Œå–å†³äºæ˜¯å¦å¯ç”¨ weaveï¼‰</li><li><strong>å®˜æ–¹åˆ—è¡¨ä¸­æœªåˆ—å‡ºçš„æ ¸å¿ƒ images</strong>ï¼ˆ12 ä¸ªï¼Œå¿…é¡»ï¼Œå¦åˆ™éƒ¨ç½²æ—¶æŠ¥é”™ï¼‰</li><li><strong>å®˜æ–¹åˆ—è¡¨ä¸­æœªåˆ—å‡ºçš„å¿…è¦ images</strong>ï¼ˆ4 ä¸ªï¼Œå¿…é¡»ï¼Œå¦åˆ™éƒ¨ç½²æ—¶æŠ¥é”™ï¼‰</li></ul><p>ä¸ºäº†ä¿æŒå®Œæ•´æ€§ï¼Œæœ¬æ–‡ä½¿ç”¨äº†æ‰€æœ‰ Imageï¼Œåªæ˜¯ä¿®æ”¹äº†é•œåƒå‰ç¼€ä¸º <strong>registry.cn-beijing.aliyuncs.com/kubesphereio</strong>ï¼Œä¿®æ”¹åçš„å®Œæ•´çš„é•œåƒåˆ—è¡¨åœ¨ä¸‹é¢çš„ manifest æ–‡ä»¶ä¸­å±•ç¤ºï¼Œè¯»è€…å¯æ ¹æ®éœ€æ±‚è£å‰ªã€‚</p><h3 id=24-è·å–æ“ä½œç³»ç»Ÿä¾èµ–åŒ…>2.4. è·å–æ“ä½œç³»ç»Ÿä¾èµ–åŒ…</h3><p>æœ¬å®éªŒç¯å¢ƒä½¿ç”¨çš„æ“ä½œç³»ç»Ÿæ˜¯ x64 çš„ CentOS 7.9ï¼Œæ‰€ä»¥åªä¸‹è½½ centos7 çš„æ“ä½œç³»ç»Ÿä¾èµ–åŒ…ï¼Œå…¶ä»–æ“ä½œç³»ç»Ÿè¯·è¯»è€…åœ¨ <a href=https://github.com/kubesphere/kubekey/releases target=_blank rel="noopener noreferrer">KubeKey releases é¡µé¢</a>ä¸‹è½½ã€‚</p><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œåœ¨èƒ½è”ç½‘çš„éƒ¨ç½²æœåŠ¡å™¨ä¸Šæ‰§è¡Œä¸‹è½½ã€‚ç½‘ç»œè®¿é—®å—é™æ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼ï¼Œå°†è¯¥ ISO ä¸‹è½½åæ”¾åˆ°åˆ¶ä½œç¦»çº¿é•œåƒçš„æœåŠ¡å™¨çš„ /root/kubekey ç›®å½•ä¸‹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wget https://github.com/kubesphere/kubekey/releases/download/v3.0.12/centos7-rpms-amd64.iso
</span></span></code></pre></div><blockquote><p>è¯´æ˜ï¼šKubeKey v3.0.13 çš„ release ä¸­æ²¡åŒ…ï¼Œåªèƒ½åœ¨ v3.0.12 çš„ releases ä¸­ä¸‹è½½ã€‚</p></blockquote><p>æœ€ç»ˆçš„ ISOï¼ˆ<strong>centos7-rpms-amd64.isoï¼Œ314 MB</strong>ï¼‰å®é™…ä¿¡æ¯å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æŸ¥çœ‹æ–‡ä»¶å¤§å°</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-deploy kubekey<span style=color:#f92672>]</span><span style=color:#75715e># ll -h centos7-rpms-amd64.iso</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root 315M Oct <span style=color:#ae81ff>23</span> 18:21 centos7-rpms-amd64.iso
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éªŒè¯ sha256sumï¼Œç¡®ä¿ ISO åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­æ²¡å‡ºé—®é¢˜ï¼ˆå®˜æ–¹æä¾›çš„ sha256sum ä¿¡æ¯åœ¨ https://github.com/kubesphere/kubekey/releases/download/v3.0.12/centos7-rpms.iso.sha256sum.txtï¼‰</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-deploy kubekey<span style=color:#f92672>]</span><span style=color:#75715e># sha256sum centos7-rpms-amd64.iso</span>
</span></span><span style=display:flex><span>2588fbc12acc9f3b95766a0c20382988f2a21da2a36e444b7e1a0f523e75f858  centos7-rpms-amd64.iso
</span></span></code></pre></div><h3 id=25-ç”Ÿæˆ-manifest-æ–‡ä»¶>2.5. ç”Ÿæˆ manifest æ–‡ä»¶</h3><p>æ ¹æ®ä¸Šé¢çš„æ–‡ä»¶åŠç›¸å…³ä¿¡æ¯ï¼Œç”Ÿæˆæœ€ç»ˆ <strong>manifest.yaml</strong>ã€‚</p><p>å‘½åä¸º <strong>ksp-v3.4.1-manifest.yaml</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kubekey.kubesphere.io/v1alpha2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Manifest</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>sample</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>arches</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>amd64</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>operatingSystems</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>arch</span>: <span style=color:#ae81ff>amd64</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>linux</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>centos</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;7&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>osImage</span>: <span style=color:#ae81ff>CentOS Linux 7 (Core)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>repository</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>iso</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>localPath</span>: <span style=color:#e6db74>&#34;/root/kubekey/centos7-rpms-amd64.iso&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>url</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>kubernetesDistributions</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>kubernetes</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>version</span>: <span style=color:#ae81ff>v1.26.5</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>components</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>helm</span>: 
</span></span><span style=display:flex><span>      <span style=color:#f92672>version</span>: <span style=color:#ae81ff>v3.9.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>cni</span>: 
</span></span><span style=display:flex><span>      <span style=color:#f92672>version</span>: <span style=color:#ae81ff>v1.2.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>etcd</span>: 
</span></span><span style=display:flex><span>      <span style=color:#f92672>version</span>: <span style=color:#ae81ff>v3.4.13</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>calicoctl</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>version</span>: <span style=color:#ae81ff>v3.26.1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>containerRuntimes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>docker</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>version</span>: <span style=color:#ae81ff>20.10.23</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>containerd</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>version</span>: <span style=color:#ae81ff>1.6.4</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>crictl</span>: 
</span></span><span style=display:flex><span>      <span style=color:#f92672>version</span>: <span style=color:#ae81ff>v1.24.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>docker-registry</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;2&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>harbor</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>version</span>: <span style=color:#ae81ff>v2.5.3</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>docker-compose</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>version</span>: <span style=color:#ae81ff>v2.2.2</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>images</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/ks-installer:v3.4.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/ks-apiserver:v3.4.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/ks-console:v3.4.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/ks-controller-manager:v3.4.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kubectl:v1.20.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kubefed:v0.8.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/tower:v0.2.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/minio:RELEASE.2019-08-07T01-59-21Z</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/mc:RELEASE.2019-08-07T23-14-43Z</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/snapshot-controller:v4.0.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/nginx-ingress-controller:v1.3.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/defaultbackend-amd64:1.4</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/metrics-server:v0.4.2</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/redis:5.0.14-alpine</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/haproxy:2.0.25-alpine</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/alpine:3.14</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/openldap:1.3.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/netshoot:v1.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/cloudcore:v1.13.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/iptables-manager:v1.13.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/edgeservice:v0.3.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/gatekeeper:v3.5.2</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/openpitrix-jobs:v3.3.2</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/devops-apiserver:ks-v3.4.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/devops-controller:ks-v3.4.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/devops-tools:ks-v3.4.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/ks-jenkins:v3.4.0-2.319.3-1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/inbound-agent:4.10-2</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-base:v3.2.2</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-nodejs:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.1-jdk11</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-python:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.16</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.17</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.18</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-base:v3.2.2-podman</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-nodejs:v3.2.0-podman</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.0-podman</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.1-jdk11-podman</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-python:v3.2.0-podman</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.0-podman</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.16-podman</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.17-podman</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.18-podman</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/s2ioperator:v3.2.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/s2irun:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/s2i-binary:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/tomcat85-java11-centos7:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/tomcat85-java11-runtime:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/tomcat85-java8-centos7:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/tomcat85-java8-runtime:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/java-11-centos7:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/java-8-centos7:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/java-8-runtime:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/java-11-runtime:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/nodejs-8-centos7:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/nodejs-6-centos7:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/nodejs-4-centos7:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/python-36-centos7:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/python-35-centos7:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/python-34-centos7:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/python-27-centos7:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/argocd:v2.3.3</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/argocd-applicationset:v0.4.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/dex:v2.30.2</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/redis:6.2.6-alpine</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/configmap-reload:v0.7.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/prometheus:v2.39.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/prometheus-config-reloader:v0.55.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/prometheus-operator:v0.55.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-rbac-proxy:v0.11.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-state-metrics:v2.6.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/node-exporter:v1.3.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/alertmanager:v0.23.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/thanos:v0.31.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/grafana:8.3.3</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-rbac-proxy:v0.11.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/notification-manager-operator:v2.3.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/notification-manager:v2.3.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/notification-tenant-sidecar:v3.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/elasticsearch-curator:v5.7.6</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/opensearch-curator:v0.0.5</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/elasticsearch-oss:6.8.22</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/opensearch:2.6.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/opensearch-dashboards:2.6.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/fluentbit-operator:v0.14.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/docker:19.03</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/fluent-bit:v1.9.4</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/log-sidecar-injector:v1.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/filebeat:6.7.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-events-operator:v0.6.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-events-exporter:v0.6.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-events-ruler:v0.6.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-auditing-operator:v0.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-auditing-webhook:v0.2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/pilot:1.14.6</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/proxyv2:1.14.6</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-operator:1.29</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-agent:1.29</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-collector:1.29</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-query:1.29</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-es-index-cleaner:1.29</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kiali-operator:v1.50.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kiali:v1.50</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/busybox:1.31.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/nginx:1.14-alpine</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/wget:1.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/hello:plain-text</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/wordpress:4.8-apache</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/hpa-example:latest</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/fluentd:v1.4.2-2.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/perl:latest</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/examples-bookinfo-productpage-v1:1.16.2</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/examples-bookinfo-reviews-v1:1.16.2</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/examples-bookinfo-reviews-v2:1.16.2</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/examples-bookinfo-details-v1:1.16.2</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/examples-bookinfo-ratings-v1:1.16.3</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/scope:1.13.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/pause:3.8</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/pause:3.9</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-apiserver:v1.26.5</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-controller-manager:v1.26.5</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-scheduler:v1.26.5</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-proxy:v1.26.5</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/k8s-dns-node-cache:1.15.12</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/coredns:1.9.3</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-controllers:v3.26.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/cni:v3.26.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/node:v3.26.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/pod2daemon-flexvol:v3.26.1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/haproxy:2.3</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/provisioner-localpv:3.3.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/linux-utils:3.3.0</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>registry.cn-beijing.aliyuncs.com/kubesphereio/kubectl:v1.22.0</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>kubectl:v1.22.0</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>registry</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>auths</span>: {}
</span></span></code></pre></div><blockquote><p><strong>manifest ä¿®æ”¹è¯´æ˜</strong></p><ul><li><p><strong>æœ€åçš„ 16 ä¸ªé•œåƒå°±æ˜¯å®˜æ–¹ images-list æ–‡ä»¶ç¼ºå¤±çš„é•œåƒï¼Œä¸€å®šè¦æ‰‹å·¥è¡¥å……åœ¨ list ä¸­</strong></p></li><li><p>kubernetes ç‰ˆæœ¬ï¼šv1.26.5</p></li><li><p>å…¶ä»–ç»„ä»¶ç‰ˆæœ¬çš„é€‰æ‹©ï¼šä¸ªäººæ˜¯æ ¹æ® kubekey åœ¨çº¿å®‰è£…è¿‡ç¨‹çš„æ—¥å¿—ï¼ŒæŸ¥æ‰¾ç›¸å…³ç»„ä»¶çš„å¯¹åº”ç‰ˆæœ¬ï¼Œä»¥åŠå‚è€ƒå®˜æ–¹çš„æ–‡æ¡£ <a href=https://github.com/kubesphere/kubekey/blob/v3.0.13/docs/components-versions.md target=_blank rel="noopener noreferrer">ç»„ä»¶é»˜è®¤ç‰ˆæœ¬è¯´æ˜</a>ã€<a href=https://github.com/kubesphere/kubekey/blob/v3.0.13/cmd/kk/apis/kubekey/v1alpha2/default.go target=_blank rel="noopener noreferrer">ç»„ä»¶é»˜è®¤ç‰ˆæœ¬æºç </a> ã€<a href=https://github.com/kubesphere/kubekey/blob/v3.0.13/version/components.json target=_blank rel="noopener noreferrer">æ”¯æŒçš„ç»„ä»¶åˆ—è¡¨</a> å’Œ <a href=https://github.com/kubesphere/kubekey/blob/v3.0.13/cmd/kk/pkg/artifact/manifest.go target=_blank rel="noopener noreferrer">åˆ¶å“æ¸…å•æºç </a></p></li><li><p>å¼€å¯ <strong>harbor</strong> å’Œ <strong>docker-compose</strong> é…ç½®é¡¹ï¼Œä¸ºåé¢é€šè¿‡ KubeKey è‡ªå»º harbor ä»“åº“æ¨é€é•œåƒä½¿ç”¨ã€‚</p></li><li><p>é»˜è®¤åˆ›å»ºçš„ manifest é‡Œé¢çš„é•œåƒåˆ—è¡¨ä» <strong>docker.io</strong> è·å–ï¼Œæ›¿æ¢å‰ç¼€ä¸º <strong>registry.cn-beijing.aliyuncs.com/kubesphereio</strong>ã€‚</p></li><li><p>è‹¥éœ€è¦å¯¼å‡ºçš„ artifact æ–‡ä»¶ä¸­åŒ…å«æ“ä½œç³»ç»Ÿä¾èµ–æ–‡ä»¶ï¼ˆå¦‚ï¼šconntarckã€chrony ç­‰ï¼‰ï¼Œå¯åœ¨ <strong>operationSystem</strong> å…ƒç´ ä¸­çš„ <strong>.repostiory.iso.url</strong> ä¸­é…ç½®ç›¸åº”çš„ ISO ä¾èµ–æ–‡ä»¶ä¸‹è½½åœ°å€ä¸º <strong>localPath</strong> ï¼Œå¡«å†™æå‰ä¸‹è½½å¥½çš„ ISO åŒ…åœ¨æœ¬åœ°çš„å­˜æ”¾è·¯å¾„ï¼Œå¹¶å°† <strong>url</strong> é…ç½®é¡¹ç½®ç©ºã€‚</p></li><li><p>æ‚¨å¯ä»¥è®¿é—® <code>https://github.com/kubesphere/kubekey/releases/tag/v3.0.12</code> ä¸‹è½½ ISO æ–‡ä»¶ã€‚</p></li></ul></blockquote><h3 id=26-å¯¼å‡ºåˆ¶å“-artifact>2.6. å¯¼å‡ºåˆ¶å“ artifact</h3><p><strong>åˆ¶å“ (artifact) è¯´æ˜</strong></p><ul><li><p>åˆ¶å“ï¼ˆartifactï¼‰æ˜¯ä¸€ä¸ªæ ¹æ®æŒ‡å®šçš„ manifest æ–‡ä»¶å†…å®¹å¯¼å‡ºçš„åŒ…å«é•œåƒ tar åŒ…å’Œç›¸å…³äºŒè¿›åˆ¶æ–‡ä»¶çš„ tgz åŒ…ã€‚</p></li><li><p>åœ¨ KubeKey åˆå§‹åŒ–é•œåƒä»“åº“ã€åˆ›å»ºé›†ç¾¤ã€æ·»åŠ èŠ‚ç‚¹å’Œå‡çº§é›†ç¾¤çš„å‘½ä»¤ä¸­å‡å¯æŒ‡å®šä¸€ä¸ª artifactï¼ŒKubeKey å°†è‡ªåŠ¨è§£åŒ…è¯¥ artifact å¹¶åœ¨æ‰§è¡Œå‘½ä»¤æ—¶ç›´æ¥ä½¿ç”¨è§£åŒ…å‡ºæ¥çš„æ–‡ä»¶ã€‚</p></li><li><p>å¯¼å‡ºæ—¶è¯·ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸ã€‚</p></li><li><p>KubeKey ä¼šè§£æé•œåƒåˆ—è¡¨ä¸­çš„é•œåƒåï¼Œè‹¥é•œåƒåä¸­çš„é•œåƒä»“åº“éœ€è¦é‰´æƒä¿¡æ¯ï¼Œå¯åœ¨ manifest æ–‡ä»¶ä¸­çš„ <strong>.registry.auths</strong> å­—æ®µä¸­è¿›è¡Œé…ç½®ï¼ˆ<strong>æœ¬æ–‡æœªé…ç½®</strong>ï¼‰ã€‚</p></li></ul><p>æ ¹æ®ç”Ÿæˆçš„ manifestï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤åˆ¶ä½œåˆ¶å“ï¼ˆartifactï¼‰ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>export KKZONE<span style=color:#f92672>=</span>cn
</span></span><span style=display:flex><span>./kk artifact export -m ksp-v3.4.1-manifest.yaml -o ksp-v3.4.1-artifact.tar.gz
</span></span></code></pre></div><p>åˆ¶ä½œå®Œæˆåï¼Œæˆ‘ä»¬ç®€å•æŸ¥çœ‹ä¸€ä¸‹åˆ¶ä½œçš„åˆ¶å“åŒ…å«å“ªäº›å†…å®¹ã€‚</p><ul><li>æŸ¥çœ‹ KubeKey ç›®å½•å†…å®¹</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ¶ä½œå®ŒæˆåæŸ¥çœ‹ç»“æœ</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-deploy kubekey<span style=color:#f92672>]</span><span style=color:#75715e># ls -lh</span>
</span></span><span style=display:flex><span>total 14G
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root 315M Oct <span style=color:#ae81ff>23</span> 18:21 centos7-rpms-amd64.iso
</span></span><span style=display:flex><span>-rwxr-xr-x. <span style=color:#ae81ff>1</span> root root  76M Nov  <span style=color:#ae81ff>7</span> 16:43 kk
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root  13G Dec <span style=color:#ae81ff>12</span> 13:08 ksp-v3.4.1-artifact.tar.gz
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root  11K Dec <span style=color:#ae81ff>12</span> 11:23 ksp-v3.4.1-manifest.yaml
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>3</span> root root   <span style=color:#ae81ff>18</span> Dec <span style=color:#ae81ff>12</span> 13:08 kubekey
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root  35M Dec  <span style=color:#ae81ff>8</span> 10:33 kubekey-v3.0.13-linux-amd64.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ¶ä½œè¿‡ç¨‹ä¸­æ•æ‰çš„å†…å®¹ï¼Œå¯èƒ½ä¸å…¨ï¼ˆåˆ¶ä½œå®Œæˆå kubekey/artifact ç›®å½•ä¼šè¢«æ¸…ç†ï¼‰</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-deploy kubekey<span style=color:#f92672>]</span><span style=color:#75715e># du -sh kubekey/*</span>
</span></span><span style=display:flex><span>13G     kubekey/artifact
</span></span><span style=display:flex><span>88K     kubekey/logs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-deploy kubekey<span style=color:#f92672>]</span><span style=color:#75715e># du -sh kubekey/artifact/*</span>
</span></span><span style=display:flex><span>102M    kubekey/artifact/cni
</span></span><span style=display:flex><span>43M     kubekey/artifact/containerd
</span></span><span style=display:flex><span>14M     kubekey/artifact/crictl
</span></span><span style=display:flex><span>130M    kubekey/artifact/docker
</span></span><span style=display:flex><span>17M     kubekey/artifact/etcd
</span></span><span style=display:flex><span>45M     kubekey/artifact/helm
</span></span><span style=display:flex><span>12G     kubekey/artifact/images
</span></span><span style=display:flex><span>207M    kubekey/artifact/kube
</span></span><span style=display:flex><span>660M    kubekey/artifact/registry
</span></span><span style=display:flex><span>315M    kubekey/artifact/repository
</span></span><span style=display:flex><span>9.0M    kubekey/artifact/runc
</span></span></code></pre></div><ul><li>æŸ¥çœ‹åˆ¶å“å¤§å°ï¼ˆå…¨é•œåƒï¼Œåˆ¶å“åŒ…å±…ç„¶è¾¾åˆ°äº† 13Gï¼Œç”Ÿäº§ç¯å¢ƒè¿˜æ˜¯æœ‰é€‰æ‹©çš„è£å‰ªå§ï¼‰</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-deploy kubekey<span style=color:#f92672>]</span><span style=color:#75715e># ls -lh ksp-v3.4.1-artifact.tar.gz</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root 13G Dec <span style=color:#ae81ff>12</span> 13:08 ksp-v3.4.1-artifact.tar.gz
</span></span></code></pre></div><h3 id=27-å¯¼å‡º-kubekey>2.7. å¯¼å‡º KubeKey</h3><p>æŠŠ KubeKey å·¥å…·ä¹Ÿåˆ¶ä½œæˆå‹ç¼©åŒ…ï¼Œä¾¿äºæ‹·è´åˆ°ç¦»çº¿èŠ‚ç‚¹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># å‹ç¼©</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-deploy kubekey<span style=color:#f92672>]</span><span style=color:#75715e># tar zcvf kubekey-v3.0.13.tar.gz kk kubekey-v3.0.13-linux-amd64.tar.gz</span>
</span></span></code></pre></div><h3 id=28-kernel-å‡çº§åŒ…>2.8. Kernel å‡çº§åŒ…</h3><p><strong>CentOS 7.9 çš„é»˜è®¤å†…æ ¸æ¯”è¾ƒè€ï¼Œå»ºè®®å‡çº§æ“ä½œç³»ç»Ÿå†…æ ¸ï¼ˆå…·ä½“æ˜¯å¦å‡çº§è¯·æ ¹æ®å®é™…ç¯å¢ƒè‡ªè¡Œå†³å®šï¼‰</strong>ã€‚</p><ul><li>ä¸‹è½½ Kernel å‡çº§åŒ…</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://mirrors.tuna.tsinghua.edu.cn/elrepo/kernel/el7/x86_64/RPMS/kernel-lt-5.4.263-1.el7.elrepo.x86_64.rpm
</span></span><span style=display:flex><span>wget https://mirrors.tuna.tsinghua.edu.cn/elrepo/kernel/el7/x86_64/RPMS/kernel-lt-tools-libs-5.4.263-1.el7.elrepo.x86_64.rpm
</span></span><span style=display:flex><span>wget https://mirrors.tuna.tsinghua.edu.cn/elrepo/kernel/el7/x86_64/RPMS/kernel-lt-tools-5.4.263-1.el7.elrepo.x86_64.rpm
</span></span></code></pre></div><ul><li>æ‰“åŒ… Kernel å‡çº§åŒ…</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tar zcvf kernel-lt-5.4.263-1-upgrade.tar.gz kernel-lt-*
</span></span></code></pre></div><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡äº† 3 ä¸ªç¦»çº¿éƒ¨ç½²èµ„æºåŒ…ï¼š</p><ul><li>KubeKeyï¼š<strong>kubekey-v3.0.13.tar.gzï¼ˆ69Mï¼‰</strong></li><li>åˆ¶å“ï¼ˆartifactï¼‰ï¼š<strong>ksp-v3.4.1-artifact.tar.gzï¼ˆ13Gï¼‰</strong></li><li>å†…æ ¸å‡çº§åŒ…ï¼ˆ<strong>å¯é€‰</strong>ï¼‰ï¼š<strong>kernel-lt-5.4.263-1-upgrade.tar.gzï¼ˆ50M ï¼‰</strong></li></ul><h2 id=3-k8s-ç¦»çº¿é›†ç¾¤æœåŠ¡å™¨-åˆå§‹åŒ–é…ç½®>3. K8s ç¦»çº¿é›†ç¾¤æœåŠ¡å™¨-åˆå§‹åŒ–é…ç½®</h2><h3 id=31-æ“ä½œç³»ç»ŸåŸºç¡€é…ç½®>3.1. æ“ä½œç³»ç»ŸåŸºç¡€é…ç½®</h3><p>æœ¬æ¼”ç¤ºç¯å¢ƒä½¿ç”¨ KubeKey è‡ªåŠ¨é…ç½®ï¼Œç”Ÿäº§ç¯å¢ƒå¯ä»¥å‚è€ƒæˆ‘ä»¥å‰å‘å¸ƒçš„éƒ¨ç½²å®æˆ˜ç³»åˆ—æ–‡æ¡£æ‰‹å·¥é…ç½®ã€‚</p><h3 id=32-æ•°æ®ç›˜é…ç½®>3.2. æ•°æ®ç›˜é…ç½®</h3><p>æ¯å°æœåŠ¡å™¨æ–°å¢ä¸€å—æ•°æ®ç›˜ <strong>/dev/sdb</strong>ï¼Œç”¨äº <strong>Containerd</strong> å’Œ <strong>Kubernetes Pod</strong> çš„æŒä¹…åŒ–å­˜å‚¨ã€‚</p><p>ä¸ºäº†æ»¡è¶³éƒ¨åˆ†ç”¨æˆ·å¸Œæœ›åœ¨ç”Ÿäº§ä¸Šçº¿åï¼Œç£ç›˜å®¹é‡ä¸å¤Ÿæ—¶å¯ä»¥å®ç°æ‰©å®¹ï¼Œæœ¬æ–‡é‡‡ç”¨äº† LVM çš„æ–¹å¼é…ç½®ç£ç›˜ï¼ˆ<strong>å®é™…ä¸Šï¼Œæœ¬äººç»´æŠ¤çš„ç”Ÿäº§ç¯å¢ƒï¼Œå‡ ä¹ä¸ç”¨ LVM</strong>ï¼‰ã€‚</p><p><strong>æœ¬å°èŠ‚çš„é…ç½®æ¯”è¾ƒç®€å•ï¼Œå› æ­¤ï¼Œä¸‹é¢çš„å†…å®¹ä¸ºæ— åºŸè¯å®æ“ç‰ˆã€‚</strong></p><p>è¯·æ³¨æ„ï¼Œä»¥ä¸‹æ“ä½œæ— ç‰¹æ®Šè¯´æ˜æ—¶éœ€åœ¨æ‰€æœ‰æ–°å¢èŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚æœ¬æ–‡åªé€‰å– Master-1 èŠ‚ç‚¹ä½œä¸ºæ¼”ç¤ºï¼Œå¹¶å‡å®šå…¶ä½™æœåŠ¡å™¨éƒ½å·²æŒ‰ç…§ç›¸åŒçš„æ–¹å¼è¿›è¡Œé…ç½®å’Œè®¾ç½®ã€‚</p><ul><li>åˆ›å»º PV</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> pvcreate /dev/sdb
</span></span></code></pre></div><ul><li>åˆ›å»º VG</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vgcreate data /dev/sdb
</span></span></code></pre></div><ul><li>åˆ›å»º LV</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ä½¿ç”¨æ‰€æœ‰ç©ºé—´ï¼ŒVG åå­—ä¸º dataï¼ŒLV åå­—ä¸º lvdata</span>
</span></span><span style=display:flex><span>lvcreate -l 100%VG data -n lvdata
</span></span></code></pre></div><ul><li>æ ¼å¼åŒ–ç£ç›˜</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkfs.xfs /dev/mapper/data-lvdata
</span></span></code></pre></div><ul><li>æ‰‹å·¥æŒ‚è½½ç£ç›˜</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir /data
</span></span><span style=display:flex><span>mount /dev/mapper/data-lvdata /data/
</span></span></code></pre></div><ul><li>é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tail -1 /etc/mtab &gt;&gt; /etc/fstab
</span></span></code></pre></div><ul><li>åˆ›å»º openebs æœ¬åœ°æ•°æ®æ ¹ç›®å½•</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p /data/openebs/local
</span></span></code></pre></div><ul><li>åˆ›å»º Containerd æ•°æ®ç›®å½•</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p /data/containerd
</span></span></code></pre></div><ul><li>åˆ›å»º Containerd æ•°æ®ç›®å½•è½¯è¿æ¥</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ln -s /data/containerd /var/lib/containerd
</span></span></code></pre></div><blockquote><p>è¯´æ˜ï¼šKubeKey ä¸æ”¯æŒåœ¨éƒ¨ç½²çš„æ—¶å€™æ›´æ”¹ Containerd çš„æ•°æ®ç›®å½•ï¼Œåªèƒ½ç”¨è¿™ç§å˜é€šçš„æ–¹å¼ï¼ˆ<strong>ä¹Ÿå¯ä»¥æå‰æ‰‹å·¥å®‰è£… Containerdï¼Œå»ºè®®</strong>ï¼‰ã€‚</p></blockquote><h3 id=33-å‡çº§ç³»ç»Ÿå†…æ ¸>3.3. å‡çº§ç³»ç»Ÿå†…æ ¸</h3><p><strong>å‡çº§ CentOS 7.9 æ“ä½œç³»ç»Ÿå†…æ ¸</strong>ï¼ˆ<strong>å¯é€‰é¡¹ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®æ‰§è¡Œ</strong>ï¼‰ã€‚</p><p>è¯·æ³¨æ„ï¼Œä»¥ä¸‹æ“ä½œæ— ç‰¹æ®Šè¯´æ˜æ—¶éœ€åœ¨é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚æœ¬æ–‡åªé€‰å– <strong>Master-1</strong> èŠ‚ç‚¹ä½œä¸ºæ¼”ç¤ºï¼Œå¹¶å‡å®šå…¶ä½™æœåŠ¡å™¨éƒ½å·²æŒ‰ç…§ç›¸åŒçš„æ–¹å¼è¿›è¡Œé…ç½®å’Œè®¾ç½®ã€‚</p><ul><li>ä¸Šä¼ å†…æ ¸å‡çº§åŒ…</li></ul><p>å°†å†…æ ¸å‡çº§åŒ… <code>kernel-lt-5.4.263-1-upgrade.tar.gz</code> ä¸Šä¼ åˆ°é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹çš„ /root ç›®å½•ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /root
</span></span><span style=display:flex><span>tar xvf kernel-lt-5.4.263-1-upgrade.tar.gz
</span></span></code></pre></div><ul><li>å®‰è£…æ–°ç‰ˆæœ¬å†…æ ¸</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install kernel-lt-5.4.263-1.el7.elrepo.x86_64.rpm
</span></span></code></pre></div><blockquote><p><strong>æ³¨æ„ï¼š</strong> è¿™é‡Œæˆ‘ä»¬åªå®‰è£…å†…æ ¸ï¼ŒåŒæ—¶å®‰è£…å…¶ä»–åŒ…ï¼Œä¼šæœ‰<strong>åŒ… conflicts</strong> çš„æŠ¥é”™ã€‚</p></blockquote><ul><li>ä¿®æ”¹ç³»ç»Ÿé»˜è®¤å†…æ ¸ä¸ºæ–°å†…æ ¸</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>grubby --set-default <span style=color:#e6db74>&#34;/boot/vmlinuz-5.4.263-1.el7.elrepo.x86_64&#34;</span>
</span></span></code></pre></div><ul><li>é‡å¯ç³»ç»Ÿï¼Œä½¿ç”¨æ–°å†…æ ¸å¼•å¯¼ç³»ç»Ÿ</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>reboot
</span></span></code></pre></div><ul><li>éªŒè¯å†…æ ¸ç‰ˆæœ¬</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># uname -r</span>
</span></span><span style=display:flex><span>5.4.263-1.el7.elrepo.x86_64
</span></span></code></pre></div><ul><li>æ›´æ–°å…¶ä»– Kernel ç›¸å…³è½¯ä»¶åŒ…ï¼ˆ<strong>å¯é€‰</strong>ï¼Œç”¨ä¸åˆ°åˆ™ä¸ç”¨æ›´æ–°ï¼‰</li></ul><p>åœ¨ä½¿ç”¨æ–°å†…æ ¸å¼•å¯¼ç³»ç»Ÿåï¼Œå®‰è£…å…¶ä»– Kernel ç›¸å…³è½¯ä»¶åŒ…ï¼Œè§£å†³ä¹‹å‰å‡ºç°çš„ä¾èµ–å†²çªé—®é¢˜ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å¸è½½æ—§ç‰ˆæœ¬çš„ kernel-tools ç›¸å…³è½¯ä»¶åŒ…ï¼Œä¿ç•™ kernel-3.10.0-1160.71.1ï¼Œé¿å…æ–°å†…æ ¸å¼‚å¸¸æ— æ³•è¿›å…¥ç³»ç»Ÿï¼ˆå…·ä½“ç‰ˆæœ¬å·ä»¥å®é™…ä¸ºå‡†ï¼‰</span>
</span></span><span style=display:flex><span>yum remove kernel-tools-3.10.0-1160.71.1.el7.x86_64 kernel-tools-libs-3.10.0-1160.71.1.el7.x86_64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å®‰è£…æ–°ç‰ˆæœ¬çš„ kernel-tools ç›¸å…³è½¯ä»¶åŒ…</span>
</span></span><span style=display:flex><span>yum install kernel-lt-tools-5.4.263-1.el7.elrepo.x86_64.rpm kernel-lt-tools-libs-5.4.263-1.el7.elrepo.x86_64.rpm
</span></span></code></pre></div><ul><li>æ¸…ç†ä¸´æ—¶å®‰è£…åŒ…ï¼ˆ<strong>å»ºè®®ï¼Œå…»æˆè‰¯å¥½çš„è¿ç»´ä¹ æƒ¯</strong>ï¼‰</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rm -rf kernel-lt-5.4.263-1.el7.elrepo.x86_64.rpm kernel-lt-tools-5.4.263-1.el7.elrepo.x86_64.rpm kernel-lt-tools-libs-5.4.263-1.el7.elrepo.x86_64.rpm
</span></span></code></pre></div><h2 id=4-ç¦»çº¿éƒ¨ç½²-kubesphere-å’Œ-k8s-çš„å‰æå‡†å¤‡>4. ç¦»çº¿éƒ¨ç½² KubeSphere å’Œ K8s çš„å‰æå‡†å¤‡</h2><h3 id=41-ä¸Šä¼ ç¦»çº¿éƒ¨ç½²èµ„æºåŒ…åˆ°éƒ¨ç½²èŠ‚ç‚¹>4.1. ä¸Šä¼ ç¦»çº¿éƒ¨ç½²èµ„æºåŒ…åˆ°éƒ¨ç½²èŠ‚ç‚¹</h3><p>å°†ä»¥ä¸‹ç¦»çº¿éƒ¨ç½²èµ„æºåŒ…ï¼ˆKubeKey å’Œåˆ¶å“ artifact ï¼‰ï¼Œä¸Šä¼ è‡³ç¦»çº¿ç¯å¢ƒéƒ¨ç½²èŠ‚ç‚¹ (é€šå¸¸æ˜¯ <strong>Master-1</strong> èŠ‚ç‚¹) çš„ /data/ ç›®å½•ï¼ˆ<strong>å¯æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹</strong>ï¼‰ã€‚</p><ul><li>Kubekeyï¼š<strong>kubekey-v3.0.13.tar.gz</strong></li><li>åˆ¶å“ artifactï¼š<strong>ksp-v3.4.1-artifact.tar.gz</strong></li></ul><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè§£å‹ KubeKeyï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># åˆ›ç¦»çº¿èµ„æºå­˜æ”¾çš„æ•°æ®ç›®å½•</span>
</span></span><span style=display:flex><span>mkdir /data/kubekey
</span></span><span style=display:flex><span>mv /data/ksp-v3.4.1-artifact.tar.gz /data/kubekey/
</span></span><span style=display:flex><span>tar xvf /data/kubekey-v3.0.13.tar.gz -C /data/kubekey
</span></span><span style=display:flex><span>cd /data/kubekey
</span></span></code></pre></div><h3 id=42-åˆ›å»ºç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶>4.2. åˆ›å»ºç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶</h3><ul><li>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./kk create config --with-kubesphere v3.4.1 --with-kubernetes v1.26.5 -f ksp-v341-v1265-offline.yaml
</span></span></code></pre></div><p>å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œåœ¨å½“å‰ç›®å½•ä¼šç”Ÿæˆæ–‡ä»¶åä¸º <strong>ksp-v341-v1265-offline.yaml</strong> çš„é…ç½®æ–‡ä»¶ã€‚</p><blockquote><p>æ³¨æ„ï¼šç”Ÿæˆçš„é»˜è®¤é…ç½®æ–‡ä»¶å†…å®¹è¾ƒå¤šï¼Œè¿™é‡Œå°±ä¸åšè¿‡å¤šå±•ç¤ºäº†ï¼Œæ›´å¤šè¯¦ç»†çš„é…ç½®å‚æ•°è¯·å‚è€ƒ <a href=https://github.com/kubesphere/kubekey/blob/master/docs/config-example.md target=_blank rel="noopener noreferrer">å®˜æ–¹é…ç½®ç¤ºä¾‹</a>ã€‚</p></blockquote><h3 id=43-ä¿®æ”¹-cluster-é…ç½®>4.3. ä¿®æ”¹ Cluster é…ç½®</h3><p>åœ¨ç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶æ–‡ä»¶ä¸­ <strong>kind: Cluster</strong> å°èŠ‚çš„ä½œç”¨æ˜¯éƒ¨ç½² Kubernetes é›†ç¾¤ã€‚æœ¬æ–‡ç¤ºä¾‹é‡‡ç”¨ 3 ä¸ªèŠ‚ç‚¹åŒæ—¶ä½œä¸º control-planeã€etcd èŠ‚ç‚¹å’Œ worker èŠ‚ç‚¹ã€‚</p><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¿®æ”¹ç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶ <code>ksp-v341-v1265-offline.yaml</code>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim ksp-v341-v1265-offline.yaml
</span></span></code></pre></div><p>ä¿®æ”¹ <strong>kind: Cluster</strong> å°èŠ‚ä¸­ hosts å’Œ roleGroups ç­‰ä¿¡æ¯ï¼Œä¿®æ”¹è¯´æ˜å¦‚ä¸‹ã€‚</p><ul><li>hostsï¼šæŒ‡å®šèŠ‚ç‚¹çš„ IPã€ssh ç”¨æˆ·ã€ssh å¯†ç ã€ssh ç«¯å£ã€‚ç¤ºä¾‹æ¼”ç¤ºäº† ssh ç«¯å£å·çš„é…ç½®æ–¹æ³•ã€‚åŒæ—¶ï¼Œæ–°å¢ä¸€ä¸ª Registry èŠ‚ç‚¹çš„é…ç½®</li><li>roleGroupsï¼šæŒ‡å®š 3 ä¸ª etcdã€control-plane èŠ‚ç‚¹ï¼Œå¤ç”¨ç›¸åŒçš„æœºå™¨ä½œä¸º 3 ä¸ª worker èŠ‚ç‚¹</li><li>å¿…é¡»æŒ‡å®šä¸»æœºç»„ <code>registry</code> ä½œä¸ºä»“åº“éƒ¨ç½²èŠ‚ç‚¹ï¼ˆæœ¬æ–‡ä¸ºäº†æ»¡è¶³è¯»è€…çš„éœ€æ±‚ä½¿ç”¨äº† KubeKey è‡ªåŠ¨éƒ¨ç½² Harbor é•œåƒä»“åº“ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å·²æœ‰çš„ Harborï¼Œä½¿ç”¨å·²æœ‰ Harbor æ—¶æ­¤é…ç½®å¯ä»¥ä¸åŠ ï¼‰</li><li>internalLoadbalancerï¼š å¯ç”¨å†…ç½®çš„ HAProxy è´Ÿè½½å‡è¡¡å™¨</li><li>domainï¼šè‡ªå®šä¹‰äº†ä¸€ä¸ª <strong>opsman.top</strong>ï¼Œæ²¡ç‰¹æ®Šéœ€æ±‚çš„åœºæ™¯ä¿ç•™é»˜è®¤å€¼å³å¯</li><li>containerManagerï¼šä½¿ç”¨äº† containerd</li><li>storage.openebs.basePathï¼š<strong>æ–°å¢é…ç½®</strong>ï¼ŒæŒ‡å®š openebs é»˜è®¤å­˜å‚¨è·¯å¾„ä¸º <strong>/data/openebs/local</strong></li><li>registryï¼šå¿…é¡»æŒ‡å®š <code>type</code> ç±»å‹ä¸º <code>harbor</code>ï¼Œå¦åˆ™é»˜è®¤å®‰è£… docker registry</li></ul><p>ä¿®æ”¹åçš„å®Œæ•´ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kubekey.kubesphere.io/v1alpha2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Cluster</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>sample</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>  - {<span style=color:#f92672>name: ksp-master-1, address: 192.168.9.91, internalAddress: 192.168.9.91, port:22, user: root, password</span>: <span style=color:#e6db74>&#34;P@88w0rd&#34;</span>}
</span></span><span style=display:flex><span>  - {<span style=color:#f92672>name: ksp-master-2, address: 192.168.9.92, internalAddress: 192.168.9.92, user: root, password</span>: <span style=color:#e6db74>&#34;P@88w0rd&#34;</span>}
</span></span><span style=display:flex><span>  - {<span style=color:#f92672>name: ksp-master-3, address: 192.168.9.93, internalAddress: 192.168.9.93, user: root, password</span>: <span style=color:#e6db74>&#34;P@88w0rd&#34;</span>}
</span></span><span style=display:flex><span>  - {<span style=color:#f92672>name: ksp-registry, address: 192.168.9.90, internalAddress: 192.168.9.90, user: root, password</span>: <span style=color:#e6db74>&#34;P@88w0rd&#34;</span>}
</span></span><span style=display:flex><span>  <span style=color:#f92672>roleGroups</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>etcd</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ksp-master-1</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ksp-master-2</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ksp-master-3</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>control-plane</span>: 
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ksp-master-1</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ksp-master-2</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ksp-master-3</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>worker</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ksp-master-1</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ksp-master-2</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ksp-master-3</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>registry</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ksp-registry</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>controlPlaneEndpoint</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e>## Internal loadbalancer for apiservers </span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>internalLoadbalancer</span>: <span style=color:#ae81ff>haproxy</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>domain</span>: <span style=color:#ae81ff>lb.opsman.top</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>address</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>6443</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>kubernetes</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>version</span>: <span style=color:#ae81ff>v1.26.5</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>clusterName</span>: <span style=color:#ae81ff>opsman.top</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>autoRenewCerts</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>containerManager</span>: <span style=color:#ae81ff>containerd</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>etcd</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>kubekey</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>network</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>plugin</span>: <span style=color:#ae81ff>calico</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kubePodsCIDR</span>: <span style=color:#ae81ff>10.233.64.0</span><span style=color:#ae81ff>/18</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kubeServiceCIDR</span>: <span style=color:#ae81ff>10.233.0.0</span><span style=color:#ae81ff>/18</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>## multus support. https://github.com/k8snetworkplumbingwg/multus-cni</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>multusCNI</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>storage</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>openebs</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>basePath</span>: <span style=color:#ae81ff>/data/openebs/local</span> <span style=color:#75715e># é»˜è®¤æ²¡æœ‰çš„æ–°å¢é…ç½®ï¼Œbase path of the local PV provisioner</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>registry</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># å¦‚éœ€ä½¿ç”¨ kk éƒ¨ç½² harbor, å¯å°†è¯¥å‚æ•°è®¾ç½®ä¸º harborï¼Œä¸è®¾ç½®è¯¥å‚æ•°ä¸”éœ€ä½¿ç”¨ kk åˆ›å»ºå®¹å™¨é•œåƒä»“åº“ï¼Œå°†é»˜è®¤ä½¿ç”¨ docker registryã€‚</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>harbor</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># æ³¨æ„ï¼š</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 1ã€å¦‚éœ€ä½¿ç”¨ kk éƒ¨ç½²çš„ harbor æˆ–å…¶ä»–è‡ªå®šä¹‰ä»“åº“ï¼Œå¯è®¾ç½®å¯¹åº”ä»“åº“çš„ authsï¼Œå¦‚ä½¿ç”¨ kk åˆ›å»º docker registry ä»“åº“ï¼Œåˆ™æ— éœ€é…ç½®è¯¥å‚æ•°ã€‚</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 2ã€kk éƒ¨ç½²çš„ harborï¼Œé»˜è®¤åœ°å€ä¸º dockerhub.kubekey.localï¼Œå¦‚è¦ä¿®æ”¹ç¡®ä¿ä¸ privateRegistry å­—æ®µçš„å€¼ä¿æŒä¸€è‡´ã€‚</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 3ã€å¦‚éœ€ä½¿ç”¨ kk éƒ¨ç½² harborï¼Œè¯·å…ˆæ³¨é‡Šè¯¥å‚æ•°ï¼Œå¾…éƒ¨ç½²å®Œ Harbor åå†æ¥ä¿®æ”¹å¯ç”¨ã€‚</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>auths</span>:
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;registry.opsman.top&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>username</span>: <span style=color:#ae81ff>admin</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>password</span>: <span style=color:#ae81ff>Harbor12345</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>certsPath</span>: <span style=color:#e6db74>&#34;/etc/docker/certs.d/registry.opsman.top&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># è®¾ç½®é›†ç¾¤éƒ¨ç½²æ—¶ä½¿ç”¨çš„ç§æœ‰ä»“åº“</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>privateRegistry</span>: <span style=color:#e6db74>&#34;registry.opsman.top&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespaceOverride</span>: <span style=color:#e6db74>&#34;kubesphereio&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>registryMirrors</span>: []
</span></span><span style=display:flex><span>    <span style=color:#f92672>insecureRegistries</span>: []
</span></span><span style=display:flex><span>  <span style=color:#f92672>addons</span>: []
</span></span></code></pre></div><blockquote><p>æ³¨æ„ï¼šç¦»çº¿ Harbor éƒ¨ç½²ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ç§æœ‰è‡ªå®šä¹‰åŸŸåå’Œè‡ªç­¾åè¯ä¹¦ï¼Œå®é™…ç”Ÿäº§ä¸­å»ºè®®å„ä½ä½¿ç”¨çœŸæ­£çš„äº’è”ç½‘åŸŸåå’Œæ­£è§„æœºæ„ç­¾å‘çš„å…è´¹æˆ–æ”¶è´¹è¯ä¹¦ã€‚</p></blockquote><h3 id=44-ä¿®æ”¹-clusterconfiguration-é…ç½®>4.4. ä¿®æ”¹ ClusterConfiguration é…ç½®</h3><p>åœ¨ç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶ä¸­ <strong>kind: ClusterConfiguration</strong> å°èŠ‚çš„ä½œç”¨æ˜¯éƒ¨ç½² KubeSphere åŠç›¸å…³ç»„ä»¶ã€‚</p><p>æœ¬æ–‡ä¸ºäº†éªŒè¯ç¦»çº¿éƒ¨ç½²çš„å®Œæ•´æ€§ï¼Œå¯ç”¨äº†é™¤ Kubeedge ã€gatekeeper ä»¥å¤–çš„æ‰€æœ‰æ’ä»¶ã€‚</p><p>ç»§ç»­ç¼–è¾‘ç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶ <code>ksp-v341-v1265-offline.yaml</code>ï¼Œä¿®æ”¹ <strong>kind: ClusterConfiguration</strong> éƒ¨åˆ†æ¥å¯ç”¨å¯æ’æ‹”ç»„ä»¶ï¼Œå…·ä½“çš„ä¿®æ”¹è¯´æ˜å¦‚ä¸‹ã€‚</p><ul><li>å¯ç”¨ Etcd ç›‘æ§</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>etcd</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>monitoring</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># å°† &#34;false&#34; æ›´æ”¹ä¸º &#34;true&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>endpointIps</span>: <span style=color:#ae81ff>localhost</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>2379</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tlsEnable</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><ul><li>å¯ç”¨åº”ç”¨å•†åº—</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>openpitrix</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>store</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># å°† &#34;false&#34; æ›´æ”¹ä¸º &#34;true&#34;</span>
</span></span></code></pre></div><ul><li>å¯ç”¨ KubeSphere DevOps ç³»ç»Ÿ</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>devops</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># å°† &#34;false&#34; æ›´æ”¹ä¸º &#34;true&#34;</span>
</span></span></code></pre></div><ul><li>å¯ç”¨ KubeSphere æ—¥å¿—ç³»ç»Ÿï¼ˆ<strong>v3.4.0 å¼€å§‹é»˜è®¤å¯ç”¨ OpenSearch</strong>ï¼‰</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>logging:
</span></span><span style=display:flex><span>  enabled: true <span style=color:#75715e># å°† &#34;false&#34; æ›´æ”¹ä¸º &#34;true&#34;</span>
</span></span></code></pre></div><ul><li>å¯ç”¨ KubeSphere äº‹ä»¶ç³»ç»Ÿ</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>events</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># å°† &#34;false&#34; æ›´æ”¹ä¸º &#34;true&#34;</span>
</span></span></code></pre></div><ul><li>å¯ç”¨ KubeSphere å‘Šè­¦ç³»ç»Ÿ</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>alerting</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># å°† &#34;false&#34; æ›´æ”¹ä¸º &#34;true&#34;</span>
</span></span></code></pre></div><ul><li>å¯ç”¨ KubeSphere å®¡è®¡æ—¥å¿—</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>auditing</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># å°† &#34;false&#34; æ›´æ”¹ä¸º &#34;true&#34;</span>
</span></span></code></pre></div><ul><li>å¯ç”¨ KubeSphere æœåŠ¡ç½‘æ ¼ï¼ˆIstioï¼‰</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>servicemesh</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># å°† &#34;false&#34; æ›´æ”¹ä¸º &#34;true&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>istio</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>components</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>ingressGateways</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>istio-ingressgateway</span> <span style=color:#75715e># å°†æœåŠ¡æš´éœ²è‡³æœåŠ¡ç½‘æ ¼ä¹‹å¤–ã€‚é»˜è®¤ä¸å¼€å¯ã€‚</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>cni</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span> <span style=color:#75715e># å¯ç”¨åï¼Œä¼šåœ¨ Kubernetes pod ç”Ÿå‘½å‘¨æœŸçš„ç½‘ç»œè®¾ç½®é˜¶æ®µå®Œæˆ Istio ç½‘æ ¼çš„ pod æµé‡è½¬å‘è®¾ç½®å·¥ä½œã€‚</span>
</span></span></code></pre></div><ul><li>å¯ç”¨ Metrics Server</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>metrics_server:
</span></span><span style=display:flex><span>  enabled: true <span style=color:#75715e># å°† &#34;false&#34; æ›´æ”¹ä¸º &#34;true&#34;</span>
</span></span></code></pre></div><blockquote><p>è¯´æ˜ï¼šKubeSphere æ”¯æŒç”¨äº <a href=https://www.kubesphere.io/zh/docs/v3.3/project-user-guide/application-workloads/deployments/ target=_blank rel="noopener noreferrer">éƒ¨ç½²</a> çš„å®¹å™¨ç»„ï¼ˆPodï¼‰å¼¹æ€§ä¼¸ç¼©ç¨‹åº (HPA)ã€‚åœ¨ KubeSphere ä¸­ï¼ŒMetrics Server æ§åˆ¶ç€ HPA æ˜¯å¦å¯ç”¨ã€‚</p></blockquote><ul><li>å¯ç”¨ç½‘ç»œç­–ç•¥ã€å®¹å™¨ç»„ IP æ± ï¼ŒæœåŠ¡æ‹“æ‰‘å›¾ï¼ˆåå­—æ’åºï¼Œå¯¹åº”é…ç½®å‚æ•°æ’åºï¼‰</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>network</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>networkpolicy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># å°† &#34;false&#34; æ›´æ”¹ä¸º &#34;true&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ippool</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>calico</span> <span style=color:#75715e># å°† &#34;none&#34; æ›´æ”¹ä¸º &#34;calico&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>topology</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>weave-scope</span> <span style=color:#75715e># å°† &#34;none&#34; æ›´æ”¹ä¸º &#34;weave-scope&#34;</span>
</span></span></code></pre></div><blockquote><p>è¯´æ˜ï¼š</p><ul><li>ä» 3.0.0 ç‰ˆæœ¬å¼€å§‹ï¼Œç”¨æˆ·å¯ä»¥åœ¨ KubeSphere ä¸­é…ç½®åŸç”Ÿ Kubernetes çš„ç½‘ç»œç­–ç•¥ã€‚</li><li>å®¹å™¨ç»„ IP æ± ç”¨äºè§„åˆ’å®¹å™¨ç»„ç½‘ç»œåœ°å€ç©ºé—´ï¼Œæ¯ä¸ªå®¹å™¨ç»„ IP æ± ä¹‹é—´çš„åœ°å€ç©ºé—´ä¸èƒ½é‡å ã€‚</li><li>å¯ç”¨æœåŠ¡æ‹“æ‰‘å›¾ä»¥é›†æˆ <a href=https://www.weave.works/oss/scope/ target=_blank rel="noopener noreferrer">Weave Scope</a> (Docker å’Œ Kubernetes çš„å¯è§†åŒ–å’Œç›‘æ§å·¥å…·)ï¼ŒæœåŠ¡æ‹“æ‰‘å›¾æ˜¾ç¤ºåœ¨æ‚¨çš„é¡¹ç›®ä¸­ï¼Œå°†æœåŠ¡ä¹‹é—´çš„è¿æ¥å…³ç³»å¯è§†åŒ–ï¼ˆå®é™…ä¸Šæ²¡å•¥ç”¨ï¼Œè¯¥é¡¹ç›®ç›®å‰å·²åœæ­¢ç»´æŠ¤äº†ï¼Œå§‘ä¸”æ”¾ç€å§ï¼‰ã€‚</li></ul></blockquote><ul><li><strong>ä¿®æ”¹ä¸Šé¢çš„æ‰€æœ‰å‚æ•°åï¼Œå¿…é¡»åŠ å…¥ä¸€ä¸ªå‚æ•°</strong>ï¼ˆä»¥å‰çš„ 2.x æ—¶ä»£çš„ kk æ²¡è¿™ä¸ªé—®é¢˜ï¼Œä¸åŠ çš„è¯ï¼Œåœ¨éƒ¨ç½² KubeSphere çš„æ—¶å€™ä¼šæœ‰å‘½åç©ºé—´ä¸åŒ¹é…çš„é—®é¢˜ï¼‰</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace_override</span>: <span style=color:#ae81ff>kubesphereio</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>......</span>
</span></span></code></pre></div><p>ç»è¿‡ä¸Šè¿°æ­¥éª¤ï¼Œæˆ‘ä»¬æˆåŠŸå®Œæˆäº†å¯¹ç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶ <code>ksp-v341-v1265-offline.yaml</code> çš„ä¿®æ”¹ã€‚ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ— æ³•åœ¨æ­¤å±•ç¤ºå®Œæ•´çš„æ–‡ä»¶å†…å®¹ï¼Œè¯·å„ä½è¯»è€…æ ¹æ®ä¸Šæ–‡æä¾›çš„é…ç½®è¯´æ˜ä»”ç»†æ ¸å¯¹ã€‚</p><h2 id=5-å®‰è£…é…ç½®-harbor>5. å®‰è£…é…ç½® Harbor</h2><p>ä¸ºäº†éªŒè¯ KubeKey éƒ¨ç½²ç¦»çº¿ Harbor çš„èƒ½åŠ›ï¼Œæœ¬å®æˆ˜å†…å®¹é‡‡ç”¨ KubeKey éƒ¨ç½² Harborã€‚<strong>ç”Ÿäº§ç¯å¢ƒå»ºè®®æå‰è‡ªå»º</strong>ã€‚</p><p>è¯·æ³¨æ„ï¼Œä»¥ä¸‹æ“ä½œæ— ç‰¹æ®Šè¯´æ˜æ—¶éœ€åœ¨ç¦»çº¿ç¯å¢ƒéƒ¨ç½²èŠ‚ç‚¹ï¼ˆ<strong>é»˜è®¤ä¸º Master-1</strong>ï¼‰ä¸Šæ‰§è¡Œã€‚</p><h3 id=51-å®‰è£…-harbor>5.1. å®‰è£… Harbor</h3><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…é•œåƒä»“åº“ Harborï¼ˆ<strong>å—é™äºç¯‡å¹…ï¼Œè¾“å‡ºç»“æœæœªå±•ç¤º</strong>ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /root/kubekey
</span></span><span style=display:flex><span>./kk init registry -f ksp-v341-v1265-offline.yaml -a ksp-v3.4.1-artifact.tar.gz
</span></span></code></pre></div><blockquote><p><strong>è¯´æ˜ï¼š</strong> <code>ksp-v3.4.1-artifact.tar.gz</code> æˆ‘ä»¬åˆ¶ä½œçš„ç¦»çº¿éƒ¨ç½²èµ„æºåŒ…ä¸­çš„åˆ¶å“åŒ…ã€‚</p></blockquote><p>éƒ¨ç½²å®Œæˆåï¼Œæˆ‘ä»¬ <strong>SSH ç™»é™†åˆ° Registry èŠ‚ç‚¹</strong>ï¼Œæ‰§è¡Œä»¥ä¸‹çš„å‘½ä»¤ï¼ŒéªŒè¯ Harbor çš„å®‰è£…æƒ…å†µï¼š</p><ul><li>æŸ¥çœ‹å®‰è£…å®Œæˆåæœ‰å“ªäº›å†…å®¹</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-registry ~<span style=color:#f92672>]</span><span style=color:#75715e># ls -lh /opt/harbor/</span>
</span></span><span style=display:flex><span>total 633M
</span></span><span style=display:flex><span>......ï¼ˆå—é™äºç¯‡å¹…ï¼Œè¾“å‡ºç»“æœæœªå±•ç¤ºï¼‰
</span></span></code></pre></div><ul><li>æŸ¥çœ‹å®‰è£…ç‰ˆæœ¬</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-registry ~<span style=color:#f92672>]</span><span style=color:#75715e># docker images</span>
</span></span><span style=display:flex><span>REPOSITORY                      TAG       IMAGE ID       CREATED         SIZE
</span></span><span style=display:flex><span>goharbor/harbor-exporter        v2.5.3    d9a8cfa37cf8   <span style=color:#ae81ff>17</span> months ago   87.2MB
</span></span><span style=display:flex><span>goharbor/chartmuseum-photon     v2.5.3    788b207156ad   <span style=color:#ae81ff>17</span> months ago   225MB
</span></span><span style=display:flex><span>goharbor/redis-photon           v2.5.3    5dc5331f3de8   <span style=color:#ae81ff>17</span> months ago   154MB
</span></span><span style=display:flex><span>goharbor/trivy-adapter-photon   v2.5.3    27798821348a   <span style=color:#ae81ff>17</span> months ago   251MB
</span></span><span style=display:flex><span>goharbor/notary-server-photon   v2.5.3    c686413b72ce   <span style=color:#ae81ff>17</span> months ago   112MB
</span></span><span style=display:flex><span>goharbor/notary-signer-photon   v2.5.3    a3bc1def3f94   <span style=color:#ae81ff>17</span> months ago   109MB
</span></span><span style=display:flex><span>goharbor/harbor-registryctl     v2.5.3    942de6829d43   <span style=color:#ae81ff>17</span> months ago   136MB
</span></span><span style=display:flex><span>goharbor/registry-photon        v2.5.3    fb1278854b91   <span style=color:#ae81ff>17</span> months ago   77.9MB
</span></span><span style=display:flex><span>goharbor/nginx-photon           v2.5.3    91877cbc147a   <span style=color:#ae81ff>17</span> months ago   44.3MB
</span></span><span style=display:flex><span>goharbor/harbor-log             v2.5.3    ca36fb3b68a6   <span style=color:#ae81ff>17</span> months ago   161MB
</span></span><span style=display:flex><span>goharbor/harbor-jobservice      v2.5.3    75e6a7496590   <span style=color:#ae81ff>17</span> months ago   227MB
</span></span><span style=display:flex><span>goharbor/harbor-core            v2.5.3    93a775677473   <span style=color:#ae81ff>17</span> months ago   203MB
</span></span><span style=display:flex><span>goharbor/harbor-portal          v2.5.3    d78f9bbad9ee   <span style=color:#ae81ff>17</span> months ago   52.6MB
</span></span><span style=display:flex><span>goharbor/harbor-db              v2.5.3    bd50ae1eccdf   <span style=color:#ae81ff>17</span> months ago   224MB
</span></span><span style=display:flex><span>goharbor/prepare                v2.5.3    15102b9ebde6   <span style=color:#ae81ff>17</span> months ago   166MB
</span></span></code></pre></div><ul><li>æŸ¥çœ‹å®‰è£…çŠ¶æ€</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-registry ~<span style=color:#f92672>]</span><span style=color:#75715e># cd /opt/harbor/</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-registry harbor<span style=color:#f92672>]</span><span style=color:#75715e># docker-compose ps -a</span>
</span></span></code></pre></div><ul><li>æŸ¥çœ‹ Harbor é…ç½®çš„åŸŸåï¼ˆ<strong>ç¡®ä¿ä½¿ç”¨äº†è‡ªå®šä¹‰åŸŸå</strong>ï¼‰</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-registry harbor<span style=color:#f92672>]</span><span style=color:#75715e># cat /opt/harbor/harbor.yml | grep hostname:</span>
</span></span><span style=display:flex><span>hostname: registry.opsman.top
</span></span></code></pre></div><ul><li>æŸ¥çœ‹ Docker æ˜¯å¦é…ç½®äº†ç§æœ‰è¯ä¹¦ï¼ˆ<strong>ç¡®ä¿ä½¿ç”¨äº†è‡ªå®šä¹‰åŸŸååŠè¯ä¹¦</strong>ï¼‰</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-registry harbor<span style=color:#f92672>]</span><span style=color:#75715e># ll /etc/docker/certs.d/registry.opsman.top/</span>
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>12</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>1103</span> Dec <span style=color:#ae81ff>13</span> 09:47 ca.crt
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>1253</span> Dec <span style=color:#ae81ff>13</span> 09:47 registry.opsman.top.cert
</span></span><span style=display:flex><span>-rw-------. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>1679</span> Dec <span style=color:#ae81ff>13</span> 09:47 registry.opsman.top.key
</span></span></code></pre></div><blockquote><p>å°çŸ¥è¯†ï¼šKubeKey éƒ¨ç½² Harbor æ—¶ä¼šè‡ªåŠ¨åŒæ­¥è‡ªç­¾åè¯ä¹¦åˆ°é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ï¼Œè‡ªå·±éƒ¨ç½²çš„ Harbor <strong>å¿…é¡»æ‰‹åŠ¨å¤åˆ¶</strong> Registry èŠ‚ç‚¹çš„<strong>è‡ªç­¾åè¯ä¹¦</strong>åˆ°é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ã€‚</p><p>KubeKey å®Œæˆå¤åˆ¶çš„åŠ¨ä½œåœ¨ä¸‹é¢ä¸¤ä¸ªæ¨¡å—ï¼š</p><ul><li><code>[InitRegistryModule] Synchronize certs file</code></li><li><code>[InitRegistryModule] Synchronize certs file to all nodes</code></li></ul></blockquote><h3 id=52-åœ¨-harbor-ä¸­åˆ›å»ºé¡¹ç›®>5.2. åœ¨ Harbor ä¸­åˆ›å»ºé¡¹ç›®</h3><p>ç”±äº Harbor é¡¹ç›®å­˜åœ¨è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰çš„é™åˆ¶ï¼Œå³åªæœ‰æŒ‡å®šè§’è‰²çš„ç”¨æˆ·æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚å¦‚æœæ‚¨æœªåˆ›å»ºé¡¹ç›®ï¼Œåˆ™é•œåƒä¸èƒ½è¢«æ¨é€åˆ° Harborã€‚</p><p>Harbor ä¸­æœ‰ä¸¤ç§ç±»å‹çš„é¡¹ç›®ï¼š</p><ul><li>å…¬å…±é¡¹ç›®ï¼ˆPublicï¼‰ï¼šä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥ä»è¿™ä¸ªé¡¹ç›®ä¸­æ‹‰å–é•œåƒã€‚</li><li>ç§æœ‰é¡¹ç›®ï¼ˆPrivateï¼‰ï¼šåªæœ‰ä½œä¸ºé¡¹ç›®æˆå‘˜çš„ç”¨æˆ·å¯ä»¥æ‹‰å–é•œåƒã€‚</li></ul><p>ä½¿ç”¨ KubeKey å®‰è£…çš„ Harbor é»˜è®¤ä¿¡æ¯å¦‚ä¸‹ï¼š</p><ul><li>ç™»é™†è´¦æˆ·ä¿¡æ¯ï¼šç®¡ç†å‘˜è´¦å·ï¼š<strong>admin</strong>ï¼Œå¯†ç ï¼š<strong>Harbor12345</strong>ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼‰ã€‚</li><li>Harbor å®‰è£…æ–‡ä»¶åœ¨ <strong>/opt/harbor</strong> , å¦‚éœ€è¿ç»´ Harborï¼Œå¯è‡³è¯¥ç›®å½•ä¸‹ã€‚</li></ul><p>æ¥ä¸‹æ¥çš„ä»»åŠ¡éœ€è¦æˆ‘ä»¬ <strong>SSH ç™»é™†åˆ° Registry èŠ‚ç‚¹</strong>æ‰§è¡Œã€‚</p><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¸‹è½½å®˜æ–¹æä¾›çš„è‡ªåŠ¨åˆå§‹åŒ– Harbor ä»“åº“çš„è„šæœ¬ï¼ˆ<strong>å¯ä¸ä¸‹è½½ç›´æ¥ç”¨æœ¬æ–‡æä¾›çš„è„šæœ¬</strong>ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -O https://raw.githubusercontent.com/kubesphere/ks-installer/master/scripts/create_project_harbor.sh
</span></span></code></pre></div><ul><li>æ ¹æ®å®é™…æƒ…å†µï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¿®æ”¹è„šæœ¬é…ç½® <code>vim create_project_harbor.sh</code>ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e># Harbor ä»“åº“åœ°å€ï¼ˆå†™åŸŸåï¼Œé»˜è®¤é…ç½®ä¸º https://dockerhub.kubekey.localï¼‰</span>
</span></span><span style=display:flex><span>url<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://registry.opsman.top&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è®¿é—® Harbor ä»“åº“çš„é»˜è®¤ç”¨æˆ·å’Œå¯†ç ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿®æ”¹ï¼‰</span>
</span></span><span style=display:flex><span>user<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;admin&#34;</span>
</span></span><span style=display:flex><span>passwd<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Harbor12345&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éœ€è¦åˆ›å»ºçš„é¡¹ç›®ååˆ—è¡¨ï¼ŒæŒ‰æˆ‘ä»¬åˆ¶ä½œçš„ç¦»çº¿åŒ…çš„é•œåƒå‘½åè§„åˆ™ï¼Œå®é™…ä¸Šåªéœ€è¦åˆ›å»ºä¸€ä¸ª kubesphereio å³å¯ï¼Œè¿™é‡Œä¿ç•™äº†æ‰€æœ‰å¯ç”¨å€¼ï¼Œå„ä½å¯æ ¹æ®è‡ªå·±çš„ç¦»çº¿ä»“åº“é•œåƒåç§°è§„åˆ™ä¿®æ”¹ã€‚</span>
</span></span><span style=display:flex><span>harbor_projects<span style=color:#f92672>=(</span>library
</span></span><span style=display:flex><span>    kubesphere
</span></span><span style=display:flex><span>    calico
</span></span><span style=display:flex><span>    coredns
</span></span><span style=display:flex><span>    openebs
</span></span><span style=display:flex><span>    csiplugin
</span></span><span style=display:flex><span>    minio
</span></span><span style=display:flex><span>    mirrorgooglecontainers
</span></span><span style=display:flex><span>    osixia
</span></span><span style=display:flex><span>    prom
</span></span><span style=display:flex><span>    thanosio
</span></span><span style=display:flex><span>    jimmidyson
</span></span><span style=display:flex><span>    grafana
</span></span><span style=display:flex><span>    elastic
</span></span><span style=display:flex><span>    istio
</span></span><span style=display:flex><span>    jaegertracing
</span></span><span style=display:flex><span>    jenkins
</span></span><span style=display:flex><span>    weaveworks
</span></span><span style=display:flex><span>    openpitrix
</span></span><span style=display:flex><span>    joosthofman
</span></span><span style=display:flex><span>    nginxdemos
</span></span><span style=display:flex><span>    fluent
</span></span><span style=display:flex><span>    kubeedge
</span></span><span style=display:flex><span>    kubesphereio
</span></span><span style=display:flex><span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> project in <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>harbor_projects[@]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;creating </span>$project<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    curl -k -u <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>user<span style=color:#e6db74>}</span><span style=color:#e6db74>:</span><span style=color:#e6db74>${</span>passwd<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> -X POST -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>url<span style=color:#e6db74>}</span><span style=color:#e6db74>/api/v2.0/projects&#34;</span> -d <span style=color:#e6db74>&#34;{ \&#34;project_name\&#34;: \&#34;</span><span style=color:#e6db74>${</span>project<span style=color:#e6db74>}</span><span style=color:#e6db74>\&#34;, \&#34;public\&#34;: true}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><blockquote><p>é‡ç‚¹æ³¨æ„ï¼š</p><ul><li>harbor_projects ä¸­ä¸€å®šè¦æ–°å¢ <code>kubesphereio</code>ï¼Œé»˜è®¤æ²¡æœ‰ã€‚ä¸åŠ åé¢æŠ¥é”™ï¼Œè¯¦æƒ…è§ <strong>é—®é¢˜ 2</strong>ã€‚</li><li>è„šæœ¬åˆ›å»ºçš„æ˜¯ public é¡¹ç›®ï¼Œå¦‚éœ€è¦ç§æœ‰é¡¹ç›®è¯·ä¿®æ”¹è„šæœ¬ã€‚</li></ul></blockquote><ul><li>æ‰§è¡Œè„šæœ¬åˆ›å»ºé¡¹ç›®</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sh create_project_harbor.sh
</span></span></code></pre></div><ul><li>æ­£ç¡®çš„æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼ˆ<strong>library ä¼šæœ‰æŠ¥é”™ï¼Œå› ä¸ºé»˜è®¤å·²ç»å­˜åœ¨ï¼Œå¯å¿½ç•¥</strong>ï¼‰</li></ul><h3 id=53-æ¨é€ç¦»çº¿é•œåƒåˆ°-harbor-ä»“åº“>5.3. æ¨é€ç¦»çº¿é•œåƒåˆ° Harbor ä»“åº“</h3><p>å°†æå‰å‡†å¤‡å¥½çš„ç¦»çº¿é•œåƒæ¨é€åˆ° Harbor ä»“åº“ï¼Œè¿™ä¸€æ­¥ä¸º<strong>å¯é€‰é¡¹</strong>ï¼Œå› ä¸ºåˆ›å»ºé›†ç¾¤çš„æ—¶å€™é»˜è®¤ä¼šæ¨é€é•œåƒï¼ˆæœ¬æ–‡ä½¿ç”¨å‚æ•°å¿½ç•¥äº†ï¼‰ã€‚ä¸ºäº†éƒ¨ç½²æˆåŠŸç‡ï¼Œå»ºè®®å…ˆæ¨é€ã€‚</p><ul><li>æ¨é€ç¦»çº¿é•œåƒ</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./kk artifact image push -f ksp-v341-v1265-offline.yaml -a ksp-v3.4.1-artifact.tar.gz
</span></span></code></pre></div><ul><li>Harbor ç®¡ç†é¡µé¢æŸ¥çœ‹é¡¹ç›®å’Œé•œåƒä»“åº“ï¼ˆ<strong>æå‰åœ¨è‡ªå·±ç”µè„‘ä¸Šåšå¥½åŸŸåè§£æé…ç½®</strong>ï¼‰</li></ul><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-offline-harbor-v253-projects-118.png alt></p><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-offline-harbor-v253-projects-repositories-kubesphereio.png alt></p><h2 id=6-å®‰è£…-kubesphere-å’Œ-k8s-é›†ç¾¤>6. å®‰è£… KubeSphere å’Œ K8s é›†ç¾¤</h2><h3 id=61-å®‰è£…-kubesphere-å’Œ-k8s-é›†ç¾¤>6.1. å®‰è£… KubeSphere å’Œ K8s é›†ç¾¤</h3><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®‰è£… KubeSphere å’Œ K8s é›†ç¾¤ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./kk create cluster -f ksp-v341-v1265-offline.yaml -a ksp-v3.4.1-artifact.tar.gz --with-packages --skip-push-images
</span></span></code></pre></div><blockquote><p>å‚æ•°è¯´æ˜</p><ul><li><strong>ksp-v341-v1265-offline.yaml</strong>ï¼šç¦»çº¿ç¯å¢ƒé›†ç¾¤çš„é…ç½®æ–‡ä»¶</li><li><strong>ksp-v3.4.1-artifact.tar.gz</strong>ï¼šåˆ¶å“åŒ…çš„ tar åŒ…é•œåƒ</li><li><strong>--with-packages</strong>ï¼šå¦‚éœ€è¦å®‰è£…æ“ä½œç³»ç»Ÿä¾èµ–ï¼Œéœ€æŒ‡å®šè¯¥é€‰é¡¹</li><li><strong>--skip-push-imagesï¼š</strong> å¿½ç•¥æ¨é€é•œåƒï¼Œå› ä¸ºï¼Œå‰é¢å·²ç»å®Œæˆäº†æ¨é€é•œåƒåˆ°ç§æœ‰ä»“åº“çš„ä»»åŠ¡</li></ul></blockquote><p>ä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œåï¼Œé¦–å…ˆ KubeKey ä¼šæ£€æŸ¥éƒ¨ç½² K8s çš„ä¾èµ–åŠå…¶ä»–è¯¦ç»†è¦æ±‚ã€‚æ£€æŸ¥åˆæ ¼åï¼Œç³»ç»Ÿå°†æç¤ºæ‚¨ç¡®è®¤å®‰è£…ã€‚è¾“å…¥ <strong>yes</strong> å¹¶æŒ‰ ENTER ç»§ç»­éƒ¨ç½²ã€‚</p><blockquote><p>ç‰¹æ®Šè¯´æ˜ï¼šç”±äºæœ¬æ–‡åœ¨å®‰è£…çš„è¿‡ç¨‹ä¸­å¯ç”¨äº†æ—¥å¿—æ’ä»¶ï¼Œå› æ­¤åœ¨å®‰è£…çš„è¿‡ç¨‹ä¸­å¿…é¡»æŒ‰ç…§ ã€Œ<strong>é—®é¢˜ 6</strong>ã€çš„æè¿°<strong>æ‰‹å·¥ä»‹å…¥å¤„ç†</strong>ï¼Œ<strong>å¦åˆ™å®‰è£…ä¼šå¤±è´¥</strong>ã€‚</p></blockquote><p>å®‰è£…è¿‡ç¨‹æ—¥å¿—è¾“å‡ºæ¯”è¾ƒå¤šï¼Œå—é™äºç¯‡å¹…æœ¬æ–‡åªå±•ç¤ºæœ€ç»ˆç»“æœã€‚</p><p>éƒ¨ç½²å®Œæˆéœ€è¦å¤§çº¦ 10-30 åˆ†é’Ÿå·¦å³ï¼Œå…·ä½“çœ‹ç½‘é€Ÿã€æœºå™¨é…ç½®ã€å¯ç”¨å¤šå°‘æ’ä»¶ç­‰ã€‚</p><p>éƒ¨ç½²å®Œæˆåï¼Œæ‚¨åº”è¯¥ä¼šåœ¨ç»ˆç«¯ä¸Šçœ‹åˆ°ç±»ä¼¼äºä¸‹é¢çš„è¾“å‡ºã€‚æç¤ºéƒ¨ç½²å®Œæˆçš„åŒæ—¶ï¼Œè¾“å‡ºä¸­è¿˜ä¼šæ˜¾ç¤ºç”¨æˆ·ç™»é™† KubeSphere çš„é»˜è®¤ç®¡ç†å‘˜ç”¨æˆ·å’Œå¯†ç ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#####################################################</span>
</span></span><span style=display:flex><span><span style=color:#75715e>###              Welcome to KubeSphere!           ###</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#####################################################</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Console: http://192.168.9.91:30880
</span></span><span style=display:flex><span>Account: admin
</span></span><span style=display:flex><span>Password: P@88w0rd
</span></span><span style=display:flex><span>NOTESï¼š
</span></span><span style=display:flex><span>  1. After you log into the console, please check the
</span></span><span style=display:flex><span>     monitoring status of service components in
</span></span><span style=display:flex><span>     <span style=color:#e6db74>&#34;Cluster Management&#34;</span>. If any service is not
</span></span><span style=display:flex><span>     ready, please wait patiently <span style=color:#66d9ef>until</span> all components
</span></span><span style=display:flex><span>     are up and running.
</span></span><span style=display:flex><span>  2. Please change the default password after login.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#####################################################</span>
</span></span><span style=display:flex><span>https://kubesphere.io             2023-12-13 10:56:38
</span></span><span style=display:flex><span><span style=color:#75715e>#####################################################</span>
</span></span><span style=display:flex><span>10:56:40 CST skipped: <span style=color:#f92672>[</span>ksp-master-3<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>10:56:40 CST skipped: <span style=color:#f92672>[</span>ksp-master-2<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>10:56:40 CST success: <span style=color:#f92672>[</span>ksp-master-1<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>10:56:40 CST Pipeline<span style=color:#f92672>[</span>CreateClusterPipeline<span style=color:#f92672>]</span> execute successfully
</span></span><span style=display:flex><span>Installation is complete.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Please check the result using the command:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        kubectl logs -n kubesphere-system <span style=color:#66d9ef>$(</span>kubectl get pod -n kubesphere-system -l <span style=color:#e6db74>&#39;app in (ks-install, ks-installer)&#39;</span> -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.items[0].metadata.name}&#39;</span><span style=color:#66d9ef>)</span> -f
</span></span></code></pre></div><blockquote><p>å°æŠ€å·§ï¼š</p></blockquote><ul><li>å½“å‡ºç°ç†Ÿæ‚‰çš„å®‰è£…æ»šåŠ¨æ¡ <strong>>>---></strong> åï¼Œå¯ä»¥å¦å¼€ä¸€ä¸ªç»ˆç«¯ ä½¿ç”¨å‘½ä»¤ <code>kubectl get pod -A </code>æˆ–æ˜¯ <code>kubectl get pod -A | grep -v Running</code> è§‚å¯Ÿè¿›åº¦ï¼Œå¦‚å‡ºç°å¼‚å¸¸å¯åŠæ—¶ä»‹å…¥å¤„ç†ã€‚</li><li>ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹è¯¦ç»†çš„éƒ¨ç½²è¿‡ç¨‹æ—¥å¿—åŠæŠ¥é”™ä¿¡æ¯ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl logs -n kubesphere-system <span style=color:#66d9ef>$(</span>kubectl get pod -n kubesphere-system -l <span style=color:#e6db74>&#39;app in (ks-install, ks-installer)&#39;</span> -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.items[0].metadata.name}&#39;</span><span style=color:#66d9ef>)</span> -f
</span></span></code></pre></div><h3 id=62--éƒ¨ç½²ç»“æœéªŒè¯>6.2. éƒ¨ç½²ç»“æœéªŒè¯</h3><p>ç™»å½• Web æ§åˆ¶å°é€šè¿‡ <code>http://{IP}:30880</code> ä½¿ç”¨é»˜è®¤å¸æˆ·å’Œå¯†ç  <code>admin/P@88w0rd</code> è®¿é—® KubeSphere çš„ Web æ§åˆ¶å°ï¼Œç®€å•çš„éªŒè¯ä¸€ä¸‹éƒ¨ç½²ç»“æœã€‚</p><ul><li>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€</li></ul><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-v341-v126-offline-clusters-nodes.png alt></p><ul><li>æŸ¥çœ‹ç³»ç»Ÿç»„ä»¶çŠ¶æ€</li></ul><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-v341-v126-offline-clusters-components.png alt></p><h2 id=7-å¸¸è§é—®é¢˜>7. å¸¸è§é—®é¢˜</h2><h3 id=é—®é¢˜-1>é—®é¢˜ 1</h3><ul><li>é—®é¢˜ç°è±¡</li></ul><p>æ‰§è¡Œè„šæœ¬ <code>create_project_harbor.sh</code> ï¼Œåˆ›å»º Harbor é¡¹ç›®æ—¶ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl performs SSL certificate verification by default, using a <span style=color:#e6db74>&#34;bundle&#34;</span>
</span></span><span style=display:flex><span> of Certificate Authority <span style=color:#f92672>(</span>CA<span style=color:#f92672>)</span> public keys <span style=color:#f92672>(</span>CA certs<span style=color:#f92672>)</span>. If the default
</span></span><span style=display:flex><span> bundle file isn<span style=color:#e6db74>&#39;t adequate, you can specify an alternate file
</span></span></span><span style=display:flex><span><span style=color:#e6db74> using the --cacert option.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>If this HTTPS server uses a certificate signed by a CA represented in
</span></span></span><span style=display:flex><span><span style=color:#e6db74> the bundle, the certificate verification probably failed due to a
</span></span></span><span style=display:flex><span><span style=color:#e6db74> problem with the certificate (it might be expired, or the name might
</span></span></span><span style=display:flex><span><span style=color:#e6db74> not match the domain name in the URL).
</span></span></span><span style=display:flex><span><span style=color:#e6db74>If you&#39;</span>d like to turn off curl<span style=color:#960050;background-color:#1e0010>&#39;</span>s verification of the certificate, use
</span></span><span style=display:flex><span> the -k <span style=color:#f92672>(</span>or --insecure<span style=color:#f92672>)</span> option.
</span></span></code></pre></div><ul><li>è§£å†³æ–¹æ¡ˆ</li></ul><p>å› ä¸ºæˆ‘ä»¬ Harbor ä½¿ç”¨çš„æ˜¯ Https åè®®ï¼Œå¹¶ä¸”ä½¿ç”¨äº†ç§æœ‰çš„åŸŸåå’Œç§æœ‰è‡ªå®šä¹‰çš„è¯ä¹¦ã€‚éœ€ä¿®æ”¹è„šæœ¬ï¼Œåœ¨ curl å‘½ä»¤ä¸­åŠ å…¥ <code>-k</code> å‚æ•°ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ä¿®æ”¹åå‘½ä»¤</span>
</span></span><span style=display:flex><span>curl -k -u <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>user<span style=color:#e6db74>}</span><span style=color:#e6db74>:</span><span style=color:#e6db74>${</span>passwd<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> -X POST -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>url<span style=color:#e6db74>}</span><span style=color:#e6db74>/api/v2.0/projects&#34;</span> -d <span style=color:#e6db74>&#34;{ \&#34;project_name\&#34;: \&#34;</span><span style=color:#e6db74>${</span>project<span style=color:#e6db74>}</span><span style=color:#e6db74>\&#34;, \&#34;public\&#34;: true}&#34;</span>
</span></span></code></pre></div><h3 id=é—®é¢˜-2>é—®é¢˜ 2</h3><ul><li>é—®é¢˜ç°è±¡</li></ul><p>éƒ¨ç½² Kubesphere å’Œ Kubernetes é›†ç¾¤ä¹‹å‰ï¼Œæ‰§è¡Œæ¨é€ç¦»çº¿é•œåƒçš„å‘½ä»¤ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>15:01:29 CST <span style=color:#f92672>[</span>CopyImagesToRegistryModule<span style=color:#f92672>]</span> Push multi-arch manifest to private registry
</span></span><span style=display:flex><span>15:01:29 CST message: <span style=color:#f92672>[</span>LocalHost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>get manifest list failed by module cache
</span></span><span style=display:flex><span>15:01:29 CST failed: <span style=color:#f92672>[</span>LocalHost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>error: Pipeline<span style=color:#f92672>[</span>ArtifactImagesPushPipeline<span style=color:#f92672>]</span> execute failed: Module<span style=color:#f92672>[</span>CopyImagesToRegistryModule<span style=color:#f92672>]</span> exec failed:
</span></span><span style=display:flex><span>failed: <span style=color:#f92672>[</span>LocalHost<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>PushManifest<span style=color:#f92672>]</span> exec failed after <span style=color:#ae81ff>1</span> retries: get manifest list failed by module cache
</span></span></code></pre></div><ul><li>è§£å†³æ–¹æ¡ˆ</li></ul><p>å‚è€ƒ <a href=https://github.com/kubesphere/kubekey/issues/2054 target=_blank rel="noopener noreferrer">issues-2054</a>ï¼Œåœ¨ Harbor ä¸­åˆ›å»ºé¡¹ç›® <code>kubesphereio</code>ã€‚</p><h3 id=é—®é¢˜-3>é—®é¢˜ 3</h3><ul><li>é—®é¢˜ç°è±¡</li></ul><p>éƒ¨ç½²é›†ç¾¤æ—¶ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>17:26:33 CST message: <span style=color:#f92672>[</span>ksp-master-1<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>pull image failed: Failed to exec command: sudo -E /bin/bash -c <span style=color:#e6db74>&#34;env PATH=</span>$PATH<span style=color:#e6db74> crictl pull registry.opsman.top/kubesphereio/pause:3.8 --platform amd64&#34;</span>
</span></span><span style=display:flex><span>E1211 17:26:33.225514    <span style=color:#ae81ff>5977</span> remote_image.go:238<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;PullImage from image service failed&#34;</span> err<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;rpc error: code = Unknown desc = failed to pull and unpack image \&#34;registry.opsman.top/kubesphereio/pause:3.8\&#34;: failed to resolve reference \&#34;registry.opsman.top/kubesphereio/pause:3.8\&#34;: failed to do request: Head \&#34;https://registry.opsman.top/v2/kubesphereio/pause/manifests/3.8\&#34;: x509: certificate signed by unknown authority&#34;</span> image<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;registry.opsman.top/kubesphereio/pause:3.8&#34;</span>
</span></span><span style=display:flex><span>FATA<span style=color:#f92672>[</span>0000<span style=color:#f92672>]</span> pulling image: rpc error: code <span style=color:#f92672>=</span> Unknown desc <span style=color:#f92672>=</span> failed to pull and unpack image <span style=color:#e6db74>&#34;registry.opsman.top/kubesphereio/pause:3.8&#34;</span>: failed to resolve reference <span style=color:#e6db74>&#34;registry.opsman.top/kubesphereio/pause:3.8&#34;</span>: failed to <span style=color:#66d9ef>do</span> request: Head <span style=color:#e6db74>&#34;https://registry.opsman.top/v2/kubesphereio/pause/manifests/3.8&#34;</span>: x509: certificate signed by unknown authority: Process exited with status <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>17:26:33 CST retry: <span style=color:#f92672>[</span>ksp-master-1<span style=color:#f92672>]</span>
</span></span></code></pre></div><ul><li>è§£å†³æ–¹æ¡ˆ</li></ul><p>å‚è€ƒ <a href=https://github.com/kubesphere/kubekey/issues/1762 target=_blank rel="noopener noreferrer">issues-1762</a>ï¼Œåœ¨é›†ç¾¤éƒ¨ç½²æ–‡ä»¶ <code>ksp-v341-v1265-offline.yaml</code> çš„ registry éƒ¨åˆ†é…ç½®ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼ˆä¸€å®šè¦ç¡®ä¿ <strong>/etc/docker/certs.d/registry.opsman.top</strong> æ–‡ä»¶å¤¹å­˜åœ¨ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># æœ¬æ–‡ç”¨çš„ registry.opsman.top é»˜è®¤ä¸º dockerhub.kubekey.local</span>
</span></span><span style=display:flex><span><span style=color:#f92672>certsPath</span>: <span style=color:#e6db74>&#34;/etc/docker/certs.d/registry.opsman.top&#34;</span>
</span></span></code></pre></div><p>å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­æŠ¥é”™ï¼Œå¯ä»¥åœ¨ containerd çš„é…ç½®æ–‡ä»¶ä¸­ï¼ŒåŠ å…¥ä¸‹é¢çš„é…ç½®ï¼Œé‡å¯ containerd æœåŠ¡ï¼Œå†é‡æ–°æ‰§è¡Œéƒ¨ç½²ä»»åŠ¡ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e>#  vi /etc/containerd/config.toml æ‰¾åˆ°æ­£ç¡®ä½ç½®åŠ å…¥ï¼ˆä¸€èˆ¬åœ¨æ–‡ä»¶æœ€åæœ‰ç±»ä¼¼æ®µè½ï¼Œä¿®æ”¹æ›¿æ¢å³å¯ï¼‰</span>
</span></span><span style=display:flex><span>[<span style=color:#ae81ff>plugins.&#34;io.containerd.grpc.v1.cri&#34;.registry.configs.&#34;registry.opsman.top&#34;.tls]</span>
</span></span><span style=display:flex><span>              <span style=color:#ae81ff>ca_file = &#34;/etc/docker/certs.d/registry.opsman.top/ca.crt&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#ae81ff>cert_file = &#34;/etc/docker/certs.d/registry.opsman.top/registry.opsman.top.cert&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#ae81ff>key_file = &#34;/etc/docker/certs.d/registry.opsman.top/registry.opsman.top.key&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#ae81ff>insecure_skip_verify = false</span>
</span></span><span style=display:flex><span>              
</span></span><span style=display:flex><span><span style=color:#75715e># é‡å¯æœåŠ¡</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>systemctl restart containerd</span>
</span></span></code></pre></div><p>å¦‚æœæŠ¥é”™æç¤º <code>/etc/docker/certs.d/registry.opsman.top</code> æ‰¾ä¸åˆ°ï¼Œå¯ä»¥æŒ‰ä¸‹é¢çš„æ“ä½œæ‰§è¡Œï¼ˆ<strong>æ²¡ç”¨ KubeKey éƒ¨ç½² Harbor æ—¶ä¼šå‡ºç°</strong>ï¼‰ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 1. ç™»é™†åˆ° registry èŠ‚ç‚¹</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. å¤åˆ¶ /etc/docker/certs.d/registry.opsman.top æ–‡ä»¶å¤¹åˆ°å…¶ä»–èŠ‚ç‚¹</span>
</span></span></code></pre></div><h3 id=é—®é¢˜-4>é—®é¢˜ 4</h3><ul><li>é—®é¢˜ç°è±¡</li></ul><p>éƒ¨ç½²é›†ç¾¤æ—¶ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>17:50:16 CST message: <span style=color:#f92672>[</span>ksp-master-3<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>pull image failed: Failed to exec command: sudo -E /bin/bash -c <span style=color:#e6db74>&#34;env PATH=</span>$PATH<span style=color:#e6db74> crictl pull registry.opsman.top/kubesphereio/pause:3.8 --platform amd64&#34;</span>
</span></span><span style=display:flex><span>E1211 17:50:16.841836    <span style=color:#ae81ff>8464</span> remote_image.go:238<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;PullImage from image service failed&#34;</span> err<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;rpc error: code = Unknown desc = failed to pull and unpack image \&#34;registry.opsman.top/kubesphereio/pause:3.8\&#34;: failed to resolve reference \&#34;registry.opsman.top/kubesphereio/pause:3.8\&#34;: get TLSConfig for registry \&#34;https://registry.opsman.top\&#34;: failed to load cert file: open /etc/docker/certs.d/registry.opsman.top/registry.opsman.top.cert: no such file or directory&#34;</span> image<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;registry.opsman.top/kubesphereio/pause:3.8&#34;</span>
</span></span><span style=display:flex><span>FATA<span style=color:#f92672>[</span>0000<span style=color:#f92672>]</span> pulling image: rpc error: code <span style=color:#f92672>=</span> Unknown desc <span style=color:#f92672>=</span> failed to pull and unpack image <span style=color:#e6db74>&#34;registry.opsman.top/kubesphereio/pause:3.8&#34;</span>: failed to resolve reference <span style=color:#e6db74>&#34;registry.opsman.top/kubesphereio/pause:3.8&#34;</span>: get TLSConfig <span style=color:#66d9ef>for</span> registry <span style=color:#e6db74>&#34;https://registry.opsman.top&#34;</span>: failed to load cert file: open /etc/docker/certs.d/registry.opsman.top/registry.opsman.top.cert: no such file or directory: Process exited with status <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>17:50:16 CST retry: <span style=color:#f92672>[</span>ksp-master-3<span style=color:#f92672>]</span>
</span></span></code></pre></div><ul><li>è§£å†³æ–¹æ¡ˆ</li></ul><p>åˆ¶ä½œç¦»çº¿èµ„æºçš„å®˜æ–¹ image-list ä¸­ä¸å­˜åœ¨ pause:3.8 è¿™ä¸ª imageï¼Œéœ€è¦è‡ªå·±é¢„å…ˆåŠ ä¸Šå†åˆ¶ä½œåˆ¶å“ã€‚å®é™…ä¸Šä¸€å…±éœ€è¦è¡¥å…… <strong>16</strong> ä¸ªï¼ŒæŠ¥é”™éƒ½ä¸ä¸€æ ·ï¼Œå¯ä»¥æ ¹æ®æŠ¥é”™ä¿¡æ¯è¡¥å……ï¼ˆ<strong>æœ¬æ–‡æä¾›çš„ images-list å·²ç»æ˜¯è¡¥å……å®Œæ•´çš„</strong>ï¼‰ã€‚</p><h3 id=é—®é¢˜-5>é—®é¢˜ 5</h3><ul><li>é—®é¢˜ç°è±¡</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Events:
</span></span><span style=display:flex><span>  Type     Reason     Age                   From               Message
</span></span><span style=display:flex><span>  ----     ------     ----                  ----               -------
</span></span><span style=display:flex><span>  Normal   Scheduled  18m                   default-scheduler  Successfully assigned kube-system/metrics-server-5d65c798b8-m9tbj to ksp-master-3
</span></span><span style=display:flex><span>  Normal   Pulling    16m <span style=color:#f92672>(</span>x4 over 18m<span style=color:#f92672>)</span>     kubelet            Pulling image <span style=color:#e6db74>&#34;registry.opsman.top/kubesphere/metrics-server:v0.4.2&#34;</span>
</span></span><span style=display:flex><span>  Warning  Failed     16m <span style=color:#f92672>(</span>x4 over 18m<span style=color:#f92672>)</span>     kubelet            Failed to pull image <span style=color:#e6db74>&#34;registry.opsman.top/kubesphere/metrics-server:v0.4.2&#34;</span>: rpc error: code <span style=color:#f92672>=</span> NotFound desc <span style=color:#f92672>=</span> failed to pull and unpack image <span style=color:#e6db74>&#34;registry.opsman.top/kubesphere/metrics-server:v0.4.2&#34;</span>: failed to resolve reference <span style=color:#e6db74>&#34;registry.opsman.top/kubesphere/metrics-server:v0.4.2&#34;</span>: registry.opsman.top/kubesphere/metrics-server:v0.4.2: not found
</span></span><span style=display:flex><span>  Warning  Failed     16m <span style=color:#f92672>(</span>x4 over 18m<span style=color:#f92672>)</span>     kubelet            Error: ErrImagePull
</span></span><span style=display:flex><span>  Warning  Failed     16m <span style=color:#f92672>(</span>x6 over 17m<span style=color:#f92672>)</span>     kubelet            Error: ImagePullBackOff
</span></span><span style=display:flex><span>  Normal   BackOff    2m57s <span style=color:#f92672>(</span>x64 over 17m<span style=color:#f92672>)</span>  kubelet            Back-off pulling image <span style=color:#e6db74>&#34;registry.opsman.top/kubesphere/metrics-server:v0.4.2&#34;</span>
</span></span></code></pre></div><ul><li>è§£å†³æ–¹æ¡ˆ</li></ul><p>å¯èƒ½æ˜¯ bugï¼ˆ<strong>å·²åé¦ˆç»™ç¤¾åŒºï¼Œæš‚æœªç¡®è®¤</strong>ï¼‰ã€‚ç¤¾åŒºç»™äº†ä¸´æ—¶æ–¹æ¡ˆåœ¨ç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶ä¸­ <strong>kind: ClusterConfiguration</strong> å°èŠ‚ä¸­ï¼ŒåŠ å…¥å‚æ•° <code>namespace_override: kubesphereio</code>ã€‚</p><h3 id=é—®é¢˜-6>é—®é¢˜ 6</h3><ul><li>é—®é¢˜ç°è±¡</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># kubectl describe pod opensearch-cluster-data-0 -n kubesphere-logging-system</span>
</span></span><span style=display:flex><span>Events:
</span></span><span style=display:flex><span>  Type     Reason     Age                  From               Message
</span></span><span style=display:flex><span>  ----     ------     ----                 ----               -------
</span></span><span style=display:flex><span>  Normal   Pulling    56s <span style=color:#f92672>(</span>x3 over 2m57s<span style=color:#f92672>)</span>  kubelet            Pulling image <span style=color:#e6db74>&#34;busybox:latest&#34;</span>
</span></span><span style=display:flex><span>  Warning  Failed     15s <span style=color:#f92672>(</span>x3 over 2m17s<span style=color:#f92672>)</span>  kubelet            Error: ErrImagePull
</span></span><span style=display:flex><span>  Warning  Failed     15s                  kubelet            Failed to pull image <span style=color:#e6db74>&#34;busybox:latest&#34;</span>: rpc error: code <span style=color:#f92672>=</span> Unknown desc <span style=color:#f92672>=</span> failed to pull and unpack image <span style=color:#e6db74>&#34;docker.io/library/busybox:latest&#34;</span>: failed to resolve reference <span style=color:#e6db74>&#34;docker.io/library/busybox:latest&#34;</span>: failed to <span style=color:#66d9ef>do</span> request: Head <span style=color:#e6db74>&#34;https://registry-1.docker.io/v2/library/busybox/manifests/latest&#34;</span>: dial tcp: lookup registry-1.docker.io on 114.114.114.114:53: read udp 192.168.9.92:37639-&gt;114.114.114.114:53: i/o timeout
</span></span><span style=display:flex><span>  Normal   BackOff    0s <span style=color:#f92672>(</span>x3 over 2m16s<span style=color:#f92672>)</span>   kubelet            Back-off pulling image <span style=color:#e6db74>&#34;busybox:latest&#34;</span>
</span></span><span style=display:flex><span>  Warning  Failed     0s <span style=color:#f92672>(</span>x3 over 2m16s<span style=color:#f92672>)</span>   kubelet            Error: ImagePullBackOff
</span></span></code></pre></div><ul><li>è§£å†³æ–¹æ¡ˆ</li></ul><p>è¿™ä¸ªåº”è¯¥ä¹Ÿæ˜¯ä¸ª bugï¼Œå®˜æ–¹é…ç½®å†™æ­»äº† busybox çš„åœ°å€ï¼ˆ<strong>å·²åé¦ˆç»™ç¤¾åŒºï¼Œå·²ç¡®è®¤</strong>ï¼‰ï¼Œæš‚æ—¶éœ€è¦æ‰‹æ”¹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æŸ¥çœ‹ sts</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-master-1 kubekey<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get sts -n kubesphere-logging-system</span>
</span></span><span style=display:flex><span>NAME                        READY   AGE
</span></span><span style=display:flex><span>opensearch-cluster-data     0/2     7m42s
</span></span><span style=display:flex><span>opensearch-cluster-master   0/1     7m40s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¿®æ”¹ sts ä½¿ç”¨çš„ busyboy é•œåƒä¸ºæœ¬åœ°é•œåƒï¼ˆç»†èŠ‚ä¸å±•ç¤ºï¼‰</span>
</span></span><span style=display:flex><span>kubectl edit sts opensearch-cluster-data -n kubesphere-logging-system
</span></span><span style=display:flex><span>kubectl edit sts opensearch-cluster-master -n kubesphere-logging-system
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æœ¬æ–‡ä¿®æ”¹å image å†…å®¹ï¼ˆè‡ªå·±æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹åŸŸåå‰ç¼€ï¼‰</span>
</span></span><span style=display:flex><span>registry.opsman.top/kubesphereio/busybox:1.31.1
</span></span></code></pre></div><h3 id=é—®é¢˜-7>é—®é¢˜ 7</h3><ul><li>é—®é¢˜ç°è±¡</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>preflight<span style=color:#f92672>]</span> You can also perform this action in beforehand using <span style=color:#e6db74>&#39;kubeadm config images pull&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span>WARNING ImagePull<span style=color:#f92672>]</span>: failed to pull image registry.opsman.top/kubesphereio/pause:3.9: output: E1213 10:31:38.814017    <span style=color:#ae81ff>8325</span> remote_image.go:238<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;PullImage from image service failed&#34;</span> err<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;rpc error: code = NotFound desc = failed to pull and unpack image \&#34;registry.opsman.top/kubesphereio/pause:3.9\&#34;: failed to resolve reference \&#34;registry.opsman.top/kubesphereio/pause:3.9\&#34;: registry.opsman.top/kubesphereio/pause:3.9: not found&#34;</span> image<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;registry.opsman.top/kubesphereio/pause:3.9&#34;</span>
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;2023-12-13T10:31:38+08:00&#34;</span> level<span style=color:#f92672>=</span>fatal msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pulling image: rpc error: code = NotFound desc = failed to pull and unpack image \&#34;registry.opsman.top/kubesphereio/pause:3.9\&#34;: failed to resolve reference \&#34;registry.opsman.top/kubesphereio/pause:3.9\&#34;: registry.opsman.top/kubesphereio/pause:3.9: not found&#34;</span>
</span></span><span style=display:flex><span>, error: exit status <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><ul><li>è§£å†³æ–¹æ¡ˆ</li></ul><p>è¿™ä¸ªæŠ¥é”™æ˜¯åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­å‡ºç°çš„ï¼Œä½†æ˜¯æŠ¥é”™å¹¶æœªå¯¼è‡´é›†ç¾¤éƒ¨ç½²å¤±è´¥ã€‚è§£å†³åŠæ³•è·Ÿ<code>é—®é¢˜ 4</code> ä¸€æ ·ï¼Œåˆ¶ä½œç¦»çº¿èµ„æºçš„å®˜æ–¹ image-list ä¸­ä¸å­˜åœ¨ pause:3.9 è¿™ä¸ª imageï¼Œéœ€è¦è‡ªå·±é¢„å…ˆåŠ ä¸Šå†åˆ¶ä½œåˆ¶å“ã€‚</p><h3 id=é—®é¢˜-8>é—®é¢˜ 8</h3><ul><li>é—®é¢˜ç°è±¡</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Events:
</span></span><span style=display:flex><span>  Type     Reason       Age                   From               Message
</span></span><span style=display:flex><span>  ----     ------       ----                  ----               -------
</span></span><span style=display:flex><span>  Normal   Pulling      4m25s                 kubelet            Pulling image <span style=color:#e6db74>&#34;registry.opsman.top/kubesphereio/ks-apiserver:v3.4.1&#34;</span>
</span></span><span style=display:flex><span>  Warning  Failed       4m22s                 kubelet            Failed to pull image <span style=color:#e6db74>&#34;registry.opsman.top/kubesphereio/ks-apiserver:v3.4.1&#34;</span>: rpc error: code <span style=color:#f92672>=</span> Unknown desc <span style=color:#f92672>=</span> failed to pull and unpack image <span style=color:#e6db74>&#34;registry.opsman.top/kubesphereio/ks-apiserver:v3.4.1&#34;</span>: failed to extract layer sha256:9f4598b692bcf57921e45bc384b60591c5f8eac82e32e781e9fe5849ef6eb29e: write /var/lib/containerd/io.containerd.snapshotter.v1.overlayfs/snapshots/291/fs/usr/local/bin/ks-apiserver: no space left on device: unknown
</span></span><span style=display:flex><span>  Warning  Failed       4m22s                 kubelet            Error: ErrImagePull
</span></span><span style=display:flex><span>  Warning  Failed       4m21s                 kubelet            Error: ImagePullBackOff
</span></span><span style=display:flex><span>  Normal   BackOff      39s <span style=color:#f92672>(</span>x15 over 4m21s<span style=color:#f92672>)</span>  kubelet            Back-off pulling image <span style=color:#e6db74>&#34;registry.opsman.top/kubesphereio/ks-apiserver:v3.4.1&#34;</span>
</span></span></code></pre></div><ul><li>è§£å†³æ–¹æ¡ˆ</li></ul><p>äººä¸ºé€ æˆï¼ŒKubeKey çš„ç¦»çº¿éƒ¨ç½²èµ„æºåŒ…æ”¾åœ¨äº†èŠ‚ç‚¹ <code>ksp-master-1</code>ï¼ŒåŒæ—¶ï¼Œè¯¥èŠ‚ç‚¹ä¹Ÿæ˜¯ K8s çš„ Master-1 èŠ‚ç‚¹ã€‚è¯¥èŠ‚ç‚¹çš„ç³»ç»Ÿç›˜ä¸º 40Gï¼Œæ¼”ç¤ºç¯å¢ƒæ²¡åŠ é¢å¤–çš„æ•°æ®ç›˜ï¼Œæ‰€ä»¥<strong>ç£ç›˜ç©ºé—´æ»¡äº†</strong>ã€‚å®é™…ä½¿ç”¨ä¸­ï¼Œå»ºè®®æ–°åŠ ä¸€å—æ•°æ®ç›˜ã€‚</p><h3 id=é—®é¢˜-9>é—®é¢˜ 9</h3><ul><li>é—®é¢˜ç°è±¡</li></ul><p>å®¹å™¨ <code>devops-argocd-dex-server</code> åå¤é‡å¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># kubectl describe pod devops-argocd-dex-server-84fff59566-2brcn -n argocd</span>
</span></span><span style=display:flex><span>Events:
</span></span><span style=display:flex><span>  Type     Reason     Age                    From               Message
</span></span><span style=display:flex><span>  ----     ------     ----                   ----               -------
</span></span><span style=display:flex><span>  Normal   Created    35m <span style=color:#f92672>(</span>x2 over 36m<span style=color:#f92672>)</span>      kubelet            Created container dex-server
</span></span><span style=display:flex><span>  Normal   Started    35m <span style=color:#f92672>(</span>x2 over 36m<span style=color:#f92672>)</span>      kubelet            Started container dex-server
</span></span><span style=display:flex><span>  Normal   Killing    35m                    kubelet            Container dex-server failed liveness probe, will be restarted
</span></span><span style=display:flex><span>  Normal   Pulled     35m                    kubelet            Container image <span style=color:#e6db74>&#34;registry.opsman.top/kubesphereio/dex:v2.30.2&#34;</span> already present on machine
</span></span><span style=display:flex><span>  Warning  Unhealthy  35m <span style=color:#f92672>(</span>x6 over 36m<span style=color:#f92672>)</span>      kubelet            Liveness probe failed: Get <span style=color:#e6db74>&#34;http://10.233.89.12:5558/healthz/live&#34;</span>: dial tcp 10.233.89.12:5558: connect: connection refused
</span></span><span style=display:flex><span>  Warning  Unhealthy  22m <span style=color:#f92672>(</span>x38 over 36m<span style=color:#f92672>)</span>     kubelet            Readiness probe failed: Get <span style=color:#e6db74>&#34;http://10.233.89.12:5558/healthz/ready&#34;</span>: dial tcp 10.233.89.12:5558: connect: connection refused
</span></span><span style=display:flex><span>  Warning  BackOff    2m21s <span style=color:#f92672>(</span>x127 over 33m<span style=color:#f92672>)</span>  kubelet            Back-off restarting failed container dex-server in pod devops-argocd-dex-server-84fff59566-2brcn_argocd<span style=color:#f92672>(</span>d83b98dc-cd21-47d9-aa5e-e7a26d458e7f<span style=color:#f92672>)</span>
</span></span></code></pre></div><ul><li>è§£å†³æ–¹æ¡ˆï¼ˆ<strong>æœªè§£å†³</strong>ï¼‰</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ç»†èŠ‚æ²¡æ·±ç©¶ï¼Œåˆ é™¤ pod è‡ªåŠ¨é‡å»ºï¼Œä½†æ˜¯è¿˜ä¼šè‡ªåŠ¨é‡å¯</span>
</span></span><span style=display:flex><span>kubectl delete pod devops-argocd-dex-server-84fff59566-2brcn -n argocd
</span></span></code></pre></div><h2 id=8-æ€»ç»“>8. æ€»ç»“</h2><p>æœ¬æ¬¡çš„å®æˆ˜è¯¾ç¨‹ï¼Œæˆ‘ä»¬è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ KubeKey <strong>v3.0.13</strong> ç¦»çº¿éƒ¨ç½² KubeSphere å’Œ K8s é›†ç¾¤ã€‚</p><p>æ¦‚æ‹¬æ€»ç»“å…¨æ–‡ä¸»è¦æ¶‰åŠä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>äº†è§£æ¸…å• (manifest) å’Œåˆ¶å“ (artifact) çš„æ¦‚å¿µ</li><li>äº†è§£ manifest å’Œ images-list èµ„æºçš„è·å–åœ°å€</li><li>äº†è§£ images-list çš„ç»„æˆåŠè£å‰ªæ–¹æ¡ˆ</li><li>æ‰‹å·¥ç¼–å†™ manifest æ¸…å•</li><li>æ ¹æ® manifest æ¸…å•åˆ¶ä½œ artifact</li><li>KubeKey ç¦»çº¿éƒ¨ç½² Harbor</li><li>Harbor é•œåƒä»“åº“è‡ªåŠ¨åˆ›å»ºé¡¹ç›®</li><li>KubeKey ç¦»çº¿éƒ¨ç½² KubeSphere å’Œ K8s</li><li>KubeKey ç¦»çº¿éƒ¨ç½²å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</li></ul><p>å—é™äºç¯‡å¹…é™åˆ¶ï¼Œæœ¬æ–‡ç•¥æœ‰é—æ†¾ä¹‹å¤„åœ¨äºå¾ˆå¤šéƒ¨ç½²ä»»åŠ¡çš„è¾“å‡ºç»“æœæ²¡æœ‰å±•ç¤ºï¼Œå»ºè®®è¯»è€…åœ¨å®æˆ˜ä¸­ä»”ç»†åˆ†æã€‚</p><blockquote><p><strong>å…è´£å£°æ˜ï¼š</strong></p><ul><li>ç¬”è€…æ°´å¹³æœ‰é™ï¼Œå°½ç®¡ç»è¿‡å¤šæ¬¡éªŒè¯å’Œæ£€æŸ¥ï¼Œå°½åŠ›ç¡®ä¿å†…å®¹çš„å‡†ç¡®æ€§ï¼Œ<strong>ä½†ä»å¯èƒ½å­˜åœ¨ç–æ¼ä¹‹å¤„</strong>ã€‚æ•¬è¯·ä¸šç•Œä¸“å®¶å¤§ä½¬ä¸åæŒ‡æ•™ã€‚</li><li>æœ¬æ–‡æ‰€è¿°å†…å®¹ä»…é™äºå®æˆ˜ç¯å¢ƒéªŒè¯æµ‹è¯•é€šè¿‡ï¼Œè¯»è€…å¯å­¦ä¹ ã€å€Ÿé‰´ï¼Œä½†<strong>ä¸¥ç¦ç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒ</strong>ã€‚<strong>ç”±æ­¤å¼•å‘çš„ä»»ä½•é—®é¢˜ï¼Œä½œè€…æ¦‚ä¸è´Ÿè´£</strong>ï¼</li></ul></blockquote></div></div><div class=share-2><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploying-kubesphere-and-k8s-offline-with-kubekey%2f&text=KubeKey%20%e7%a6%bb%e7%ba%bf%e9%83%a8%e7%bd%b2%20KubeSphere%20v3.4.1%20%e5%92%8c%20K8s%20v1.26%20%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploying-kubesphere-and-k8s-offline-with-kubekey%2f&title=KubeKey%20%e7%a6%bb%e7%ba%bf%e9%83%a8%e7%bd%b2%20KubeSphere%20v3.4.1%20%e5%92%8c%20K8s%20v1.26%20%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploying-kubesphere-and-k8s-offline-with-kubekey%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploying-kubesphere-and-k8s-offline-with-kubekey%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploying-kubesphere-and-k8s-offline-with-kubekey%2f&t=KubeKey%20%e7%a6%bb%e7%ba%bf%e9%83%a8%e7%bd%b2%20KubeSphere%20v3.4.1%20%e5%92%8c%20K8s%20v1.26%20%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div></div><div class=aside><div class=inner-div><div class=title>ç›®å½•</div><div class=tabs><nav id=TableOfContents><ul><li><a href=#å‰è¨€>å‰è¨€</a><ul><li><a href=#çŸ¥è¯†ç‚¹>çŸ¥è¯†ç‚¹</a></li><li><a href=#å®æˆ˜æœåŠ¡å™¨é…ç½®>å®æˆ˜æœåŠ¡å™¨é…ç½®</a></li><li><a href=#å®æˆ˜ç¯å¢ƒæ¶‰åŠè½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯>å®æˆ˜ç¯å¢ƒæ¶‰åŠè½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯</a></li></ul></li><li><a href=#1-ç®€ä»‹>1. ç®€ä»‹</a></li><li><a href=#2-ç¦»çº¿éƒ¨ç½²èµ„æºåˆ¶ä½œ>2. ç¦»çº¿éƒ¨ç½²èµ„æºåˆ¶ä½œ</a><ul><li><a href=#21-ä¸‹è½½-kubekey>2.1. ä¸‹è½½ KubeKey</a></li><li><a href=#22-è·å–-manifest-æ¨¡æ¿>2.2. è·å– manifest æ¨¡æ¿</a></li><li><a href=#23-è·å–-images-list-åŠå¯è£å‰ªæ€§åˆ†æ>2.3. è·å– images-list åŠå¯è£å‰ªæ€§åˆ†æ</a></li><li><a href=#24-è·å–æ“ä½œç³»ç»Ÿä¾èµ–åŒ…>2.4. è·å–æ“ä½œç³»ç»Ÿä¾èµ–åŒ…</a></li><li><a href=#25-ç”Ÿæˆ-manifest-æ–‡ä»¶>2.5. ç”Ÿæˆ manifest æ–‡ä»¶</a></li><li><a href=#26-å¯¼å‡ºåˆ¶å“-artifact>2.6. å¯¼å‡ºåˆ¶å“ artifact</a></li><li><a href=#27-å¯¼å‡º-kubekey>2.7. å¯¼å‡º KubeKey</a></li><li><a href=#28-kernel-å‡çº§åŒ…>2.8. Kernel å‡çº§åŒ…</a></li></ul></li><li><a href=#3-k8s-ç¦»çº¿é›†ç¾¤æœåŠ¡å™¨-åˆå§‹åŒ–é…ç½®>3. K8s ç¦»çº¿é›†ç¾¤æœåŠ¡å™¨-åˆå§‹åŒ–é…ç½®</a><ul><li><a href=#31-æ“ä½œç³»ç»ŸåŸºç¡€é…ç½®>3.1. æ“ä½œç³»ç»ŸåŸºç¡€é…ç½®</a></li><li><a href=#32-æ•°æ®ç›˜é…ç½®>3.2. æ•°æ®ç›˜é…ç½®</a></li><li><a href=#33-å‡çº§ç³»ç»Ÿå†…æ ¸>3.3. å‡çº§ç³»ç»Ÿå†…æ ¸</a></li></ul></li><li><a href=#4-ç¦»çº¿éƒ¨ç½²-kubesphere-å’Œ-k8s-çš„å‰æå‡†å¤‡>4. ç¦»çº¿éƒ¨ç½² KubeSphere å’Œ K8s çš„å‰æå‡†å¤‡</a><ul><li><a href=#41-ä¸Šä¼ ç¦»çº¿éƒ¨ç½²èµ„æºåŒ…åˆ°éƒ¨ç½²èŠ‚ç‚¹>4.1. ä¸Šä¼ ç¦»çº¿éƒ¨ç½²èµ„æºåŒ…åˆ°éƒ¨ç½²èŠ‚ç‚¹</a></li><li><a href=#42-åˆ›å»ºç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶>4.2. åˆ›å»ºç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶</a></li><li><a href=#43-ä¿®æ”¹-cluster-é…ç½®>4.3. ä¿®æ”¹ Cluster é…ç½®</a></li><li><a href=#44-ä¿®æ”¹-clusterconfiguration-é…ç½®>4.4. ä¿®æ”¹ ClusterConfiguration é…ç½®</a></li></ul></li><li><a href=#5-å®‰è£…é…ç½®-harbor>5. å®‰è£…é…ç½® Harbor</a><ul><li><a href=#51-å®‰è£…-harbor>5.1. å®‰è£… Harbor</a></li><li><a href=#52-åœ¨-harbor-ä¸­åˆ›å»ºé¡¹ç›®>5.2. åœ¨ Harbor ä¸­åˆ›å»ºé¡¹ç›®</a></li><li><a href=#53-æ¨é€ç¦»çº¿é•œåƒåˆ°-harbor-ä»“åº“>5.3. æ¨é€ç¦»çº¿é•œåƒåˆ° Harbor ä»“åº“</a></li></ul></li><li><a href=#6-å®‰è£…-kubesphere-å’Œ-k8s-é›†ç¾¤>6. å®‰è£… KubeSphere å’Œ K8s é›†ç¾¤</a><ul><li><a href=#61-å®‰è£…-kubesphere-å’Œ-k8s-é›†ç¾¤>6.1. å®‰è£… KubeSphere å’Œ K8s é›†ç¾¤</a></li><li><a href=#62--éƒ¨ç½²ç»“æœéªŒè¯>6.2. éƒ¨ç½²ç»“æœéªŒè¯</a></li></ul></li><li><a href=#7-å¸¸è§é—®é¢˜>7. å¸¸è§é—®é¢˜</a><ul><li><a href=#é—®é¢˜-1>é—®é¢˜ 1</a></li><li><a href=#é—®é¢˜-2>é—®é¢˜ 2</a></li><li><a href=#é—®é¢˜-3>é—®é¢˜ 3</a></li><li><a href=#é—®é¢˜-4>é—®é¢˜ 4</a></li><li><a href=#é—®é¢˜-5>é—®é¢˜ 5</a></li><li><a href=#é—®é¢˜-6>é—®é¢˜ 6</a></li><li><a href=#é—®é¢˜-7>é—®é¢˜ 7</a></li><li><a href=#é—®é¢˜-8>é—®é¢˜ 8</a></li><li><a href=#é—®é¢˜-9>é—®é¢˜ 9</a></li></ul></li><li><a href=#8-æ€»ç»“>8. æ€»ç»“</a></li></ul></nav></div></div></div></div></section><div class=SubscribeForm><div class=innerBox><img class=close src=/images/home/close.svg alt=close><p class=description>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=blog_formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input-blog type=text placeholder>
<button id=email-submit-blog>è®¢é˜…</button>
<span id=message_blog data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨ style=color:red></span><span id=message1_blog style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span></div></div></div><footer><div class=footer><div class="footer-main common-layout"><div class=up-main><div class=left-div><img src=/images/logo.svg alt class=foot-logo><p>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input type=text placeholder=è¯·è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€>
<button id=email-submit>è®¢é˜…</button></div><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨></span><span id=message1 style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span><script>var bindSubmit=function(){var e=$("#email-input");$("#email-submit").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message").data("message1"),a=$("#message").data("message2"),r=$("#message").data("message3"),c=$("#message1").data("success");if(n)if(validateEmail(n)){if(s=$("#formAddress").data("usesendcloud"),!s)return;o=$("#formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:$("#email-input").val().toString()},success:function(){showSuccessMessage(c),setTimeout(function(){$("#email-input").val("")},1e3)},error:function(){showMessage(r)}})}else t.preventDefault(),showMessage(a);else t.preventDefault(),showMessage(i)})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},showMessage=function(e){$("#message").html(e).show()},showSuccessMessage=function(e){$("#message1").html(e).show()},bindHideMessage=function(){$(window).click(function(){$("#message").hide(),$("#message1").hide()})},bindClose=function(){$(".formBox .close").click(function(e){e.stopPropagation(),$(".formBox").fadeOut()})};bindSubmit(),bindClose(),bindHideMessage()</script><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€!></span></div><div class=right-div><ul class=common-flex-layout><li class=nowrap-li><div class=h3>åº”ç”¨åœºæ™¯</div><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps</a>
<a href=/zh/service-mesh/>åœ¨ K8s è¿è¡Œå¾®æœåŠ¡</a>
<a href=/zh/observability/>æ„å»ºäº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a>
<a href=https://github.com/kubesphere/kubekey target=_blank rel="noopener noreferrer">K8s ä¸€é”®éƒ¨ç½²ä¸è¿ç»´</a>
<a href=https://github.com/OpenFunction/OpenFunction target=_blank rel="noopener noreferrer">æ„å»º FaaS å¹³å°ä¸ Serverless æ¶æ„</a>
<a href=https://github.com/openpitrix/openpitrix target=_blank rel="noopener noreferrer">å¤šäº‘åº”ç”¨ç®¡ç†å¹³å°</a></li><li class=nowrap-li><div class=h3>èµ„æº</div><a href=/zh/projects/>å¼€æºé¡¹ç›®</a>
<a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a>
<a href=/zh/conferences/>å¼€æºå³°ä¼š</a>
<a href=/zh/videos/>è§†é¢‘èµ„æº</a>
<a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li><li class=nowrap-li><div class=h3>æ–‡æ¡£ä¸­å¿ƒ</div><a href=/zh/docs/v4.1/01-intro/01-introduction/>äº§å“ä»‹ç»</a>
<a href=/zh/docs/v4.1/03-installation-and-upgrade/02-install-kubesphere/02-install-kubernetes-and-kubesphere/>å¦‚ä½•å®‰è£…</a>
<a href=/zh/docs/v4.1/02-quickstart/>å¿«é€Ÿå…¥é—¨</a>
<a href=/zh/docs/v3.4/reference/api-docs/>API æ–‡æ¡£</a></li><li class=nowrap-li><div class=h3>å¼€æºç¤¾åŒº</div><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a>
<a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a>
<a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a>
<a href=/zh/partner/>åˆä½œä¼™ä¼´</a>
<a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a>
<a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a>
<a href=https://kubesphere.com.cn/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a>
<a href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ä¸­æ–‡è®ºå›</a>
<a href=https://kubesphere.io target=_blank rel="noopener noreferrer">å…¨çƒç«™</a></li><li class=nowrap-li><div class=h3>äº§å“ä¸æœåŠ¡</div><a href=https://aws.amazon.com/cn/quickstart/architecture/qingcloud-kubesphere/ target=_blank rel="noopener noreferrer">KubeSphere on AWS</a>
<a href=https://market.azure.cn/marketplace/apps/qingcloud.kubesphere target=_blank rel="noopener noreferrer">KubeSphere on Azure</a>
<a href=https://marketplace.digitalocean.com/apps/kubesphere target=_blank rel="noopener noreferrer">KubeSphere on DigitalOcean</a>
<a href=https://www.qingcloud.com/products/kubesphereqke target=_blank rel="noopener noreferrer">KubeSphere on QingCloud(QKE)</a>
<a href=https://kubesphere.com.cn/kse/ target=_blank rel="noopener noreferrer">KubeSphere ä¼ä¸šç‰ˆ</a>
<a href=https://kubesphere.cloud/ksv/ target=_blank rel="noopener noreferrer">KubeSphere è™šæ‹ŸåŒ–å¹³å°</a>
<a href=https://kubesphere.com.cn/marketplace/ target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿæ‰©å±•ç»„ä»¶å¸‚åœº</a>
<a href=https://kubesphere.cloud target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿåº”ç”¨æœåŠ¡å¹³å°</a>
<a href=https://m.qingcloud.com/p/aec50 target=_blank rel="noopener noreferrer">äº†è§£å•†ä¸šäº§å“ä¸å’¨è¯¢åˆä½œ</a></li></ul></div></div><div class=down-main><div class=img-div><a class=wechat href=javascript:void(0); aria-label=wechat><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28"><defs><path id="a" d="M0 0h15.673v12.156H0z"/></defs><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="13" cy="13" r="13" stroke="#B6C2CD"/><g transform="translate(5 7)"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59.0-4.625 1.679-4.625 3.74.0 2.066 2.035 3.738 4.625 3.738.542.0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27.0-.541-.257-.541-.514.0-.256.27-.514.541-.514.41.0.681.258.681.514.0.257-.271.514-.681.514zm2.994.0c-.27.0-.541-.257-.541-.514.0-.256.27-.514.54-.514.41.0.681.258.681.514.0.257-.277.514-.68.514z" mask="url(#b)"/><path fill="currentColor" d="M10.602 3.674c.177.0.356.011.533.029C10.657 1.576 8.27.0 5.543.0 2.498.0.0 1.974.0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17.0.343-.005.515-.022a3.68 3.68.0 01-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417.0.693.263.693.66s-.276.66-.693.66c-.418.0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417.0-.834-.263-.834-.66s.417-.66.834-.66c.418.0.695.263.695.66.0.392-.277.66-.695.66z" mask="url(#b)"/></g></g></svg><div class=hide-div><img src=/images/home/wechat.svg alt></div></a><a class=facebook-a href=https://www.facebook.com/kubesphere target=_blank aria-label=facebook></a><a class=twitter-a href=https://x.com/KubeSphere target=_blank aria-label=twitter rel="noopener noreferrer"></a><a class=linkedin-a href=https://www.linkedin.com/company/kubesphere/ target=_blank aria-label=linkedin rel="noopener noreferrer"></a><a class=bilibili-a href=https://space.bilibili.com/438908638 target=_blank aria-label=bilibili rel="noopener noreferrer"></a><a class=slack-a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank aria-label=slack rel="noopener noreferrer"></a><a class=github-a href=https://github.com/kubesphere/kubesphere target=_blank aria-label=github rel="noopener noreferrer"></a><a class=medium-a href=https://itnext.io/@kubesphere target=_blank aria-label=medium rel="noopener noreferrer"></a></div><p class=p1></p><p class=case><a href=http://www.beian.miit.gov.cn/ target=_blank rel="noopener noreferrer"><span>äº¬ICPå¤‡13019086å·</span>
</a><a target=_blank rel="noopener noreferrer" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502041003"><img src=/images/footer/case-icon.png alt=å¤‡æ¡ˆå›¾æ ‡>
<span>äº¬å…¬ç½‘å®‰å¤‡ 11010502041003å·</span></a></p></div></div></div><div class=cookie><div class=common-layout><p>æ‚¨çš„éšç§å¯¹æˆ‘ä»¬å¾ˆé‡è¦ã€‚æˆ‘ä»¬ä½¿ç”¨Cookieæ¥è®°ä½è®¢é˜…è¯¦ç»†ä¿¡æ¯ï¼Œä¼˜åŒ–ç½‘ç«™åŠŸèƒ½å¹¶äº¤ä»˜æ ¹æ®æ‚¨çš„å…´è¶£é‡èº«å®šåˆ¶çš„å†…å®¹ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„<a href=/zh/privacy>éšç§æ”¿ç­–</a>.</p><button>
æ¥å—å¹¶ç»§ç»­</button></div></div></footer><script>var lazyLoad=function(e,t){for(var n,o,i,s=0;s<t;s++){if(n=e.eq(s),o=n.attr("data-loaded"),o)continue;n.offset().top<parseInt($(window).height())+parseInt($(window).scrollTop())&&(i=n.attr("src"),n.attr("src",i),n.attr("data-loaded",!0))}},bindLayLoad=function(){var e=$("img"),t=e.length;lazyLoad(e,t),$(window).scroll(function(){lazyLoad(e,t)})},bindAddPadding=function(){var e=$("#close-join");e.length>0&&$(".main-section").addClass("padding")},docCookies={getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t){return!!e&&!/^(?:expires|max-age|path|domain|secure)$/i.test(e)&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t),!0)}},bindHideCookie=function(){var t=docCookies.getItem("hasAuth"),e=$(".cookie");t?e.hide():e.show(),e.find("button").on("click",function(){docCookies.setItem("hasAuth","1"),e.hide()})};bindAddPadding(),bindHideCookie()</script><script type=text/javascript src=/js/aside.2d6977c0f16aef4ed3e886dd66675ce74bd0efcd467c2b2bcdb30b92d5e7c7c0e5c6e0c9d8f09a883c22f58df9e6b0b6347fcdd3c9a920b7faba6d7f91a201c3.js integrity="sha512-LWl3wPFq707T6IbdZmdc50vQ781GfCsrzbMLktXnx8DlxuDJ2PCaiDwi9Y355rC2NH/N08mpILf6um1/kaIBww=="></script><script type=text/javascript src=/js/markdown-tab.17f9f46b021adebc7250ce1b07134a577b307e7a436daa4aaf388f218e8463966f53770b26a64817c06c168738a887672d47fb4c29615adfc446e11d09a344cf.js integrity="sha512-F/n0awIa3rxyUM4bBxNKV3swfnpDbapKrziPIY6EY5ZvU3cLJqZIF8BsFoc4qIdnLUf7TClhWt/ERuEdCaNEzw=="></script><script>let forbidForm=!1;var viewer=new Viewer(document.querySelector(".md-body"),{url:"src"}),blogBindSubmit=function(){var e=$("#email-input-blog");$("#email-submit-blog").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message_blog").data("message1"),a=$("#message_blog").data("message2"),r=$("#message_blog").data("message3"),c=$("#message1_blog").data("success");if(n)if(validateEmail(n)){if(s=$("#blog_formAddress").data("usesendcloud"),!s)return;o=$("#blog_formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:n.toString()},success:function(){showSuccessMessage_blog(c),setTimeout(function(){window.onscroll="",$(".SubscribeForm").hide(),$("#email-input-blog").val("")},5e3)},error:function(){showMessage_blog(r)}})}else t.preventDefault(),$("#message_blog").html(a).show();else t.preventDefault(),$("#message_blog").html(i).show()})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},bindHideMessageBlog=function(){$(window).click(function(){$("#message_blog").hide()})},bindCloseBlog=function(){$(".SubscribeForm .close").click(function(e){e.stopPropagation(),$(".SubscribeForm").fadeOut(),window.onscroll=""})},showMessage_blog=function(e){$("#message_blog").html(e).show()},showSuccessMessage_blog=function(e){$("#message1_blog").html(e).show()};window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;forbidForm&&(window.onscroll=""),e+t>n-710?$(".SubscribeForm").hide():$(".SubscribeForm").show()},blogBindSubmit(),bindCloseBlog(),bindHideMessageBlog()</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>