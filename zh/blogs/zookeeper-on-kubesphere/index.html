<!doctype html><html lang=en-US><head><meta charset=utf-8><title>KubeSphere éƒ¨ç½² Zookeeper å®æˆ˜æ•™ç¨‹</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† Zookeeper å•èŠ‚ç‚¹å’Œé›†ç¾¤æ¨¡å¼åœ¨åŸºäº KubeSphere éƒ¨ç½²çš„ K8s é›†ç¾¤ä¸Šçš„å®‰è£…éƒ¨ç½²ã€æµ‹è¯•éªŒè¯çš„è¿‡ç¨‹"><meta name=keywords content="Kubernetes,KubeSphere,Zookeeper"><meta property="og:type" content="article"><meta property="og:title" content="KubeSphere éƒ¨ç½² Zookeeper å®æˆ˜æ•™ç¨‹"><meta property="og:description" content="æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† Zookeeper å•èŠ‚ç‚¹å’Œé›†ç¾¤æ¨¡å¼åœ¨åŸºäº KubeSphere éƒ¨ç½²çš„ K8s é›†ç¾¤ä¸Šçš„å®‰è£…éƒ¨ç½²ã€æµ‹è¯•éªŒè¯çš„è¿‡ç¨‹"><meta property="og:image" content="https://pek3b.qingstor.com/kubesphere-community/images/zookeeper-on-kubesphere-cover.png"><meta property="og:url" content="https://openksc.github.io/zh/blogs/zookeeper-on-kubesphere/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeSphere"><meta property="twitter:image" content="https://pek3b.qingstor.com/kubesphere-community/images/zookeeper-on-kubesphere-cover.png"><meta name=docsearch:language content="zh-CN"><meta name=docsearch:version content><link rel=canonical href=https://kubesphere.io/zh/blogs/zookeeper-on-kubesphere/><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=apple-touch-icon href=/images/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/svg+xml href=/images/favicons/favicon.svg><link rel=icon type=image/png href=/images/favicons/favicon.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg color=#00ad6e><meta name=msapplication-config content='/images/favicons/browserconfig.xml'><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/fonts/Roboto/stylesheet.css><link rel=stylesheet href=/fonts/ProximaNova/stylesheet.css><link rel=stylesheet href=/css/jquery.modal.min.css><link rel=stylesheet href=/css/viewer.min.css><link rel=stylesheet href=/swiper/swiper-bundle.min.css><link rel=stylesheet href=/scss/common.min.0c3fdcc05ec210321169846714f74b11c4a1baf09a1833fa9273b2347c81e636.css><script src=/js/jquery-3.7.1.min.js></script><script src=/js/viewer.min.js></script><script src=/js/jquery.modal.min.js></script><script src=/swiper/swiper-bundle.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0888981f1fa45d241b1fb6962da2963e",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YYCVN36HT5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YYCVN36HT5")</script><script type=text/javascript>!function(e,t,n,s,o){e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=("https:"==document.location.protocol?"https://":"http://")+s,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio"),gio("init","8a24ae300cbf8b8c",{}),gio("send")</script><link rel=stylesheet href=/scss/content.min.f73b326fbf8c5bd331900b0de21c7dde608a4926f482f6465f9ae1d9049b83ad.css><link rel=stylesheet href=/scss/markdown.min.db47186481122431dffae72d17dbbd51f90b66f022cc163458645709924e4eac.css></head><body><header class=navigation><div class=join-div><div class=content>ğŸš€ KubeSphere v4.1.3 å‘å¸ƒï¼Œå¤šé¡¹ä¼˜åŒ–ä¸æ”¹è¿›ï¼Œæ¬¢è¿ä½“éªŒï¼<a href=/zh/docs/v4.1/20-release-notes/release-v413/ target=_blank rel="noopener noreferrer">è¯·æŸ¥çœ‹ Release notes â†’</a>
<img id=close-join src=/images/header/close.svg alt=close></div></div><div class=common-layout><div class=header-container><a href=/zh/ aria-label=logo><img src=/images/header/logo.svg alt class=logo></a><ul class=nav><li class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class="dropdown-menu menu-2"><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li class=menu-li><span class=menu-span>èµ„æº</span><ul class="dropdown-menu menu-3"><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class="dropdown-menu menu-4"><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/ target=_blank rel="noopener noreferrer">æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/ target=_blank rel="noopener noreferrer">Kube Design</a></li></ul></li><li class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class="dropdown-menu menu-5"><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025 target=_blank rel="noopener noreferrer">å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/ target=_blank rel="noopener noreferrer">è®¤è¯</a></li></ul><div class=right-menu><ul><li class=language-menu><div><img src=/images/header/black.svg alt>
<span>ç®€ä½“ä¸­æ–‡</span></div><ul class=dropdown-menu><li onclick='handleLangClick("zh","/zh/blogs/zookeeper-on-kubesphere/")'>ç®€ä½“ä¸­æ–‡</li></ul></li><li class=github-li><div class=github-star><a class=star-btn href=https://github.com/kubesphere/kubesphere rel="noopener noreferrer" target=_blank><span class=star-img></span>&nbsp;<span>Star</span>
</a><a class=social-count href=https://github.com/kubesphere/kubesphere/stargazers rel="noopener noreferrer" target=_blank></a></div></li><li class=menu-icon><img src=/images/header/menu.svg alt></li></ul></div></div></div><div id=modal-for-menu class=modal><ul class=nav><li data-check=0 class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class=dropdown-menu><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>èµ„æº</span><ul class=dropdown-menu><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class=dropdown-menu><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/>æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/>Kube Design</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class=dropdown-menu><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md>ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/>ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025>å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum>ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/>è®¤è¯</a></li></ul><div class=link-div><a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank rel="noopener noreferrer" aria-label=slack><img src=/images/header/slack-hover.svg alt>
</a><a href=https://x.com/KubeSphere target=_blank rel="noopener noreferrer" aria-label=twitter><img src=/images/header/twitter-hover.svg alt>
</a><a href=https://github.com/kubesphere/kubesphere target=_blank rel="noopener noreferrer" aria-label=github><img src=/images/header/github-hover.svg alt></a></div></div></header><script>var bindNavMouseEvent,bindScrollChangeHeader,bindClickShowMenu,bindClickModalLi,bindClickClose,language,handleLangClick,githubApiLink="https://api.github.com/repos/kubesphere/kubesphere",getStar=function(){$(".social-count").hide(),$.getJSON(githubApiLink,function(e){$(".social-count").show().html(e.stargazers_count)})};getStar(),bindNavMouseEvent=function(e,t){t||(t=$(e));var n=!1;t.mouseenter(function(){if(n)return!1;n=!0,$(this).find(".dropdown-menu").fadeIn(200,function(){n=!1})}),t.mouseleave(function(){$(this).find(".dropdown-menu").fadeOut(200)})},bindScrollChangeHeader=function(){var t=100,e=$("header");window.addEventListener("scroll",function(){var t=window.scrollY;t>0?e.addClass("navigationScroll"):e.removeClass("navigationScroll")})},bindClickShowMenu=function(){$(".menu-icon").click(function(){$("#modal-for-menu").modal()})},bindClickModalLi=function(){$(".modal .menu-li").click(function(){var e=$(this).data("check");e===0?($(this).data("check",1),$(this).find(".dropdown-menu").slideDown(200)):($(this).data("check",0),$(this).find(".dropdown-menu").slideUp(200)),$(this).find(".menu-span").toggleClass("up")})},bindClickClose=function(){$("#close-join").click(function(){$(".navigation .join-div").hide(),$(".main-section").removeClass("padding")})},language="zh",bindClickClose(),bindScrollChangeHeader(),$(".header-container .menu-li").each(function(){bindNavMouseEvent("",$(this))}),bindNavMouseEvent(".header-container .language-menu"),bindNavMouseEvent(".header-container .btn-li"),bindClickShowMenu(),bindClickModalLi(),handleLangClick=function(e,t){try{localStorage.setItem("lang",e)}catch{}location.href=t}</script><section class=main-section><div class=common-layout><div class=breadcrumb><span><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a> > </span><span>KubeSphere éƒ¨ç½² Zookeeper å®æˆ˜æ•™ç¨‹</span></div><div class='main-div middle-div'><div class=author>è¿ç»´æœ‰æœ¯</div><span class=date>å‘å¸ƒäºï¼š2023-08-11</span>&nbsp;&nbsp;&nbsp;
<span style=font-size:14px;color:#919aa3 id=busuanzi_container_page_pv>æœ¬æ–‡æ€»é˜…è¯»é‡ï¼š<span id=busuanzi_value_page_pv></span></span><h1>KubeSphere éƒ¨ç½² Zookeeper å®æˆ˜æ•™ç¨‹</h1><div class=share-1><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fzookeeper-on-kubesphere%2f&text=KubeSphere%20%e9%83%a8%e7%bd%b2%20Zookeeper%20%e5%ae%9e%e6%88%98%e6%95%99%e7%a8%8b" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fzookeeper-on-kubesphere%2f&title=KubeSphere%20%e9%83%a8%e7%bd%b2%20Zookeeper%20%e5%ae%9e%e6%88%98%e6%95%99%e7%a8%8b" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fzookeeper-on-kubesphere%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fzookeeper-on-kubesphere%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fzookeeper-on-kubesphere%2f&t=KubeSphere%20%e9%83%a8%e7%bd%b2%20Zookeeper%20%e5%ae%9e%e6%88%98%e6%95%99%e7%a8%8b" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div><div class=content><div class=md-body><h2 id=å‰è¨€>å‰è¨€</h2><h3 id=çŸ¥è¯†ç‚¹>çŸ¥è¯†ç‚¹</h3><ul><li>å®šçº§ï¼š<strong>å…¥é—¨çº§</strong></li><li>å¦‚ä½•åˆ©ç”¨ <strong>AI åŠ©æ‰‹</strong>è¾…åŠ©è¿ç»´å·¥ä½œ</li><li>å•èŠ‚ç‚¹ Zookeeper å®‰è£…éƒ¨ç½²</li><li>é›†ç¾¤æ¨¡å¼ Zookeeper å®‰è£…éƒ¨ç½²</li><li>å¼€æºåº”ç”¨é€‰å‹æ€æƒ³</li></ul><h3 id=å®æˆ˜æœåŠ¡å™¨é…ç½®æ¶æ„-11-å¤åˆ»å°è§„æ¨¡ç”Ÿäº§ç¯å¢ƒé…ç½®ç•¥æœ‰ä¸åŒ>å®æˆ˜æœåŠ¡å™¨é…ç½®(æ¶æ„ 1:1 å¤åˆ»å°è§„æ¨¡ç”Ÿäº§ç¯å¢ƒï¼Œé…ç½®ç•¥æœ‰ä¸åŒ)</h3><table><thead><tr><th style=text-align:center>ä¸»æœºå</th><th style=text-align:center>IP</th><th style=text-align:center>CPU</th><th style=text-align:center>å†…å­˜</th><th style=text-align:center>ç³»ç»Ÿç›˜</th><th style=text-align:center>æ•°æ®ç›˜</th><th style=text-align:center>ç”¨é€”</th></tr></thead><tbody><tr><td style=text-align:center>ks-master-0</td><td style=text-align:center>192.168.9.91</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>50</td><td style=text-align:center>100</td><td style=text-align:center>KubeSphere/k8s-master</td></tr><tr><td style=text-align:center>ks-master-1</td><td style=text-align:center>192.168.9.92</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>50</td><td style=text-align:center>100</td><td style=text-align:center>KubeSphere/k8s-master</td></tr><tr><td style=text-align:center>ks-master-2</td><td style=text-align:center>192.168.9.93</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>50</td><td style=text-align:center>100</td><td style=text-align:center>KubeSphere/k8s-master</td></tr><tr><td style=text-align:center>ks-worker-0</td><td style=text-align:center>192.168.9.95</td><td style=text-align:center>4</td><td style=text-align:center>16</td><td style=text-align:center>50</td><td style=text-align:center>100</td><td style=text-align:center>k8s-worker/CI</td></tr><tr><td style=text-align:center>ks-worker-1</td><td style=text-align:center>192.168.9.96</td><td style=text-align:center>4</td><td style=text-align:center>16</td><td style=text-align:center>50</td><td style=text-align:center>100</td><td style=text-align:center>k8s-worker</td></tr><tr><td style=text-align:center>ks-worker-2</td><td style=text-align:center>192.168.9.97</td><td style=text-align:center>4</td><td style=text-align:center>16</td><td style=text-align:center>50</td><td style=text-align:center>100</td><td style=text-align:center>k8s-worker</td></tr><tr><td style=text-align:center>storage-0</td><td style=text-align:center>192.168.9.81</td><td style=text-align:center>2</td><td style=text-align:center>4</td><td style=text-align:center>50</td><td style=text-align:center>100+</td><td style=text-align:center>ElasticSearch/GlusterFS/Ceph/Longhorn/NFS/</td></tr><tr><td style=text-align:center>storage-1</td><td style=text-align:center>192.168.9.82</td><td style=text-align:center>2</td><td style=text-align:center>4</td><td style=text-align:center>50</td><td style=text-align:center>100+</td><td style=text-align:center>ElasticSearch/GlusterFS/Ceph/Longhorn</td></tr><tr><td style=text-align:center>storage-2</td><td style=text-align:center>192.168.9.83</td><td style=text-align:center>2</td><td style=text-align:center>4</td><td style=text-align:center>50</td><td style=text-align:center>100+</td><td style=text-align:center>ElasticSearch/GlusterFS/Ceph/Longhorn</td></tr><tr><td style=text-align:center>registry</td><td style=text-align:center>192.168.9.80</td><td style=text-align:center>2</td><td style=text-align:center>4</td><td style=text-align:center>50</td><td style=text-align:center>200</td><td style=text-align:center>Sonatype Nexus 3</td></tr><tr><td style=text-align:center>åˆè®¡</td><td style=text-align:center>10</td><td style=text-align:center>32</td><td style=text-align:center>88</td><td style=text-align:center>500</td><td style=text-align:center>1100+</td><td style=text-align:center></td></tr></tbody></table><h2 id=å®æˆ˜ç¯å¢ƒæ¶‰åŠè½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯>å®æˆ˜ç¯å¢ƒæ¶‰åŠè½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯</h2><ul><li>æ“ä½œç³»ç»Ÿï¼š<strong>openEuler 22.03 LTS SP2 x86_64</strong></li><li>KubeSphereï¼š<strong>3.3.2</strong></li><li>Kubernetesï¼š<strong>v1.24.12</strong></li><li>Containerdï¼š<strong>1.6.4</strong></li><li>GlusterFSï¼š<strong>10.0-8</strong></li><li>KubeKey: <strong>v3.0.8</strong></li><li>Zookeeperï¼š<strong>3.8.2</strong></li></ul><h2 id=ç®€ä»‹>ç®€ä»‹</h2><p>ä»Šå¤©æˆ‘ä»¬çš„å®æˆ˜å†…å®¹é‡‡ç”¨<strong>åœºæ™¯æ¨¡æ‹Ÿ</strong>çš„å½¢å¼ï¼Œæ¨¡æ‹ŸçœŸå®è¿ç»´å·¥ä½œä¸­ï¼Œ<strong>å¿…ç„¶ä¼š</strong>é‡åˆ°çš„ä¸€ä¸ªåœºæ™¯ã€‚</p><p>ä½œä¸ºä¸€ä¸ªåˆå…¥èŒåœºåˆšæ¥è§¦äº‘åŸç”Ÿè¿ç»´çš„è¿ç»´å°ç™½ï¼ŒBoss ä»Šå¤©ç»™æˆ‘å®‰æ’äº†ä¸€ä¸ª<strong>é«˜éš¾åº¦</strong>çš„ä»»åŠ¡ï¼Œå¯¹ï¼Œä½ æ²¡çœ‹é”™å°±æ˜¯<strong>é«˜éš¾åº¦</strong>çš„ã€‚</p><p><strong>é«˜éš¾åº¦</strong> = <strong>2 M 1 D</strong>= <strong>å¬è¿‡ã€æ²¡è§è¿‡ã€æ²¡å¹²è¿‡ã€æ—¶é—´çŸ­</strong>ã€‚</p><p>Boss æå‡ºçš„ä»»åŠ¡è¦æ±‚æ•´ç†å¦‚ä¸‹ï¼ˆéƒ½æ˜¯æˆ‘æ ¹æ® Boss çš„åŸè¯ï¼Œè‡ªå·±ç†è§£ã€çŒœæµ‹ã€æœç´¢æ•´ç†çš„ï¼Œå®é™…ä¸Š Boos æ ¹æœ¬æ²¡è¯´å‡ ä¸ªå­—ï¼‰ï¼š</p><ul><li>åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½²ä¸€ä¸ªå•èŠ‚ç‚¹æ¨¡å¼çš„ Zookeeper</li><li>åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½²é›†ç¾¤æ¨¡å¼çš„ Zookeeper</li><li>ä½¿ç”¨åœºæ™¯ï¼š<strong>ç ”å‘ã€æµ‹è¯•ï¼ˆåæœŸå¾ˆæœ‰å¯èƒ½ç›´æ¥è½¬ç”Ÿäº§ï¼‰</strong></li><li>ä»»åŠ¡äº¤ä»˜æœŸï¼š<strong>æ˜å¤©ï¼ˆé¢†å¯¼è®¤ä¸ºå¾ˆç®€å•ï¼‰</strong></li><li><strong>æ ¸å¿ƒè¦æ±‚ï¼šèƒ½ç”¨å°±è¡Œï¼ˆè‡ªå·±ç†è§£çš„ï¼‰</strong></li></ul><p>æ—¢ç„¶ä¸èƒ½æ‹’ç»ï¼Œæ—¶é—´ç´§ä»»åŠ¡é‡ï¼Œé‚£å°±å¹²å§ï¼Œå†²å†²å†²ï¼ï¼ï¼</p><h2 id=2-ä»»åŠ¡å®ç°æ€è·¯åˆ†æ>2. ä»»åŠ¡å®ç°æ€è·¯åˆ†æ</h2><p>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚æ—¢ç„¶æ˜¯ <strong>2 M 1 D</strong> çº§åˆ«çš„ä»»åŠ¡ï¼Œå…ˆæ¬å‡º <strong>AI æ—¶ä»£</strong>è¿ç»´ä¸‰æ¿æ–§ä¸­çš„å‰ä¸¤æ¿ï¼Œçœ‹çœ‹æ˜¯å¦èƒ½è§£å†³é—®é¢˜ã€‚</p><blockquote><p>ç”±äºåªç”¨äº†ä¸¤æ¿æ–§å°±æå®šäº†ï¼Œæ‰€ä»¥å°±æ²¡ç”¨åˆ°ç¬¬ä¸‰æ¿ã€‚</p></blockquote><h3 id=ç¬¬ä¸€æ¿æ–§ai-åŠ©æ‰‹>ç¬¬ä¸€æ¿æ–§â€”â€”AI åŠ©æ‰‹</h3><p><strong>æç¤ºè¯ï¼š</strong> "æˆ‘è¦åœ¨ K8s ä¸Šéƒ¨ç½² zookeerperã€‚åˆ†åˆ«ç»™æˆ‘ä¸€ä¸ªå•èŠ‚ç‚¹å’Œé›†ç¾¤æ¨¡å¼çš„éƒ¨ç½²æ–¹æ¡ˆï¼Œæ³¨æ„éœ€è¦ä½¿ç”¨å­˜å‚¨ç±» glusterfsã€éœ€è¦æœ‰ SVCã€éœ€è¦æœ‰ zoo.cfg çš„ ConfigMap"</p><blockquote><p><strong>é‡ç‚¹è¯´æ˜ï¼š</strong> æœ¬äººå­¦è‰ºä¸ç²¾ï¼Œ<strong>AI åŠ©æ‰‹</strong>ç©çš„è¿˜ä¸ç†Ÿï¼Œæç¤ºè¯å†™çš„ä¸å¥½ï¼Œæ‰€ä»¥æœ€ç»ˆæ•ˆæœä¹Ÿä¸æ˜¯å¤ªå¥½ã€‚</p></blockquote><p>è¾“å…¥ä¸Šé¢çš„æç¤ºè¯ä»¥åï¼Œ<strong>AI åŠ©æ‰‹-3.5</strong> å§å•¦å§å•¦è¿”å›äº†ä¸€å †æ–‡å­—ç»™æˆ‘ï¼Œæˆ‘åªå–äº†ç²¾åä½œä¸ºå±•ç¤ºã€‚</p><ul><li>å•èŠ‚ç‚¹éƒ¨ç½²é…ç½®æ–‡ä»¶ï¼ˆ<code>zookeeper-single.yaml</code>ï¼‰</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PersistentVolumeClaim</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-data</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>accessModes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ReadWriteOnce</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>storageClassName</span>: <span style=color:#ae81ff>glusterfs</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>10Gi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-config</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>zoo.cfg</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    tickTime=2000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    dataDir=/data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    clientPort=2181</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>zookeeper:3.7.0</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>100m</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>1Gi</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-data</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/data</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ZOOKEEPER_CONFIG_FILE</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#ae81ff>/opt/zookeeper-3.7.0/conf/zoo.cfg</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ZOO_SERVERS</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;server.1=zookeeper-0.zookeeper.default.svc.cluster.local:2888:3888;2181&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-data</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>persistentVolumeClaim</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>claimName</span>: <span style=color:#ae81ff>zookeeper-data</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-config</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>configMap</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-config</span>
</span></span></code></pre></div><ul><li>é›†ç¾¤æ¨¡å¼éƒ¨ç½²é…ç½®æ–‡ä»¶ï¼ˆ<code>zookeeper-cluster.yaml</code>ï¼‰ï¼š</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PersistentVolumeClaim</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-data</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>accessModes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ReadWriteOnce</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>storageClassName</span>: <span style=color:#ae81ff>glusterfs</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>10Gi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-config</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>zoo.cfg</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    tickTime=2000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    dataDir=/data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    clientPort=2181
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    initLimit=5
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    syncLimit=2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    server.1=zookeeper-0.zookeeper.default.svc.cluster.local:2888:3888
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    server.2=zookeeper-1.zookeeper.default.svc.cluster.local:2888:3888
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    server.3=zookeeper-2.zookeeper.default.svc.cluster.local:2888:3888</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>StatefulSet</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>serviceName</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>zookeeper:3.7.0</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>100m</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>1Gi</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-data</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/data</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ZOOKEEPER_CONFIG_FILE</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#ae81ff>/opt/zookeeper-3.7.0/conf/zoo.cfg</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-data</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>persistentVolumeClaim</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>claimName</span>: <span style=color:#ae81ff>zookeeper-data</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-config</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>configMap</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-config</span>
</span></span></code></pre></div><p>åˆ†æå®Œå†…å®¹ï¼Œæˆ‘å‘ç°æˆ‘å¥½åƒæ‡‚äº†ç‚¹ï¼Œä½†æ˜¯åˆæ²¡æœ‰å®Œå…¨æ‡‚ï¼Œè¿”å›çš„ç»“æœä¸­å•èŠ‚ç‚¹å’Œé›†ç¾¤æ¨¡å¼çš„é…ç½®æ–‡ä»¶çœ‹ç€å·®ä¸å¤ªå¤šï¼Œåˆ†æä¸€ä¸‹ç»“æœï¼Œé¡ºä¾¿æ‹ä¸€ä¸‹æ€è·¯ï¼š</p><ul><li>kind ç±»å‹ä¸åŒï¼š å•èŠ‚ç‚¹æ˜¯ <strong>Deployment</strong>ï¼Œ é›†ç¾¤æ¨¡å¼æ˜¯ <strong>StatefulSet</strong>ï¼Œè¿™ä¸ªç›®å‰çœ‹èµ·æ¥æ²¡æ¯›ç—…ï¼Œæ€è·¯æ˜¯å¯¹çš„</li><li>Deployment å‰¯æœ¬æ•°ä¸º 1ï¼ŒStatefulSet å‰¯æœ¬æ•°ä¸º 3</li><li>é›†ç¾¤æ¨¡å¼æ²¡æœ‰ä½¿ç”¨ <strong>volumeClaimTemplates</strong></li><li>é›†ç¾¤æ¨¡å¼ zoo.cfg é…ç½®æ–‡ä»¶ä¸­å¤šäº†å‡ ä¸ª server çš„é…ç½®é¡¹ï¼Œä½†æ˜¯å¥½åƒæ²¡æœ‰å®ç° <strong>myid</strong> çš„å¤„ç†</li></ul><blockquote><p>å¿…é¡»æœ‰ä¸€å®šçš„ K8s å’Œ Zookeeper ç›¸å…³çŸ¥è¯†ç§¯ç´¯æ‰èƒ½åˆ†æå‡º <strong>AI åŠ©æ‰‹</strong> ç»™å‡ºçš„ç»“æœæ˜¯å¦ç¬¦åˆéœ€æ±‚ï¼Œå¦åˆ™æ ¹æœ¬çœ‹ä¸æ‡‚ã€‚</p></blockquote><h3 id=ç¬¬äºŒæ¿æ–§æœç´¢å¼•æ“>ç¬¬äºŒæ¿æ–§â€”â€”æœç´¢å¼•æ“</h3><p>æœç´¢å¼•æ“ï¼Œåœ¨<strong>AI åŠ©æ‰‹</strong>å‡ºæ¥ä»¥å‰åœ¨è¿ç»´è¾…åŠ©ä¸­æ’åç¬¬ä¸€ï¼Œç°åœ¨æš‚å±…ç¬¬äºŒäº†ï¼Œä¼°è®¡ä¹Ÿæ²¡æœºä¼šé‡å›å·…å³°äº†ï¼ˆè°¨ä»£è¡¨ä¸ªäººæ’åæ„è§ï¼‰ã€‚</p><p>çœ‹å®Œäº† <strong>AI åŠ©æ‰‹</strong> çš„è¾“å‡ºç»“æœï¼Œè§‰å¾—æ•´ä½“ç»“æ„å†…å®¹æ²¡é—®é¢˜ï¼Œä½†æ˜¯æ„Ÿè§‰ç»†èŠ‚ä¸Šè¿˜æ˜¯å·®é‚£ä¹ˆç‚¹æ„æ€ï¼Œå°¤å…¶æ˜¯é›†ç¾¤æ¨¡å¼çš„éƒ¨ç½²ã€‚æˆ‘ä»¬ä¼šåœ¨æœ¬æ–‡ç¬¬ä¸‰å°èŠ‚éªŒè¯ã€‚</p><p>åŒæ—¶ï¼Œæˆ‘è¿˜å‘ç°äº†ä¸€ç‚¹ <code>image: zookeeper:3.7.0</code>ï¼Œæ—¢ç„¶å¼•ç”¨çš„ Image æ˜¯ DockerHub å®˜æ–¹çš„ï¼Œé‚£ä¹ˆ DockerHub ä¸Šä¸€å®šæœ‰å¯¹åº”çš„ Image åŠå®¹å™¨åŒ–éƒ¨ç½²çš„ä½¿ç”¨æ–¹æ³•ã€‚</p><p>è¿™ä¹Ÿå°±å¸¦æ¥ä¸€ä¸ªæ–°çš„çµæ„Ÿå’Œä¸€ç§æ–°çš„å­¦ä¹ æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿæ˜¯<strong>æœ€ç®€å•ç›´æ¥çš„</strong> Docker éƒ¨ç½²è½¬åŒ–ä¸º Kubernetes éƒ¨ç½²çš„æ–¹æ³•ï¼Œç›´æ¥å»çœ‹ Docker çš„éƒ¨ç½²å‘½ä»¤ã€å¯åŠ¨å‘½ä»¤ã€ç›¸å…³å‚æ•°ï¼Œç„¶åç›´æ¥æ¬åˆ° K8s ä¸Šå°±å¯ä»¥ã€‚</p><p>ç›´æ¥è½¬åˆ° <strong>DokcerHub å®˜ç½‘</strong>ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨å…³é”®è¯ <strong>zookeeper</strong> æœç´¢ä¸€ä¸‹ã€‚</p><p>æœç´¢ç»“æœæˆªå›¾ï¼š</p><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//DockerHub-Repository-%20zookeeper.png alt></p><p>ç®€å•çš„æ€è€ƒåˆ†æä¸€ä¸‹æœç´¢ç»“æœï¼š</p><ul><li><p>æ’åæœ€é«˜çš„ä¸¤ä¸ª zookeeper é•œåƒï¼Œä¸‹è½½é‡éƒ½è¶…è¿‡ <strong>100M+</strong>, åˆ†åˆ«æ˜¯ Docker å®˜æ–¹å’Œ <strong>Bitnami</strong> å‡ºå“çš„ã€‚</p></li><li><p>ä¸Šå‘¨ä¸‹è½½é‡æœ€å¤šçš„æ˜¯ Bitnami å‡ºå“çš„ zookeeperï¼Œä¸‹è½½é‡é«˜è¾¾ 1,140,215ï¼Œæ¯” DockerHub å‡ºå“çš„ zookeeper ä¸‹è½½é‡ 681,115ï¼Œå¤šäº†ä¸€å€è¿˜å¤šã€‚</p></li></ul><blockquote><p>å°æç¤ºï¼š<strong>Bitnami</strong>ï¼Œ åå‡ å¹´å‰æˆ‘å°±å¼€å§‹ç”¨ï¼Œå®ƒä»¬å‡ºå“çš„ä¸€é”®éƒ¨ç½²å®‰è£…åŒ…ï¼Œå½“æ—¶å°±æ˜¯å¾ˆç‰›çš„ä¸€é”®éƒ¨ç½²ä¸­é—´ä»¶è§£å†³æ–¹æ¡ˆæœåŠ¡å•†ï¼Œç°åœ¨åº”è¯¥æ˜¯æ›´å…¨é¢ã€æ›´ç‰›äº†ã€‚</p></blockquote><p><strong>ä¸ºä»€ä¹ˆè¦åšä¸Šé¢çš„åˆ†æï¼Ÿ</strong></p><ul><li>å½“æˆ‘ä»¬åšå¼€æºæŠ€æœ¯é€‰å‹çš„æ—¶å€™ï¼Œä¸»è¦çš„å†³å®šå› ç´ ä¹‹ä¸€å°±æ˜¯<strong>ä½¿ç”¨è€…æ•°é‡</strong>ï¼Œä½¿ç”¨è€…å¤ªå°‘è¯´æ˜äº§å“è¿˜ä¸æˆç†Ÿï¼Œä»£è¡¨ç€å‡ºäº†é—®é¢˜ä½ éƒ½æ²¡åœ°æ–¹å¯»æ±‚å¸®åŠ©ã€‚</li><li>æˆ‘çš„æŠ€æœ¯é€‰å‹å‡ ä¸ªåŸåˆ™ï¼š<strong>é¦–é€‰å®˜æ–¹</strong>(Apache å®˜æ–¹æ²¡æœ‰ï¼Œåªèƒ½é€‰ DockerHub å®˜æ–¹)ã€<strong>ç”¨æˆ·é‡å¤§</strong>(100M+)ã€<strong>ç»´æŠ¤æ›´æ–°é¢‘ç¹</strong>(7 days ago)ã€‚</li><li>é™¤äº† <strong>DockerHub</strong> å‡ºå“çš„ <strong>zookeeper</strong> é•œåƒä¹‹å¤–ï¼Œ<strong>Bitnami</strong> å‡ºå“çš„é•œåƒä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œç¾¤ä¼—çš„çœ¼ç›æ˜¯é›ªäº®çš„ï¼Œå¦‚æœä¸å¥½ç”¨ä¹Ÿä¸å¯èƒ½è¿™ä¹ˆå¤šäººæ¨èã€ä¸‹è½½ã€‚</li><li><strong>AI åŠ©æ‰‹</strong> ç»™å‡ºçš„ç¤ºä¾‹ç”¨çš„æ˜¯ DockerHub å®˜æ–¹çš„é•œåƒã€‚</li></ul><p>ä¸Šé¢è¯´äº†é‚£ä¹ˆå¤šï¼Œå¥½åƒæ²¡æœ‰è¯´åˆ°<strong>ç¬¬äºŒæ¿æ–§</strong>çš„é‡ç‚¹<strong>æœç´¢å¼•æ“</strong>ï¼Œ<strong>AI åŠ©æ‰‹</strong> ç»™å‡ºçš„ç»“æœä¸­ï¼Œå•èŠ‚ç‚¹æ¨¡å¼çœ‹ç€æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯é›†ç¾¤æ¨¡å¼æ€»æ„Ÿè§‰å°‘ç‚¹å•¥ï¼Œé‡ç‚¹çš„ <strong>myid</strong> çš„å¤„ç†æ–¹å¼æˆ‘å°±æ²¡çœ‹åˆ°ã€‚å› æ­¤ï¼Œæˆ‘åˆç”¨å…³é”®è¯ <strong>StatefulSet éƒ¨ç½² Zookeeper</strong> åœ¨æœç´¢å¼•æ“ä¸­æœç´¢äº†ä¸€ç•ªã€‚</p><p>æœç´¢ç»“æœä¸­æœ‰ä¸¤ä¸ªæ–¹å‘çš„æ€è·¯æ¯”è¾ƒæœ‰å‚è€ƒä»·å€¼ï¼š</p><ul><li>åŸºäº K8s å®˜æ–¹æ–‡æ¡£ç»™å‡ºçš„ Zookeeper éƒ¨ç½²æ–¹æ¡ˆã€‚</li></ul><p>K8s å®˜ç½‘çš„ä¸€ä¸ªæ•™ç¨‹æ¡ˆä¾‹ <a href=https://kubernetes.io/docs/tutorials/stateful-application/zookeeper/ title="Running ZooKeeper, A Distributed System Coordinator" target=_blank rel="noopener noreferrer">Running ZooKeeper, A Distributed System Coordinator</a>ï¼Œè¿™ä¸ªä¾‹å­çœ‹ç€æ¯”è¾ƒå¤æ‚ï¼Œè€Œä¸”å¼•å…¥äº†å‡ ä¸ªæ–°çš„æŠ€æœ¯ã€‚</p><ul><li>åŸºäº Bitnami åˆ¶ä½œçš„é•œåƒæä¾›çš„ Zookeeper é›†ç¾¤éƒ¨ç½²æ–¹æ¡ˆ</li></ul><p>æ¢³ç†æ¸…æ¥šå·²ç»è·å–çš„ä¿¡æ¯ï¼Œä¸ºäº†å¿«é€Ÿå®Œæˆé¢†å¯¼äº¤ä»˜çš„ä»»åŠ¡ï¼Œä»Šå¤©çš„éªŒè¯æµ‹è¯•æ–¹æ¡ˆé¡ºåºå¦‚ä¸‹ï¼š</p><ul><li><strong>AI åŠ©æ‰‹</strong> æä¾›çš„å•èŠ‚ç‚¹éƒ¨ç½²é…ç½®</li><li><strong>AI åŠ©æ‰‹</strong> æä¾›çš„é›†ç¾¤æ¨¡å¼éƒ¨ç½²é…ç½®</li><li><strong>Bitnami</strong> æä¾›çš„é›†ç¾¤æ¨¡å¼éƒ¨ç½²æ–¹æ¡ˆ</li><li>K8s å®˜ç½‘ Zookeeper éƒ¨ç½²æ¡ˆä¾‹</li></ul><p>å› ä¸ºï¼Œå•èŠ‚ç‚¹éƒ¨ç½²æ¯”è¾ƒç®€å•ã€‚æ‰€ä»¥ï¼Œæµ‹è¯•é—®é¢˜é‡ç‚¹å°±åœ¨äº <strong>AI åŠ©æ‰‹</strong>å’Œ <strong>Bitnami</strong> æä¾›çš„é›†ç¾¤æ¨¡å¼éƒ¨ç½²é…ç½®æ˜¯å¦å¯è¡Œï¼Œå¦‚æœæ–¹æ¡ˆå¯è¡Œå°±æ²¡å®˜ç½‘æ¡ˆä¾‹ä»€ä¹ˆäº‹äº†ï¼Œå¦‚æœä¸è¡Œå†å»å®éªŒ <strong>K8s å®˜ç½‘ Zookeeper éƒ¨ç½²æ¡ˆä¾‹</strong>ï¼Œä½†æ˜¯è¯´å®è¯æˆ‘æš‚æ—¶è¿˜å¾ˆä¸æƒ³ç¢°ï¼Œå› ä¸ºè¿™ä¸ªæ¡ˆä¾‹é‡Œæœ‰ä¸ªæŠ€æœ¯ç‚¹æˆ‘å‹æ ¹å„¿å°±æ²¡å¬è¿‡ï¼ŒçœŸè¦æçš„è¯åˆä¼šå¼•å…¥æ–°çš„é—®é¢˜ã€‚</p><h2 id=zookeeper-å•èŠ‚ç‚¹éƒ¨ç½²>Zookeeper å•èŠ‚ç‚¹éƒ¨ç½²</h2><p>æˆ‘è§‰å¾— <strong>AI åŠ©æ‰‹</strong> è¿”å›çš„å•èŠ‚ç‚¹çš„éƒ¨ç½²æ–¹æ¡ˆå’Œé…ç½®æ–‡ä»¶çœ‹ç€è¿˜å¯ä»¥æ²¡å•¥é—®é¢˜ã€‚ä½†æ˜¯ï¼Œä¹Ÿä¸è¦ç›´æ¥å¤åˆ¶ã€ç²˜è´´ï¼Œæ‹¿æ¥å³ç”¨ã€‚ä¸€å®šè¦å¤šå‚è€ƒ DockerHub å®˜ç½‘çš„ <a href=https://hub.docker.com/_/zookeeper title="Zookeeper ç›¸å…³ç¤ºä¾‹" target=_blank rel="noopener noreferrer">Zookeeper ç›¸å…³ç¤ºä¾‹</a>ï¼ŒäºŒè€…ç›¸ç»“åˆï¼Œå†™å‡ºæ¥çš„æ‰æ˜¯æ›´é è°±çš„èµ„æºæ¸…å•ã€‚</p><h3 id=æ€è·¯æ¢³ç†>æ€è·¯æ¢³ç†</h3><p>åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ä¸€å¥—å•èŠ‚ç‚¹çš„ Zookeeper éœ€è¦çš„èµ„æºæ¸…å•å¦‚ä¸‹ï¼š</p><ul><li><p>PersistentVolumeClaim</p></li><li><p>ConfigMapï¼šzoo.cfg</p></li><li><p>Deployment</p></li><li><p>Cluster Service</p></li><li><p>External Serviceï¼ˆå¯é€‰ï¼‰</p></li></ul><p>çŸ¥é“äº†éœ€è¦å®Œæˆçš„ä»»åŠ¡ç›®æ ‡ï¼Œæ¥ä¸‹æ¥ç»“åˆ <strong>AI åŠ©æ‰‹</strong>ç»™å‡ºçš„é…ç½®å’Œå®˜æ–¹é…ç½®å‚æ•°ï¼Œç”Ÿæˆä¸€å¥—èµ„æºé…ç½®æ¸…å•ã€‚</p><p><strong>æ³¨æ„ï¼š</strong> å®è·µè¯æ˜ï¼Œ<strong>AI åŠ©æ‰‹</strong> ç»™å‡ºçš„ä¹Ÿåªæ˜¯ä¸€ä¸ªå¤§æ¦‚ï¼Œç»†èŠ‚è¿˜æ˜¯æœ‰å¾ˆå¤šä¸è¶³çš„åœ°æ–¹ï¼Œä¸‹é¢ç¤ºä¾‹ä¸­çš„æ‰€æœ‰èµ„æºé…ç½®æ¸…å•ï¼Œéƒ½æ˜¯å‚è€ƒå®˜æ–¹é…ç½®å‚æ•°å’Œå®é™…ä½¿ç”¨éœ€æ±‚æ•´ç†çš„ã€‚</p><p>ç®€å•è¯´ä¸€ä¸‹ä¿®æ”¹äº†å“ªäº›å†…å®¹ã€‚</p><ul><li>Zookeeper ç‰ˆæœ¬é€‰æ‹©ï¼Œä½¿ç”¨äº†è½åå®˜æ–¹æœ€æ–°çš„ç¨³å®šç‰ˆ 3.9.0 ä¸€ä¸ªç‰ˆæœ¬çš„ <strong>3.8.2</strong> æ›¿æ¢ AI åŠ©æ‰‹ç»™å‡ºçš„é…ç½®æ–¹æ¡ˆä¸­çš„ <strong>3.7.0</strong></li><li>å¢åŠ äº† <strong>dataLog</strong> çš„é…ç½®</li><li>å®Œå–„äº†èµ„æºé™åˆ¶çš„é…ç½®</li><li>å®Œå–„äº† <strong>zoo.cfg</strong> çš„é…ç½®</li></ul><h3 id=èµ„æºé…ç½®æ¸…å•>èµ„æºé…ç½®æ¸…å•</h3><p><strong>å¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œæ‰€æœ‰æ¶‰åŠ K8s çš„æ“ä½œéƒ½åœ¨ Master-0 èŠ‚ç‚¹ä¸Šæ‰§è¡Œ , é…ç½®æ–‡ä»¶æ ¹ç›®å½•ä¸º /srv/opsman/k8s-yaml</strong>ã€‚</p><ul><li>åˆ›å»ºèµ„æºæ¸…å•æ–‡ä»¶å¤¹</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd /srv/opsman/k8s-yaml
</span></span><span style=display:flex><span>mkdir -p zookeeper/single
</span></span><span style=display:flex><span>cd zookeeper/single
</span></span></code></pre></div><ul><li>vi <strong>zookeeper-pvc.yaml</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PersistentVolumeClaim</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-data</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>accessModes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ReadWriteOnce</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>storageClassName</span>: <span style=color:#ae81ff>glusterfs</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>1Gi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PersistentVolumeClaim</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-datalog</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>accessModes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ReadWriteOnce</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>storageClassName</span>: <span style=color:#ae81ff>glusterfs</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>2Gi</span>
</span></span></code></pre></div><blockquote><p><strong>è¯´æ˜ï¼š</strong> åç«¯å­˜å‚¨ç±»ä½¿ç”¨çš„ <strong>GlusterFS</strong>ã€‚</p></blockquote><ul><li>vi <strong>zookeeper-cm.yaml</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-config</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>zoo-cfg</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    tickTime=2000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    dataDir=/data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    dataLogDir=/datalog
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    clientPort=2181
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    initLimit=10
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    syncLimit=5</span>
</span></span></code></pre></div><ul><li>vi <strong>zookeeper-deploy.yaml</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>zookeeper:3.8.2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>50m</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>500Mi</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#39;2&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>4000Mi</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-2181</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>config</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/conf</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>data</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/data</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>datalog</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/datalog</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>data</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>persistentVolumeClaim</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>claimName</span>: <span style=color:#ae81ff>zookeeper-data</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>datalog</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>persistentVolumeClaim</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>claimName</span>: <span style=color:#ae81ff>zookeeper-datalog</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>config</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>configMap</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-config</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>items</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>key</span>: <span style=color:#ae81ff>zoo-cfg</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>path</span>: <span style=color:#ae81ff>zoo.cfg</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-2181</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>ClusterIP</span>
</span></span></code></pre></div><blockquote><p>Deployment å’Œ Cluster Service æ”¾åœ¨äº†ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚</p></blockquote><ul><li>vi <strong>zookeeper-external-svc.yaml</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-external-svc</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper-external-svc</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>tcp-zookeeper-external</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>32181</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span></code></pre></div><blockquote><p><strong>æ³¨æ„ï¼šå¯é€‰é…ç½®é¡¹</strong>ï¼Œå¦‚æœä¸éœ€è¦è¢« K8s é›†ç¾¤ä¹‹å¤–çš„æœåŠ¡è®¿é—®ï¼Œåˆ™ä¸éœ€è¦é…ç½®ã€‚</p></blockquote><h3 id=éƒ¨ç½²èµ„æº>éƒ¨ç½²èµ„æº</h3><ul><li>éƒ¨ç½² PersistentVolumeClaim</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f zookeeper-pvc.yaml
</span></span></code></pre></div><ul><li>éƒ¨ç½² ConfigMap</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f zookeeper-cm.yaml
</span></span></code></pre></div><ul><li>éƒ¨ç½² Deployment</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f zookeeper-deploy.yaml
</span></span></code></pre></div><ul><li>éƒ¨ç½² External Service</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f zookeeper-svc.yaml
</span></span></code></pre></div><h3 id=k8s-éƒ¨ç½²èµ„æºéªŒè¯>K8s éƒ¨ç½²èµ„æºéªŒè¯</h3><ul><li>éªŒè¯ PersistentVolumeClaim</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 single<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pvc -o wide</span>
</span></span><span style=display:flex><span>NAME                STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE   VOLUMEMODE
</span></span><span style=display:flex><span>zookeeper-data      Bound    pvc-371c9406-1757-451a-9c89-bed47ac71dd4   1Gi        RWO            glusterfs      12s   Filesystem
</span></span><span style=display:flex><span>zookeeper-datalog   Bound    pvc-457a134c-0db2-4efc-902c-555daba2057e   2Gi        RWO            glusterfs      11s   Filesystem
</span></span></code></pre></div><ul><li>éªŒè¯ Deployment</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 single<span style=color:#f92672>]</span><span style=color:#75715e>#  kubectl get deploy -o wide</span>
</span></span><span style=display:flex><span>NAME        READY   UP-TO-DATE   AVAILABLE   AGE    CONTAINERS   IMAGES            SELECTOR
</span></span><span style=display:flex><span>zookeeper   1/1     <span style=color:#ae81ff>1</span>            <span style=color:#ae81ff>1</span>           5m1s   zookeeper    zookeeper:3.8.2   app<span style=color:#f92672>=</span>zookeeper
</span></span></code></pre></div><ul><li>éªŒè¯ Pod</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 single<span style=color:#f92672>]</span><span style=color:#75715e>#  kubectl get pod -o wide</span>
</span></span><span style=display:flex><span>NAME                         READY   STATUS        RESTARTS        AGE     IP             NODE          NOMINATED NODE   READINESS GATES
</span></span><span style=display:flex><span>zookeeper-bcfc6cc5c-bh56m    1/1     Running       <span style=color:#ae81ff>0</span>               54s     10.233.120.8   ks-worker-1   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><ul><li>éªŒè¯ Service</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 single<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get svc -o wide</span>
</span></span><span style=display:flex><span>NAME                                                     TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span style=color:#f92672>(</span>S<span style=color:#f92672>)</span>          AGE    SELECTOR
</span></span><span style=display:flex><span>zookeeper                                                ClusterIP   10.233.58.30    &lt;none&gt;        2181/TCP         59s    app<span style=color:#f92672>=</span>zookeeper
</span></span><span style=display:flex><span>zookeeper-external-svc                                   NodePort    10.233.40.37    &lt;none&gt;        2181:32181/TCP   59s    app<span style=color:#f92672>=</span>zookeeper
</span></span></code></pre></div><h3 id=zookeeper-æœåŠ¡å¯ç”¨æ€§éªŒè¯>Zookeeper æœåŠ¡å¯ç”¨æ€§éªŒè¯</h3><p><strong>åœ¨ K8s é›†ç¾¤å†…éƒ¨éªŒè¯</strong>ã€‚</p><ul><li>åœ¨ K8s ä¸Šåˆ›å»ºä¸€ä¸ª Zookeeper Client Pod éªŒè¯</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl run zookeeper-client --image<span style=color:#f92672>=</span>zookeeper:3.8.2
</span></span></code></pre></div><ul><li>éªŒè¯ Zookeeper Server è¿é€šæ€§</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># è¿›å…¥ Zookeeper Client å®¹å™¨å†…éƒ¨</span>
</span></span><span style=display:flex><span>kubectl exec -it zookeeper-client -- bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¿æ¥ Zookeeper Server</span>
</span></span><span style=display:flex><span>bin/zkCli.sh -server 10.233.58.30:2181
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æˆåŠŸç»“æœå¦‚ä¸‹</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 single<span style=color:#f92672>]</span><span style=color:#75715e># kubectl exec -it zookeeper-client -- bash</span>
</span></span><span style=display:flex><span>root@zookeeper-client:/apache-zookeeper-3.8.2-bin# bin/zkCli.sh -server 10.233.58.30:2181
</span></span><span style=display:flex><span>Connecting to 10.233.58.30:2181
</span></span><span style=display:flex><span>2023-08-07 07:44:16,110 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:zookeeper.version<span style=color:#f92672>=</span>3.8.2-139d619b58292d7734b4fc83a0f44be4e7b0c986, built on 2023-07-05 19:24 UTC
</span></span><span style=display:flex><span>2023-08-07 07:44:16,117 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:host.name<span style=color:#f92672>=</span>zookeeper-client
</span></span><span style=display:flex><span>2023-08-07 07:44:16,117 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:java.version<span style=color:#f92672>=</span>11.0.20
</span></span><span style=display:flex><span>2023-08-07 07:44:16,117 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:java.vendor<span style=color:#f92672>=</span>Eclipse Adoptium
</span></span><span style=display:flex><span>2023-08-07 07:44:16,117 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:java.home<span style=color:#f92672>=</span>/opt/java/openjdk
</span></span><span style=display:flex><span>2023-08-07 07:44:16,117 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:java.class.path<span style=color:#f92672>=</span>/apache-zookeeper-3.8.2-bin/bin/......<span style=color:#f92672>(</span>æ­¤å¤„æœ‰çœç•¥<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2023-08-07 07:44:16,118 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:java.library.path<span style=color:#f92672>=</span>/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib
</span></span><span style=display:flex><span>2023-08-07 07:44:16,118 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:java.io.tmpdir<span style=color:#f92672>=</span>/tmp
</span></span><span style=display:flex><span>2023-08-07 07:44:16,118 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:java.compiler<span style=color:#f92672>=</span>&lt;NA&gt;
</span></span><span style=display:flex><span>2023-08-07 07:44:16,118 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:os.name<span style=color:#f92672>=</span>Linux
</span></span><span style=display:flex><span>2023-08-07 07:44:16,118 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:os.arch<span style=color:#f92672>=</span>amd64
</span></span><span style=display:flex><span>2023-08-07 07:44:16,118 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:os.version<span style=color:#f92672>=</span>5.10.0-153.12.0.92.oe2203sp2.x86_64
</span></span><span style=display:flex><span>2023-08-07 07:44:16,118 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:user.name<span style=color:#f92672>=</span>root
</span></span><span style=display:flex><span>2023-08-07 07:44:16,119 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:user.home<span style=color:#f92672>=</span>/root
</span></span><span style=display:flex><span>2023-08-07 07:44:16,119 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:user.dir<span style=color:#f92672>=</span>/apache-zookeeper-3.8.2-bin
</span></span><span style=display:flex><span>2023-08-07 07:44:16,119 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:os.memory.free<span style=color:#f92672>=</span>42MB
</span></span><span style=display:flex><span>2023-08-07 07:44:16,119 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:os.memory.max<span style=color:#f92672>=</span>256MB
</span></span><span style=display:flex><span>2023-08-07 07:44:16,120 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:os.memory.total<span style=color:#f92672>=</span>48MB
</span></span><span style=display:flex><span>2023-08-07 07:44:16,123 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.ZooKeeper@637<span style=color:#f92672>]</span> - Initiating client connection, connectString<span style=color:#f92672>=</span>10.233.58.30:2181 sessionTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>30000</span> watcher<span style=color:#f92672>=</span>org.apache.zookeeper.ZooKeeperMain$MyWatcher@18bf3d14
</span></span><span style=display:flex><span>2023-08-07 07:44:16,128 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.c.X509Util@78<span style=color:#f92672>]</span> - Setting -D jdk.tls.rejectClientInitiatedRenegotiation<span style=color:#f92672>=</span>true to disable client-initiated TLS renegotiation
</span></span><span style=display:flex><span>2023-08-07 07:44:16,134 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.ClientCnxnSocket@239<span style=color:#f92672>]</span> - jute.maxbuffer value is <span style=color:#ae81ff>1048575</span> Bytes
</span></span><span style=display:flex><span>2023-08-07 07:44:16,143 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.ClientCnxn@1741<span style=color:#f92672>]</span> - zookeeper.request.timeout value is 0. feature enabled<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>Welcome to ZooKeeper!
</span></span><span style=display:flex><span>2023-08-07 07:44:16,171 <span style=color:#f92672>[</span>myid:10.233.58.30:2181<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main-SendThread<span style=color:#f92672>(</span>10.233.58.30:2181<span style=color:#f92672>)</span>:o.a.z.ClientCnxn$SendThread@1177<span style=color:#f92672>]</span> - Opening socket connection to server zookeeper.default.svc.cluster.local/10.233.58.30:2181.
</span></span><span style=display:flex><span>2023-08-07 07:44:16,173 <span style=color:#f92672>[</span>myid:10.233.58.30:2181<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main-SendThread<span style=color:#f92672>(</span>10.233.58.30:2181<span style=color:#f92672>)</span>:o.a.z.ClientCnxn$SendThread@1179<span style=color:#f92672>]</span> - SASL config status: Will not attempt to authenticate using SASL <span style=color:#f92672>(</span>unknown error<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2023-08-07 07:44:16,185 <span style=color:#f92672>[</span>myid:10.233.58.30:2181<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main-SendThread<span style=color:#f92672>(</span>10.233.58.30:2181<span style=color:#f92672>)</span>:o.a.z.ClientCnxn$SendThread@1011<span style=color:#f92672>]</span> - Socket connection established, initiating session, client: /10.233.118.8:55022, server: zookeeper.default.svc.cluster.local/10.233.58.30:2181
</span></span><span style=display:flex><span>JLine support is enabled
</span></span><span style=display:flex><span>2023-08-07 07:44:16,251 <span style=color:#f92672>[</span>myid:10.233.58.30:2181<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main-SendThread<span style=color:#f92672>(</span>10.233.58.30:2181<span style=color:#f92672>)</span>:o.a.z.ClientCnxn$SendThread@1452<span style=color:#f92672>]</span> - Session establishment complete on server zookeeper.default.svc.cluster.local/10.233.58.30:2181, session id <span style=color:#f92672>=</span> 0x1000178f5af0000, negotiated timeout <span style=color:#f92672>=</span> <span style=color:#ae81ff>30000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WATCHER::
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WatchedEvent state:SyncConnected type:None path:null
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.233.58.30:2181<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 0<span style=color:#f92672>]</span>
</span></span></code></pre></div><ul><li>åˆ›å»ºæµ‹è¯•æ•°æ®ï¼ŒéªŒè¯æœåŠ¡å¯ç”¨æ€§</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæµ‹è¯•æ•°æ®</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.233.58.30:2181<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 0<span style=color:#f92672>]</span> create /test test-data1
</span></span><span style=display:flex><span>Created /test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¯»å–æµ‹è¯•æ•°æ®</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.233.58.30:2181<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 1<span style=color:#f92672>]</span> get /test
</span></span><span style=display:flex><span>test-data1
</span></span></code></pre></div><p><strong>åœ¨ K8s é›†ç¾¤å¤–éƒ¨éªŒè¯ã€‚</strong></p><p><strong>æœ¬æ–‡ç›´æ¥ä½¿ç”¨ K8s Master-0 èŠ‚ç‚¹å®‰è£… Zookeeper å®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯•éªŒè¯ã€‚</strong></p><ul><li>å®‰è£… openjdkï¼Œä»…é™äºæµ‹è¯•éªŒè¯ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>yum install java-11-openjdk
</span></span></code></pre></div><ul><li>å®‰è£… Zookeeper å®¢æˆ·ç«¯ï¼Œåˆ° <a href=https://zookeeper.apache.org/releases.html title="Zookeeper å®˜ç½‘" target=_blank rel="noopener noreferrer">Zookeeper å®˜ç½‘</a>æ‰¾ç›¸åº”ç‰ˆæœ¬çš„è½¯ä»¶åŒ…ã€‚æœ¬æ–‡é€‰æ‹© <strong>3.8.2</strong> ä½œä¸ºæµ‹è¯•ç‰ˆæœ¬ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># ä¸‹è½½å¹¶è§£å‹ Zookeeperï¼ˆåœ¨å›½å†…æºä¸‹è½½ï¼‰</span>
</span></span><span style=display:flex><span>wget https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.8.2/apache-zookeeper-3.8.2-bin.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tar xvf apache-zookeeper-3.8.2-bin.tar.gz
</span></span></code></pre></div><ul><li>éªŒè¯ Zookeeper Server è¿é€šæ€§</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd apache-zookeeper-3.8.2-bin/bin/
</span></span><span style=display:flex><span>./zkCli.sh -server 192.168.9.91:32181
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æˆåŠŸç»“æœå¦‚ä¸‹ï¼ˆç»“æœæœ‰çœç•¥ï¼‰</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 bin<span style=color:#f92672>]</span><span style=color:#75715e># ./zkCli.sh -server 192.168.9.91:32181</span>
</span></span><span style=display:flex><span>/usr/bin/java
</span></span><span style=display:flex><span>Connecting to 192.168.9.91:32181
</span></span><span style=display:flex><span>2023-08-07 15:46:53,156 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:zookeeper.version<span style=color:#f92672>=</span>3.8.2-139d619b58292d7734b4fc83a0f44be4e7b0c986, built on 2023-07-05 19:24 UTC
</span></span><span style=display:flex><span>......
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WATCHER::
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WatchedEvent state:SyncConnected type:None path:null
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 192.168.9.91:32181<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 0<span style=color:#f92672>]</span>
</span></span></code></pre></div><ul><li>åˆ›å»ºæµ‹è¯•æ•°æ®ï¼ŒéªŒè¯æœåŠ¡å¯ç”¨æ€§</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæµ‹è¯•æ•°æ®</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 192.168.9.91:32181<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 0<span style=color:#f92672>]</span> create /test2 test2-data1
</span></span><span style=display:flex><span>Created /test2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¯»å–æµ‹è¯•æ•°æ®</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 192.168.9.91:32181<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 1<span style=color:#f92672>]</span> get /test2
</span></span><span style=display:flex><span>test2-data1
</span></span></code></pre></div><p>è‡³æ­¤ï¼ŒBoss äº¤ä»£çš„ä»»åŠ¡å®Œæˆäº†ä¸€åŠï¼Œå·²ç»å®ç°äº†å•èŠ‚ç‚¹ Zookeeper çš„éƒ¨ç½²ï¼Œå¹¶åœ¨ K8s é›†ç¾¤å†…éƒ¨å’Œå¤–éƒ¨åˆ†åˆ«åšäº†è¿é€šæ€§ã€å¯ç”¨æ€§æµ‹è¯•ã€‚</p><p>ä½†æ˜¯ï¼Œæ—¶é—´å·²è¶…æœŸï¼Œå·²ç»æ¥åˆ°äº†ç¬¬äºŒå¤©ï¼Œæ‰€ä»¥è¯´å•Šï¼Œå¯¹äºä¸€ä¸ªæœªçŸ¥çš„ä»»åŠ¡ï¼Œå®ç°èµ·æ¥ï¼Œæ ¹æœ¬æ²¡æœ‰ Boss æƒ³è±¡çš„é‚£ä¹ˆç®€å•ã€‚</p><p>ä¸è¿‡ï¼Œç”±äºå®Œæˆäº†å•èŠ‚ç‚¹çš„ä»»åŠ¡ï¼Œå…ˆä¸Šäº¤æ±‡æŠ¥ç»™ Bossï¼Œå¹¶è¯´æ˜ä¸€ä¸‹å®ç°æ€è·¯ã€è¿‡ç¨‹ï¼Œéƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼ˆåˆ‡è®°ä¸è¦ç›´æ¥è·Ÿ Boss è¯´è¿™ä¸ªå¾ˆéš¾ï¼Œä½ é¢„ä¼°çš„æ—¶é—´æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆè¯´çº¯å±æ‰¾æŠ½ï¼‰ã€‚</p><p>æŒ‰ä¸Šé¢çš„å¥—è·¯æ±‡æŠ¥å®Œï¼Œå¾—åˆ°äº† Boss çš„ç†è§£å’Œè®¤å¯ï¼ˆBoss å…¶å®è¿˜æ˜¯å¾ˆå¥½è¯´è¯çš„ï¼Œåªè¦ä½ èƒ½ä»¥ç†è¯´æœä»–ï¼‰ï¼Œè®©æˆ‘å…ˆæŠŠå•èŠ‚ç‚¹çš„ Zookeeper ç¯å¢ƒäº¤ç»™æµ‹è¯•ä½¿ç”¨ï¼Œå†å»ç»§ç»­ç ”ç©¶é›†ç¾¤æ¨¡å¼çš„éƒ¨ç½²æ–¹æ¡ˆã€‚</p><p>è¿™æ³¢æ“ä½œä¸ä»…æ²¡æœ‰å—åˆ°æ‰¹è¯„ï¼Œè¿˜ç»™è‡ªå·±äº‰å–äº†æ—¶é—´ï¼Œå®Œç¾ï¼ï¼ï¼</p><h2 id=é›†ç¾¤æ¨¡å¼-zookeeper-éƒ¨ç½²>é›†ç¾¤æ¨¡å¼ Zookeeper éƒ¨ç½²</h2><p>å•èŠ‚ç‚¹éƒ¨ç½² Zookeeper çš„ä»»åŠ¡å®Œæˆä»¥åï¼Œæ¥ä¸‹æ¥å¼€å§‹ç ”ç©¶é›†ç¾¤æ¨¡å¼çš„ Zookeeper éƒ¨ç½²ï¼Œ<strong>AI åŠ©æ‰‹</strong>ç»™å‡ºçš„é»˜è®¤ç¤ºä¾‹æ ¹æœ¬å°±ä¸é è°±ï¼Œæˆ‘ä¹Ÿæ‡’å¾—å†è°ƒæ•™ä»–äº†ã€‚</p><p><strong>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿ</strong></p><p>å› ä¸ºæˆ‘åˆ©ç”¨ AI åŠ©æ‰‹ç»™çš„æ–¹æ¡ˆï¼Œåˆ©ç”¨ DockerHub æä¾›çš„ Zookeeper å»å°è¯•åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Zookeeper é›†ç¾¤ï¼Œè€—æ—¶ <strong>2</strong> å¤©ï¼ˆä¸»è¦æ˜¯çŠ¯ç—…äº†ï¼Œé’»äº†ç‰›è§’å°–ï¼Œå°±æƒ³æå®šå®ƒï¼Œæ— å¥ˆèƒ½åŠ›åˆä¸å¤Ÿï¼ï¼‰</p><p>æ¥ä¸‹æ¥ç®€å•è¯´ä¸€ä¸‹ï¼Œæˆ‘è¢«æŠ˜ç£¨ç–¯äº†çš„ä¸¤å¤©éƒ½åšäº†å“ªäº›å°è¯•ã€é‡åˆ°äº†å“ªäº›é—®é¢˜ã€æœ‰å“ªäº›å¿ƒå¾—ä½“ä¼šï¼ˆé€¼å¾—æˆ‘éƒ½å·®ç‚¹ç¥­å‡ºç¬¬ä¸‰æ¿æ–§äº†ï¼‰ã€‚</p><ul><li>é›†ç¾¤æ¨¡å¼çš„å…³é”®è§£å†³ myid å’Œ servers çš„é…ç½®</li><li>servers çš„é…ç½®è¿™ä¸ªæ²¡æœ‰é—®é¢˜å¾ˆå¥½è§£å†³ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ç›´æ¥å†™å…¥æˆ–æ˜¯ç”¨ ENV çš„æ–¹å¼æ³¨å…¥</li><li>myid æ˜¯é‡ç‚¹ï¼ŒDockHub é•œåƒä»“åº“ä¸­æä¾›çš„ Zookeeper é•œåƒï¼ŒèŠ‚ç‚¹ myid ä¸èƒ½åŠ¨æ€é…ç½®</li><li>åœ¨å®éªŒä¸­å°è¯•äº† <strong>initContainers</strong> ã€<strong>SidecarContainer</strong>ã€ConfigMap æŒ‚è½½å¯åŠ¨è„šæœ¬ç­‰æ–¹å¼ï¼Œéƒ½æ²¡æœ‰èµ·åˆ°æ•ˆæœ</li><li>ä¸æ˜¯è¯´ DockHub é•œåƒå½»åº•ä¸èƒ½ç”¨ï¼Œåªæ˜¯éœ€è¦è¿›è¡Œå¯åŠ¨è„šæœ¬æ”¹é€ ï¼Œç”šè‡³éœ€è¦é‡æ–°æ‰“ Imageï¼Œå¤ªéº»çƒ¦äº†ï¼Œå·²ç»è€—æ—¶ <strong>2</strong> å¤©äº†ï¼Œä¸å¾—ä¸æš‚æ—¶æ”¾å¼ƒ</li><li>ä¸Šé¢å‡ ç§å°è¯•ä»¥åŠæœ€åçš„æˆå“èµ„æºé…ç½®æ¸…å•çš„ç¼–å†™ï¼Œéƒ½æ˜¯åœ¨ KubeSphere çš„å›¾å½¢åŒ–ç®¡ç†æ§åˆ¶å°ä¸‹æµ‹è¯•éªŒè¯çš„ï¼Œæ¯”å‘½ä»¤è¡Œç•Œé¢æ–¹ä¾¿äº†å¤ªå¤š</li><li><strong>å¿ƒå¾—ï¼š</strong> é€šå¾€æˆåŠŸçš„è·¯æœ‰åƒä¸‡æ¡ï¼Œä¸€æ¡ä¸é€šæ—¶å¯ä»¥å°è¯•æ¢æ¡è·¯ï¼Œ<strong>ä¸è¦æ­»ç£•åˆ°åº•</strong>ã€‚æˆ‘ä»¬çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³é—®é¢˜ï¼Œ<strong>èƒ½è§£å†³é—®é¢˜çš„åŠæ³•å°±æ˜¯å¥½åŠæ³•</strong>ï¼Œé’»ç‰›è§’å°–çš„ç²¾ç¥ä¹Ÿè¦åˆ†æƒ…å†µ</li></ul><p>æœ€ç»ˆåªèƒ½å¦å¯»å‡ºè·¯ï¼Œå¥½åœ¨ä¹‹å‰çš„è°ƒç ”ä¸­ï¼Œå·²ç»æ‰¾åˆ°äº†å¦å¤–ä¸¤ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆã€‚</p><ul><li>ä½¿ç”¨ Bitnami åˆ¶ä½œçš„é•œåƒéƒ¨ç½² Zookeeper é›†ç¾¤ï¼ˆ<strong>æœ€ç»ˆé€‰æ‹©</strong>ï¼‰ã€‚</li><li>Kubernetes å®˜æ–¹æ–‡æ¡£ç¤ºä¾‹ä¸­ä»‹ç»çš„æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆä½¿ç”¨é•œåƒ <strong>registry.k8s.io/kubernetes-zookeeper:1.0-3.4.10</strong>ï¼Œä½¿ç”¨ <strong>PodDisruptionBudget</strong> ç¡®ä¿æœåŠ¡å¯ç”¨æ€§ã€‚</li></ul><p><strong>è¯´ä¸€ä¸‹æœ€ç»ˆçš„é€‰å‹ç†ç”±</strong>ï¼š</p><ul><li><strong>Pod Disruption Budget</strong>ï¼Œæœ‰ç‚¹å¤æ‚ä¸å¤ªé€‚åˆæˆ‘ç›®å‰æ®µä½ã€‚</li></ul><p>Pod Disruption Budget (Pod å¹²æ‰° é¢„ç®—) ç®€ç§° PDBï¼ŒKubernetes version <strong>>= 1.21</strong> æ‰å¯ä»¥ä½¿ç”¨ PodDisruptionBudgetã€‚PDB çš„ä½œç”¨æ˜¯å°†é™åˆ¶åœ¨åŒä¸€æ—¶é—´å› è‡ªæ„¿å¹²æ‰°å¯¼è‡´çš„å¤šå‰¯æœ¬åº”ç”¨ä¸­å‘ç”Ÿå®•æœºçš„ Pod æ•°é‡ã€‚</p><p>å…·ä½“çš„çŸ¥è¯†ç‚¹ï¼Œæœ¬æ–‡ä¸ç»†è¯´äº†ï¼Œåæ­£æˆ‘ç›®å‰ä¹Ÿä¸æ‰“ç®—ç”¨äº†ï¼ˆå”‰ï¼ä¸»è¦æ˜¯è¯´ä¸æ˜ç™½éš¾å…è¯¯äººå­å¼Ÿï¼‰ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£çš„ <a href=https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/disruptions/#pod-disruption-budget title="PDB ä»‹ç»" target=_blank rel="noopener noreferrer">PDB ä»‹ç»</a>å’Œ <a href=https://kubernetes.io/zh-cn/docs/tasks/run-application/configure-pdb/ title="PDB é…ç½®æ¡ˆä¾‹" target=_blank rel="noopener noreferrer">PDB é…ç½®æ¡ˆä¾‹</a>ã€‚</p><ul><li>Bitnami åˆ¶ä½œçš„é•œåƒéƒ¨ç½² Zookeeper é›†ç¾¤ï¼Œè¯¥æ–¹æ¡ˆç½‘ä¸Šçš„å‚è€ƒæ¡ˆä¾‹æœ‰å¾ˆå¤šï¼Œè€Œä¸”è¯¥æ–¹æ¡ˆé‡‡ç”¨ Zookeeper åŸç”Ÿéƒ¨ç½²æ–¹æ¡ˆï¼Œæ²¡æœ‰é¢å¤–çš„ K8S æœºåˆ¶ï¼Œå‡å°‘äº†å¤æ‚åº¦ã€‚<strong>è¿™ä¸ªä¹Ÿæ˜¯é€‰æ‹©çš„é‡ç‚¹</strong>ã€‚</li></ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å¼€å§‹å°è¯•ä½¿ç”¨ Bitnami åˆ¶ä½œçš„ <strong>Zookeeper</strong> é•œåƒå®Œæˆ <strong>Zookeeper</strong> é›†ç¾¤çš„éƒ¨ç½²ã€‚</p><h3 id=æ€è·¯æ¢³ç†-1>æ€è·¯æ¢³ç†</h3><p>åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ä¸€å¥— Zookeeper é›†ç¾¤éœ€è¦çš„èµ„æºæ¸…å•å¦‚ä¸‹ï¼š</p><ul><li><p><strong>StatefulSet</strong></p></li><li><p><strong>Headless Service</strong></p></li><li><p>ConfigMapï¼šzoo.cfgï¼ˆæ²¡æœ‰ä½¿ç”¨ï¼Œæ‰€æœ‰çš„é…ç½®éƒ½ä½¿ç”¨ ENV çš„å½¢å¼ï¼‰</p></li><li><p><strong>ConfigMapï¼šsetup.shï¼ˆå¯åŠ¨è„šæœ¬ï¼Œè®¡åˆ’ä½¿ç”¨å®é™…æ²¡æœ‰ä½¿ç”¨ï¼Œæœ€ç»ˆé‡‡å–äº† ENV å’Œ Command æ–¹å¼ï¼‰</strong></p></li><li><p><strong>External Serviceï¼ˆå¯é€‰ï¼‰</strong></p></li></ul><p><strong>æ³¨æ„ï¼šç”±äºæœ¬æ–‡é…ç½®æ–¹æ¡ˆæ²¡æœ‰è€ƒè™‘å®‰å…¨é…ç½®ä»…é€‚ç”¨äºå¼€å‘ã€æµ‹è¯•ç¯å¢ƒã€‚ä¸è¦æŠŠæœ¬æ–‡çš„ç¤ºä¾‹ç›´æ¥æ‹¿åˆ°ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œå¿…é¡»å‚è€ƒå®˜æ–¹é…ç½®æ–‡æ¡£å¢åŠ ç›¸åº”çš„ ENV é…ç½®ï¼Œæ–¹å¯ç”¨äºç”Ÿäº§</strong>ã€‚</p><h3 id=èµ„æºé…ç½®æ¸…å•-1>èµ„æºé…ç½®æ¸…å•</h3><p><strong>å¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œæ‰€æœ‰æ¶‰åŠ K8s çš„æ“ä½œéƒ½åœ¨ Master-0 èŠ‚ç‚¹ä¸Šæ‰§è¡Œ , é…ç½®æ–‡ä»¶æ ¹ç›®å½•ä¸º /srv/opsman/k8s-yaml</strong>ã€‚</p><ul><li>åˆ›å»ºèµ„æºæ¸…å•æ–‡ä»¶å¤¹</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd /srv/opsman/k8s-yaml
</span></span><span style=display:flex><span>mkdir -p zookeeper/cluster
</span></span><span style=display:flex><span>cd zookeeper/cluster
</span></span></code></pre></div><ul><li><strong>vi zookeeper-svc.yaml</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># Headless Serviceï¼Œç”¨äº Zookeeper é›†ç¾¤ä¹‹é—´ç›¸äº’é€šè®¯</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zk-hs</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>tcp-client</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>tcp-follower</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>2888</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>2888</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>tcp-election</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>3888</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>3888</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>clusterIP</span>: <span style=color:#ae81ff>None</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>ClusterIP</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># Client Serviceï¼Œç”¨äº K8S é›†ç¾¤å†…çš„åº”ç”¨è®¿é—® Zookeeper</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zk-cs</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>tcp-client</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>ClusterIP</span>
</span></span></code></pre></div><ul><li><strong>vi zookeeper-sts.yaml</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>StatefulSet</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>serviceName</span>: <span style=color:#ae81ff>zk-hs</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>podAntiAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>                  - <span style=color:#f92672>key</span>: <span style=color:#e6db74>&#34;app&#34;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>                    - <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>topologyKey</span>: <span style=color:#e6db74>&#34;kubernetes.io/hostname&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>image</span>: <span style=color:#ae81ff>bitnami/zookeeper:3.8.2</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>bash</span>
</span></span><span style=display:flex><span>            - <span style=color:#e6db74>&#39;-ec&#39;</span>
</span></span><span style=display:flex><span>            - |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              HOSTNAME=&#34;$(hostname -s)&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              if [[ $HOSTNAME =~ (.*)-([0-9]+)$ ]]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                ORD=${BASH_REMATCH[2]}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                export ZOO_SERVER_ID=&#34;$((ORD + 1 ))&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              else
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                echo &#34;Failed to get index from hostname $HOST&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                exit 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              exec /entrypoint.sh /run.sh</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>2Gi</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>cpu</span>: <span style=color:#ae81ff>50m</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>500Mi</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ZOO_ENABLE_AUTH</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;no&#34;</span>
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ALLOW_ANONYMOUS_LOGIN</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;yes&#34;</span>
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ZOO_SERVERS</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>value</span>: &gt;<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                zookeeper-0.zk-hs.default.svc.cluster.local:2888:3888
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                zookeeper-1.zk-hs.default.svc.cluster.local:2888:3888
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                zookeeper-2.zk-hs.ddefault.svc.cluster.local:2888:3888</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>client</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>follower</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>2888</span>
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>election</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>3888</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>livenessProbe</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>tcpSocket</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>port</span>: <span style=color:#ae81ff>client</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>failureThreshold</span>: <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>successThreshold</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>timeoutSeconds</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>readinessProbe</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>tcpSocket</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>port</span>: <span style=color:#ae81ff>client</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>failureThreshold</span>: <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>successThreshold</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>timeoutSeconds</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>data</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/bitnami/zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>volumeClaimTemplates</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#ae81ff>data</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>accessModes</span>: [ <span style=color:#e6db74>&#34;ReadWriteOnce&#34;</span> ]
</span></span><span style=display:flex><span>        <span style=color:#f92672>storageClassName</span>: <span style=color:#e6db74>&#34;glusterfs&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>2Gi</span>
</span></span></code></pre></div><blockquote><p><strong>è¯´æ˜ï¼š</strong></p><ul><li><strong>ENV</strong> çš„é…ç½®æˆ‘åªç”¨äº†æœ€åŸºæœ¬çš„ï¼Œé‡ç‚¹å°±æ˜¯ <strong>ZOO_SERVERS</strong>ï¼Œæ›´å¤šå‚æ•°çš„ç”¨æ³•è¯·å‚è€ƒ <a href=https://hub.docker.com/r/bitnami/zookeeper title="Bitnami å®˜æ–¹æ–‡æ¡£" target=_blank rel="noopener noreferrer">Bitnami å®˜æ–¹æ–‡æ¡£</a></li><li><strong>Command</strong> é‡Œç›´æ¥å†™äº†å¯åŠ¨å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥åšæˆ ConfigMap æŒ‚è½½ä¸ºè„šæœ¬</li><li><strong>default.svc.cluster.local</strong>ï¼Œæ³¨æ„ FQDN åªèƒ½è¿™ä¹ˆå†™ï¼Œä¸è¦å†™æˆè‡ªå®šä¹‰çš„ï¼Œå“ªæ€•æˆ‘çš„é›†ç¾¤åŸŸåæ˜¯ <strong>opsman.top</strong>ï¼ˆè¿™ä¸ªæ˜¯é—ç•™é—®é¢˜ï¼Œæ¥ä¸åŠç»†çœ‹äº†ï¼Œå›å¤´å†è¯´ï¼‰</li></ul></blockquote><ul><li>vi zookeeper-external-svc.yaml</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># External Client Serviceï¼Œç”¨äº K8S é›†ç¾¤å¤–éƒ¨è®¿é—® Zookeeper</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zookeeper-external-svc</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper-external-svc</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>tcp-zookeeper-external</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>32181</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span></code></pre></div><blockquote><p><strong>æ³¨æ„ï¼šå¯é€‰é…ç½®é¡¹</strong>ï¼Œå¦‚æœä¸éœ€è¦è¢« K8s é›†ç¾¤ä¹‹å¤–çš„æœåŠ¡è®¿é—®ï¼Œåˆ™ä¸éœ€è¦é…ç½®ã€‚</p></blockquote><h3 id=éƒ¨ç½²èµ„æº-1>éƒ¨ç½²èµ„æº</h3><ul><li>éƒ¨ç½² Cluster å’Œ Headless Service</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f zookeeper-svc.yaml
</span></span></code></pre></div><ul><li>éƒ¨ç½² StatefulSet</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f zookeeper-sts.yaml
</span></span></code></pre></div><ul><li>éƒ¨ç½²å¤–éƒ¨ Services</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f zookeeper-external-svc.yaml
</span></span></code></pre></div><h3 id=k8s-éƒ¨ç½²èµ„æºéªŒè¯-1>K8s éƒ¨ç½²èµ„æºéªŒè¯</h3><ul><li>éªŒè¯ PersistentVolumeClaim</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 cluster<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pvc -o wide</span>
</span></span><span style=display:flex><span>NAME               STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE    VOLUMEMODE
</span></span><span style=display:flex><span>data-zookeeper-0   Bound    pvc-342c3869-17ca-40c7-9db0-755d5af0f85f   2Gi        RWO            glusterfs      2m7s   Filesystem
</span></span><span style=display:flex><span>data-zookeeper-1   Bound    pvc-6744813f-0f5b-4138-8ffc-387f63044af3   2Gi        RWO            glusterfs      47s    Filesystem
</span></span><span style=display:flex><span>data-zookeeper-2   Bound    pvc-731edc8d-189a-4601-aa64-a8d6754d93ec   2Gi        RWO            glusterfs      28s    Filesystem
</span></span></code></pre></div><ul><li>éªŒè¯ StatefulSet</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 cluster<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get sts -o wide</span>
</span></span><span style=display:flex><span>NAME        READY   AGE    CONTAINERS   IMAGES
</span></span><span style=display:flex><span>zookeeper   3/3     2m3s   zookeeper    bitnami/zookeeper:3.8.2
</span></span></code></pre></div><ul><li>éªŒè¯ Pod</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 cluster<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pod -o wide</span>
</span></span><span style=display:flex><span>NAME               READY   STATUS    RESTARTS   AGE     IP              NODE          NOMINATED NODE   READINESS GATES
</span></span><span style=display:flex><span>zookeeper-0        1/1     Running   <span style=color:#ae81ff>0</span>          2m42s   10.233.118.45   ks-worker-2   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>zookeeper-1        1/1     Running   <span style=color:#ae81ff>0</span>          83s     10.233.120.17   ks-worker-1   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>zookeeper-2        1/1     Running   <span style=color:#ae81ff>0</span>          64s     10.233.115.99   ks-worker-0   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><ul><li>éªŒè¯ Service</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 cluster<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get svc -o wide</span>
</span></span><span style=display:flex><span>NAME                                                     TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span style=color:#f92672>(</span>S<span style=color:#f92672>)</span>                      AGE     SELECTOR
</span></span><span style=display:flex><span>zk-cs                                                    ClusterIP   10.233.43.229   &lt;none&gt;        2181/TCP                     3m58s   app<span style=color:#f92672>=</span>zookeeper
</span></span><span style=display:flex><span>zk-hs                                                    ClusterIP   None            &lt;none&gt;        2181/TCP,2888/TCP,3888/TCP   3m58s   app<span style=color:#f92672>=</span>zookeeper
</span></span><span style=display:flex><span>zookeeper-external-svc                                   NodePort    10.233.45.5     &lt;none&gt;        2181:32181/TCP               10s     app<span style=color:#f92672>=</span>zookeeper
</span></span></code></pre></div><h3 id=zookeeper-é›†ç¾¤çŠ¶æ€éªŒè¯>Zookeeper é›†ç¾¤çŠ¶æ€éªŒè¯</h3><ul><li>éªŒè¯ StatefulSet åˆ›å»ºçš„ Pod é…ç½®çš„ä¸»æœºå</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 cluster<span style=color:#f92672>]</span><span style=color:#75715e># for i in 0 1 2; do kubectl exec zookeeper-$i -- hostname; done</span>
</span></span><span style=display:flex><span>zookeeper-0
</span></span><span style=display:flex><span>zookeeper-1
</span></span><span style=display:flex><span>zookeeper-2
</span></span></code></pre></div><ul><li>éªŒè¯ StatefulSet åˆ›å»ºçš„ Pod é…ç½®çš„å®Œå…¨é™å®šåŸŸåï¼ˆFully Qualified Domain Nameï¼ŒFQDNï¼‰</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 cluster<span style=color:#f92672>]</span><span style=color:#75715e># for i in 0 1 2; do kubectl exec zookeeper-$i -- hostname -f; done</span>
</span></span><span style=display:flex><span>zookeeper-0.zk-hs.default.svc.cluster.local
</span></span><span style=display:flex><span>zookeeper-1.zk-hs.default.svc.cluster.local
</span></span><span style=display:flex><span>zookeeper-2.zk-hs.default.svc.cluster.local
</span></span></code></pre></div><ul><li>éªŒè¯æ¯ä¸ª Zookeeper æœåŠ¡çš„ myid æ–‡ä»¶å†…å®¹</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 cluster<span style=color:#f92672>]</span><span style=color:#75715e># for i in 0 1 2; do echo &#34;myid zookeeper-$i&#34;;kubectl exec zookeeper-$i -- cat /bitnami/zookeeper/data/myid; done</span>
</span></span><span style=display:flex><span>myid zookeeper-0
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>myid zookeeper-1
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>myid zookeeper-2
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>
</span></span></code></pre></div><ul><li>éªŒè¯ Zookeeper ç”Ÿæˆçš„é…ç½®æ–‡ä»¶</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 cluster<span style=color:#f92672>]</span><span style=color:#75715e># kubectl exec -it zookeeper-0 --  cat /opt/bitnami/zookeeper/conf/zoo.cfg | grep -vE &#34;^#|^$&#34;</span>
</span></span><span style=display:flex><span>tickTime<span style=color:#f92672>=</span><span style=color:#ae81ff>2000</span>
</span></span><span style=display:flex><span>initLimit<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>syncLimit<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>dataDir<span style=color:#f92672>=</span>/bitnami/zookeeper/data
</span></span><span style=display:flex><span>clientPort<span style=color:#f92672>=</span><span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>maxClientCnxns<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>autopurge.snapRetainCount<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>autopurge.purgeInterval<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>preAllocSize<span style=color:#f92672>=</span><span style=color:#ae81ff>65536</span>
</span></span><span style=display:flex><span>snapCount<span style=color:#f92672>=</span><span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>maxCnxns<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>reconfigEnabled<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>quorumListenOnAllIPs<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>4lw.commands.whitelist<span style=color:#f92672>=</span>srvr, mntr
</span></span><span style=display:flex><span>maxSessionTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>40000</span>
</span></span><span style=display:flex><span>admin.serverPort<span style=color:#f92672>=</span><span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>admin.enableServer<span style=color:#f92672>=</span>true
</span></span><span style=display:flex><span>server.1<span style=color:#f92672>=</span>zookeeper-0.zk-hs.default.svc.cluster.local:2888:3888;<span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>server.2<span style=color:#f92672>=</span>zookeeper-1.zk-hs.default.svc.cluster.local:2888:3888;<span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>server.3<span style=color:#f92672>=</span>zookeeper-2.zk-hs.default.svc.cluster.local:2888:3888;<span style=color:#ae81ff>2181</span>
</span></span></code></pre></div><ul><li>éªŒè¯é›†ç¾¤çŠ¶æ€</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 cluster<span style=color:#f92672>]</span><span style=color:#75715e># for i in 0 1 2; do echo -e &#34;# myid zookeeper-$i \n&#34;;kubectl exec zookeeper-$i -- /opt/bitnami/zookeeper/bin/zkServer.sh status;echo -e &#34;\n&#34;; done</span>
</span></span><span style=display:flex><span><span style=color:#75715e># myid zookeeper-0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/opt/bitnami/java/bin/java
</span></span><span style=display:flex><span>ZooKeeper JMX enabled by default
</span></span><span style=display:flex><span>Using config: /opt/bitnami/zookeeper/bin/../conf/zoo.cfg
</span></span><span style=display:flex><span>Client port found: 2181. Client address: localhost. Client SSL: false.
</span></span><span style=display:flex><span>Mode: leader
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># myid zookeeper-1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/opt/bitnami/java/bin/java
</span></span><span style=display:flex><span>ZooKeeper JMX enabled by default
</span></span><span style=display:flex><span>Using config: /opt/bitnami/zookeeper/bin/../conf/zoo.cfg
</span></span><span style=display:flex><span>Client port found: 2181. Client address: localhost. Client SSL: false.
</span></span><span style=display:flex><span>Mode: follower
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># myid zookeeper-2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/opt/bitnami/java/bin/java
</span></span><span style=display:flex><span>ZooKeeper JMX enabled by default
</span></span><span style=display:flex><span>Using config: /opt/bitnami/zookeeper/bin/../conf/zoo.cfg
</span></span><span style=display:flex><span>Client port found: 2181. Client address: localhost. Client SSL: false.
</span></span><span style=display:flex><span>Mode: follower
</span></span></code></pre></div><h3 id=zookeeper-æœåŠ¡å¯ç”¨æ€§éªŒè¯-1>Zookeeper æœåŠ¡å¯ç”¨æ€§éªŒè¯</h3><p><strong>åœ¨ K8s é›†ç¾¤å†…éƒ¨éªŒè¯</strong>ã€‚</p><ul><li>åœ¨ K8s ä¸Šåˆ›å»ºä¸€ä¸ª Zookeeper Client Pod éªŒè¯ï¼ˆå•èŠ‚ç‚¹éªŒè¯æ—¶åˆ›å»ºè¿‡ï¼Œä¸éœ€è¦å†åˆ›å»ºäº†ï¼‰</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl run zookeeper-client --image<span style=color:#f92672>=</span>zookeeper:3.8.2
</span></span></code></pre></div><ul><li>éªŒè¯ Zookeeper Server è¿é€šæ€§</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># è¿›å…¥ Zookeeper Client å®¹å™¨å†…éƒ¨</span>
</span></span><span style=display:flex><span>kubectl exec -it zookeeper-client -- bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¿æ¥ Zookeeper Serverï¼ˆ 10.233.43.229 æ˜¯ Cluster Service çš„ IPï¼‰</span>
</span></span><span style=display:flex><span>bin/zkCli.sh -server 10.233.43.229:2181
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æˆåŠŸç»“æœå¦‚ä¸‹(å†…å®¹æœ‰çœç•¥)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 cluster<span style=color:#f92672>]</span><span style=color:#75715e># kubectl exec -it zookeeper-client -- bash</span>
</span></span><span style=display:flex><span>root@zookeeper-client:/apache-zookeeper-3.8.2-bin# bin/zkCli.sh -server 10.233.43.229:2181
</span></span><span style=display:flex><span>Connecting to 10.233.43.229:2181
</span></span><span style=display:flex><span>2023-08-08 10:08:40,864 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:zookeeper.version<span style=color:#f92672>=</span>3.8.2-139d619b58292d7734b4fc83a0f44be4e7b0c986, built on 2023-07-05 19:24 UTC
</span></span><span style=display:flex><span>.....
</span></span><span style=display:flex><span>2023-08-08 10:08:40,872 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.ZooKeeper@637<span style=color:#f92672>]</span> - Initiating client connection, connectString<span style=color:#f92672>=</span>10.233.43.229:2181 sessionTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>30000</span> watcher<span style=color:#f92672>=</span>org.apache.zookeeper.ZooKeeperMain$MyWatcher@18bf3d14
</span></span><span style=display:flex><span>2023-08-08 10:08:40,886 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.c.X509Util@78<span style=color:#f92672>]</span> - Setting -D jdk.tls.rejectClientInitiatedRenegotiation<span style=color:#f92672>=</span>true to disable client-initiated TLS renegotiation
</span></span><span style=display:flex><span>2023-08-08 10:08:40,892 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.ClientCnxnSocket@239<span style=color:#f92672>]</span> - jute.maxbuffer value is <span style=color:#ae81ff>1048575</span> Bytes
</span></span><span style=display:flex><span>2023-08-08 10:08:40,903 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.ClientCnxn@1741<span style=color:#f92672>]</span> - zookeeper.request.timeout value is 0. feature enabled<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>Welcome to ZooKeeper!
</span></span><span style=display:flex><span>2023-08-08 10:08:40,920 <span style=color:#f92672>[</span>myid:10.233.43.229:2181<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main-SendThread<span style=color:#f92672>(</span>10.233.43.229:2181<span style=color:#f92672>)</span>:o.a.z.ClientCnxn$SendThread@1177<span style=color:#f92672>]</span> - Opening socket connection to server zk-cs.default.svc.cluster.local/10.233.43.229:2181.
</span></span><span style=display:flex><span>2023-08-08 10:08:40,923 <span style=color:#f92672>[</span>myid:10.233.43.229:2181<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main-SendThread<span style=color:#f92672>(</span>10.233.43.229:2181<span style=color:#f92672>)</span>:o.a.z.ClientCnxn$SendThread@1179<span style=color:#f92672>]</span> - SASL config status: Will not attempt to authenticate using SASL <span style=color:#f92672>(</span>unknown error<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>JLine support is enabled
</span></span><span style=display:flex><span>2023-08-08 10:08:40,948 <span style=color:#f92672>[</span>myid:10.233.43.229:2181<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main-SendThread<span style=color:#f92672>(</span>10.233.43.229:2181<span style=color:#f92672>)</span>:o.a.z.ClientCnxn$SendThread@1011<span style=color:#f92672>]</span> - Socket connection established, initiating session, client: /10.233.118.8:38050, server: zk-cs.default.svc.cluster.local/10.233.43.229:2181
</span></span><span style=display:flex><span>2023-08-08 10:08:41,064 <span style=color:#f92672>[</span>myid:10.233.43.229:2181<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main-SendThread<span style=color:#f92672>(</span>10.233.43.229:2181<span style=color:#f92672>)</span>:o.a.z.ClientCnxn$SendThread@1452<span style=color:#f92672>]</span> - Session establishment complete on server zk-cs.default.svc.cluster.local/10.233.43.229:2181, session id <span style=color:#f92672>=</span> 0x10007253d840000, negotiated timeout <span style=color:#f92672>=</span> <span style=color:#ae81ff>30000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WATCHER::
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WatchedEvent state:SyncConnected type:None path:null
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.233.43.229:2181<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 0<span style=color:#f92672>]</span>
</span></span></code></pre></div><ul><li>åˆ›å»ºæµ‹è¯•æ•°æ®ï¼ŒéªŒè¯æœåŠ¡å¯ç”¨æ€§</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæµ‹è¯•æ•°æ®</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.233.43.229:2181<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 0<span style=color:#f92672>]</span> create /test test-data1
</span></span><span style=display:flex><span>Created /test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¯»å–æµ‹è¯•æ•°æ®</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.233.43.229:2181<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 1<span style=color:#f92672>]</span> get /test
</span></span><span style=display:flex><span>test-data1
</span></span></code></pre></div><p><strong>åœ¨ K8s é›†ç¾¤å¤–éƒ¨éªŒè¯ã€‚</strong></p><ul><li>éªŒè¯ Zookeeper Server è¿é€šæ€§</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># è¿›å…¥ Zookeeper å®‰è£…åŒ…çš„ bin ç›®å½•</span>
</span></span><span style=display:flex><span>cd apache-zookeeper-3.8.2-bin/bin/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¿æ¥ Zookeeper Serverï¼ˆ 192.168.9.91 æ˜¯ K8S Master-0 èŠ‚ç‚¹çš„ IPï¼Œ32181 æ˜¯ External Service å®šä¹‰çš„ NodePort ç«¯å£å·ï¼‰</span>
</span></span><span style=display:flex><span>./zkCli.sh -server 192.168.9.91:32181
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æˆåŠŸç»“æœå¦‚ä¸‹ï¼ˆç»“æœæœ‰çœç•¥ï¼‰</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-0 bin<span style=color:#f92672>]</span><span style=color:#75715e># ./zkCli.sh -server 192.168.9.91:32181</span>
</span></span><span style=display:flex><span>/usr/bin/java
</span></span><span style=display:flex><span>Connecting to 192.168.9.91:32181
</span></span><span style=display:flex><span>2023-08-08 18:13:52,650 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.Environment@98<span style=color:#f92672>]</span> - Client environment:zookeeper.version<span style=color:#f92672>=</span>3.8.2-139d619b58292d7734b4fc83a0f44be4e7b0c986, built on 2023-07-05 19:24 UTC
</span></span><span style=display:flex><span>......
</span></span><span style=display:flex><span>2023-08-08 18:13:52,660 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.ZooKeeper@637<span style=color:#f92672>]</span> - Initiating client connection, connectString<span style=color:#f92672>=</span>192.168.9.91:32181 sessionTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>30000</span> watcher<span style=color:#f92672>=</span>org.apache.zookeeper.ZooKeeperMain$MyWatcher@5c072e3f
</span></span><span style=display:flex><span>2023-08-08 18:13:52,666 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.c.X509Util@78<span style=color:#f92672>]</span> - Setting -D jdk.tls.rejectClientInitiatedRenegotiation<span style=color:#f92672>=</span>true to disable client-initiated TLS renegotiation
</span></span><span style=display:flex><span>2023-08-08 18:13:52,671 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.ClientCnxnSocket@239<span style=color:#f92672>]</span> - jute.maxbuffer value is <span style=color:#ae81ff>1048575</span> Bytes
</span></span><span style=display:flex><span>2023-08-08 18:13:52,686 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:o.a.z.ClientCnxn@1741<span style=color:#f92672>]</span> - zookeeper.request.timeout value is 0. feature enabled<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>Welcome to ZooKeeper!
</span></span><span style=display:flex><span>2023-08-08 18:13:52,708 <span style=color:#f92672>[</span>myid:192.168.9.91:32181<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main-SendThread<span style=color:#f92672>(</span>192.168.9.91:32181<span style=color:#f92672>)</span>:o.a.z.ClientCnxn$SendThread@1177<span style=color:#f92672>]</span> - Opening socket connection to server ks-master-0/192.168.9.91:32181.
</span></span><span style=display:flex><span>2023-08-08 18:13:52,709 <span style=color:#f92672>[</span>myid:192.168.9.91:32181<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main-SendThread<span style=color:#f92672>(</span>192.168.9.91:32181<span style=color:#f92672>)</span>:o.a.z.ClientCnxn$SendThread@1179<span style=color:#f92672>]</span> - SASL config status: Will not attempt to authenticate using SASL <span style=color:#f92672>(</span>unknown error<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>JLine support is enabled
</span></span><span style=display:flex><span>2023-08-08 18:13:52,721 <span style=color:#f92672>[</span>myid:192.168.9.91:32181<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main-SendThread<span style=color:#f92672>(</span>192.168.9.91:32181<span style=color:#f92672>)</span>:o.a.z.ClientCnxn$SendThread@1011<span style=color:#f92672>]</span> - Socket connection established, initiating session, client: /192.168.9.91:45004, server: ks-master-0/192.168.9.91:32181
</span></span><span style=display:flex><span>2023-08-08 18:13:52,776 <span style=color:#f92672>[</span>myid:192.168.9.91:32181<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main-SendThread<span style=color:#f92672>(</span>192.168.9.91:32181<span style=color:#f92672>)</span>:o.a.z.ClientCnxn$SendThread@1452<span style=color:#f92672>]</span> - Session establishment complete on server ks-master-0/192.168.9.91:32181, session id <span style=color:#f92672>=</span> 0x10007253d840001, negotiated timeout <span style=color:#f92672>=</span> <span style=color:#ae81ff>30000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WATCHER::
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WatchedEvent state:SyncConnected type:None path:null
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 192.168.9.91:32181<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 0<span style=color:#f92672>]</span>
</span></span></code></pre></div><ul><li>åˆ›å»ºæµ‹è¯•æ•°æ®ï¼ŒéªŒè¯æœåŠ¡å¯ç”¨æ€§</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºæµ‹è¯•æ•°æ®</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 192.168.9.91:32181<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 0<span style=color:#f92672>]</span> create /test2 test2-data1
</span></span><span style=display:flex><span>Created /test2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¯»å–æµ‹è¯•æ•°æ®ï¼ˆè¯»å–äº† 2æ¬¡ æµ‹è¯•æ•°æ®ï¼‰</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 192.168.9.91:32181<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 1<span style=color:#f92672>]</span> get /test
</span></span><span style=display:flex><span>test-data1
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 192.168.9.91:32181<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 2<span style=color:#f92672>]</span> get /test2
</span></span><span style=display:flex><span>test2-data1
</span></span></code></pre></div><p>è‡³æ­¤ï¼Œå®ç°äº† Zookeeper é›†ç¾¤æ¨¡å¼éƒ¨ç½²ï¼Œå¹¶åœ¨ K8S é›†ç¾¤å†…éƒ¨å’Œå¤–éƒ¨åˆ†åˆ«åšäº†è¿é€šæ€§ã€å¯ç”¨æ€§æµ‹è¯•ã€‚</p><h3 id=åœ¨-kubesphere-ç®¡ç†æ§åˆ¶å°éªŒè¯>åœ¨ KubeSphere ç®¡ç†æ§åˆ¶å°éªŒè¯</h3><p>çœ‹ä¸€çœ‹ Zookeeper ç›¸å…³èµ„æºåœ¨ KubeSphere ç®¡ç†æ§åˆ¶å°ä¸­å±•ç¤ºæ•ˆæœã€‚</p><ul><li>StatefulSet</li></ul><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-sts-zk-res-status.png alt></p><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-sts-zk-monitors.png alt></p><ul><li>Pods</li></ul><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-pods-zk-0-res-status.png alt></p><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-pods-zk-0-monitors.png alt></p><ul><li>Service</li></ul><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-zk-hs-res-status.png alt></p><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-zk-cs-res-status.png alt></p><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-zk-exts-res-status.png alt></p><h2 id=æ€»ç»“>æ€»ç»“</h2><p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† Zookeeper å•èŠ‚ç‚¹å’Œé›†ç¾¤æ¨¡å¼åœ¨åŸºäº KubeSphere éƒ¨ç½²çš„ K8s é›†ç¾¤ä¸Šçš„å®‰è£…éƒ¨ç½²ã€æµ‹è¯•éªŒè¯çš„è¿‡ç¨‹ã€‚å…·ä½“æ¶‰åŠçš„å†…å®¹æ€»ç»“å¦‚ä¸‹ï¼š</p><ul><li>å¦‚ä½•åˆ©ç”¨ <strong>AI åŠ©æ‰‹</strong> å’Œ æœç´¢å¼•æ“è¾…åŠ©å®Œæˆè¿ç»´å·¥ä½œã€‚</li><li>å¦‚ä½•åˆ©ç”¨ DockerHub å®˜æ–¹æä¾›çš„ Zookeeper é•œåƒï¼Œåœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½²å•èŠ‚ç‚¹ Zookeeper æœåŠ¡å¹¶éªŒè¯æµ‹è¯•ã€‚</li><li>å¦‚ä½•åˆ©ç”¨ Bitnami æä¾›çš„ Zookeeper é•œåƒï¼Œåœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½² Zookeeper é›†ç¾¤æœåŠ¡å¹¶éªŒè¯æµ‹è¯•ã€‚</li><li>ä»‹ç»äº†ä¸€ç§ä½¿ç”¨ <strong>PodDisruptionBudget</strong> éƒ¨ç½² Zookeeper é›†ç¾¤çš„ç¤ºä¾‹ï¼Œä½†æ˜¯å¹¶æœªå®é™…éªŒè¯ã€‚</li></ul><p><strong>æœ¬æ–‡çš„é…ç½®æ–¹æ¡ˆå¯ç›´æ¥ç”¨äºå¼€å‘æµ‹è¯•ç¯å¢ƒï¼Œå¯¹äºç”Ÿäº§ç¯å¢ƒä¹Ÿæœ‰ä¸€å®šçš„å€Ÿé‰´æ„ä¹‰ã€‚</strong></p></div></div><div class=share-2><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fzookeeper-on-kubesphere%2f&text=KubeSphere%20%e9%83%a8%e7%bd%b2%20Zookeeper%20%e5%ae%9e%e6%88%98%e6%95%99%e7%a8%8b" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fzookeeper-on-kubesphere%2f&title=KubeSphere%20%e9%83%a8%e7%bd%b2%20Zookeeper%20%e5%ae%9e%e6%88%98%e6%95%99%e7%a8%8b" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fzookeeper-on-kubesphere%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fzookeeper-on-kubesphere%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fzookeeper-on-kubesphere%2f&t=KubeSphere%20%e9%83%a8%e7%bd%b2%20Zookeeper%20%e5%ae%9e%e6%88%98%e6%95%99%e7%a8%8b" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div></div><div class=aside><div class=inner-div><div class=title>ç›®å½•</div><div class=tabs><nav id=TableOfContents><ul><li><a href=#å‰è¨€>å‰è¨€</a><ul><li><a href=#çŸ¥è¯†ç‚¹>çŸ¥è¯†ç‚¹</a></li><li><a href=#å®æˆ˜æœåŠ¡å™¨é…ç½®æ¶æ„-11-å¤åˆ»å°è§„æ¨¡ç”Ÿäº§ç¯å¢ƒé…ç½®ç•¥æœ‰ä¸åŒ>å®æˆ˜æœåŠ¡å™¨é…ç½®(æ¶æ„ 1:1 å¤åˆ»å°è§„æ¨¡ç”Ÿäº§ç¯å¢ƒï¼Œé…ç½®ç•¥æœ‰ä¸åŒ)</a></li></ul></li><li><a href=#å®æˆ˜ç¯å¢ƒæ¶‰åŠè½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯>å®æˆ˜ç¯å¢ƒæ¶‰åŠè½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯</a></li><li><a href=#ç®€ä»‹>ç®€ä»‹</a></li><li><a href=#2-ä»»åŠ¡å®ç°æ€è·¯åˆ†æ>2. ä»»åŠ¡å®ç°æ€è·¯åˆ†æ</a><ul><li><a href=#ç¬¬ä¸€æ¿æ–§ai-åŠ©æ‰‹>ç¬¬ä¸€æ¿æ–§â€”â€”AI åŠ©æ‰‹</a></li><li><a href=#ç¬¬äºŒæ¿æ–§æœç´¢å¼•æ“>ç¬¬äºŒæ¿æ–§â€”â€”æœç´¢å¼•æ“</a></li></ul></li><li><a href=#zookeeper-å•èŠ‚ç‚¹éƒ¨ç½²>Zookeeper å•èŠ‚ç‚¹éƒ¨ç½²</a><ul><li><a href=#æ€è·¯æ¢³ç†>æ€è·¯æ¢³ç†</a></li><li><a href=#èµ„æºé…ç½®æ¸…å•>èµ„æºé…ç½®æ¸…å•</a></li><li><a href=#éƒ¨ç½²èµ„æº>éƒ¨ç½²èµ„æº</a></li><li><a href=#k8s-éƒ¨ç½²èµ„æºéªŒè¯>K8s éƒ¨ç½²èµ„æºéªŒè¯</a></li><li><a href=#zookeeper-æœåŠ¡å¯ç”¨æ€§éªŒè¯>Zookeeper æœåŠ¡å¯ç”¨æ€§éªŒè¯</a></li></ul></li><li><a href=#é›†ç¾¤æ¨¡å¼-zookeeper-éƒ¨ç½²>é›†ç¾¤æ¨¡å¼ Zookeeper éƒ¨ç½²</a><ul><li><a href=#æ€è·¯æ¢³ç†-1>æ€è·¯æ¢³ç†</a></li><li><a href=#èµ„æºé…ç½®æ¸…å•-1>èµ„æºé…ç½®æ¸…å•</a></li><li><a href=#éƒ¨ç½²èµ„æº-1>éƒ¨ç½²èµ„æº</a></li><li><a href=#k8s-éƒ¨ç½²èµ„æºéªŒè¯-1>K8s éƒ¨ç½²èµ„æºéªŒè¯</a></li><li><a href=#zookeeper-é›†ç¾¤çŠ¶æ€éªŒè¯>Zookeeper é›†ç¾¤çŠ¶æ€éªŒè¯</a></li><li><a href=#zookeeper-æœåŠ¡å¯ç”¨æ€§éªŒè¯-1>Zookeeper æœåŠ¡å¯ç”¨æ€§éªŒè¯</a></li><li><a href=#åœ¨-kubesphere-ç®¡ç†æ§åˆ¶å°éªŒè¯>åœ¨ KubeSphere ç®¡ç†æ§åˆ¶å°éªŒè¯</a></li></ul></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li></ul></nav></div></div></div></div></section><div class=SubscribeForm><div class=innerBox><img class=close src=/images/home/close.svg alt=close><p class=description>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=blog_formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input-blog type=text placeholder>
<button id=email-submit-blog>è®¢é˜…</button>
<span id=message_blog data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨ style=color:red></span><span id=message1_blog style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span></div></div></div><footer><div class=footer><div class="footer-main common-layout"><div class=up-main><div class=left-div><img src=/images/logo.svg alt class=foot-logo><p>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input type=text placeholder=è¯·è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€>
<button id=email-submit>è®¢é˜…</button></div><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨></span><span id=message1 style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span><script>var bindSubmit=function(){var e=$("#email-input");$("#email-submit").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message").data("message1"),a=$("#message").data("message2"),r=$("#message").data("message3"),c=$("#message1").data("success");if(n)if(validateEmail(n)){if(s=$("#formAddress").data("usesendcloud"),!s)return;o=$("#formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:$("#email-input").val().toString()},success:function(){showSuccessMessage(c),setTimeout(function(){$("#email-input").val("")},1e3)},error:function(){showMessage(r)}})}else t.preventDefault(),showMessage(a);else t.preventDefault(),showMessage(i)})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},showMessage=function(e){$("#message").html(e).show()},showSuccessMessage=function(e){$("#message1").html(e).show()},bindHideMessage=function(){$(window).click(function(){$("#message").hide(),$("#message1").hide()})},bindClose=function(){$(".formBox .close").click(function(e){e.stopPropagation(),$(".formBox").fadeOut()})};bindSubmit(),bindClose(),bindHideMessage()</script><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€!></span></div><div class=right-div><ul class=common-flex-layout><li class=nowrap-li><div class=h3>åº”ç”¨åœºæ™¯</div><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps</a>
<a href=/zh/service-mesh/>åœ¨ K8s è¿è¡Œå¾®æœåŠ¡</a>
<a href=/zh/observability/>æ„å»ºäº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a>
<a href=https://github.com/kubesphere/kubekey target=_blank rel="noopener noreferrer">K8s ä¸€é”®éƒ¨ç½²ä¸è¿ç»´</a>
<a href=https://github.com/OpenFunction/OpenFunction target=_blank rel="noopener noreferrer">æ„å»º FaaS å¹³å°ä¸ Serverless æ¶æ„</a>
<a href=https://github.com/openpitrix/openpitrix target=_blank rel="noopener noreferrer">å¤šäº‘åº”ç”¨ç®¡ç†å¹³å°</a></li><li class=nowrap-li><div class=h3>èµ„æº</div><a href=/zh/projects/>å¼€æºé¡¹ç›®</a>
<a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a>
<a href=/zh/conferences/>å¼€æºå³°ä¼š</a>
<a href=/zh/videos/>è§†é¢‘èµ„æº</a>
<a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li><li class=nowrap-li><div class=h3>æ–‡æ¡£ä¸­å¿ƒ</div><a href=/zh/docs/v4.1/01-intro/01-introduction/>äº§å“ä»‹ç»</a>
<a href=/zh/docs/v4.1/03-installation-and-upgrade/02-install-kubesphere/02-install-kubernetes-and-kubesphere/>å¦‚ä½•å®‰è£…</a>
<a href=/zh/docs/v4.1/02-quickstart/>å¿«é€Ÿå…¥é—¨</a>
<a href=/zh/docs/v3.4/reference/api-docs/>API æ–‡æ¡£</a></li><li class=nowrap-li><div class=h3>å¼€æºç¤¾åŒº</div><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a>
<a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a>
<a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a>
<a href=/zh/partner/>åˆä½œä¼™ä¼´</a>
<a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a>
<a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a>
<a href=https://kubesphere.com.cn/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a>
<a href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ä¸­æ–‡è®ºå›</a>
<a href=https://kubesphere.io target=_blank rel="noopener noreferrer">å…¨çƒç«™</a></li><li class=nowrap-li><div class=h3>äº§å“ä¸æœåŠ¡</div><a href=https://aws.amazon.com/cn/quickstart/architecture/qingcloud-kubesphere/ target=_blank rel="noopener noreferrer">KubeSphere on AWS</a>
<a href=https://market.azure.cn/marketplace/apps/qingcloud.kubesphere target=_blank rel="noopener noreferrer">KubeSphere on Azure</a>
<a href=https://marketplace.digitalocean.com/apps/kubesphere target=_blank rel="noopener noreferrer">KubeSphere on DigitalOcean</a>
<a href=https://www.qingcloud.com/products/kubesphereqke target=_blank rel="noopener noreferrer">KubeSphere on QingCloud(QKE)</a>
<a href=https://kubesphere.com.cn/kse/ target=_blank rel="noopener noreferrer">KubeSphere ä¼ä¸šç‰ˆ</a>
<a href=https://kubesphere.cloud/ksv/ target=_blank rel="noopener noreferrer">KubeSphere è™šæ‹ŸåŒ–å¹³å°</a>
<a href=https://kubesphere.com.cn/marketplace/ target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿæ‰©å±•ç»„ä»¶å¸‚åœº</a>
<a href=https://kubesphere.cloud target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿåº”ç”¨æœåŠ¡å¹³å°</a>
<a href=https://m.qingcloud.com/p/aec50 target=_blank rel="noopener noreferrer">äº†è§£å•†ä¸šäº§å“ä¸å’¨è¯¢åˆä½œ</a></li></ul></div></div><div class=down-main><div class=img-div><a class=wechat href=javascript:void(0); aria-label=wechat><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28"><defs><path id="a" d="M0 0h15.673v12.156H0z"/></defs><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="13" cy="13" r="13" stroke="#B6C2CD"/><g transform="translate(5 7)"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59.0-4.625 1.679-4.625 3.74.0 2.066 2.035 3.738 4.625 3.738.542.0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27.0-.541-.257-.541-.514.0-.256.27-.514.541-.514.41.0.681.258.681.514.0.257-.271.514-.681.514zm2.994.0c-.27.0-.541-.257-.541-.514.0-.256.27-.514.54-.514.41.0.681.258.681.514.0.257-.277.514-.68.514z" mask="url(#b)"/><path fill="currentColor" d="M10.602 3.674c.177.0.356.011.533.029C10.657 1.576 8.27.0 5.543.0 2.498.0.0 1.974.0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17.0.343-.005.515-.022a3.68 3.68.0 01-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417.0.693.263.693.66s-.276.66-.693.66c-.418.0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417.0-.834-.263-.834-.66s.417-.66.834-.66c.418.0.695.263.695.66.0.392-.277.66-.695.66z" mask="url(#b)"/></g></g></svg><div class=hide-div><img src=/images/home/wechat.svg alt></div></a><a class=facebook-a href=https://www.facebook.com/kubesphere target=_blank aria-label=facebook></a><a class=twitter-a href=https://x.com/KubeSphere target=_blank aria-label=twitter rel="noopener noreferrer"></a><a class=linkedin-a href=https://www.linkedin.com/company/kubesphere/ target=_blank aria-label=linkedin rel="noopener noreferrer"></a><a class=bilibili-a href=https://space.bilibili.com/438908638 target=_blank aria-label=bilibili rel="noopener noreferrer"></a><a class=slack-a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank aria-label=slack rel="noopener noreferrer"></a><a class=github-a href=https://github.com/kubesphere/kubesphere target=_blank aria-label=github rel="noopener noreferrer"></a><a class=medium-a href=https://itnext.io/@kubesphere target=_blank aria-label=medium rel="noopener noreferrer"></a></div><p class=p1></p><p class=case><a href=http://www.beian.miit.gov.cn/ target=_blank rel="noopener noreferrer"><span>äº¬ICPå¤‡13019086å·</span>
</a><a target=_blank rel="noopener noreferrer" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502041003"><img src=/images/footer/case-icon.png alt=å¤‡æ¡ˆå›¾æ ‡>
<span>äº¬å…¬ç½‘å®‰å¤‡ 11010502041003å·</span></a></p></div></div></div><div class=cookie><div class=common-layout><p>æ‚¨çš„éšç§å¯¹æˆ‘ä»¬å¾ˆé‡è¦ã€‚æˆ‘ä»¬ä½¿ç”¨Cookieæ¥è®°ä½è®¢é˜…è¯¦ç»†ä¿¡æ¯ï¼Œä¼˜åŒ–ç½‘ç«™åŠŸèƒ½å¹¶äº¤ä»˜æ ¹æ®æ‚¨çš„å…´è¶£é‡èº«å®šåˆ¶çš„å†…å®¹ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„<a href=/zh/privacy>éšç§æ”¿ç­–</a>.</p><button>
æ¥å—å¹¶ç»§ç»­</button></div></div></footer><script>var lazyLoad=function(e,t){for(var n,o,i,s=0;s<t;s++){if(n=e.eq(s),o=n.attr("data-loaded"),o)continue;n.offset().top<parseInt($(window).height())+parseInt($(window).scrollTop())&&(i=n.attr("src"),n.attr("src",i),n.attr("data-loaded",!0))}},bindLayLoad=function(){var e=$("img"),t=e.length;lazyLoad(e,t),$(window).scroll(function(){lazyLoad(e,t)})},bindAddPadding=function(){var e=$("#close-join");e.length>0&&$(".main-section").addClass("padding")},docCookies={getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t){return!!e&&!/^(?:expires|max-age|path|domain|secure)$/i.test(e)&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t),!0)}},bindHideCookie=function(){var t=docCookies.getItem("hasAuth"),e=$(".cookie");t?e.hide():e.show(),e.find("button").on("click",function(){docCookies.setItem("hasAuth","1"),e.hide()})};bindAddPadding(),bindHideCookie()</script><script type=text/javascript src=/js/aside.2d6977c0f16aef4ed3e886dd66675ce74bd0efcd467c2b2bcdb30b92d5e7c7c0e5c6e0c9d8f09a883c22f58df9e6b0b6347fcdd3c9a920b7faba6d7f91a201c3.js integrity="sha512-LWl3wPFq707T6IbdZmdc50vQ781GfCsrzbMLktXnx8DlxuDJ2PCaiDwi9Y355rC2NH/N08mpILf6um1/kaIBww=="></script><script type=text/javascript src=/js/markdown-tab.17f9f46b021adebc7250ce1b07134a577b307e7a436daa4aaf388f218e8463966f53770b26a64817c06c168738a887672d47fb4c29615adfc446e11d09a344cf.js integrity="sha512-F/n0awIa3rxyUM4bBxNKV3swfnpDbapKrziPIY6EY5ZvU3cLJqZIF8BsFoc4qIdnLUf7TClhWt/ERuEdCaNEzw=="></script><script>let forbidForm=!1;var viewer=new Viewer(document.querySelector(".md-body"),{url:"src"}),blogBindSubmit=function(){var e=$("#email-input-blog");$("#email-submit-blog").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message_blog").data("message1"),a=$("#message_blog").data("message2"),r=$("#message_blog").data("message3"),c=$("#message1_blog").data("success");if(n)if(validateEmail(n)){if(s=$("#blog_formAddress").data("usesendcloud"),!s)return;o=$("#blog_formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:n.toString()},success:function(){showSuccessMessage_blog(c),setTimeout(function(){window.onscroll="",$(".SubscribeForm").hide(),$("#email-input-blog").val("")},5e3)},error:function(){showMessage_blog(r)}})}else t.preventDefault(),$("#message_blog").html(a).show();else t.preventDefault(),$("#message_blog").html(i).show()})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},bindHideMessageBlog=function(){$(window).click(function(){$("#message_blog").hide()})},bindCloseBlog=function(){$(".SubscribeForm .close").click(function(e){e.stopPropagation(),$(".SubscribeForm").fadeOut(),window.onscroll=""})},showMessage_blog=function(e){$("#message_blog").html(e).show()},showSuccessMessage_blog=function(e){$("#message1_blog").html(e).show()};window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;forbidForm&&(window.onscroll=""),e+t>n-710?$(".SubscribeForm").hide():$(".SubscribeForm").show()},blogBindSubmit(),bindCloseBlog(),bindHideMessageBlog()</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>