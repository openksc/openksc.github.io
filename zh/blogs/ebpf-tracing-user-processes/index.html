<!doctype html><html lang=en-US><head><meta charset=utf-8><title>eBPF æ¦‚è¿°ï¼Œç¬¬ 5 éƒ¨åˆ†ï¼šè·Ÿè¸ªç”¨æˆ·è¿›ç¨‹</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="æœ¬æ–‡ä¸»è¦è®²è§£äº†å¦‚ä½•ä½¿ç”¨ eBPF ç¨‹åºæ¥è·Ÿè¸ªç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºã€‚"><meta name=keywords content="eBPF,Linux,Python"><meta property="og:type" content="article"><meta property="og:title" content="eBPF æ¦‚è¿°ï¼Œç¬¬ 5 éƒ¨åˆ†ï¼šè·Ÿè¸ªç”¨æˆ·è¿›ç¨‹"><meta property="og:description" content="æœ¬æ–‡ä¸»è¦è®²è§£äº†å¦‚ä½•ä½¿ç”¨ eBPF ç¨‹åºæ¥è·Ÿè¸ªç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºã€‚"><meta property="og:image" content="https://kubesphere-community.pek3b.qingstor.com/images/ebpf-guide-cover.png"><meta property="og:url" content="https://openksc.github.io/zh/blogs/ebpf-tracing-user-processes/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeSphere"><meta property="twitter:image" content="https://kubesphere-community.pek3b.qingstor.com/images/ebpf-guide-cover.png"><meta name=docsearch:language content="zh-CN"><meta name=docsearch:version content><link rel=canonical href=https://kubesphere.io/zh/blogs/ebpf-tracing-user-processes/><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=apple-touch-icon href=/images/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/svg+xml href=/images/favicons/favicon.svg><link rel=icon type=image/png href=/images/favicons/favicon.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg color=#00ad6e><meta name=msapplication-config content='/images/favicons/browserconfig.xml'><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/fonts/Roboto/stylesheet.css><link rel=stylesheet href=/fonts/ProximaNova/stylesheet.css><link rel=stylesheet href=/css/jquery.modal.min.css><link rel=stylesheet href=/css/viewer.min.css><link rel=stylesheet href=/swiper/swiper-bundle.min.css><link rel=stylesheet href=/scss/common.min.0c3fdcc05ec210321169846714f74b11c4a1baf09a1833fa9273b2347c81e636.css><script src=/js/jquery-3.7.1.min.js></script><script src=/js/viewer.min.js></script><script src=/js/jquery.modal.min.js></script><script src=/swiper/swiper-bundle.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0888981f1fa45d241b1fb6962da2963e",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YYCVN36HT5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YYCVN36HT5")</script><script type=text/javascript>!function(e,t,n,s,o){e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=("https:"==document.location.protocol?"https://":"http://")+s,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio"),gio("init","8a24ae300cbf8b8c",{}),gio("send")</script><link rel=stylesheet href=/scss/content.min.f73b326fbf8c5bd331900b0de21c7dde608a4926f482f6465f9ae1d9049b83ad.css><link rel=stylesheet href=/scss/markdown.min.db47186481122431dffae72d17dbbd51f90b66f022cc163458645709924e4eac.css></head><body><header class=navigation><div class=join-div><div class=content>ğŸš€ KubeSphere v4.1.3 å‘å¸ƒï¼Œå¤šé¡¹ä¼˜åŒ–ä¸æ”¹è¿›ï¼Œæ¬¢è¿ä½“éªŒï¼<a href=/zh/docs/v4.1/20-release-notes/release-v413/ target=_blank rel="noopener noreferrer">è¯·æŸ¥çœ‹ Release notes â†’</a>
<img id=close-join src=/images/header/close.svg alt=close></div></div><div class=common-layout><div class=header-container><a href=/zh/ aria-label=logo><img src=/images/header/logo.svg alt class=logo></a><ul class=nav><li class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class="dropdown-menu menu-2"><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li class=menu-li><span class=menu-span>èµ„æº</span><ul class="dropdown-menu menu-3"><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class="dropdown-menu menu-4"><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/ target=_blank rel="noopener noreferrer">æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/ target=_blank rel="noopener noreferrer">Kube Design</a></li></ul></li><li class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class="dropdown-menu menu-5"><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025 target=_blank rel="noopener noreferrer">å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/ target=_blank rel="noopener noreferrer">è®¤è¯</a></li></ul><div class=right-menu><ul><li class=language-menu><div><img src=/images/header/black.svg alt>
<span>ç®€ä½“ä¸­æ–‡</span></div><ul class=dropdown-menu><li onclick='handleLangClick("zh","/zh/blogs/ebpf-tracing-user-processes/")'>ç®€ä½“ä¸­æ–‡</li></ul></li><li class=github-li><div class=github-star><a class=star-btn href=https://github.com/kubesphere/kubesphere rel="noopener noreferrer" target=_blank><span class=star-img></span>&nbsp;<span>Star</span>
</a><a class=social-count href=https://github.com/kubesphere/kubesphere/stargazers rel="noopener noreferrer" target=_blank></a></div></li><li class=menu-icon><img src=/images/header/menu.svg alt></li></ul></div></div></div><div id=modal-for-menu class=modal><ul class=nav><li data-check=0 class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class=dropdown-menu><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>èµ„æº</span><ul class=dropdown-menu><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class=dropdown-menu><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/>æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/>Kube Design</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class=dropdown-menu><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md>ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/>ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025>å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum>ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/>è®¤è¯</a></li></ul><div class=link-div><a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank rel="noopener noreferrer" aria-label=slack><img src=/images/header/slack-hover.svg alt>
</a><a href=https://x.com/KubeSphere target=_blank rel="noopener noreferrer" aria-label=twitter><img src=/images/header/twitter-hover.svg alt>
</a><a href=https://github.com/kubesphere/kubesphere target=_blank rel="noopener noreferrer" aria-label=github><img src=/images/header/github-hover.svg alt></a></div></div></header><script>var bindNavMouseEvent,bindScrollChangeHeader,bindClickShowMenu,bindClickModalLi,bindClickClose,language,handleLangClick,githubApiLink="https://api.github.com/repos/kubesphere/kubesphere",getStar=function(){$(".social-count").hide(),$.getJSON(githubApiLink,function(e){$(".social-count").show().html(e.stargazers_count)})};getStar(),bindNavMouseEvent=function(e,t){t||(t=$(e));var n=!1;t.mouseenter(function(){if(n)return!1;n=!0,$(this).find(".dropdown-menu").fadeIn(200,function(){n=!1})}),t.mouseleave(function(){$(this).find(".dropdown-menu").fadeOut(200)})},bindScrollChangeHeader=function(){var t=100,e=$("header");window.addEventListener("scroll",function(){var t=window.scrollY;t>0?e.addClass("navigationScroll"):e.removeClass("navigationScroll")})},bindClickShowMenu=function(){$(".menu-icon").click(function(){$("#modal-for-menu").modal()})},bindClickModalLi=function(){$(".modal .menu-li").click(function(){var e=$(this).data("check");e===0?($(this).data("check",1),$(this).find(".dropdown-menu").slideDown(200)):($(this).data("check",0),$(this).find(".dropdown-menu").slideUp(200)),$(this).find(".menu-span").toggleClass("up")})},bindClickClose=function(){$("#close-join").click(function(){$(".navigation .join-div").hide(),$(".main-section").removeClass("padding")})},language="zh",bindClickClose(),bindScrollChangeHeader(),$(".header-container .menu-li").each(function(){bindNavMouseEvent("",$(this))}),bindNavMouseEvent(".header-container .language-menu"),bindNavMouseEvent(".header-container .btn-li"),bindClickShowMenu(),bindClickModalLi(),handleLangClick=function(e,t){try{localStorage.setItem("lang",e)}catch{}location.href=t}</script><section class=main-section><div class=common-layout><div class=breadcrumb><span><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a> > </span><span>eBPF æ¦‚è¿°ï¼Œç¬¬ 5 éƒ¨åˆ†ï¼šè·Ÿè¸ªç”¨æˆ·è¿›ç¨‹</span></div><div class='main-div middle-div'><div class=author>Adrian Ratiu</div><span class=date>å‘å¸ƒäºï¼š2021-11-23</span>&nbsp;&nbsp;&nbsp;
<span style=font-size:14px;color:#919aa3 id=busuanzi_container_page_pv>æœ¬æ–‡æ€»é˜…è¯»é‡ï¼š<span id=busuanzi_value_page_pv></span></span><h1>eBPF æ¦‚è¿°ï¼Œç¬¬ 5 éƒ¨åˆ†ï¼šè·Ÿè¸ªç”¨æˆ·è¿›ç¨‹</h1><div class=share-1><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2febpf-tracing-user-processes%2f&text=eBPF%20%e6%a6%82%e8%bf%b0%ef%bc%8c%e7%ac%ac%205%20%e9%83%a8%e5%88%86%ef%bc%9a%e8%b7%9f%e8%b8%aa%e7%94%a8%e6%88%b7%e8%bf%9b%e7%a8%8b" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2febpf-tracing-user-processes%2f&title=eBPF%20%e6%a6%82%e8%bf%b0%ef%bc%8c%e7%ac%ac%205%20%e9%83%a8%e5%88%86%ef%bc%9a%e8%b7%9f%e8%b8%aa%e7%94%a8%e6%88%b7%e8%bf%9b%e7%a8%8b" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2febpf-tracing-user-processes%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2febpf-tracing-user-processes%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2febpf-tracing-user-processes%2f&t=eBPF%20%e6%a6%82%e8%bf%b0%ef%bc%8c%e7%ac%ac%205%20%e9%83%a8%e5%88%86%ef%bc%9a%e8%b7%9f%e8%b8%aa%e7%94%a8%e6%88%b7%e8%bf%9b%e7%a8%8b" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div><div class=content><div class=md-body><blockquote><p>åŸæ–‡é“¾æ¥ï¼š <a href=https://www.collabora.com/news-and-blog/blog/2019/05/14/an-ebpf-overview-part-5-tracing-user-processes/ target=_blank rel="noopener noreferrer">https://www.collabora.com/news-and-blog/blog/2019/05/14/an-ebpf-overview-part-5-tracing-user-processes/</a></p></blockquote><blockquote><p><strong>ä½œè€…ï¼šAdrian Ratiu</strong><br><strong>è¯‘è€…ï¼šç‹„å«å</strong><br><strong>æ³¨ï¼šæœ¬æ–‡å·²å–å¾—ä½œè€…æœ¬äººçš„ç¿»è¯‘æˆæƒ</strong></p></blockquote><h2 id=1-å‰è¨€>1. å‰è¨€</h2><p>åœ¨ä¹‹å‰çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬ä¸“æ³¨äº Linux å†…æ ¸è·Ÿè¸ªï¼Œåœ¨æˆ‘ä»¬çœ‹æ¥ï¼ŒåŸºäº eBPF çš„é¡¹ç›®æ˜¯æœ€å®‰å…¨ã€æœ€å¹¿æ³›å¯ç”¨å’Œæœ€æœ‰æ•ˆçš„æ–¹æ³•ï¼ˆeBPF åœ¨ Linux ä¸­å®Œå…¨æ˜¯ä¸Šæ¸¸æ”¯æŒçš„ï¼Œä¿è¯ç¨³å®šçš„ ABIï¼Œåœ¨å‡ ä¹æ‰€æœ‰çš„å‘è¡Œç‰ˆä¸­éƒ½é»˜è®¤å¯ç”¨ï¼Œå¹¶å¯ä¸æ‰€æœ‰å…¶ä»–è·Ÿè¸ªæœºåˆ¶é›†æˆï¼‰ã€‚ eBPF æˆä¸ºå†…æ ¸å·¥ä½œçš„ä¸äºŒä¹‹é€‰ã€‚ ç„¶è€Œï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ•…æ„é¿å…æ·±å…¥è®¨è®ºç”¨æˆ·ç©ºé—´è·Ÿè¸ªï¼Œå› ä¸ºå®ƒå€¼å¾—ç‰¹åˆ«å¯¹å¾…ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ç¬¬ 5 éƒ¨åˆ†ä¸­ä¸“é—¨è®¨è®ºã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†è®¨è®ºä¸ºä»€ä¹ˆä½¿ç”¨ï¼Œç„¶åæˆ‘ä»¬å°† eBPF ç”¨æˆ·è·Ÿè¸ªåˆ†ä¸ºé™æ€å’ŒåŠ¨æ€ä¸¤ç±»åˆ†åˆ«è®¨è®ºã€‚</p><h2 id=2-ä¸ºä»€ä¹ˆè¦åœ¨ç”¨æˆ·ç©ºé—´ä½¿ç”¨-ebpf>2. ä¸ºä»€ä¹ˆè¦åœ¨ç”¨æˆ·ç©ºé—´ä½¿ç”¨ eBPFï¼Ÿ</h2><p>æœ€é‡è¦çš„ç”¨æˆ·é—®é¢˜æ˜¯ï¼Œæ—¢ç„¶æœ‰è¿™ä¹ˆå¤šå…¶ä»–çš„è°ƒè¯•å™¨/æ€§èƒ½åˆ†æå™¨/è·Ÿè¸ªå™¨ï¼Œè¿™ä¹ˆå¤šé’ˆå¯¹ç‰¹å®šè¯­è¨€æˆ–æ“ä½œç³»ç»Ÿçš„å·¥å…·ä¸ºåŒæ ·çš„ä»»åŠ¡è€Œå¼€å‘ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨ eBPF æ¥è·Ÿè¸ªç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼Ÿç­”æ¡ˆå¹¶ä¸ç®€å•ï¼Œæ ¹æ®ä¸åŒçš„ä½¿ç”¨æƒ…å†µï¼ŒeBPF å¯èƒ½ä¸æ˜¯æœ€ä½³è§£å†³æ–¹æ¡ˆï¼›åœ¨åºå¤§çš„ç”¨æˆ·ç©ºé—´ç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªé€‚åˆæ‰€æœ‰æƒ…å†µçš„è°ƒè¯•/è·Ÿè¸ªçš„é¡¹ç›®ã€‚</p><p>eBPF è·Ÿè¸ªå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p><ul><li><p>å®ƒä¸ºå†…æ ¸å’Œç”¨æˆ·ç©ºé—´æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„è·Ÿè¸ªæ¥å£ï¼Œä¸å…¶ä»–å·¥å…·ï¼ˆ[k,u]probe, (dtrace)tracepoint ç­‰ï¼‰ä½¿ç”¨çš„æœºåˆ¶å…¼å®¹ã€‚2015 å¹´çš„æ–‡ç« <a href=https://www.brendangregg.com/blog/2015-07-08/choosing-a-linux-tracer.html target=_blank rel="noopener noreferrer">é€‰æ‹© linux è·Ÿè¸ªå™¨</a>è™½ç„¶æœ‰äº›è¿‡æ—¶ï¼Œä½†å…¶æä¾›äº†å¾ˆå¥½çš„è§è§£ï¼Œè¯´æ˜ä½¿ç”¨æ‰€æœ‰ä¸åŒçš„å·¥å…·æœ‰å¤šå›°éš¾ï¼Œè¦èŠ±å¤šå°‘ç²¾åŠ›ã€‚æœ‰ä¸€ä¸ªç»Ÿä¸€çš„ã€å¼ºå¤§çš„ã€å®‰å…¨çš„ã€å¯å¹¿æ³›ä½¿ç”¨çš„æ¡†æ¶æ¥æ»¡è¶³å¤§å¤šæ•°è·Ÿè¸ªçš„éœ€è¦ï¼Œæ˜¯éå¸¸æœ‰ä»·å€¼çš„ã€‚ä¸€äº›æ›´é«˜çº§åˆ«çš„å·¥å…·ï¼Œå¦‚ Perf/SystemTap/DTraceï¼Œæ­£åœ¨ eBPF çš„åŸºç¡€ä¸Šé‡å†™ï¼ˆæˆä¸º eBPF çš„å‰ç«¯ï¼‰ï¼Œæ‰€ä»¥äº†è§£ eBPF æœ‰åŠ©äºä½¿ç”¨å®ƒä»¬ã€‚</p></li><li><p>eBPF æ˜¯å®Œå…¨å¯ç¼–ç¨‹çš„ã€‚Perf/ftrace å’Œå…¶ä»–å·¥å…·éƒ½éœ€è¦åœ¨äº‹åå¤„ç†æ•°æ®ï¼Œè€Œ eBPF å¯ç›´æ¥åœ¨å†…æ ¸/åº”ç”¨ç¨‹åºä¸­è¿è¡Œè‡ªå®šä¹‰çš„é«˜çº§æœ¬åœ°ç¼–è¯‘çš„ C/Python/Go æ£€æµ‹ä»£ç ã€‚å®ƒå¯ä»¥åœ¨å¤šä¸ª eBPF äº‹ä»¶è¿è¡Œä¹‹é—´å­˜å‚¨æ•°æ®ï¼Œä¾‹å¦‚ä»¥åŸºäºå‡½æ•°çŠ¶æ€/å‚æ•°è®¡ç®—æ¯ä¸ªå‡½æ•°è°ƒç”¨ç»Ÿè®¡æ•°æ®ã€‚</p></li><li><p>eBPF å¯ä»¥è·Ÿè¸ªç³»ç»Ÿä¸­çš„ä¸€åˆ‡ï¼Œå®ƒå¹¶ä¸å±€é™äºç‰¹å®šçš„åº”ç”¨ç¨‹åºã€‚ä¾‹å¦‚å¯ä»¥åœ¨å…±äº«åº“ä¸Šè®¾ç½® uprobes å¹¶è·Ÿè¸ªé“¾æ¥å’Œè°ƒç”¨å®ƒçš„æ‰€æœ‰è¿›ç¨‹ã€‚</p></li><li><p>å¾ˆå¤šè°ƒè¯•å™¨éœ€è¦æš‚åœç¨‹åºæ¥è§‚å¯Ÿå…¶çŠ¶æ€æˆ–é™ä½è¿è¡Œæ—¶æ€§èƒ½ï¼Œä»è€Œéš¾ä»¥è¿›è¡Œå®æ—¶åˆ†æï¼Œå°¤å…¶æ˜¯åœ¨ç”Ÿäº§å·¥ä½œè´Ÿè½½ä¸Šã€‚å› ä¸º eBPF é™„åŠ äº† JIT çš„æœ¬åœ°ç¼–è¯‘çš„æ£€æµ‹ä»£ç ï¼Œå®ƒçš„æ€§èƒ½å½±å“æ˜¯æœ€å°çš„ï¼Œä¸éœ€è¦é•¿æ—¶é—´æš‚åœæ‰§è¡Œã€‚</p></li></ul><p>è¯šç„¶ï¼ŒeBPF ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼š</p><ul><li>eBPF ä¸åƒå…¶ä»–è·Ÿè¸ªå™¨é‚£æ ·å¯ä»¥ç§»æ¤ã€‚è¯¥è™šæ‹Ÿæœºä¸»è¦æ˜¯åœ¨ Linux å†…æ ¸ä¸­å¼€å‘çš„ï¼ˆæœ‰ä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„ BSD ç§»æ¤ï¼‰ï¼Œç›¸å…³çš„å·¥å…·æ˜¯åŸºäº Linux å¼€å‘çš„ã€‚</li><li>eBPF éœ€è¦ä¸€ä¸ªç›¸å½“æ–°çš„å†…æ ¸ã€‚ä¾‹å¦‚å¯¹äº MIPS çš„æ”¯æŒæ˜¯åœ¨ v4.13 ä¸­åŠ å…¥çš„ï¼Œä½†ç»å¤§å¤šæ•° MIPS è®¾å¤‡åœ¨è¿è¡Œçš„å†…æ ¸éƒ½æ¯” v4.13 è€ã€‚</li><li>ä¸€èˆ¬æ¥è¯´ï¼ŒeBPF ä¸å®¹æ˜“åƒè¯­è¨€æˆ–ç‰¹å®šåº”ç”¨çš„ç”¨æˆ·ç©ºé—´è°ƒè¯•å™¨é‚£æ ·æä¾›ä¸€æ ·å¤šçš„æ´å¯ŸåŠ›ã€‚ä¾‹å¦‚ï¼ŒEmacs çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªç”¨ C è¯­è¨€ç¼–å†™çš„ ELISP è§£é‡Šå™¨ï¼šeBPF å¯ä»¥é€šè¿‡æŒ‚è½½åœ¨ Emacs è¿è¡Œæ—¶çš„ C å‡½æ•°è°ƒç”¨æ¥è·Ÿè¸ª/è°ƒè¯• ELISP ç¨‹åºï¼Œä½†å®ƒä¸äº†è§£æ›´é«˜çº§åˆ«çš„ ELISP è¯­è¨€å®ç°ï¼Œå› æ­¤ä½¿ç”¨ Emacs æä¾›çš„ç‰¹æ®Š ELISP è¯­è¨€ç‰¹å®šè·Ÿè¸ªå™¨å’Œè°ƒè¯•å™¨å˜å¾—æ›´åŠ æœ‰ç”¨ã€‚å¦ä¸€ä¸ªä¾‹å­æ˜¯è°ƒè¯•åœ¨ Web æµè§ˆå™¨å¼•æ“ä¸­è¿è¡Œçš„ JavaScript åº”ç”¨ç¨‹åºã€‚</li><li>å› ä¸º "æ™®é€š eBPF" åœ¨ Linux å†…æ ¸ä¸­è¿è¡Œï¼Œæ‰€ä»¥æ¯æ¬¡ eBPF æ£€æµ‹ç”¨æˆ·è¿›ç¨‹æ—¶éƒ½ä¼šå‘ç”Ÿå†…æ ¸ - ç”¨æˆ·ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚è¿™å¯¹äºè°ƒè¯•æ€§èƒ½å…³é”®çš„ç”¨æˆ·ç©ºé—´ä»£ç æ¥è¯´å¯èƒ½å¾ˆæ˜‚è´µï¼ˆä¹Ÿè®¸å¯ä»¥ä½¿ç”¨<a href=https://github.com/iovisor/ubpf target=_blank rel="noopener noreferrer">ç”¨æˆ·ç©ºé—´ eBPF è™šæ‹Ÿæœº</a>é¡¹ç›®æ¥é¿å…è¿™ç§åˆ‡æ¢æˆæœ¬ï¼Ÿï¼‰ã€‚è¿™å¯¹äºè°ƒè¯•æ€§èƒ½å…³é”®çš„ç”¨æˆ·ç©ºé—´ä»£ç æ¥è¯´æ˜¯å¾ˆæ˜‚è´µçš„ï¼ˆä¹Ÿè®¸<a href=https://github.com/iovisor/ubpf target=_blank rel="noopener noreferrer">ç”¨æˆ·ç©ºé—´ eBPF VM</a> é¡¹ç›®å¯ä»¥ç”¨æ¥é¿å…è¿™ç§åˆ‡æ¢æˆæœ¬ï¼Ÿï¼‰ã€‚è¿™ç§ä¸Šä¸‹æ–‡åˆ‡æ¢æ¯”æ­£å¸¸çš„è°ƒè¯•å™¨ï¼ˆæˆ–åƒ strace è¿™æ ·çš„å·¥å…·ï¼‰è¦ä¾¿å®œå¾—å¤šï¼Œæ‰€ä»¥å®ƒé€šå¸¸å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåƒ LTTng è¿™æ ·èƒ½å¤Ÿå®Œå…¨è¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´çš„è·Ÿè¸ªå™¨å¯èƒ½æ›´åˆé€‚ã€‚</li></ul><h2 id=3-é™æ€è·Ÿè¸ªç‚¹usdt-æ¢é’ˆ>3. é™æ€è·Ÿè¸ªç‚¹ï¼ˆUSDT æ¢é’ˆï¼‰</h2><p>é™æ€è·Ÿè¸ªç‚¹ï¼ˆtracepointï¼‰ï¼Œåœ¨ç”¨æˆ·ç©ºé—´ä¹Ÿè¢«ç§°ä¸º USDTï¼ˆç”¨æˆ·é™æ€å®šä¹‰çš„è·Ÿè¸ªï¼‰æ¢é’ˆï¼ˆåº”ç”¨ç¨‹åºä¸­æ„Ÿå…´è¶£çš„ç‰¹å®šä½ç½®ï¼‰ï¼Œè·Ÿè¸ªå™¨å¯ä»¥åœ¨æ­¤å¤„æŒ‚è½½æ£€æŸ¥ä»£ç æ‰§è¡Œå’Œæ•°æ®ã€‚å®ƒä»¬ç”±å¼€å‘äººå‘˜åœ¨æºä»£ç ä¸­æ˜ç¡®å®šä¹‰ï¼Œé€šå¸¸åœ¨ç¼–è¯‘æ—¶ç”¨ "--enable-trace" ç­‰æ ‡å¿—å¯ç”¨ã€‚é™æ€è·Ÿè¸ªç‚¹çš„ä¼˜åŠ¿åœ¨äºå®ƒä»¬ä¸ä¼šç»å¸¸å˜åŒ–ï¼šå¼€å‘äººå‘˜é€šå¸¸ä¼šä¿æŒç¨³å®šçš„é™æ€è·Ÿè¸ª ABIï¼Œæ‰€ä»¥è·Ÿè¸ªå·¥å…·åœ¨ä¸åŒçš„åº”ç”¨ç¨‹åºç‰ˆæœ¬ä¹‹é—´å·¥ä½œï¼Œè¿™å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚å½“å‡çº§ PostgreSQL å®‰è£…å¹¶é‡åˆ°æ€§èƒ½é™ä½æ—¶ã€‚</p><h3 id=31-é¢„å®šä¹‰çš„è·Ÿè¸ªç‚¹>3.1 é¢„å®šä¹‰çš„è·Ÿè¸ªç‚¹</h3><p><a href=https://github.com/iovisor/bcc/tree/master/tools target=_blank rel="noopener noreferrer">BCC-tools</a> åŒ…å«å¾ˆå¤šæœ‰ç”¨çš„ä¸”ç»è¿‡æµ‹è¯•çš„å·¥å…·ï¼Œå¯ä»¥ä¸ç‰¹å®šåº”ç”¨ç¨‹åºæˆ–è¯­è¨€è¿è¡Œæ—¶å®šä¹‰çš„è·Ÿè¸ªç‚¹è¿›è¡Œäº¤äº’ã€‚å¯¹äºæˆ‘ä»¬çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†è·Ÿè¸ª Python åº”ç”¨ç¨‹åºã€‚ç¡®ä¿ä½ åœ¨æ„å»ºäº† python3 æ—¶å¯ç”¨äº† "--enable-trace" æ ‡è¯†ï¼Œå¹¶åœ¨ python äºŒè¿›åˆ¶æ–‡ä»¶æˆ– libpythonï¼ˆå–å†³äºä½ æ„å»ºæ–¹å¼ï¼‰ä¸Šè¿è¡Œ <a href=https://github.com/iovisor/bcc/blob/master/tools/tplist.py target=_blank rel="noopener noreferrer">tplist</a> ä»¥ç¡®è®¤è·Ÿè¸ªç‚¹è¢«å¯ç”¨ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ tplist -l /usr/lib/libpython3.7m.so
</span></span><span style=display:flex><span>b<span style=color:#e6db74>&#39;/usr/lib/libpython3.7m.so&#39;</span> b<span style=color:#e6db74>&#39;python&#39;</span>:b<span style=color:#e6db74>&#39;import__find__load__start&#39;</span>
</span></span><span style=display:flex><span>b<span style=color:#e6db74>&#39;/usr/lib/libpython3.7m.so&#39;</span> b<span style=color:#e6db74>&#39;python&#39;</span>:b<span style=color:#e6db74>&#39;import__find__load__done&#39;</span>
</span></span><span style=display:flex><span>b<span style=color:#e6db74>&#39;/usr/lib/libpython3.7m.so&#39;</span> b<span style=color:#e6db74>&#39;python&#39;</span>:b<span style=color:#e6db74>&#39;gc__start&#39;</span>
</span></span><span style=display:flex><span>b<span style=color:#e6db74>&#39;/usr/lib/libpython3.7m.so&#39;</span> b<span style=color:#e6db74>&#39;python&#39;</span>:b<span style=color:#e6db74>&#39;gc__done&#39;</span>
</span></span><span style=display:flex><span>b<span style=color:#e6db74>&#39;/usr/lib/libpython3.7m.so&#39;</span> b<span style=color:#e6db74>&#39;python&#39;</span>:b<span style=color:#e6db74>&#39;line&#39;</span>
</span></span><span style=display:flex><span>b<span style=color:#e6db74>&#39;/usr/lib/libpython3.7m.so&#39;</span> b<span style=color:#e6db74>&#39;python&#39;</span>:b<span style=color:#e6db74>&#39;function__return&#39;</span>
</span></span><span style=display:flex><span>b<span style=color:#e6db74>&#39;/usr/lib/libpython3.7m.so&#39;</span> b<span style=color:#e6db74>&#39;python&#39;</span>:b<span style=color:#e6db74>&#39;function__entry&#39;</span>
</span></span></code></pre></div><p>é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ BCC æä¾›çš„ä¸€ä¸ªå¾ˆé…·çš„è·Ÿè¸ªå·¥å…· <a href=https://github.com/iovisor/bcc/blob/master/tools/lib/uflow_example.txt target=_blank rel="noopener noreferrer">uflow</a>ï¼Œæ¥è·Ÿè¸ª python çš„<a href=https://github.com/python/cpython/blob/3.7/Lib/http/server.py target=_blank rel="noopener noreferrer">ç®€å• http æœåŠ¡å™¨</a>çš„æ‰§è¡Œæµç¨‹ã€‚è·Ÿè¸ªåº”è¯¥æ˜¯ä¸è¨€è‡ªæ˜çš„ï¼Œç®­å¤´å’Œç¼©è¿›è¡¨ç¤ºå‡½æ•°çš„è¿›å…¥/é€€å‡ºã€‚æˆ‘ä»¬åœ¨è¿™ä¸ªè·Ÿè¸ªä¸­çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªå·¥ä½œçº¿ç¨‹å¦‚ä½•åœ¨ CPU 3 ä¸Šé€€å‡ºï¼Œè€Œä¸»çº¿ç¨‹åˆ™å‡†å¤‡åœ¨ CPU 0 ä¸Šä¸ºå…¶ä»–ä¼ å…¥çš„ http è¯·æ±‚æä¾›æœåŠ¡ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python -m http.server &gt;/dev/null &amp; sudo ./uflow -l python $!
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>4<span style=color:#f92672>]</span> <span style=color:#ae81ff>11727</span>
</span></span><span style=display:flex><span>Tracing method calls in python process 11727... Ctrl-C to quit.
</span></span><span style=display:flex><span>CPU PID    TID    TIME<span style=color:#f92672>(</span>us<span style=color:#f92672>)</span> METHOD
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>   <span style=color:#ae81ff>11740</span>  <span style=color:#ae81ff>11757</span>  7.034           /usr/lib/python3.7/_weakrefset.py._remove
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>   <span style=color:#ae81ff>11740</span>  <span style=color:#ae81ff>11757</span>  7.034     /usr/lib/python3.7/threading.py._acquire_restore
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>11740</span>  <span style=color:#ae81ff>11740</span>  7.034               /usr/lib/python3.7/threading.py.__exit__
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>11740</span>  <span style=color:#ae81ff>11740</span>  7.034             /usr/lib/python3.7/socketserver.py.service_actions
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>11740</span>  <span style=color:#ae81ff>11740</span>  7.034     /usr/lib/python3.7/selectors.py.select
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>11740</span>  <span style=color:#ae81ff>11740</span>  7.532     /usr/lib/python3.7/socketserver.py.service_actions
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>11740</span>  <span style=color:#ae81ff>11740</span>  7.532
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨è·Ÿè¸ªç‚¹è¢«å‘½ä¸­æ—¶è¿è¡Œæˆ‘ä»¬çš„è‡ªå®šä¹‰ä»£ç ï¼Œå› æ­¤æˆ‘ä»¬ä¸å®Œå…¨ä¾èµ– BCC æä¾›çš„ä»»ä½•å·¥å…·ã€‚ ä»¥ä¸‹ç¤ºä¾‹å°†è‡ªèº«æŒ‚é’©åˆ° python çš„ function__entry è·Ÿè¸ªç‚¹ï¼ˆè¯·å‚é˜… <a href=https://docs.python.org/3/howto/instrumentation.html target=_blank rel="noopener noreferrer">python æ£€æµ‹</a>æ–‡æ¡£ï¼‰å¹¶åœ¨æœ‰äººä¸‹è½½æ–‡ä»¶æ—¶é€šçŸ¥æˆ‘ä»¬ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> bcc <span style=color:#f92672>import</span> BPF, USDT
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>bpf <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#include &lt;uapi/linux/ptrace.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>static int strncmp(char *s1, char *s2, int size) {for (int i = 0; i &lt; size; ++i)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if (s1[i] != s2[i])
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            return 1;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    return 0;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>int trace_file_transfers(struct pt_regs *ctx) {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    uint64_t fnameptr;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    char fname[128]=</span><span style=color:#e6db74>{0}</span><span style=color:#e6db74>, searchname[9]=&#34;copyfile&#34;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    bpf_usdt_readarg(2, ctx, &amp;fnameptr);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    bpf_probe_read(&amp;fname, sizeof(fname), (void *)fnameptr);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    if (!strncmp(fname, searchname, sizeof(searchname)))
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        bpf_trace_printk(&#34;Someone is transferring a file!</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>n&#34;);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    return 0;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>u <span style=color:#f92672>=</span> USDT(pid<span style=color:#f92672>=</span>int(sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>]))
</span></span><span style=display:flex><span>u<span style=color:#f92672>.</span>enable_probe(probe<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;function__entry&#34;</span>, fn_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;trace_file_transfers&#34;</span>)
</span></span><span style=display:flex><span>b <span style=color:#f92672>=</span> BPF(text<span style=color:#f92672>=</span>bpf, usdt_contexts<span style=color:#f92672>=</span>[u])
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        (_, _, _, _, ts, msg) <span style=color:#f92672>=</span> b<span style=color:#f92672>.</span>trace_fields()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ValueError</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>%-18.9f</span><span style=color:#e6db74> </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> (ts, msg))
</span></span></code></pre></div><p>æˆ‘ä»¬é€šè¿‡å†æ¬¡é™„åŠ åˆ°ç®€å•çš„ http-server è¿›è¡Œæµ‹è¯•ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python -m http.server &gt;/dev/null &amp; sudo ./trace_simplehttp.py $!
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>14<span style=color:#f92672>]</span> <span style=color:#ae81ff>28682</span>
</span></span><span style=display:flex><span>34677.450520000    b<span style=color:#e6db74>&#39;Someone is transferring a file!&#39;</span>
</span></span></code></pre></div><p>ä¸Šé¢çš„ä¾‹å­å‘Šè¯‰æˆ‘ä»¬ä»€ä¹ˆæ—¶å€™æœ‰äººåœ¨ä¸‹è½½æ–‡ä»¶ï¼Œä½†å®ƒä¸èƒ½æ¯”è¿™æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å…³äºè°åœ¨ä¸‹è½½ã€ä¸‹è½½ä»€ä¹ˆæ–‡ä»¶ç­‰ã€‚è¿™æ˜¯å› ä¸º python åªé»˜è®¤å¯ç”¨äº†å‡ ä¸ªéå¸¸é€šç”¨çš„è·Ÿè¸ªç‚¹ï¼ˆæ¨¡å—åŠ è½½ã€å‡½æ•°è¿›å…¥/é€€å‡ºç­‰ï¼‰ã€‚ä¸ºäº†è·å¾—æ›´å¤šçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ„Ÿå…´è¶£çš„åœ°æ–¹å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„è·Ÿè¸ªç‚¹ï¼Œä»¥ä¾¿æˆ‘ä»¬èƒ½å¤Ÿæå–ç›¸å…³çš„æ•°æ®ã€‚</p><h3 id=32-å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„è·Ÿè¸ªç‚¹>3.2 å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„è·Ÿè¸ªç‚¹</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªä½¿ç”¨åˆ«äººå®šä¹‰çš„è·Ÿè¸ªç‚¹ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¹¶æ²¡æœ‰æä¾›ä»»ä½•è·Ÿè¸ªç‚¹ï¼Œæˆ–è€…æˆ‘ä»¬éœ€è¦æ·»åŠ æ¯”ç°æœ‰è·Ÿè¸ªç‚¹æ›´å¤šçš„ä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä¸å¾—ä¸æ·»åŠ è‡ªå·±çš„è·Ÿè¸ªç‚¹ã€‚</p><p>æ·»åŠ è·Ÿè¸ªç‚¹æ–¹å¼æœ‰å¤šç§ï¼Œä¾‹å¦‚ python-core é€šè¿‡ <a href=https://github.com/python/cpython/blob/v3.7.2/Include/pydtrace.h target=_blank rel="noopener noreferrer">pydtrace.h</a> å’Œ <a href=https://github.com/python/cpython/blob/v3.7.2/Include/pydtrace.d target=_blank rel="noopener noreferrer">pydtrace.d</a> ä½¿ç”¨ systemtap çš„å¼€å‘åŒ… "systemtap-sdt-dev"ï¼Œä½†æˆ‘ä»¬å°†é‡‡å–å¦ä¸€ç§æ–¹æ³•ï¼Œä½¿ç”¨ <a href=https://github.com/sthima/libstapsdt target=_blank rel="noopener noreferrer">libstapsdt</a>ï¼Œå› ä¸ºå®ƒæœ‰ä¸€ä¸ªæ›´ç®€å•çš„ APIï¼Œæ›´è½»å·§ï¼ˆåªä¾èµ–äº libelfï¼‰ï¼Œå¹¶æ”¯æŒå¤šç§è¯­è¨€ç»‘å®šã€‚ä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼Œæˆ‘ä»¬å†æ¬¡æŠŠé‡ç‚¹æ”¾åœ¨ python ä¸Šï¼Œä½†æ˜¯è·Ÿè¸ªç‚¹ä¹Ÿå¯ä»¥ç”¨å…¶ä»–è¯­è¨€æ·»åŠ ï¼Œè¿™é‡Œæœ‰<a href=https://github.com/sthima/libstapsdt/blob/master/example/demo.c target=_blank rel="noopener noreferrer">ä¸€ä¸ª C è¯­è¨€ç¤ºä¾‹</a>ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç»™ç®€å•çš„ http æœåŠ¡å™¨æ‰“ä¸Šè¡¥ä¸ï¼Œå…¬å¼€è·Ÿè¸ªç‚¹ã€‚ä»£ç åº”è¯¥æ˜¯ä¸è¨€è‡ªæ˜çš„ï¼šæ³¨æ„è·Ÿè¸ªç‚¹çš„åå­— <strong>file_transfer</strong> åŠå…¶å‚æ•°ï¼Œè¶³å¤Ÿå­˜å‚¨ä¸¤ä¸ªå­—ç¬¦ä¸²æŒ‡é’ˆå’Œä¸€ä¸ª 32 ä½æ— ç¬¦å·æ•´æ•°ï¼Œä»£è¡¨å®¢æˆ·ç«¯ IP åœ°å€ï¼Œæ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶å¤§å°ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>diff <span style=color:#f92672>--</span>git a<span style=color:#f92672>/</span>usr<span style=color:#f92672>/</span>lib<span style=color:#f92672>/</span>python3<span style=color:#ae81ff>.7</span><span style=color:#f92672>/</span>http<span style=color:#f92672>/</span>server<span style=color:#f92672>.</span>py b<span style=color:#f92672>/</span>usr<span style=color:#f92672>/</span>lib<span style=color:#f92672>/</span>python3<span style=color:#ae81ff>.7</span><span style=color:#f92672>/</span>http<span style=color:#f92672>/</span>server<span style=color:#f92672>.</span>py
</span></span><span style=display:flex><span>index ca2dd50<span style=color:#f92672>..</span>af08e10 <span style=color:#ae81ff>100644</span>
</span></span><span style=display:flex><span><span style=color:#f92672>---</span> a<span style=color:#f92672>/</span>usr<span style=color:#f92672>/</span>lib<span style=color:#f92672>/</span>python3<span style=color:#ae81ff>.7</span><span style=color:#f92672>/</span>http<span style=color:#f92672>/</span>server<span style=color:#f92672>.</span>py
</span></span><span style=display:flex><span><span style=color:#f92672>+++</span> b<span style=color:#f92672>/</span>usr<span style=color:#f92672>/</span>lib<span style=color:#f92672>/</span>python3<span style=color:#ae81ff>.7</span><span style=color:#f92672>/</span>http<span style=color:#f92672>/</span>server<span style=color:#f92672>.</span>py
</span></span><span style=display:flex><span><span style=color:#f92672>@@</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>107</span>,<span style=color:#ae81ff>6</span> <span style=color:#f92672>+</span><span style=color:#ae81ff>107</span>,<span style=color:#ae81ff>13</span> <span style=color:#f92672>@@</span> <span style=color:#f92672>from</span> functools <span style=color:#f92672>import</span> partial
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> <span style=color:#f92672>from</span> http <span style=color:#f92672>import</span> HTTPStatus
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#f92672>+</span><span style=color:#f92672>import</span> stapsdt
</span></span><span style=display:flex><span><span style=color:#f92672>+</span>provider <span style=color:#f92672>=</span> stapsdt<span style=color:#f92672>.</span>Provider(<span style=color:#e6db74>&#34;simplehttp&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>+</span>probe <span style=color:#f92672>=</span> provider<span style=color:#f92672>.</span>add_probe(<span style=color:#e6db74>&#34;file_transfer&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#f92672>+</span>                           stapsdt<span style=color:#f92672>.</span>ArgTypes<span style=color:#f92672>.</span>uint64,
</span></span><span style=display:flex><span><span style=color:#f92672>+</span>                           stapsdt<span style=color:#f92672>.</span>ArgTypes<span style=color:#f92672>.</span>uint64,
</span></span><span style=display:flex><span><span style=color:#f92672>+</span>                           stapsdt<span style=color:#f92672>.</span>ArgTypes<span style=color:#f92672>.</span>uint32)<span style=color:#f92672>+</span>provider<span style=color:#f92672>.</span>load()
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> <span style=color:#75715e># Default error message template</span>
</span></span><span style=display:flex><span> DEFAULT_ERROR_MESSAGE <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;</span><span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span><span style=color:#e6db74>@@ -650,6 +657,8 @@ class SimpleHTTPRequestHandler(BaseHTTPRequestHandler):
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         f = self.send_head()
</span></span></span><span style=display:flex><span><span style=color:#e6db74>         if f:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>             try:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>+                path = self.translate_path(self.path)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>+                probe.fire(self.address_string(), path, os.path.getsize(path))
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                 self.copyfile(f, self.wfile)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>             finally:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                 f.close()
</span></span></span></code></pre></div><p>è¿è¡Œæ‰“è¿‡è¡¥ä¸çš„æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ tplist éªŒè¯æˆ‘ä»¬çš„ <strong>file_transfer</strong> è·Ÿè¸ªç‚¹åœ¨è¿è¡Œæ—¶æ˜¯å¦å­˜åœ¨ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python -m http.server &gt;/dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span> &amp; tplist -p $!
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>1<span style=color:#f92672>]</span> <span style=color:#ae81ff>13297</span>
</span></span><span style=display:flex><span>b<span style=color:#e6db74>&#39;/tmp/simplehttp-Q6SJDX.so&#39;</span> b<span style=color:#e6db74>&#39;simplehttp&#39;</span>:b<span style=color:#e6db74>&#39;file_transfer&#39;</span>
</span></span><span style=display:flex><span>b<span style=color:#e6db74>&#39;/usr/lib/libpython3.7m.so.1.0&#39;</span> b<span style=color:#e6db74>&#39;python&#39;</span>:b<span style=color:#e6db74>&#39;import__find__load__start&#39;</span>
</span></span><span style=display:flex><span>b<span style=color:#e6db74>&#39;/usr/lib/libpython3.7m.so.1.0&#39;</span> b<span style=color:#e6db74>&#39;python&#39;</span>:b<span style=color:#e6db74>&#39;import__find__load__done&#39;</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å°†å¯¹ä¸Šè¿°ç¤ºä¾‹ä¸­çš„è·Ÿè¸ªå™¨ç¤ºä¾‹ä»£ç è¿›è¡Œä»¥ä¸‹æœ€é‡è¦çš„ä¿®æ”¹ï¼š</p><ul><li>å®ƒå°†å…¶é€»è¾‘æŒ‚æ¥åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„ <strong>file_transfer</strong> è·Ÿè¸ªç‚¹ã€‚</li><li>å®ƒä½¿ç”¨ <a href=https://perf.wiki.kernel.org/index.php/Tutorial target=_blank rel="noopener noreferrer">PERF EVENTS</a> æ¥å­˜å‚¨å¯ä»¥å°†ä»»æ„ç»“æ„ä¼ é€’åˆ°ç”¨æˆ·ç©ºé—´çš„æ•°æ®ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„ ftrace ç¯å½¢ç¼“å­˜åŒºåªèƒ½ä¼ è¾“å•ä¸ªå­—ç¬¦ä¸²ã€‚</li><li>å®ƒ<strong>ä¸</strong>ä½¿ç”¨ <strong>bpf_usdt_readarg</strong> æ¥è·å– USDT æä¾›çš„æŒ‡é’ˆï¼Œè€Œæ˜¯ç›´æ¥åœ¨å¤„ç†ç¨‹åºå‡½æ•°ç­¾åä¸­å£°æ˜å®ƒä»¬ã€‚ è¿™æ˜¯ä¸€ä¸ªæ˜¾ç€çš„è´¨é‡æ”¹å–„ï¼Œå¯ç”¨äºæ‰€æœ‰å¤„ç†ç¨‹åºã€‚</li><li>æ­¤è·Ÿè¸ªå™¨æ˜ç¡®ä½¿ç”¨ <strong><a href=https://perf.wiki.kernel.org/index.php/Tutorial target=_blank rel="noopener noreferrer">python2</a></strong>ï¼Œå³ä½¿åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬æ‰€æœ‰çš„ç¤ºä¾‹ï¼ˆåŒ…æ‹¬ä¸Šé¢çš„ python http.server è¡¥ä¸ï¼‰ ä½¿ç”¨ <strong><a href=https://perf.wiki.kernel.org/index.php/Tutorial target=_blank rel="noopener noreferrer">python3</a></strong>ã€‚ å¸Œæœ›å°†æ¥æ‰€æœ‰ BCC API å’Œæ–‡æ¡£éƒ½èƒ½ç§»æ¤åˆ° python 3ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span> <span style=color:#75715e>#!/usr/bin/env python2</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>from</span> bcc <span style=color:#f92672>import</span> BPF, USDT
</span></span><span style=display:flex><span> <span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> bpf <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74> #include &lt;uapi/linux/ptrace.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74> BPF_PERF_OUTPUT(events);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74> struct file_transf {char client_ip_str[20];
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     char file_path[300];
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     u32 file_size;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     u64 timestamp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74> };
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74> int trace_file_transfers(struct pt_regs *ctx, char *ipstrptr, char *pathptr, u32 file_size) {struct file_transf ft = </span><span style=color:#e6db74>{0}</span><span style=color:#e6db74>;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     ft.file_size = file_size;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     ft.timestamp = bpf_ktime_get_ns();
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     bpf_probe_read(&amp;ft.client_ip_str, sizeof(ft.client_ip_str), (void *)ipstrptr);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     bpf_probe_read(&amp;ft.file_path, sizeof(ft.file_path), (void *)pathptr);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     events.perf_submit(ctx, &amp;ft, sizeof(ft));
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     return 0;
</span></span></span><span style=display:flex><span><span style=color:#e6db74> };
</span></span></span><span style=display:flex><span><span style=color:#e6db74> &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>print_event</span>(cpu, data, size):
</span></span><span style=display:flex><span>     event <span style=color:#f92672>=</span> b[<span style=color:#e6db74>&#34;events&#34;</span>]<span style=color:#f92672>.</span>event(data)
</span></span><span style=display:flex><span>     print(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{0}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{1}</span><span style=color:#e6db74> is downloding file </span><span style=color:#e6db74>{2}</span><span style=color:#e6db74> (</span><span style=color:#e6db74>{3}</span><span style=color:#e6db74> bytes)&#34;</span><span style=color:#f92672>.</span>format(event<span style=color:#f92672>.</span>timestamp, event<span style=color:#f92672>.</span>client_ip_str, event<span style=color:#f92672>.</span>file_path, event<span style=color:#f92672>.</span>file_size))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> u <span style=color:#f92672>=</span> USDT(pid<span style=color:#f92672>=</span>int(sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>]))
</span></span><span style=display:flex><span> u<span style=color:#f92672>.</span>enable_probe(probe<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;file_transfer&#34;</span>, fn_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;trace_file_transfers&#34;</span>)
</span></span><span style=display:flex><span> b <span style=color:#f92672>=</span> BPF(text<span style=color:#f92672>=</span>bpf, usdt_contexts<span style=color:#f92672>=</span>[u])
</span></span><span style=display:flex><span> b[<span style=color:#e6db74>&#34;events&#34;</span>]<span style=color:#f92672>.</span>open_perf_buffer(print_event)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>while</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>         b<span style=color:#f92672>.</span>perf_buffer_poll()
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>KeyboardInterrupt</span>:
</span></span><span style=display:flex><span>         exit()
</span></span></code></pre></div><p>è·Ÿè¸ªå·²æ‰“è¿‡è¡¥ä¸çš„æœåŠ¡å™¨ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python -m http.server &gt;/dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span> &amp; sudo ./trace_stapsdt.py $!
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>1<span style=color:#f92672>]</span> <span style=color:#ae81ff>5613</span>
</span></span><span style=display:flex><span>325540469950102: 127.0.0.1 is downloading file /home/adi/ <span style=color:#f92672>(</span><span style=color:#ae81ff>4096</span> bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>325543319100447: 127.0.0.1 is downloading file /home/adi/.bashrc <span style=color:#f92672>(</span><span style=color:#ae81ff>827</span> bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>325552448306918: 127.0.0.1 is downloading file /home/adi/workspace/ <span style=color:#f92672>(</span><span style=color:#ae81ff>4096</span> bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>325563646387008: 127.0.0.1 is downloading file /home/adi/workspace/work.tar <span style=color:#f92672>(</span><span style=color:#ae81ff>112640</span> bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>...<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>ä¸Šé¢è‡ªå®šä¹‰çš„ <strong>file_transfer</strong> è·Ÿè¸ªç‚¹çœ‹èµ·æ¥å¾ˆç®€å•ï¼ˆç›´æ¥ python æ‰“å°æˆ–æ—¥å¿—è®°å½•è°ƒç”¨å¯èƒ½æœ‰ç›¸åŒçš„æ•ˆæœï¼‰ï¼Œä½†å®ƒæä¾›çš„æœºåˆ¶éå¸¸å¼ºå¤§ï¼šè‰¯å¥½æ”¾ç½®çš„è·Ÿè¸ªç‚¹ä¿è¯ ABI ç¨³å®šæ€§ï¼Œæä¾›åŠ¨æ€è¿è¡Œçš„èƒ½åŠ›å®‰å…¨ã€æœ¬åœ°å¿«é€Ÿã€<strong>å¯ç¼–ç¨‹</strong>é€»è¾‘å¯ä»¥éå¸¸æœ‰åŠ©äºå¿«é€Ÿåˆ†æå’Œä¿®å¤å„ç§é—®é¢˜ï¼Œè€Œæ— éœ€é‡æ–°å¯åŠ¨æœ‰é—®é¢˜çš„åº”ç”¨ç¨‹åºï¼ˆé‡ç°é—®é¢˜å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ï¼‰ã€‚</p><h2 id=4-åŠ¨æ€æ¢é’ˆuprobes>4. åŠ¨æ€æ¢é’ˆï¼ˆuprobesï¼‰</h2><p>ä¸Šé¢ä¸¾ä¾‹è¯´æ˜çš„é™æ€è·Ÿè¸ªç‚¹çš„é—®é¢˜åœ¨äºï¼Œå®ƒä»¬éœ€è¦åœ¨æºä»£ç ä¸­æ˜ç¡®å®šä¹‰ï¼Œå¹¶ä¸”åœ¨ä¿®æ”¹è·Ÿè¸ªç‚¹æ—¶éœ€è¦é‡æ–°æ„å»ºåº”ç”¨ç¨‹åºã€‚ä¿è¯ç°æœ‰è·Ÿè¸ªç‚¹çš„ ABI ç¨³å®šæ€§å¯¹ç»´æŠ¤äººå‘˜å¦‚ä½•é‡æ–°æ„å»º/é‡å†™è·Ÿè¸ªç‚¹æ•°æ®çš„ä»£ç æ–½åŠ äº†é™åˆ¶ã€‚å› æ­¤ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®Œå…¨è¿è¡Œæ—¶åŠ¨æ€ç”¨æˆ·ç©ºé—´æ¢æµ‹å™¨ï¼ˆuprobesï¼‰æ˜¯é¦–é€‰ï¼šå®ƒä»¬ä»¥ç‰¹åˆ«çš„æ–¹å¼ç›´æ¥åœ¨è¿è¡Œåº”ç”¨ç¨‹åºçš„å†…å­˜ä¸­è¿›è¡Œæ¢æµ‹ï¼Œè€Œæ— éœ€ä»»ä½•ç‰¹æ®Šçš„æºä»£ç å®šä¹‰ã€‚åŠ¨æ€æ¢æµ‹å™¨å¯èƒ½ä¼šæ¯”è¾ƒå®¹æ˜“åœ¨åº”ç”¨ç¨‹åºç‰ˆæœ¬ä¹‹é—´å¤±æ•ˆï¼Œä½†å³ä¾¿å¦‚æ­¤ï¼Œå®ƒä»¬å¯¹äºå®æ—¶è°ƒè¯•æ­£åœ¨è¿è¡Œçš„å®ä¾‹ä¹Ÿå¾ˆæœ‰ç”¨ã€‚</p><p>è™½ç„¶é™æ€è·Ÿè¸ªç‚¹å¯¹äºè·Ÿè¸ªç”¨ Python æˆ– Java ç­‰é«˜çº§è¯­è¨€ç¼–å†™çš„åº”ç”¨ç¨‹åºå¾ˆæœ‰ç”¨ï¼Œä½† uprobes å¯¹æ­¤ä¸å¤ªæœ‰ç”¨ï¼Œå› ä¸ºå®ƒä»¬å·¥ä½œæ¯”è¾ƒåº•å±‚ï¼Œå¹¶ä¸”ä¸äº†è§£è¯­è¨€è¿è¡Œæ—¶å®ç°ï¼ˆé™æ€è·Ÿè¸ªç‚¹ä¹‹æ‰€ä»¥å¯ä»¥å·¥ä½œï¼Œå› ä¸ºå¼€å‘äººå‘˜è‡ªè¡Œæ‰¿æ‹…å…¬å¼€é«˜çº§åº”ç”¨ç¨‹åºçš„ç›¸å…³æ•°æ®ï¼‰ã€‚ç„¶è€Œï¼ŒåŠ¨æ€æ¢æµ‹å™¨å¯¹äºè°ƒè¯•è¯­è¨€å®ç°/å¼•æ“æœ¬èº«æˆ–ç”¨æ²¡æœ‰è¿è¡Œæ—¶çš„è¯­è¨€ï¼ˆå¦‚ Cï¼‰ç¼–å†™çš„åº”ç”¨ç¨‹åºå¾ˆæœ‰ç”¨ã€‚</p><p>å¯ä»¥å°† uprobe æ·»åŠ åˆ°ä¼˜åŒ–è¿‡ï¼ˆstrippedï¼‰çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œä½†ç”¨æˆ·å¿…é¡»æ‰‹åŠ¨è®¡ç®—è¿›ç¨‹å†…å†…å­˜åç§»ä½ç½®ï¼Œuprobe åº”é€šè¿‡ objdump å’Œ /proc//maps ç­‰å·¥å…·é™„åŠ åˆ°è¯¥ä½ç½®ï¼ˆ<a href=https://github.com/torvalds/linux/blob/v4.20/Documentation/trace/uprobetracer.rst target=_blank rel="noopener noreferrer">å‚è§ç¤ºä¾‹</a>)ï¼Œä½†è¿™ç§æ–¹å¼æ¯”è¾ƒç—›è‹¦ä¸”ä¸å¯ç§»æ¤ã€‚ ç”±äºå¤§å¤šæ•°å‘è¡Œç‰ˆéƒ½æä¾›è°ƒè¯•ç¬¦å·åŒ…ï¼ˆæˆ–ä½¿ç”¨è°ƒè¯•ç¬¦å·æ„å»ºçš„å¿«é€Ÿæ–¹æ³•ï¼‰å¹¶ä¸” BCC ä½¿å¾—ä½¿ç”¨å¸¦æœ‰ç¬¦å·åç§°è§£æçš„ uprobes å˜å¾—ç®€å•ï¼Œå› æ­¤ç»å¤§å¤šæ•°åŠ¨æ€æ¢æµ‹ä½¿ç”¨éƒ½æ˜¯ä»¥è¿™ç§æ–¹å¼è¿›è¡Œçš„ã€‚</p><p><a href=https://github.com/iovisor/bcc/blob/master/tools/gethostlatency.py target=_blank rel="noopener noreferrer">gethostlatency</a> BCC å·¥å…·é€šè¿‡å°† uprobes é™„åŠ åˆ° gethostbyname å’Œ libc ä¸­çš„ç›¸å…³å‡½æ•°æ¥æ‰“å° DNS è¯·æ±‚å»¶è¿Ÿã€‚ è¦éªŒè¯ libc æœªä¼˜åŒ–ï¼ˆstrippedï¼‰ä»¥ä¾¿å¯ä»¥è¿è¡Œè¯¥å·¥å…·ï¼ˆå¦åˆ™ä¼šå¼•å‘ sybol-not-found é”™è¯¯ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ file /usr/lib/libc-2.28.so
</span></span><span style=display:flex><span>/usr/lib/libc-2.28.so: ELF 64-bit LSB shared object, x86-64, version <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>GNU/Linux<span style=color:#f92672>)</span>, dynamically linked, <span style=color:#f92672>(</span>...<span style=color:#f92672>)</span>, not stripped
</span></span><span style=display:flex><span>$ nm -na /usr/lib/libc-2.28.so | grep -i -e getaddrinfo
</span></span><span style=display:flex><span><span style=color:#ae81ff>0000000000000000</span> a getaddrinfo.c
</span></span></code></pre></div><p><a href=https://github.com/iovisor/bcc/blob/master/tools/gethostlatency.py target=_blank rel="noopener noreferrer">gethostlatency</a> ä»£ç ä¸æˆ‘ä»¬ä¸Šé¢æ£€æŸ¥çš„è·Ÿè¸ªç‚¹ç¤ºä¾‹éå¸¸ç›¸ä¼¼ï¼ˆå¹¶ä¸”åœ¨æŸäº›åœ°æ–¹ç›¸åŒï¼Œå®ƒè¿˜ä½¿ç”¨ BPF_PERF_OUTPUTï¼‰ ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ä¼šåœ¨è¿™é‡Œå®Œæ•´åœ°å‘å¸ƒå®ƒã€‚ æœ€ç›¸å…³çš„åŒºåˆ«æ˜¯ä½¿ç”¨ <a href=https://github.com/iovisor/bcc/blob/master/docs/reference_guide.md#4-attach_uprobe target=_blank rel="noopener noreferrer">BCC uprobe API</a>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>b<span style=color:#f92672>.</span>attach_uprobe(name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;c&#34;</span>, sym<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;getaddrinfo&#34;</span>, fn_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;do_entry&#34;</span>, pid<span style=color:#f92672>=</span>args<span style=color:#f92672>.</span>pid)
</span></span><span style=display:flex><span>b<span style=color:#f92672>.</span>attach_uretprobe(name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;c&#34;</span>, sym<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;getaddrinfo&#34;</span>, fn_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;do_return&#34;</span>, pid<span style=color:#f92672>=</span>args<span style=color:#f92672>.</span>pid)
</span></span></code></pre></div><p>è¿™é‡Œéœ€è¦ç†è§£å’Œè®°ä½çš„å…³é”®æ€æƒ³æ˜¯ï¼šåªè¦å¯¹æˆ‘ä»¬çš„ BCC eBPF ç¨‹åºåšä¸€äº›å°çš„æ”¹åŠ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡é™æ€å’ŒåŠ¨æ€æ¢æµ‹æ¥è·Ÿè¸ªéå¸¸ä¸åŒçš„åº”ç”¨ç¨‹åºã€åº“ç”šè‡³æ˜¯å†…æ ¸ã€‚ä¹‹å‰æˆ‘ä»¬æ˜¯é™æ€è·Ÿè¸ª Python åº”ç”¨ç¨‹åºï¼Œç°åœ¨æˆ‘ä»¬æ˜¯åŠ¨æ€åœ°æµ‹é‡ libc çš„ä¸»æœºåè§£æå»¶æ—¶ã€‚é€šè¿‡å¯¹è¿™äº›å°çš„ï¼ˆå°äº 150LOCï¼Œå¾ˆå¤šæ˜¯æ¨¡æ¿ï¼‰ä¾‹å­è¿›è¡Œç±»ä¼¼çš„ä¿®æ”¹ï¼Œå¯åœ¨è¿è¡Œçš„ç³»ç»Ÿä¸­è·Ÿè¸ªä»»ä½•å†…å®¹ï¼Œè¿™éå¸¸å®‰å…¨ï¼Œæ²¡æœ‰å´©æºƒçš„é£é™©æˆ–å…¶ä»–å·¥å…·å¼•èµ·çš„é—®é¢˜ï¼ˆå¦‚è°ƒè¯•å™¨åº”ç”¨ç¨‹åºæš‚åœ/åœé¡¿ï¼‰ã€‚</p><h2 id=5-æ€»ç»“>5. æ€»ç»“</h2><p>åœ¨ç¬¬ 5 éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†å¦‚ä½•ä½¿ç”¨ eBPF ç¨‹åºæ¥è·Ÿè¸ªç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºã€‚ ä½¿ç”¨ eBPF å®Œæˆè¿™é¡¹ä»»åŠ¡çš„æœ€å¤§ä¼˜åŠ¿æ˜¯å®ƒæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æ¥å®‰å…¨æœ‰æ•ˆåœ°è·Ÿè¸ªæ•´ä¸ªç³»ç»Ÿï¼šå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­é‡ç°é”™è¯¯ï¼Œç„¶åè¿›ä¸€æ­¥è·Ÿè¸ªåˆ°åº“æˆ–å†…æ ¸ä¸­ï¼Œé€šè¿‡ç»Ÿä¸€çš„ç¼–ç¨‹æ¡†æ¶/æ¥å£æä¾›å®Œæ•´çš„ç³»ç»Ÿå¯è§æ€§ã€‚ ç„¶è€Œï¼ŒeBPF å¹¶ä¸æ˜¯é“¶å¼¹ï¼Œå°¤å…¶æ˜¯åœ¨è°ƒè¯•ç”¨é«˜çº§è¯­è¨€ç¼–å†™çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œç‰¹å®šè¯­è¨€çš„å·¥å…·å¯ä»¥æ›´å¥½åœ°æä¾›æ´å¯ŸåŠ›ï¼Œæˆ–è€…å¯¹äºé‚£äº›è¿è¡Œæ—§ç‰ˆæœ¬ Linux å†…æ ¸æˆ–éœ€è¦é Linux ç³»ç»Ÿçš„åº”ç”¨ç¨‹åºã€‚</p></div></div><div class=share-2><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2febpf-tracing-user-processes%2f&text=eBPF%20%e6%a6%82%e8%bf%b0%ef%bc%8c%e7%ac%ac%205%20%e9%83%a8%e5%88%86%ef%bc%9a%e8%b7%9f%e8%b8%aa%e7%94%a8%e6%88%b7%e8%bf%9b%e7%a8%8b" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2febpf-tracing-user-processes%2f&title=eBPF%20%e6%a6%82%e8%bf%b0%ef%bc%8c%e7%ac%ac%205%20%e9%83%a8%e5%88%86%ef%bc%9a%e8%b7%9f%e8%b8%aa%e7%94%a8%e6%88%b7%e8%bf%9b%e7%a8%8b" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2febpf-tracing-user-processes%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2febpf-tracing-user-processes%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2febpf-tracing-user-processes%2f&t=eBPF%20%e6%a6%82%e8%bf%b0%ef%bc%8c%e7%ac%ac%205%20%e9%83%a8%e5%88%86%ef%bc%9a%e8%b7%9f%e8%b8%aa%e7%94%a8%e6%88%b7%e8%bf%9b%e7%a8%8b" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div></div><div class=aside><div class=inner-div><div class=title>ç›®å½•</div><div class=tabs><nav id=TableOfContents><ul><li><a href=#1-å‰è¨€>1. å‰è¨€</a></li><li><a href=#2-ä¸ºä»€ä¹ˆè¦åœ¨ç”¨æˆ·ç©ºé—´ä½¿ç”¨-ebpf>2. ä¸ºä»€ä¹ˆè¦åœ¨ç”¨æˆ·ç©ºé—´ä½¿ç”¨ eBPFï¼Ÿ</a></li><li><a href=#3-é™æ€è·Ÿè¸ªç‚¹usdt-æ¢é’ˆ>3. é™æ€è·Ÿè¸ªç‚¹ï¼ˆUSDT æ¢é’ˆï¼‰</a><ul><li><a href=#31-é¢„å®šä¹‰çš„è·Ÿè¸ªç‚¹>3.1 é¢„å®šä¹‰çš„è·Ÿè¸ªç‚¹</a></li><li><a href=#32-å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„è·Ÿè¸ªç‚¹>3.2 å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„è·Ÿè¸ªç‚¹</a></li></ul></li><li><a href=#4-åŠ¨æ€æ¢é’ˆuprobes>4. åŠ¨æ€æ¢é’ˆï¼ˆuprobesï¼‰</a></li><li><a href=#5-æ€»ç»“>5. æ€»ç»“</a></li></ul></nav></div></div></div></div></section><div class=SubscribeForm><div class=innerBox><img class=close src=/images/home/close.svg alt=close><p class=description>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=blog_formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input-blog type=text placeholder>
<button id=email-submit-blog>è®¢é˜…</button>
<span id=message_blog data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨ style=color:red></span><span id=message1_blog style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span></div></div></div><footer><div class=footer><div class="footer-main common-layout"><div class=up-main><div class=left-div><img src=/images/logo.svg alt class=foot-logo><p>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input type=text placeholder=è¯·è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€>
<button id=email-submit>è®¢é˜…</button></div><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨></span><span id=message1 style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span><script>var bindSubmit=function(){var e=$("#email-input");$("#email-submit").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message").data("message1"),a=$("#message").data("message2"),r=$("#message").data("message3"),c=$("#message1").data("success");if(n)if(validateEmail(n)){if(s=$("#formAddress").data("usesendcloud"),!s)return;o=$("#formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:$("#email-input").val().toString()},success:function(){showSuccessMessage(c),setTimeout(function(){$("#email-input").val("")},1e3)},error:function(){showMessage(r)}})}else t.preventDefault(),showMessage(a);else t.preventDefault(),showMessage(i)})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},showMessage=function(e){$("#message").html(e).show()},showSuccessMessage=function(e){$("#message1").html(e).show()},bindHideMessage=function(){$(window).click(function(){$("#message").hide(),$("#message1").hide()})},bindClose=function(){$(".formBox .close").click(function(e){e.stopPropagation(),$(".formBox").fadeOut()})};bindSubmit(),bindClose(),bindHideMessage()</script><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€!></span></div><div class=right-div><ul class=common-flex-layout><li class=nowrap-li><div class=h3>åº”ç”¨åœºæ™¯</div><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps</a>
<a href=/zh/service-mesh/>åœ¨ K8s è¿è¡Œå¾®æœåŠ¡</a>
<a href=/zh/observability/>æ„å»ºäº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a>
<a href=https://github.com/kubesphere/kubekey target=_blank rel="noopener noreferrer">K8s ä¸€é”®éƒ¨ç½²ä¸è¿ç»´</a>
<a href=https://github.com/OpenFunction/OpenFunction target=_blank rel="noopener noreferrer">æ„å»º FaaS å¹³å°ä¸ Serverless æ¶æ„</a>
<a href=https://github.com/openpitrix/openpitrix target=_blank rel="noopener noreferrer">å¤šäº‘åº”ç”¨ç®¡ç†å¹³å°</a></li><li class=nowrap-li><div class=h3>èµ„æº</div><a href=/zh/projects/>å¼€æºé¡¹ç›®</a>
<a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a>
<a href=/zh/conferences/>å¼€æºå³°ä¼š</a>
<a href=/zh/videos/>è§†é¢‘èµ„æº</a>
<a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li><li class=nowrap-li><div class=h3>æ–‡æ¡£ä¸­å¿ƒ</div><a href=/zh/docs/v4.1/01-intro/01-introduction/>äº§å“ä»‹ç»</a>
<a href=/zh/docs/v4.1/03-installation-and-upgrade/02-install-kubesphere/02-install-kubernetes-and-kubesphere/>å¦‚ä½•å®‰è£…</a>
<a href=/zh/docs/v4.1/02-quickstart/>å¿«é€Ÿå…¥é—¨</a>
<a href=/zh/docs/v3.4/reference/api-docs/>API æ–‡æ¡£</a></li><li class=nowrap-li><div class=h3>å¼€æºç¤¾åŒº</div><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a>
<a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a>
<a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a>
<a href=/zh/partner/>åˆä½œä¼™ä¼´</a>
<a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a>
<a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a>
<a href=https://kubesphere.com.cn/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a>
<a href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ä¸­æ–‡è®ºå›</a>
<a href=https://kubesphere.io target=_blank rel="noopener noreferrer">å…¨çƒç«™</a></li><li class=nowrap-li><div class=h3>äº§å“ä¸æœåŠ¡</div><a href=https://aws.amazon.com/cn/quickstart/architecture/qingcloud-kubesphere/ target=_blank rel="noopener noreferrer">KubeSphere on AWS</a>
<a href=https://market.azure.cn/marketplace/apps/qingcloud.kubesphere target=_blank rel="noopener noreferrer">KubeSphere on Azure</a>
<a href=https://marketplace.digitalocean.com/apps/kubesphere target=_blank rel="noopener noreferrer">KubeSphere on DigitalOcean</a>
<a href=https://www.qingcloud.com/products/kubesphereqke target=_blank rel="noopener noreferrer">KubeSphere on QingCloud(QKE)</a>
<a href=https://kubesphere.com.cn/kse/ target=_blank rel="noopener noreferrer">KubeSphere ä¼ä¸šç‰ˆ</a>
<a href=https://kubesphere.cloud/ksv/ target=_blank rel="noopener noreferrer">KubeSphere è™šæ‹ŸåŒ–å¹³å°</a>
<a href=https://kubesphere.com.cn/marketplace/ target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿæ‰©å±•ç»„ä»¶å¸‚åœº</a>
<a href=https://kubesphere.cloud target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿåº”ç”¨æœåŠ¡å¹³å°</a>
<a href=https://m.qingcloud.com/p/aec50 target=_blank rel="noopener noreferrer">äº†è§£å•†ä¸šäº§å“ä¸å’¨è¯¢åˆä½œ</a></li></ul></div></div><div class=down-main><div class=img-div><a class=wechat href=javascript:void(0); aria-label=wechat><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28"><defs><path id="a" d="M0 0h15.673v12.156H0z"/></defs><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="13" cy="13" r="13" stroke="#B6C2CD"/><g transform="translate(5 7)"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59.0-4.625 1.679-4.625 3.74.0 2.066 2.035 3.738 4.625 3.738.542.0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27.0-.541-.257-.541-.514.0-.256.27-.514.541-.514.41.0.681.258.681.514.0.257-.271.514-.681.514zm2.994.0c-.27.0-.541-.257-.541-.514.0-.256.27-.514.54-.514.41.0.681.258.681.514.0.257-.277.514-.68.514z" mask="url(#b)"/><path fill="currentColor" d="M10.602 3.674c.177.0.356.011.533.029C10.657 1.576 8.27.0 5.543.0 2.498.0.0 1.974.0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17.0.343-.005.515-.022a3.68 3.68.0 01-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417.0.693.263.693.66s-.276.66-.693.66c-.418.0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417.0-.834-.263-.834-.66s.417-.66.834-.66c.418.0.695.263.695.66.0.392-.277.66-.695.66z" mask="url(#b)"/></g></g></svg><div class=hide-div><img src=/images/home/wechat.svg alt></div></a><a class=facebook-a href=https://www.facebook.com/kubesphere target=_blank aria-label=facebook></a><a class=twitter-a href=https://x.com/KubeSphere target=_blank aria-label=twitter rel="noopener noreferrer"></a><a class=linkedin-a href=https://www.linkedin.com/company/kubesphere/ target=_blank aria-label=linkedin rel="noopener noreferrer"></a><a class=bilibili-a href=https://space.bilibili.com/438908638 target=_blank aria-label=bilibili rel="noopener noreferrer"></a><a class=slack-a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank aria-label=slack rel="noopener noreferrer"></a><a class=github-a href=https://github.com/kubesphere/kubesphere target=_blank aria-label=github rel="noopener noreferrer"></a><a class=medium-a href=https://itnext.io/@kubesphere target=_blank aria-label=medium rel="noopener noreferrer"></a></div><p class=p1></p><p class=case><a href=http://www.beian.miit.gov.cn/ target=_blank rel="noopener noreferrer"><span>äº¬ICPå¤‡13019086å·</span>
</a><a target=_blank rel="noopener noreferrer" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502041003"><img src=/images/footer/case-icon.png alt=å¤‡æ¡ˆå›¾æ ‡>
<span>äº¬å…¬ç½‘å®‰å¤‡ 11010502041003å·</span></a></p></div></div></div><div class=cookie><div class=common-layout><p>æ‚¨çš„éšç§å¯¹æˆ‘ä»¬å¾ˆé‡è¦ã€‚æˆ‘ä»¬ä½¿ç”¨Cookieæ¥è®°ä½è®¢é˜…è¯¦ç»†ä¿¡æ¯ï¼Œä¼˜åŒ–ç½‘ç«™åŠŸèƒ½å¹¶äº¤ä»˜æ ¹æ®æ‚¨çš„å…´è¶£é‡èº«å®šåˆ¶çš„å†…å®¹ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„<a href=/zh/privacy>éšç§æ”¿ç­–</a>.</p><button>
æ¥å—å¹¶ç»§ç»­</button></div></div></footer><script>var lazyLoad=function(e,t){for(var n,o,i,s=0;s<t;s++){if(n=e.eq(s),o=n.attr("data-loaded"),o)continue;n.offset().top<parseInt($(window).height())+parseInt($(window).scrollTop())&&(i=n.attr("src"),n.attr("src",i),n.attr("data-loaded",!0))}},bindLayLoad=function(){var e=$("img"),t=e.length;lazyLoad(e,t),$(window).scroll(function(){lazyLoad(e,t)})},bindAddPadding=function(){var e=$("#close-join");e.length>0&&$(".main-section").addClass("padding")},docCookies={getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t){return!!e&&!/^(?:expires|max-age|path|domain|secure)$/i.test(e)&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t),!0)}},bindHideCookie=function(){var t=docCookies.getItem("hasAuth"),e=$(".cookie");t?e.hide():e.show(),e.find("button").on("click",function(){docCookies.setItem("hasAuth","1"),e.hide()})};bindAddPadding(),bindHideCookie()</script><script type=text/javascript src=/js/aside.2d6977c0f16aef4ed3e886dd66675ce74bd0efcd467c2b2bcdb30b92d5e7c7c0e5c6e0c9d8f09a883c22f58df9e6b0b6347fcdd3c9a920b7faba6d7f91a201c3.js integrity="sha512-LWl3wPFq707T6IbdZmdc50vQ781GfCsrzbMLktXnx8DlxuDJ2PCaiDwi9Y355rC2NH/N08mpILf6um1/kaIBww=="></script><script type=text/javascript src=/js/markdown-tab.17f9f46b021adebc7250ce1b07134a577b307e7a436daa4aaf388f218e8463966f53770b26a64817c06c168738a887672d47fb4c29615adfc446e11d09a344cf.js integrity="sha512-F/n0awIa3rxyUM4bBxNKV3swfnpDbapKrziPIY6EY5ZvU3cLJqZIF8BsFoc4qIdnLUf7TClhWt/ERuEdCaNEzw=="></script><script>let forbidForm=!1;var viewer=new Viewer(document.querySelector(".md-body"),{url:"src"}),blogBindSubmit=function(){var e=$("#email-input-blog");$("#email-submit-blog").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message_blog").data("message1"),a=$("#message_blog").data("message2"),r=$("#message_blog").data("message3"),c=$("#message1_blog").data("success");if(n)if(validateEmail(n)){if(s=$("#blog_formAddress").data("usesendcloud"),!s)return;o=$("#blog_formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:n.toString()},success:function(){showSuccessMessage_blog(c),setTimeout(function(){window.onscroll="",$(".SubscribeForm").hide(),$("#email-input-blog").val("")},5e3)},error:function(){showMessage_blog(r)}})}else t.preventDefault(),$("#message_blog").html(a).show();else t.preventDefault(),$("#message_blog").html(i).show()})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},bindHideMessageBlog=function(){$(window).click(function(){$("#message_blog").hide()})},bindCloseBlog=function(){$(".SubscribeForm .close").click(function(e){e.stopPropagation(),$(".SubscribeForm").fadeOut(),window.onscroll=""})},showMessage_blog=function(e){$("#message_blog").html(e).show()},showSuccessMessage_blog=function(e){$("#message1_blog").html(e).show()};window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;forbidForm&&(window.onscroll=""),e+t>n-710?$(".SubscribeForm").hide():$(".SubscribeForm").show()},blogBindSubmit(),bindCloseBlog(),bindHideMessageBlog()</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>