<!doctype html><html lang=en-US><head><meta charset=utf-8><title>åŸºäº KubeSphere çš„å¼€æºå¾®æœåŠ¡å¼€å‘å¹³å° Pig æœ€ä½³å®è·µ</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="æœ¬æ–‡ä¸»è¦æå†™äº†ä½¿ç”¨ KubeSphere è¿™æ¬¾å®¹å™¨äº‘å¹³å°å’Œ Pig è¿™æ¬¾å¼€æºå¾®æœåŠ¡å¼€å‘å¹³å°æ¥è§£å†³å¾®æœåŠ¡ç³»ç»Ÿéƒ¨ç½²ã€ç›‘æ§çš„å¤æ‚é—®é¢˜ã€‚"><meta name=keywords content="Kubernetes,KubeSphere,Pig,å¾®æœåŠ¡"><meta property="og:type" content="article"><meta property="og:title" content="åŸºäº KubeSphere çš„å¼€æºå¾®æœåŠ¡å¼€å‘å¹³å° Pig æœ€ä½³å®è·µ"><meta property="og:description" content="æœ¬æ–‡ä¸»è¦æå†™äº†ä½¿ç”¨ KubeSphere è¿™æ¬¾å®¹å™¨äº‘å¹³å°å’Œ Pig è¿™æ¬¾å¼€æºå¾®æœåŠ¡å¼€å‘å¹³å°æ¥è§£å†³å¾®æœåŠ¡ç³»ç»Ÿéƒ¨ç½²ã€ç›‘æ§çš„å¤æ‚é—®é¢˜ã€‚"><meta property="og:image" content="https://pek3b.qingstor.com/kubesphere-community/images/kubesphere-pig-practice-cover.png"><meta property="og:url" content="https://openksc.github.io/zh/blogs/kubesphere-pig-practice/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeSphere"><meta property="twitter:image" content="https://pek3b.qingstor.com/kubesphere-community/images/kubesphere-pig-practice-cover.png"><meta name=docsearch:language content="zh-CN"><meta name=docsearch:version content><link rel=canonical href=https://kubesphere.io/zh/blogs/kubesphere-pig-practice/><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=apple-touch-icon href=/images/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/svg+xml href=/images/favicons/favicon.svg><link rel=icon type=image/png href=/images/favicons/favicon.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg color=#00ad6e><meta name=msapplication-config content='/images/favicons/browserconfig.xml'><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/fonts/Roboto/stylesheet.css><link rel=stylesheet href=/fonts/ProximaNova/stylesheet.css><link rel=stylesheet href=/css/jquery.modal.min.css><link rel=stylesheet href=/css/viewer.min.css><link rel=stylesheet href=/swiper/swiper-bundle.min.css><link rel=stylesheet href=/scss/common.min.0c3fdcc05ec210321169846714f74b11c4a1baf09a1833fa9273b2347c81e636.css><script src=/js/jquery-3.7.1.min.js></script><script src=/js/viewer.min.js></script><script src=/js/jquery.modal.min.js></script><script src=/swiper/swiper-bundle.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0888981f1fa45d241b1fb6962da2963e",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YYCVN36HT5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YYCVN36HT5")</script><script type=text/javascript>!function(e,t,n,s,o){e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=("https:"==document.location.protocol?"https://":"http://")+s,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio"),gio("init","8a24ae300cbf8b8c",{}),gio("send")</script><link rel=stylesheet href=/scss/content.min.f73b326fbf8c5bd331900b0de21c7dde608a4926f482f6465f9ae1d9049b83ad.css><link rel=stylesheet href=/scss/markdown.min.db47186481122431dffae72d17dbbd51f90b66f022cc163458645709924e4eac.css></head><body><header class=navigation><div class=join-div><div class=content>ğŸš€ KubeSphere v4.1.3 å‘å¸ƒï¼Œå¤šé¡¹ä¼˜åŒ–ä¸æ”¹è¿›ï¼Œæ¬¢è¿ä½“éªŒï¼<a href=/zh/docs/v4.1/20-release-notes/release-v413/ target=_blank rel="noopener noreferrer">è¯·æŸ¥çœ‹ Release notes â†’</a>
<img id=close-join src=/images/header/close.svg alt=close></div></div><div class=common-layout><div class=header-container><a href=/zh/ aria-label=logo><img src=/images/header/logo.svg alt class=logo></a><ul class=nav><li class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class="dropdown-menu menu-2"><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li class=menu-li><span class=menu-span>èµ„æº</span><ul class="dropdown-menu menu-3"><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class="dropdown-menu menu-4"><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/ target=_blank rel="noopener noreferrer">æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/ target=_blank rel="noopener noreferrer">Kube Design</a></li></ul></li><li class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class="dropdown-menu menu-5"><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025 target=_blank rel="noopener noreferrer">å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/ target=_blank rel="noopener noreferrer">è®¤è¯</a></li></ul><div class=right-menu><ul><li class=language-menu><div><img src=/images/header/black.svg alt>
<span>ç®€ä½“ä¸­æ–‡</span></div><ul class=dropdown-menu><li onclick='handleLangClick("zh","/zh/blogs/kubesphere-pig-practice/")'>ç®€ä½“ä¸­æ–‡</li></ul></li><li class=github-li><div class=github-star><a class=star-btn href=https://github.com/kubesphere/kubesphere rel="noopener noreferrer" target=_blank><span class=star-img></span>&nbsp;<span>Star</span>
</a><a class=social-count href=https://github.com/kubesphere/kubesphere/stargazers rel="noopener noreferrer" target=_blank></a></div></li><li class=menu-icon><img src=/images/header/menu.svg alt></li></ul></div></div></div><div id=modal-for-menu class=modal><ul class=nav><li data-check=0 class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class=dropdown-menu><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>èµ„æº</span><ul class=dropdown-menu><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class=dropdown-menu><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/>æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/>Kube Design</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class=dropdown-menu><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md>ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/>ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025>å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum>ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/>è®¤è¯</a></li></ul><div class=link-div><a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank rel="noopener noreferrer" aria-label=slack><img src=/images/header/slack-hover.svg alt>
</a><a href=https://x.com/KubeSphere target=_blank rel="noopener noreferrer" aria-label=twitter><img src=/images/header/twitter-hover.svg alt>
</a><a href=https://github.com/kubesphere/kubesphere target=_blank rel="noopener noreferrer" aria-label=github><img src=/images/header/github-hover.svg alt></a></div></div></header><script>var bindNavMouseEvent,bindScrollChangeHeader,bindClickShowMenu,bindClickModalLi,bindClickClose,language,handleLangClick,githubApiLink="https://api.github.com/repos/kubesphere/kubesphere",getStar=function(){$(".social-count").hide(),$.getJSON(githubApiLink,function(e){$(".social-count").show().html(e.stargazers_count)})};getStar(),bindNavMouseEvent=function(e,t){t||(t=$(e));var n=!1;t.mouseenter(function(){if(n)return!1;n=!0,$(this).find(".dropdown-menu").fadeIn(200,function(){n=!1})}),t.mouseleave(function(){$(this).find(".dropdown-menu").fadeOut(200)})},bindScrollChangeHeader=function(){var t=100,e=$("header");window.addEventListener("scroll",function(){var t=window.scrollY;t>0?e.addClass("navigationScroll"):e.removeClass("navigationScroll")})},bindClickShowMenu=function(){$(".menu-icon").click(function(){$("#modal-for-menu").modal()})},bindClickModalLi=function(){$(".modal .menu-li").click(function(){var e=$(this).data("check");e===0?($(this).data("check",1),$(this).find(".dropdown-menu").slideDown(200)):($(this).data("check",0),$(this).find(".dropdown-menu").slideUp(200)),$(this).find(".menu-span").toggleClass("up")})},bindClickClose=function(){$("#close-join").click(function(){$(".navigation .join-div").hide(),$(".main-section").removeClass("padding")})},language="zh",bindClickClose(),bindScrollChangeHeader(),$(".header-container .menu-li").each(function(){bindNavMouseEvent("",$(this))}),bindNavMouseEvent(".header-container .language-menu"),bindNavMouseEvent(".header-container .btn-li"),bindClickShowMenu(),bindClickModalLi(),handleLangClick=function(e,t){try{localStorage.setItem("lang",e)}catch{}location.href=t}</script><section class=main-section><div class=common-layout><div class=breadcrumb><span><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a> > </span><span>åŸºäº KubeSphere çš„å¼€æºå¾®æœåŠ¡å¼€å‘å¹³å° Pig æœ€ä½³å®è·µ</span></div><div class='main-div middle-div'><div class=author>ä½•æ˜Œæ¶›</div><span class=date>å‘å¸ƒäºï¼š2022-10-25</span>&nbsp;&nbsp;&nbsp;
<span style=font-size:14px;color:#919aa3 id=busuanzi_container_page_pv>æœ¬æ–‡æ€»é˜…è¯»é‡ï¼š<span id=busuanzi_value_page_pv></span></span><h1>åŸºäº KubeSphere çš„å¼€æºå¾®æœåŠ¡å¼€å‘å¹³å° Pig æœ€ä½³å®è·µ</h1><div class=share-1><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-pig-practice%2f&text=%e5%9f%ba%e4%ba%8e%20KubeSphere%20%e7%9a%84%e5%bc%80%e6%ba%90%e5%be%ae%e6%9c%8d%e5%8a%a1%e5%bc%80%e5%8f%91%e5%b9%b3%e5%8f%b0%20Pig%20%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-pig-practice%2f&title=%e5%9f%ba%e4%ba%8e%20KubeSphere%20%e7%9a%84%e5%bc%80%e6%ba%90%e5%be%ae%e6%9c%8d%e5%8a%a1%e5%bc%80%e5%8f%91%e5%b9%b3%e5%8f%b0%20Pig%20%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-pig-practice%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-pig-practice%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-pig-practice%2f&t=%e5%9f%ba%e4%ba%8e%20KubeSphere%20%e7%9a%84%e5%bc%80%e6%ba%90%e5%be%ae%e6%9c%8d%e5%8a%a1%e5%bc%80%e5%8f%91%e5%b9%b3%e5%8f%b0%20Pig%20%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div><div class=content><div class=md-body><blockquote><p>ä½œè€…ï¼šä½•æ˜Œæ¶›ï¼ŒåŒ—äº¬åŒ—å¤§è‹±åç§‘æŠ€æœ‰é™å…¬å¸é«˜çº§ Java å·¥ç¨‹å¸ˆï¼Œäº‘åŸç”Ÿçˆ±å¥½è€…ã€‚</p></blockquote><h2 id=å‰è¨€>å‰è¨€</h2><p>è¿‘å¹´æ¥ï¼Œä¸ºäº†æ»¡è¶³è¶Šæ¥è¶Šå¤æ‚çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘ä»¬ä»ä¼ ç»Ÿå•ä½“æ¶æ„ç³»ç»Ÿå‡çº§ä¸ºå¾®æœåŠ¡æ¶æ„ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªå¤§å‹åº”ç”¨ç¨‹åºåˆ†å‰²æˆå¯ä»¥ç‹¬ç«‹éƒ¨ç½²çš„å°å‹æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡ä¹‹é—´éƒ½æ˜¯æ¾è€¦åˆçš„ï¼Œé€šè¿‡ RPC æˆ–è€…æ˜¯ Rest åè®®æ¥è¿›è¡Œé€šä¿¡ï¼Œå¯ä»¥æŒ‰ç…§ä¸šåŠ¡é¢†åŸŸæ¥åˆ’åˆ†æˆç‹¬ç«‹çš„å•å…ƒã€‚ä½†æ˜¯å¾®æœåŠ¡ç³»ç»Ÿç›¸å¯¹äºä»¥å¾€çš„å•ä½“ç³»ç»Ÿæ›´ä¸ºå¤æ‚ï¼Œå½“ä¸šåŠ¡å¢åŠ æ—¶ï¼ŒæœåŠ¡ä¹Ÿå°†è¶Šæ¥è¶Šå¤šï¼ŒæœåŠ¡çš„é¢‘ç¹éƒ¨ç½²ã€ç›‘æ§å°†å˜å¾—å¤æ‚èµ·æ¥ï¼Œå°¤å…¶åœ¨ä¸Šäº† K8s ä»¥åä¼šæ›´åŠ å¤æ‚ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€æ¬¾å…¨æ ˆçš„å®¹å™¨äº‘å¹³å°æ¥å¸®æˆ‘ä»¬è§£å†³è¿™äº›é—®é¢˜å“©ï¼Ÿé‚£å½“ç„¶æ˜¯æœ‰çš„ï¼Œä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥æ­ç§˜ä¸€ä¸‹å§ã€‚</p><h2 id=ä»‹ç»>ä»‹ç»</h2><h3 id=kubesphere>KubeSphere</h3><p>KubeSphere æ˜¯åœ¨ Kubernetes ä¹‹ä¸Šæ„å»ºçš„å¼€æºå®¹å™¨å¹³å°ï¼Œæä¾›å…¨æ ˆçš„ IT è‡ªåŠ¨åŒ–è¿ç»´çš„èƒ½åŠ›ï¼Œç®€åŒ–ä¼ä¸šçš„ DevOps å·¥ä½œæµã€‚</p><h3 id=pig>Pig</h3><p><a href=https://gitee.com/log4j/pig target=_blank rel="noopener noreferrer">Pig</a> æ˜¯ä¸€ä¸ªåŸºäº Spring Boot 2.7ã€ Spring Cloud 2021 & Alibabaã€ SAS OAuth2 çš„å¼€æºå¾®æœåŠ¡å¼€å‘å¹³å°ï¼Œä¹Ÿæ˜¯å¾®æœåŠ¡æœ€ä½³å®è·µã€‚åœ¨å›½å†…æ‹¥æœ‰å¤§é‡æ‹¥æŠ¤è€…ï¼ŒåŒæ—¶ä¹Ÿæœ‰å•†ä¸šç‰ˆæœ¬æä¾›æŠ€æœ¯æ”¯æŒã€‚</p><h2 id=ç¯å¢ƒæ­å»º>ç¯å¢ƒæ­å»º</h2><ul><li>K8s å®¹å™¨åŒ–ç¯å¢ƒä¸€å¥—ï¼Œå¹¶éƒ¨ç½²å®Œ KubeSphere v3.3.0 ç‰ˆæœ¬ï¼Œå¯ç”¨ DevOps æ’ä»¶ã€‚</li><li>GitLab ä»£ç ä»“åº“ç®¡ç†å¼€æºç³»ç»Ÿä¸€å¥—ã€‚</li><li>Harbor å®¹å™¨é•œåƒå¼€æºç³»ç»Ÿä¸€å¥—ã€‚</li><li>SonarQube å¼€æºè‡ªåŠ¨ä»£ç å®¡æŸ¥å·¥å…·ä¸€å¥—ã€‚</li><li>ä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†çš„ Nacos å¼€æºå¹³å°ä¸€å¥—ï¼ˆå¯é€‰ï¼ŒPig å·²æä¾› Naocs æœåŠ¡ï¼Œå³ Register æœåŠ¡ï¼‰ã€‚</li><li>é«˜æ€§èƒ½çš„ key-value æ•°æ®åº“ Redisï¼ˆ3.2 +ï¼‰ä¸€å¥—ï¼ˆPig éœ€è¦ï¼‰ã€‚</li><li>å…³ç³»å‹å¼€æºæ•°æ®åº“ç®¡ç†ç³»ç»Ÿ MySQL ä¸€å¥—ï¼ˆPig éœ€è¦ï¼‰ã€‚</li><li>é«˜æ€§èƒ½å¯¹è±¡å­˜å‚¨ Minio ä¸€å¥—ï¼ˆPig ä¸­æ–‡ä»¶ä¸Šä¼ éœ€è¦ï¼Œå¯é€‰ï¼‰ã€‚æˆ–è€…é˜¿é‡Œäº‘ã€åä¸ºäº‘ã€è…¾è®¯å¯¹è±¡å­˜å‚¨ä¹Ÿå¯ã€‚</li></ul><h2 id=æ¶æ„è®¾è®¡>æ¶æ„è®¾è®¡</h2><h3 id=kubesphere-æ¶æ„>KubeSphere æ¶æ„</h3><p>KubeSphere å°†å‰ç«¯ä¸åç«¯åˆ†å¼€ï¼Œå®ç°äº†é¢å‘äº‘åŸç”Ÿçš„è®¾è®¡ï¼Œåç«¯çš„å„ä¸ªåŠŸèƒ½ç»„ä»¶å¯é€šè¿‡ REST API å¯¹æ¥å¤–éƒ¨ç³»ç»Ÿã€‚KubeSphere æ— åº•å±‚çš„åŸºç¡€è®¾æ–½ä¾èµ–ï¼Œå¯ä»¥è¿è¡Œåœ¨ä»»ä½• Kubernetesã€ç§æœ‰äº‘ã€å…¬æœ‰äº‘ã€VM æˆ–ç‰©ç†ç¯å¢ƒï¼ˆBMï¼‰ä¹‹ä¸Šã€‚ æ­¤å¤–ï¼Œå®ƒå¯ä»¥éƒ¨ç½²åœ¨ä»»ä½• Kubernetes å‘è¡Œç‰ˆä¸Šã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/f23add71-0796-4c31-9a87-7de57dc08851.png alt></p><blockquote><p>è¯¥å›¾æ¥è‡ª KubeSphere å®˜ç½‘æ¶æ„è¯´æ˜ã€‚</p></blockquote><h3 id=pig-æ¶æ„>Pig æ¶æ„</h3><p>Pig å¹³å°è®¾è®¡çµæ´»å¯æ‰©å±•ã€å¯ç§»æ¤ã€å¯åº”å¯¹é«˜å¹¶å‘éœ€æ±‚ã€‚åŒæ—¶å…¼é¡¾æœ¬åœ°åŒ–ã€ç§æœ‰äº‘ã€å…¬æœ‰äº‘éƒ¨ç½²ï¼Œæ”¯æŒ SaaS æ¨¡å¼åº”ç”¨ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/faba1b41-e6b1-459b-8e79-dd0fe8917cbf.png alt></p><blockquote><p>è¯¥å›¾æ¥è‡ª Pig ç™½çš®ä¹¦ä¸­çš„åŸºç¡€æ¶æ„å›¾ã€‚</p></blockquote><h3 id=æ•´ä½“æ¶æ„å›¾>æ•´ä½“æ¶æ„å›¾</h3><p>å…¶å®å°±æ˜¯å°†åŸæ¶æ„åŠ ä¸Šä¸€å±‚ Ingress, åœ¨ KubeSphere ä¸­å¯¹åº”çš„æ˜¯åº”ç”¨è·¯ç”±ï¼ˆIngress è·¯ç”±è§„åˆ™ï¼‰å’Œé¡¹ç›®ç½‘å…³ï¼ˆIngress Controllerï¼‰ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/a9416be1-90cc-4bf1-aa63-139a3cb0c929.png alt></p><h3 id=æ•´ä½“å®¹å™¨åŒ–éƒ¨ç½²æµç¨‹å›¾>æ•´ä½“å®¹å™¨åŒ–éƒ¨ç½²æµç¨‹å›¾</h3><p>è¿ç»´äººå‘˜å¯é€šè¿‡ KubeSphere æ¥ç®¡ç†æœåŠ¡ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ KubeSphere ä¸­çš„ Jenkins æ¥å‘å¸ƒåˆ¶å“ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/20d39dca-bc13-423c-9ef2-05687c510c33.png alt></p><h2 id=éƒ¨ç½²è¿‡ç¨‹>éƒ¨ç½²è¿‡ç¨‹</h2><p>åˆ†åˆ«åˆ›å»ºä¸¤æ¡æµæ°´çº¿ï¼Œä¸€æ¡ç”¨äºæ„å»º Pig åç«¯ Java ä»£ç ï¼Œå¦å¤–ä¸€æ¡ç”¨äºæ„å»ºåŸºäº Vue çš„ Pig-ui å‰ç«¯ä»£ç ã€‚</p><h3 id=åˆ›å»ºä¼ä¸šç©ºé—´>åˆ›å»ºä¼ä¸šç©ºé—´</h3><p>ä¸ºé¡¹ç›®åˆ›å»ºä¸€ä¸ªåç§°ä¸º pig-workspace çš„ä¼ä¸šç©ºé—´ , ä¼ä¸šç©ºé—´æ˜¯ä¸€ä¸ªç»„ç»‡æ‚¨çš„é¡¹ç›®å’Œ DevOps é¡¹ç›®ã€ç®¡ç†èµ„æºè®¿é—®æƒé™ä»¥åŠåœ¨å›¢é˜Ÿå†…éƒ¨å…±äº«èµ„æºç­‰çš„é€»è¾‘å•å…ƒï¼Œå¯ä»¥ä½œä¸ºå›¢é˜Ÿå·¥ä½œçš„ç‹¬ç«‹å·¥ä½œç©ºé—´ã€‚</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/e0aa9fa6-efb8-497a-b6c9-dd39bafb7522.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/abf5e6fb-61a2-4f85-897b-57d0f8ad5ca7.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/2e078216-6117-4e90-b97d-43c9e7773485.png alt></p><h3 id=åˆ›å»º-devops-é¡¹ç›®>åˆ›å»º DevOps é¡¹ç›®</h3><p>DevOps é¡¹ç›®æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å‘½åç©ºé—´ï¼Œå…¶ä¸­å®šä¹‰äº†ä¸€ç»„æµæ°´çº¿ã€‚ç”¨æˆ·å¯ä»¥æŒ‰ç…§è‡ªå·±çš„æ–¹å¼å¯¹æµæ°´çº¿è¿›è¡Œåˆ†ç»„ï¼ˆä¾‹å¦‚ï¼šé¡¹ç›®ç±»å‹ã€ç»„ç»‡ç±»å‹ï¼‰ã€‚</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/56f5580a-e6d7-4e4f-b7b6-f66c343fced8.png alt></p><h3 id=åˆ›å»ºé¡¹ç›®>åˆ›å»ºé¡¹ç›®</h3><p>é¡¹ç›®ç”¨äºå¯¹èµ„æºè¿›è¡Œåˆ†ç»„ç®¡ç†å’Œæ§åˆ¶ä¸åŒç”¨æˆ·çš„èµ„æºç®¡ç†æƒé™ã€‚</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/0bf17611-db4f-4a3a-a5de-453836c74116.png alt></p><h3 id=éƒ¨ç½²-mysql>éƒ¨ç½² MySQL</h3><ol><li>è¿›å…¥åº”ç”¨å•†åº—ï¼Œåœ¨åº”ç”¨åˆ†ç±»ä¸­é€‰æ‹©æ•°æ®åº“å’Œç¼“å­˜ï¼Œæ‰¾åˆ° MySQLã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/8eea9d55-9f67-4fbe-a48b-80853c16ada2.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/c1751e21-80be-4c9f-83be-53999d59a7a4.png alt></p><ol start=2><li>åœ¨åŸºæœ¬ä¿¡æ¯ä¸­ï¼Œå¡«å†™åº”ç”¨åç§° pig-MySQL, å¹¶é€‰æ‹©ä½ç½®ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/8f677cee-3502-4cc5-90ac-d6dc7c31505e.png alt></p><ol start=3><li>åœ¨åº”ç”¨é…ç½®ä¸­ï¼Œç¼–è¾‘ yaml æ–‡ä»¶ , å°†é•œåƒæ”¹ä¸º MySQL/MySQL-server:8.0.30ï¼Œå°†å¯†ç è®¾ç½®ä¸º rootã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/de473208-c31f-4311-8aec-7b40375c1268.png alt></p><blockquote><p>MySQL é•œåƒé‡‡ç”¨ pig é¡¹ç›® db ä¸‹ Dockerfile ä¸­çš„ç‰ˆæœ¬ï¼Œä¹Ÿå¯è‡ªå·±æŒ‡å®šã€‚</p></blockquote><ol start=4><li>ç‚¹å‡»å®‰è£…ï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/a6885b2f-e7d3-478e-837f-429d9bdbfa9e.png alt></p><ol start=5><li>è¿›å…¥ pig-mysql æœåŠ¡ï¼Œç¼–è¾‘å¤–éƒ¨è®¿é—® , ä»è€Œè®¿é—® MySQL å¯¼å…¥ pig çš„æ•°æ®ï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/0bff01a8-ab1c-4c52-8734-c04b808184a5.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/29ea5a30-322c-47fa-9774-68e1051a3964.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/6e3eeadd-0ebe-4cad-a94d-d7c0853d19ce.png alt></p><ol start=6><li>è¿›å…¥ MySQL å®¹å™¨ï¼Œè°ƒæ•´å¸å·å…è®¸ä»è¿œç¨‹ç™»é™†ï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/69fcb1b4-8400-4ce6-8182-34ce8b3e075c.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/9cbc4ac0-d041-477b-881c-4323b6acf0a1.png alt></p><p>ç™»å½• MySQL è¿›è¡Œæˆæƒæ“ä½œï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ MySQL -uroot -proot
</span></span><span style=display:flex><span>$ use MySQL;
</span></span><span style=display:flex><span>$ update user set host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;%&#39;</span> where user<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;root&#39;</span>;
</span></span><span style=display:flex><span>$ flush privileges;
</span></span><span style=display:flex><span>$ ALTER USER <span style=color:#e6db74>&#39;root&#39;</span>@<span style=color:#e6db74>&#39;%&#39;</span> IDENTIFIED WITH MySQL_native_password BY <span style=color:#e6db74>&#39;root&#39;</span>;
</span></span><span style=display:flex><span>$ flush privileges;
</span></span></code></pre></div><ol start=7><li>åˆ©ç”¨ Navicat å®¢æˆ·ç«¯è¿æ¥ pig-mysql æœåŠ¡ï¼Œå¯¼å…¥æ•°æ®ï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/8f4915d9-95bc-4b7c-8f9f-0ba003e39fc7.png alt></p><h2 id=éƒ¨ç½²-redis>éƒ¨ç½² Redis</h2><ol><li>è¿›å…¥åº”ç”¨å•†åº—ï¼Œåœ¨åº”ç”¨åˆ†ç±»ä¸­é€‰æ‹©æ•°æ®åº“å’Œç¼“å­˜ï¼Œæ‰¾åˆ° Redisã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/587567d1-4a45-4b52-8f0c-f883302d8095.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/ba56795b-4a30-42cd-a709-9fa6cf2cd112.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/cea14892-5f08-4e75-93f8-91d4d2774ad8.png alt></p><blockquote><p>æ³¨ï¼šPig ä¸­é»˜è®¤ä½¿ç”¨æ— å¯†ç æ¨¡å¼ï¼Œå› æ­¤å¯ä»¥æš‚æ—¶ç•™ç©ºã€‚ç”Ÿäº§ç¯å¢ƒä¸æ¨èå°†å¯†ç è®¾ç½®ä¸ºç©ºã€‚</p></blockquote><ol start=2><li>å®‰è£…æˆåŠŸåï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/3f11873d-f435-44c9-98b7-205d697c81a1.png alt></p><h2 id=åˆ›å»ºå‡­è¯>åˆ›å»ºå‡­è¯</h2><p>Pig æ‰€ä¾èµ–çš„åç«¯å¾®æœåŠ¡ä¸ºæ— çŠ¶æ€æœåŠ¡ã€‚åˆ©ç”¨ KubeSphere æœåŠ¡åˆ›å»º DevOps æµæ°´çº¿é¡¹ç›®æ¥éƒ¨ç½²è¿™äº›å¾®æœåŠ¡ã€‚</p><ol><li>åˆ›å»º kubeconfig å‡­è¯ , å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/c12fe912-8b1e-404a-9618-c1490ae34e37.png alt></p><blockquote><p>åç§°è‡ªå®šä¹‰ï¼Œéœ€è¦å’Œ Jenkinsfile ä¸­çš„ä¸€è‡´å³å¯ï¼Œå†…å®¹é»˜è®¤æˆ–è€…å» /root/.kube ä¸‹å¤åˆ¶ã€‚</p></blockquote><ol start=2><li>åˆ›å»º Harbor å‡­è¯ , å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/f9ef91cd-054d-4576-8f45-8f416659c29a.png alt></p><blockquote><p>åç§°è‡ªå®šä¹‰ï¼Œéœ€è¦å’Œ Jenkinsfile ä¸­çš„ä¸€è‡´å³å¯ã€‚</p></blockquote><ol start=3><li>åˆ›å»º gitlab å‡­è¯ , å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/ac939576-7201-4fd2-bb12-8f051ed8a930.png alt></p><blockquote><p>åç§°è‡ªå®šä¹‰ï¼Œéœ€è¦å’Œ Jenkinsfile ä¸­çš„ä¸€è‡´å³å¯ã€‚</p></blockquote><p>å…¨éƒ¨å‡­è¯å¦‚ä¸‹ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/c2731a18-018e-4fbb-8b58-9141254885d8.png alt></p><h2 id=è®¾ç½®-harbor-é•œåƒä»“åº“>è®¾ç½® harbor é•œåƒä»“åº“</h2><p>æ–°å»ºä¸€ä¸ª pig-dev é¡¹ç›® , å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/48bd9cce-d8c1-4be9-9d85-936930ee14d3.png alt></p><h2 id=éƒ¨ç½²-pig-åç«¯æ— çŠ¶æ€æœåŠ¡>éƒ¨ç½² Pig åç«¯æ— çŠ¶æ€æœåŠ¡</h2><ol><li>æ–°å»º pig åç«¯æµæ°´çº¿ , å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/634e9271-bf37-459b-8c7a-efe52850c421.png alt></p><p>é€‰æ‹©ä»£ç ä»“åº“ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/0f0f00c3-96b0-48aa-a513-04ccf40a4d90.png alt></p><p>ç¼–è¾‘è®¾ç½®ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/620044ab-92bd-459c-8725-b4aa26893b58.png alt></p><ol start=2><li>ä»£ç ä¸­åˆ›å»º Jenkinsfile æ–‡ä»¶ï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/5634357b-c0bb-4738-b99d-78e25b2a469a.png alt></p><p>å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>pipeline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    agent <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        label <span style=color:#e6db74>&#39;maven&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    parameters <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        choice<span style=color:#f92672>(</span>choices: <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;dev&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;test&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;pre&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;pre2&#39;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#39;prod&#39;</span><span style=color:#f92672>],</span> name: <span style=color:#e6db74>&#39;Environments&#39;</span><span style=color:#f92672>,</span> description: <span style=color:#e6db74>&#39;è¯·é€‰æ‹©è¦å‘å¸ƒçš„ç¯å¢ƒï¼šdevå¼€å‘ç¯å¢ƒã€testæµ‹è¯•ç¯å¢ƒã€preé¢„å‘å¸ƒç¯å¢ƒã€pre2ç°åº¦ç¯å¢ƒã€prod ç”Ÿäº§ç¯å¢ƒ&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        choice<span style=color:#f92672>(</span>choices: <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;pig-gateway&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;pig-auth&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;pig-register&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;pig-upms-biz&#39;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#39;pig-codegen&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;pig-monitor&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;pig-sentinel-dashboard&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;pig-xxl-job-admin&#39;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#39;all&#39;</span><span style=color:#f92672>],</span> name: <span style=color:#e6db74>&#39;ServicesDeploy&#39;</span><span style=color:#f92672>,</span> description: <span style=color:#e6db74>&#39;è¯·é€‰æ‹©è¦æ„å»ºçš„æœåŠ¡,æ”¯æŒå•ä¸ªæœåŠ¡å‘å¸ƒæˆ–å…¨éƒ¨æœåŠ¡å‘å¸ƒ&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        choice<span style=color:#f92672>(</span>choices: <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;no&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;yes&#39;</span><span style=color:#f92672>],</span> name: <span style=color:#e6db74>&#39;sonarQube&#39;</span><span style=color:#f92672>,</span> description: <span style=color:#e6db74>&#39;æ˜¯å¦è¿›è¡ŒsonarQubeä»£ç è´¨é‡æ£€æŸ¥,é»˜è®¤ä¸ºno&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        string<span style=color:#f92672>(</span>name: <span style=color:#e6db74>&#39;MultiServicesBuild&#39;</span><span style=color:#f92672>,</span> defaultValue: <span style=color:#e6db74>&#39;no&#39;</span><span style=color:#f92672>,</span> description: <span style=color:#e6db74>&#39;è‡ªç”±ç»„åˆå‘å¸ƒæœåŠ¡,å¦‚å¡«å†™pig-gateway,pig-authç­‰,é»˜è®¤æ­¤é¡¹ä¸ç”Ÿæ•ˆ,å’ŒServicesDeployåªèƒ½é€‰å…¶ä¸€&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    environment <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        HARBOR_CREDENTIAL_ID <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;harbor-id&#39;</span>
</span></span><span style=display:flex><span>        GITLAB_CREDENTIAL_ID <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;gitlab&#39;</span>
</span></span><span style=display:flex><span>        KUBECONFIG_CREDENTIAL_ID <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;pig-kubeconfig&#39;</span>
</span></span><span style=display:flex><span>        REGISTRY <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;ip:ç«¯å£&#39;</span><span style=color:#75715e>//harboré•œåƒä»“åº“
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        HARBOR_NAMESPACE <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;pig-dev&#39;</span>
</span></span><span style=display:flex><span>        K8s_NAMESPACE <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;pig-dev&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    stages <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        stage <span style=color:#f92672>(</span><span style=color:#e6db74>&#39;æ‹‰å–ä»£ç &#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                checkout<span style=color:#f92672>(</span>scm<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;åˆå§‹åŒ–å˜é‡&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		  agent none
</span></span><span style=display:flex><span>		  steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			container<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;maven&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			  script <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				<span style=color:#75715e>//è‡ªç”±ç»„åˆå‘å¸ƒ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>				<span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${params.MultiServicesBuild}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;no&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				  ServicesBuild <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;${params.MultiServicesBuild}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>split</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;,&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>				  <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>service <span style=color:#66d9ef>in</span> ServicesBuild<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					println <span style=color:#e6db74>&#34;now got ${service}&#34;</span>
</span></span><span style=display:flex><span>				  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span><span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${params.ServicesDeploy}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;all&#34;</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>					ServicesBuildStr <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;pig-gateway,pig-auth,pig-register,pig-upms-biz,pig-codegen,pig-monitor,pig-sentinel-dashboard,pig-xxl-job-admin&#39;</span>
</span></span><span style=display:flex><span>					ServicesBuild <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;${ServicesBuildStr}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>split</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;,&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span><span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${params.ServicesDeploy}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;all&#34;</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>					ServicesBuild <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;${params.ServicesDeploy}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>split</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;,&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;sonarQubeä»£ç è´¨é‡æ£€æŸ¥&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                script <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${params.sonarQube}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;yes&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>service <span style=color:#66d9ef>in</span> ServicesBuild<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                          <span style=color:#66d9ef>def</span> workspace <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;pig-&#34;</span>
</span></span><span style=display:flex><span>                          println <span style=color:#e6db74>&#34;å½“å‰è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥æ˜¯ï¼š${service}&#34;</span>
</span></span><span style=display:flex><span>                          <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-gateway&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-auth&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-register&#34;</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                              workspace <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;${workspace}&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>().</span><span style=color:#a6e22e>split</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;-&#34;</span><span style=color:#f92672>)[</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>                           <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                          <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-codegen&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-monitor&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-sentinel-dashboard&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-xxl-job-admin&#34;</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                              workspace <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;pig-visual/&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                          <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                           <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-upms-biz&#34;</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                               workspace <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;pig-upms/&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                           <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                           <span style=color:#75715e>//å®šä¹‰å½“å‰Jenkinsçš„SonarQubeScannerå·¥å…·
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                           scannerHome <span style=color:#f92672>=</span> tool <span style=color:#e6db74>&#39;sonar-scanner&#39;</span>
</span></span><span style=display:flex><span>                           <span style=color:#75715e>//å¼•ç”¨å½“å‰JenkinsSonarQubeç¯å¢ƒ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                           withSonarQubeEnv<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;sonarqube9.4&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                               sh <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                               cd ${workspace}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                               ${scannerHome}/bin/sonar-scanner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                           &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>                           <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                       <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span><span style=color:#66d9ef>else</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        println <span style=color:#e6db74>&#34;æ˜¯noï¼Œè·³è¿‡sonarQubeä»£ç è´¨é‡æ£€æŸ¥&#34;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;æ‰“åŒ…&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			agent none
</span></span><span style=display:flex><span>			steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				container<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;maven&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				  script <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    sh <span style=color:#e6db74>&#34;mvn -Dmaven.test.skip=true clean package -P${params.Environments}&#34;</span>
</span></span><span style=display:flex><span>				  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;æ„å»ºé•œåƒ&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			agent none
</span></span><span style=display:flex><span>			steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				container<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;maven&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				  script <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>service <span style=color:#66d9ef>in</span> ServicesBuild<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                      <span style=color:#66d9ef>def</span> workspace <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;pig-&#34;</span>
</span></span><span style=display:flex><span>                      println <span style=color:#e6db74>&#34;å½“å‰æ„å»ºçš„é•œåƒæ˜¯ï¼š${service}&#34;</span>
</span></span><span style=display:flex><span>                      stage <span style=color:#f92672>(</span><span style=color:#e6db74>&#34;build ${service}&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                          <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-gateway&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-auth&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-register&#34;</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                              workspace <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;${workspace}&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>().</span><span style=color:#a6e22e>split</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;-&#34;</span><span style=color:#f92672>)[</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>                           <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                          <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-codegen&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-monitor&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-sentinel-dashboard&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-xxl-job-admin&#34;</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                              workspace <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;pig-visual/&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                          <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                           <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-upms-biz&#34;</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                               workspace <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;pig-upms/&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                           <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                        sh <span style=color:#e6db74>&#34;cd ${workspace} &amp;&amp; docker build -f Dockerfile -t $REGISTRY/$HARBOR_NAMESPACE/${service}:$BUILD_NUMBER .&#34;</span>
</span></span><span style=display:flex><span>                      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;é•œåƒæ¨é€&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			agent none
</span></span><span style=display:flex><span>			steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				container<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;maven&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				  script <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>service <span style=color:#66d9ef>in</span> ServicesBuild<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					  println <span style=color:#e6db74>&#34;å½“å‰æ¨é€çš„é•œåƒæ˜¯ï¼š${service}&#34;</span>
</span></span><span style=display:flex><span>					  stage <span style=color:#f92672>(</span><span style=color:#e6db74>&#34;push ${service}&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						withCredentials<span style=color:#f92672>([</span>usernamePassword<span style=color:#f92672>(</span>passwordVariable <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;HARBOR_PASSWORD&#39;</span> <span style=color:#f92672>,</span>usernameVariable <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;HARBOR_USERNAME&#39;</span> <span style=color:#f92672>,</span>credentialsId <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;$HARBOR_CREDENTIAL_ID&#34;</span> <span style=color:#f92672>,)])</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>							sh <span style=color:#e6db74>&#39;echo &#34;$HARBOR_PASSWORD&#34; | docker login $REGISTRY -u &#34;$HARBOR_USERNAME&#34; --password-stdin&#39;</span>
</span></span><span style=display:flex><span>							sh <span style=color:#e6db74>&#34;docker push  $REGISTRY/$HARBOR_NAMESPACE/${service}:$BUILD_NUMBER&#34;</span>
</span></span><span style=display:flex><span>						<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>					  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;æ¨é€é•œåƒä¹‹latest&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			agent none
</span></span><span style=display:flex><span>			steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				container<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;maven&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				  script <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>service <span style=color:#66d9ef>in</span> ServicesBuild<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					  println <span style=color:#e6db74>&#34;å½“å‰æ¨é€çš„latesté•œåƒæ˜¯ï¼š${service}&#34;</span>
</span></span><span style=display:flex><span>					  stage <span style=color:#f92672>(</span><span style=color:#e6db74>&#34;pushLatest ${service}&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						sh <span style=color:#e6db74>&#34;docker tag  $REGISTRY/$HARBOR_NAMESPACE/${service}:$BUILD_NUMBER $REGISTRY/$HARBOR_NAMESPACE/${service}:latest&#34;</span>
</span></span><span style=display:flex><span>						sh <span style=color:#e6db74>&#34;docker push  $REGISTRY/$HARBOR_NAMESPACE/${service}:latest&#34;</span>
</span></span><span style=display:flex><span>					  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;éƒ¨ç½²åˆ°devç¯å¢ƒ&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			 steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				 container <span style=color:#f92672>(</span><span style=color:#e6db74>&#39;maven&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>				   script <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>					 <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>service <span style=color:#66d9ef>in</span> ServicesBuild<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                       <span style=color:#75715e>//è‡ªå®šä¹‰çš„å…¨å±€å˜é‡,ä¹Ÿå°±æ˜¯æ•´ä¸ªæµæ°´çº¿å¯ä»¥å»ä½¿ç”¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                       env<span style=color:#f92672>.</span><span style=color:#a6e22e>APP_NAME</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;${service}&#34;</span>
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-gateway&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>NODEPORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>31201</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>PORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>9999</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-auth&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>NODEPORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>31202</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>PORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-register&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>NODEPORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>31203</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>PORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>8848</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-upms-biz&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>NODEPORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>31204</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>PORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>4000</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-codegen&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>NODEPORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>31205</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>PORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5002</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-monitor&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>NODEPORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>31206</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>PORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5001</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-sentinel-dashboard&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>NODEPORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>31207</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>PORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5003</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-xxl-job-admin&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>NODEPORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>31208</span>
</span></span><span style=display:flex><span>                          env<span style=color:#f92672>.</span><span style=color:#a6e22e>PORT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5004</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>					   stage <span style=color:#f92672>(</span><span style=color:#e6db74>&#34;deploy ${service}&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>						println <span style=color:#e6db74>&#34;å³å°†éƒ¨ç½²çš„æœåŠ¡æ˜¯ $APP_NAME&#34;</span>
</span></span><span style=display:flex><span>						   withCredentials<span style=color:#f92672>([</span>
</span></span><span style=display:flex><span>							   kubeconfigFile<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>							   credentialsId: env<span style=color:#f92672>.</span><span style=color:#a6e22e>KUBECONFIG_CREDENTIAL_ID</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>							   variable: <span style=color:#e6db74>&#39;KUBECONFIG&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>							   <span style=color:#f92672>])</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                                   <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-register&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                                       sh <span style=color:#e6db74>&#34;envsubst &lt; deploy/${params.Environments}/nacos-devops.yaml | kubectl apply -f -&#34;</span>
</span></span><span style=display:flex><span>                                   <span style=color:#f92672>}</span><span style=color:#66d9ef>else</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                                       sh <span style=color:#e6db74>&#34;envsubst &lt; deploy/${params.Environments}/devops.yaml | kubectl apply -f -&#34;</span>
</span></span><span style=display:flex><span>                                   <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>						   <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>					   <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>					 <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				   <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>				 <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>			 <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><blockquote><p>é€šè¿‡ ${service} æ¥åˆ¤æ–­æœ€ç»ˆé€‰æ‹©å“ªä¸ª deploy æ¥éƒ¨ç½²ã€‚</p></blockquote><ol start=3><li>ä»£ç ä¸­åˆ›å»º devops.yaml éƒ¨ç½²æ–‡ä»¶ï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/bbbda9e8-06f4-40e8-960e-c0cf5544d77b.png alt></p><p>å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>$K8s_NAMESPACE</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>progressDeadlineSeconds</span>: <span style=color:#ae81ff>600</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>$REGISTRY/$HARBOR_NAMESPACE/$APP_NAME:$BUILD_NUMBER</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>imagePullPolicy</span>: <span style=color:#ae81ff>Always</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>$PORT</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>terminationMessagePath</span>: <span style=color:#ae81ff>/dev/termination-log</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>terminationMessagePolicy</span>: <span style=color:#ae81ff>File</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dnsPolicy</span>: <span style=color:#ae81ff>ClusterFirst</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Always</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>terminationGracePeriodSeconds</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>$K8s_NAMESPACE</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>http</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>$PORT</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>$PORT</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>$NODEPORT</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>sessionAffinity</span>: <span style=color:#ae81ff>None</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span></code></pre></div><ol start=4><li>ä»£ç ä¸­åˆ›å»º nacos-devops.yaml éƒ¨ç½²æ–‡ä»¶ï¼š</li></ol><p>ç”±äº pig-register æœåŠ¡æ˜¯ nacos æœåŠ¡ï¼Œå…¶ K8s çš„ yaml éƒ¨ç½²åº”è¯¥å’Œå…¶ä»–æœåŠ¡ä¸åŒï¼Œé‡‡ç”¨ StatefulSet æ¥éƒ¨ç½²ä¸”å‰¯æœ¬æ•°ä¸º 3ï¼Œ, å¹¶æ·»åŠ ç›¸å¯¹åº”çš„ç«¯å£ã€‚</p><p>å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>StatefulSet</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>$K8s_NAMESPACE</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>serviceName</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>pod.alpha.kubernetes.io/initialized</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>podAntiAffinity</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>labelSelector</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>matchExpressions</span>:
</span></span><span style=display:flex><span>                  - <span style=color:#f92672>key</span>: <span style=color:#e6db74>&#34;app&#34;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>operator</span>: <span style=color:#ae81ff>In</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>                      - <span style=color:#ae81ff>nacos</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>topologyKey</span>: <span style=color:#e6db74>&#34;kubernetes.io/hostname&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>$REGISTRY/$HARBOR_NAMESPACE/$APP_NAME:$BUILD_NUMBER</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>imagePullPolicy</span>: <span style=color:#ae81ff>Always</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>8848</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>client-port</span>
</span></span><span style=display:flex><span>            - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>9848</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>client-rpc</span>
</span></span><span style=display:flex><span>            - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>9849</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>raft-rpc</span>
</span></span><span style=display:flex><span>            - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>7848</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>old-raft-rpc</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>terminationMessagePath</span>: <span style=color:#ae81ff>/dev/termination-log</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>terminationMessagePolicy</span>: <span style=color:#ae81ff>File</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dnsPolicy</span>: <span style=color:#ae81ff>ClusterFirst</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Always</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>$K8s_NAMESPACE</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>service.alpha.kubernetes.io/tolerate-unready-endpoints</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8848</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>server</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>8848</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>$NODEPORT</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>9848</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>client-rpc</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>9848</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>9849</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>raft-rpc</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>9849</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>### å…¼å®¹1.4.xç‰ˆæœ¬çš„é€‰ä¸¾ç«¯å£</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>7848</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>old-raft-rpc</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>7848</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>sessionAffinity</span>: <span style=color:#ae81ff>None</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span></code></pre></div><blockquote><p>åç»­è¿™äº›æ–‡ä»¶éƒ½å¯å¯é‡‡ç”¨å…±äº«ä»“åº“æ¥ç»Ÿä¸€ç®¡ç†ã€‚</p></blockquote><ol start=5><li>å‘å¸ƒ</li></ol><p>ç”±äº pig-gatewayã€pig-auth å’Œ pig-upms-biz ç­‰å…¶å®ƒæœåŠ¡éƒ½æ˜¯ä¾èµ– nacos(pig-register) æœåŠ¡çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå‘å¸ƒ pig-register æœåŠ¡ã€‚</p><p>è¿›å…¥ DevOps é¡¹ç›® -> pig-dev -> pig-backend-dev -> è¿è¡Œã€‚</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/f39d7356-3a60-47c5-9fa8-a80a18832c71.png alt></p><blockquote><p>è¿™é‡Œ KubeSphere3.3.0 ç‰ˆæœ¬ä¸­æœ‰ä¸ª bugï¼Œchoice ç±»å‹çš„è¿˜æ˜¯è¯†åˆ«ä¸º stringï¼Œæ‰€ä»¥æš‚æ—¶åªèƒ½æ‰‹åŠ¨è¾“å…¥ã€‚æ­¤ bug å°†ä¼šåœ¨ 3.3.1 ç‰ˆæœ¬ä¿®å¤ã€‚</p></blockquote><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/04898bd6-11d6-4275-b309-239a178d9a0f.png alt></p><p>æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/5343ffc0-697f-477a-b72b-33ba709ddd19.png alt></p><p>æŸ¥çœ‹æ—¥å¿—ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/92bba4cb-d49b-4c5b-94c8-4e1e59a24693.png alt></p><p>åœ¨é¡¹ç›® -> åº”ç”¨è´Ÿè½½ -> æœåŠ¡ä¸‹æŸ¥çœ‹åˆšå‘å¸ƒçš„ pig-register æœåŠ¡ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/ad6a86ae-14c6-43e5-8c48-a62ae0f884e7.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/7f9892f1-545a-4c11-a10a-c389b0547854.png alt></p><p>è¿›å…¥ DevOps é¡¹ç›® -> pig-dev -> pig-backend-dev -> è¿è¡Œ -> é€‰æ‹©è‡ªç”±ç»„åˆå‘å¸ƒï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/f3cd8d56-db90-4819-9cd0-b67974a0a0f4.png alt></p><p>å‘å¸ƒå®ŒæˆæŸ¥çœ‹æœåŠ¡ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/253edbb2-212c-48be-aa18-46b9eef45908.png alt></p><blockquote><p>è‡³æ­¤å·²ç»å®Œæˆ Pig åç«¯æ— çŠ¶æ€æœåŠ¡çš„éƒ¨ç½²ã€‚</p></blockquote><h2 id=éƒ¨ç½²-pig-å‰ç«¯æ— çŠ¶æ€æœåŠ¡>éƒ¨ç½² Pig å‰ç«¯æ— çŠ¶æ€æœåŠ¡</h2><ol><li>æ–°å»º pig å‰ç«¯æµæ°´çº¿ , å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/83ee947b-a951-4fbc-8cd1-95481ba50303.png alt></p><p>é€‰æ‹©ä»£ç ä»“åº“ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/3e0305e6-610e-464d-baf2-f83afa86c507.png alt></p><p>ç¼–è¾‘è®¾ç½®ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/55c1d451-a031-454a-aff0-abf4c62bf9de.png alt></p><ol start=2><li>ä»£ç ä¸­åˆ›å»º Jenkinsfile æ–‡ä»¶ï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/eb803dba-adba-4037-8894-e0d30752f9bc.png alt></p><p>å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>pipeline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  agent <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    node <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      label <span style=color:#e6db74>&#39;nodejs&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    parameters <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        choice<span style=color:#f92672>(</span>choices: <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;dev&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;test&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;pre&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;pre2&#39;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#39;prod&#39;</span><span style=color:#f92672>],</span> name: <span style=color:#e6db74>&#39;Environments&#39;</span><span style=color:#f92672>,</span> description: <span style=color:#e6db74>&#39;è¯·é€‰æ‹©è¦å‘å¸ƒçš„ç¯å¢ƒï¼šdevå¼€å‘ç¯å¢ƒã€testæµ‹è¯•ç¯å¢ƒã€preé¢„å‘å¸ƒç¯å¢ƒã€pre2ç°åº¦ç¯å¢ƒã€prod ç”Ÿäº§ç¯å¢ƒ&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        choice<span style=color:#f92672>(</span>choices: <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;no&#39;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#39;yes&#39;</span><span style=color:#f92672>],</span> name: <span style=color:#e6db74>&#39;sonarQube&#39;</span><span style=color:#f92672>,</span> description: <span style=color:#e6db74>&#39;æ˜¯å¦è¿›è¡ŒsonarQubeä»£ç è´¨é‡æ£€æŸ¥,é»˜è®¤ä¸ºno&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    environment <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        HARBOR_CREDENTIAL_ID <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;harbor-id&#39;</span>
</span></span><span style=display:flex><span>        GITLAB_CREDENTIAL_ID <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;gitlab&#39;</span>
</span></span><span style=display:flex><span>        KUBECONFIG_CREDENTIAL_ID <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;pig-kubeconfig&#39;</span>
</span></span><span style=display:flex><span>        REGISTRY <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;ip:ç«¯å£&#39;</span><span style=color:#75715e>//harboré•œåƒä»“é‡Œ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        HARBOR_NAMESPACE <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;pig-dev&#39;</span>
</span></span><span style=display:flex><span>        APP_NAME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;pig-front&#39;</span>
</span></span><span style=display:flex><span>        K8s_NAMESPACE <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;pig-dev&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    stages <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        stage <span style=color:#f92672>(</span><span style=color:#e6db74>&#39;æ‹‰å–ä»£ç &#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                container<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;nodejs&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                   checkout<span style=color:#f92672>(</span>scm<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;sonarQubeä»£ç è´¨é‡æ£€æŸ¥&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                script <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${params.sonarQube}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;yes&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                       println <span style=color:#e6db74>&#34;å½“å‰è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥æ˜¯ï¼š${APP_NAME}&#34;</span>
</span></span><span style=display:flex><span>                       <span style=color:#75715e>//å®šä¹‰å½“å‰Jenkinsçš„SonarQubeScannerå·¥å…·
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                       scannerHome <span style=color:#f92672>=</span> tool <span style=color:#e6db74>&#39;sonar-scanner&#39;</span>
</span></span><span style=display:flex><span>                       <span style=color:#75715e>//å¼•ç”¨å½“å‰JenkinsSonarQubeç¯å¢ƒ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                       withSonarQubeEnv<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;sonarqube9.4&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                           sh <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                           cd .
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                           ${scannerHome}/bin/sonar-scanner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                       &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>                       <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span><span style=color:#66d9ef>else</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        println <span style=color:#e6db74>&#34;æ˜¯noï¼Œè·³è¿‡sonarQubeä»£ç è´¨é‡æ£€æŸ¥&#34;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;é¡¹ç›®ç¼–è¯‘&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            agent none
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                container<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;nodejs&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    sh <span style=color:#e6db74>&#39;node -v&#39;</span>
</span></span><span style=display:flex><span>                    sh <span style=color:#e6db74>&#39;npm -v&#39;</span>
</span></span><span style=display:flex><span>                    sh <span style=color:#e6db74>&#39;npm install&#39;</span>
</span></span><span style=display:flex><span>                    sh <span style=color:#e6db74>&#39;npm run build:docker&#39;</span>
</span></span><span style=display:flex><span>                    sh <span style=color:#e6db74>&#39;ls&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;æ„å»ºé•œåƒ&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            agent none
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                container<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;nodejs&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    sh <span style=color:#e6db74>&#39;ls&#39;</span>
</span></span><span style=display:flex><span>                    sh <span style=color:#e6db74>&#39;cd ./docker &amp;&amp; docker  build  -t $REGISTRY/$HARBOR_NAMESPACE/$APP_NAME:$APP_NAME-$BUILD_NUMBER .&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;é•œåƒæ¨é€&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            agent none
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                container<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;nodejs&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    withCredentials<span style=color:#f92672>([</span>usernamePassword<span style=color:#f92672>(</span>passwordVariable <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;HARBOR_PASSWORD&#39;</span> <span style=color:#f92672>,</span>usernameVariable <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;HARBOR_USERNAME&#39;</span> <span style=color:#f92672>,</span>credentialsId <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;$HARBOR_CREDENTIAL_ID&#34;</span> <span style=color:#f92672>,)])</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        sh <span style=color:#e6db74>&#39;echo &#34;$HARBOR_PASSWORD&#34; | docker login $REGISTRY -u &#34;$HARBOR_USERNAME&#34; --password-stdin&#39;</span>
</span></span><span style=display:flex><span>                        sh <span style=color:#e6db74>&#39;docker push  $REGISTRY/$HARBOR_NAMESPACE/$APP_NAME:$APP_NAME-$BUILD_NUMBER&#39;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;æ¨é€é•œåƒä¹‹latest&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            agent none
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                container<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;nodejs&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                  sh <span style=color:#e6db74>&#39;docker tag  $REGISTRY/$HARBOR_NAMESPACE/$APP_NAME:$APP_NAME-$BUILD_NUMBER $REGISTRY/$HARBOR_NAMESPACE/$APP_NAME:latest &#39;</span>
</span></span><span style=display:flex><span>                  sh <span style=color:#e6db74>&#39;docker push  $REGISTRY/$HARBOR_NAMESPACE/$APP_NAME:latest &#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;éƒ¨ç½²åˆ°devç¯å¢ƒ&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>              steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                  container <span style=color:#f92672>(</span><span style=color:#e6db74>&#39;nodejs&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                       withCredentials<span style=color:#f92672>([</span>
</span></span><span style=display:flex><span>                           kubeconfigFile<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                           credentialsId: env<span style=color:#f92672>.</span><span style=color:#a6e22e>KUBECONFIG_CREDENTIAL_ID</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                           variable: <span style=color:#e6db74>&#39;KUBECONFIG&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                           <span style=color:#f92672>])</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                           sh <span style=color:#e6db74>&#34;envsubst &lt; deploy/${params.Environments}/devops.yaml | kubectl apply -f -&#34;</span>
</span></span><span style=display:flex><span>                       <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ol start=3><li>ä»£ç ä¸­åˆ›å»º devops.yaml éƒ¨ç½²æ–‡ä»¶ï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/bc576a7b-4ef8-4e10-ab69-dbd3bd4ff4fb.png alt></p><p>å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>$K8s_NAMESPACE</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>progressDeadlineSeconds</span>: <span style=color:#ae81ff>600</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>pig-front</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>strategy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>rollingUpdate</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>maxSurge</span>: <span style=color:#ae81ff>50</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>maxUnavailable</span>: <span style=color:#ae81ff>50</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>RollingUpdate</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>pig-front</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>$REGISTRY/$HARBOR_NAMESPACE/$APP_NAME:$APP_NAME-$BUILD_NUMBER</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>imagePullPolicy</span>: <span style=color:#ae81ff>Always</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pig-front-end</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>terminationMessagePath</span>: <span style=color:#ae81ff>/dev/termination-log</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>terminationMessagePolicy</span>: <span style=color:#ae81ff>File</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dnsPolicy</span>: <span style=color:#ae81ff>ClusterFirst</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Always</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>terminationGracePeriodSeconds</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>$K8s_NAMESPACE</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>http</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>31200</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>sessionAffinity</span>: <span style=color:#ae81ff>None</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span></code></pre></div><blockquote><p>åç»­è¿™äº›æ–‡ä»¶éƒ½å¯å¯é‡‡ç”¨å…±äº«ä»“åº“æ¥ç»Ÿä¸€ç®¡ç†ã€‚</p></blockquote><ol start=4><li>å‘å¸ƒï¼š</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/78390f9f-be17-4205-8d75-a9f63745585c.png alt></p><blockquote><p>è¿™é‡Œ KubeSphere3.3.0 ç‰ˆæœ¬ä¸­æœ‰ä¸ª bugï¼Œchoice ç±»å‹çš„è¿˜æ˜¯è¯†åˆ«ä¸º stringï¼Œæ­¤ bug å°†ä¼šåœ¨ 3.3.1 ç‰ˆæœ¬ä¿®å¤ã€‚</p></blockquote><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/4d5a28e1-4176-430d-9101-a8d723a95333.png alt></p><p>æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/25565d31-311d-4432-aa25-51692599a687.png alt></p><p>æŸ¥çœ‹æ—¥å¿—ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/1f9e7421-127d-403f-8bb2-175327e85513.png alt></p><p>åœ¨é¡¹ç›® -> åº”ç”¨è´Ÿè½½ -> æœåŠ¡ä¸‹æŸ¥çœ‹åˆšå‘å¸ƒçš„ pig-front æœåŠ¡ã€‚</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/73125a61-53fa-477a-b0ec-cea99cc396f3.png alt></p><p>è‡³æ­¤æ‰€æœ‰çš„æœåŠ¡å‡å·²å‘å¸ƒå®Œæˆã€‚</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/b17e2d0b-707c-4316-bff8-73471915102e.png alt></p><h3 id=åˆ©ç”¨-kubesphere-ä¸­çš„-jenkins-å‘å¸ƒ>åˆ©ç”¨ KubeSphere ä¸­çš„ Jenkins å‘å¸ƒ</h3><p>è®¿é—® <code>ip:30180</code>ï¼ˆè´¦å·ï¼šadminï¼Œå¯†ç ï¼šP@88w0rdï¼‰ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/826b327e-afba-4213-b25b-25988c02fe8c.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/4b51e14f-4e77-41c3-a260-b04e70adb29d.png alt></p><p>å¯ä»¥æ‰“å¼€ Blue Ocean æŸ¥çœ‹çŠ¶æ€ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/47a07a33-9831-4ac3-b6bf-4ec161ce0130.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/a5324900-d31a-42b8-b772-61c4a9e34751.png alt></p><h2 id=é€šè¿‡-nodeport-æ–¹å¼æš´éœ²é›†ç¾¤å†…éƒ¨å®¹å™¨æœåŠ¡>é€šè¿‡ NodePort æ–¹å¼æš´éœ²é›†ç¾¤å†…éƒ¨å®¹å™¨æœåŠ¡</h2><p>NodePort è®¾è®¡ä¹‹åˆå°±ä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒæš´éœ²æœåŠ¡ï¼Œæ‰€ä»¥é»˜è®¤ç«¯å£éƒ½æ˜¯ä¸€äº›å¤§ç«¯å£ï¼Œå¦‚ä¸‹ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/8747dd92-3fca-449e-8e0f-5ed8adcc0deb.png alt></p><p>è¾“å…¥ node ip + 31200 è®¿é—®ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/d4499704-061d-4a91-8a38-66b207e5c44c.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/f7ef0f6a-b4b1-4537-8856-9d232eaa81d8.png alt></p><h2 id=ä¼˜åŒ–å’Œæ”¹è¿›>ä¼˜åŒ–å’Œæ”¹è¿›</h2><h3 id=é€šè¿‡æ¢é’ˆä¼˜é›…çš„è§£å†³éƒ¨ç½²è¿‡ç¨‹ä¸­æœåŠ¡å¹³æ»‘è¿‡æ¸¡é—®é¢˜>é€šè¿‡æ¢é’ˆä¼˜é›…çš„è§£å†³éƒ¨ç½²è¿‡ç¨‹ä¸­æœåŠ¡å¹³æ»‘è¿‡æ¸¡é—®é¢˜</h3><p>è‹¥æ˜¯åªæœ‰ä¸€ä¸ªå‰¯æœ¬çš„æƒ…å†µä¸‹ï¼Œæ–°çš„ Pod å¯åŠ¨æˆåŠŸæ—¶ï¼Œå¼€å§‹åœæ‰æ—§çš„ Pod, ä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„ running çŠ¶æ€ï¼Œå¹¶ä¸ä»¥ä¸ºç€æˆ‘ä»¬çš„æœåŠ¡æ˜¯æ­£å¸¸çš„ã€‚è‹¥æ˜¯è¿™ä¸ªæ—¶å€™æ€æ­»æ—§çš„ Pod, é‚£ä¹ˆå°†æœ‰æ–°çš„ Pod æ¥å—è¯·æ±‚ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå‡ºç°æœåŠ¡çŸ­æš‚ä¸å¯ç”¨çŠ¶æ€ï¼Œæ‰€ä»¥éœ€è¦å¢åŠ æ¢æ¥ç¡®ä¿æˆ‘ä»¬çš„æœåŠ¡å·²ç»æ­£å¸¸äº†ï¼Œå¯ä»¥æ¥æ”¶å¹¶å¤„ç†ç”¨æˆ·è¯·æ±‚ã€‚æˆ‘ä»¬å¸¸ç”¨çš„æ¢é’ˆå¦‚ä¸‹ï¼š</p><h4 id=livenessprobeå­˜æ´»æ€§æ¢æµ‹>livenessProbeï¼šå­˜æ´»æ€§æ¢æµ‹</h4><p>è®¸å¤šåº”ç”¨ç¨‹åºç»è¿‡é•¿æ—¶é—´è¿è¡Œï¼Œæœ€ç»ˆè¿‡æ¸¡åˆ°æ— æ³•è¿è¡Œçš„çŠ¶æ€ï¼Œé™¤äº†é‡å¯ï¼Œæ— æ³•æ¢å¤ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒK8s ä¼šå‘ç°åº”ç”¨ç¨‹åºå·²ç»ç»ˆæ­¢ï¼Œç„¶åé‡å¯åº”ç”¨ç¨‹åº podã€‚æœ‰æ—¶åº”ç”¨ç¨‹åºå¯èƒ½å› ä¸ºæŸäº›åŸå› ï¼ˆåç«¯æœåŠ¡æ•…éšœç­‰ï¼‰å¯¼è‡´æš‚æ—¶æ— æ³•å¯¹å¤–æä¾›æœåŠ¡ï¼Œä½†åº”ç”¨è½¯ä»¶æ²¡æœ‰ç»ˆæ­¢ï¼Œå¯¼è‡´ K8s æ— æ³•éš”ç¦»æœ‰æ•…éšœçš„ podï¼Œè°ƒç”¨è€…å¯èƒ½ä¼šè®¿é—®åˆ°æœ‰æ•…éšœçš„ podï¼Œå¯¼è‡´ä¸šåŠ¡ä¸ç¨³å®šã€‚K8s æä¾› livenessProbe æ¥æ£€æµ‹å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œå¹¶ä¸”å¯¹ç›¸åº”çŠ¶å†µè¿›è¡Œç›¸åº”çš„è¡¥æ•‘æªæ–½ã€‚</p><h4 id=readinessprobeå°±ç»ªæ€§æ¢æµ‹>readinessProbeï¼šå°±ç»ªæ€§æ¢æµ‹</h4><p>åœ¨æ²¡æœ‰é…ç½® readinessProbe çš„èµ„æºå¯¹è±¡ä¸­ï¼Œpod ä¸­çš„å®¹å™¨å¯åŠ¨å®Œæˆåï¼Œå°±è®¤ä¸º pod ä¸­çš„åº”ç”¨ç¨‹åºå¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ï¼Œè¯¥ pod å°±ä¼šåŠ å…¥ç›¸å¯¹åº”çš„ serviceï¼Œå¯¹å¤–æä¾›æœåŠ¡ã€‚ä½†æœ‰æ—¶ä¸€äº›åº”ç”¨ç¨‹åºå¯åŠ¨åï¼Œéœ€è¦è¾ƒé•¿æ—¶é—´çš„åŠ è½½æ‰èƒ½å¯¹å¤–æœåŠ¡ï¼Œå¦‚æœè¿™æ—¶å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ‰§è¡Œç»“æœå¿…ç„¶æ— æ³•è¾¾åˆ°é¢„æœŸæ•ˆæœï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚æ¯”å¦‚ä½¿ç”¨ tomcat çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå¹¶ä¸æ˜¯ç®€å•åœ°è¯´ tomcat å¯åŠ¨æˆåŠŸå°±å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡çš„ï¼Œè¿˜éœ€è¦ç­‰å¾… spring å®¹å™¨åˆå§‹åŒ–ï¼Œæ•°æ®åº“è¿æ¥ä¸Šç­‰ç­‰ã€‚</p><p><strong>1) SpringBoot çš„ actuator</strong></p><p>å…¶å® actuator æ˜¯ç”¨æ¥å¸®åŠ©ç”¨æˆ·ç›‘æ§å’Œæ“ä½œ SprinBoot åº”ç”¨çš„ï¼Œè¿™äº›ç›‘æ§å’Œæ“ä½œéƒ½å¯ä»¥é€šè¿‡ http è¯·æ±‚å®ç°ï¼Œå¦‚ä¸‹å›¾ï¼Œhttp://localhost:7777/actuator/health åœ°å€è¿”å›çš„æ˜¯åº”ç”¨çš„å¥åº·çŠ¶æ€ã€‚</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/20091db7-a6c4-4d0a-a77c-6372b894554e.png alt></p><p>éœ€å¼•ä»¥ä¸‹ maven:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- å¼•å…¥Actuatorç›‘æ§ä¾èµ– --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-actuator<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><blockquote><p>åœ¨ SpringBoot-2.3 ç‰ˆæœ¬ä¸­ï¼Œactuator æ–°å¢äº†ä¸¤ä¸ªåœ°å€ï¼š/actuator/health/liveness å’Œ /actuator/health/readinessï¼Œå‰è€…ç”¨ä½œ Kubernetes çš„å­˜æ´»æ¢é’ˆï¼Œåè€…ç”¨ä½œ Kubernetes çš„å°±ç»ªæ¢é’ˆ , éœ€è¦å…ˆåœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ï¼Œå¦‚ä¸‹ï¼š</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>management</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>endpoint</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>health</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>probes</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>health</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>livenessstate</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>readinessstate</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><blockquote><p>/actuator/health/ å’Œ /actuator/health/ æ˜¯é»˜è®¤å¼€å¯çš„ã€‚</p></blockquote><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/babcd72f-6e6d-46c3-a93d-d87b9a847d1f.png alt></p><p>åˆ©ç”¨ SpringBoot çš„æ¥å£æ¥ä½œä¸ºå®¹å™¨æ¢é’ˆçš„å¥åº·æ£€æµ‹ , æŒ‰ç…§å¦‚ä¸‹å°±å¯ä»¥ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>readinessProbe</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span><span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>timeoutSeconds</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span><span style=color:#f92672>failureThreshold</span>: <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span><span style=color:#f92672>httpGet</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>scheme</span>: <span style=color:#ae81ff>HTTP</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>9999</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/actuator/health/readiness</span>
</span></span><span style=display:flex><span><span style=color:#f92672>livenessProbe</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span><span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>timeoutSeconds</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span><span style=color:#f92672>failureThreshold</span>: <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span><span style=color:#f92672>httpGet</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>scheme</span>: <span style=color:#ae81ff>HTTP</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>9999</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/actuator/health/liveness</span>
</span></span></code></pre></div><p><strong>2) pig åç«¯é¡¹ç›®å¢åŠ æ¢é’ˆ</strong></p><p>pig é¡¹ç›®å…¨å±€æ‰€æœ‰çš„æ¨¡å—éƒ½ä¼šå¼•å…¥ Actuator ç›‘æ§ä¾èµ–ï¼Œå¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--ç›‘æ§--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-actuator<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>è°ƒæ•´ pig é¡¹ç›®åç«¯ devops.yaml, å¢åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>...
</span></span><span style=display:flex><span>          <span style=color:#f92672>readinessProbe</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>timeoutSeconds</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>httpGet</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>scheme</span>: <span style=color:#ae81ff>HTTP</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>port</span>: <span style=color:#ae81ff>$PORT</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/actuator/health</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>livenessProbe</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>40</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>timeoutSeconds</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>httpGet</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>scheme</span>: <span style=color:#ae81ff>HTTP</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>port</span>: <span style=color:#ae81ff>$PORT</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/actuator/health</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>å®Œæ•´ devops.yaml å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>$K8s_NAMESPACE</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>progressDeadlineSeconds</span>: <span style=color:#ae81ff>600</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>$REGISTRY/$HARBOR_NAMESPACE/$APP_NAME:$BUILD_NUMBER</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>imagePullPolicy</span>: <span style=color:#ae81ff>Always</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>$PORT</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>terminationMessagePath</span>: <span style=color:#ae81ff>/dev/termination-log</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>terminationMessagePolicy</span>: <span style=color:#ae81ff>File</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>readinessProbe</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>90</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>timeoutSeconds</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>failureThreshold</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>httpGet</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>scheme</span>: <span style=color:#ae81ff>HTTP</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>port</span>: <span style=color:#ae81ff>$PORT</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/actuator/health</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>livenessProbe</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>timeoutSeconds</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>failureThreshold</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>httpGet</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>scheme</span>: <span style=color:#ae81ff>HTTP</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>port</span>: <span style=color:#ae81ff>$PORT</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/actuator/health</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dnsPolicy</span>: <span style=color:#ae81ff>ClusterFirst</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Always</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>terminationGracePeriodSeconds</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>$K8s_NAMESPACE</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>http</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>$PORT</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>$PORT</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>$NODEPORT</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>sessionAffinity</span>: <span style=color:#ae81ff>None</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span></code></pre></div><blockquote><p>æ³¨ï¼š /actuator/health/readiness å’Œ /actuator/health/liveness ä¹Ÿå¯ä»¥ç”¨ï¼Œéœ€åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ã€‚è‹¥æ˜¯å†…å­˜ã€CPU é™åˆ¶è¿‡ä½ï¼Œéœ€è¦è°ƒæ•´ initialDelaySeconds æ—¶é—´ï¼Œå¦åˆ™ä¼šå‡ºç°è¿˜æœªå¯åŠ¨æˆåŠŸï¼Œå°±å¼€å§‹æ¢æµ‹ï¼Œä¼šè¿›å…¥å¾ªç¯ï¼Œç›´åˆ°æ¢æµ‹å¤±è´¥ï¼ˆå°±æ˜¯ failureThreshold å®šä¹‰çš„æ¬¡æ•°ï¼‰ï¼Œè¦æŒæ¡å¥½è¿™ä¸ªæ—¶é—´çš„åº¦ã€‚</p></blockquote><p>é‡æ–°å‘å¸ƒ pig-geteway æµ‹è¯•ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/ebea2b43-16a0-4d60-b1c3-b1b8a06e504c.png alt></p><p>æ­£åœ¨è¿›è¡Œæ¢æµ‹ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/ee68567a-983e-4b29-b8ea-2661d8d72b29.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/a8bb2922-77d2-4e93-9bc6-92a2f7d3096c.png alt></p><p>æ¢æµ‹æˆåŠŸï¼Œæ–°çš„ Pod å¯ç”¨ï¼Œæ—§çš„ Pod åˆ é™¤ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/17f70f57-b232-41cc-b68d-f8b205c333f1.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/aa6a123b-6d53-42c6-a1c9-70bff246ab19.png alt></p><p><strong>3) pig å‰ç«¯é¡¹ç›®å¢åŠ æ¢é’ˆ</strong></p><p>å‰ç«¯é¡¹ç›®æˆ‘ä»¬ç›´æ¥æ¢æµ‹ Nginx çš„ç«¯å£å³å¯ã€‚è°ƒæ•´ devops.yaml, å¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>          <span style=color:#f92672>readinessProbe</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>timeoutSeconds</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>httpGet</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>scheme</span>: <span style=color:#ae81ff>HTTP</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>livenessProbe</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>timeoutSeconds</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>httpGet</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>scheme</span>: <span style=color:#ae81ff>HTTP</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span></code></pre></div><p>å®Œæ•´ devops.yaml å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>$K8s_NAMESPACE</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>progressDeadlineSeconds</span>: <span style=color:#ae81ff>600</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>pig-front</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>strategy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>rollingUpdate</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>maxSurge</span>: <span style=color:#ae81ff>50</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>maxUnavailable</span>: <span style=color:#ae81ff>50</span><span style=color:#ae81ff>%</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>RollingUpdate</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>pig-front</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>$REGISTRY/$HARBOR_NAMESPACE/$APP_NAME:$APP_NAME-$BUILD_NUMBER</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>imagePullPolicy</span>: <span style=color:#ae81ff>Always</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pig-front-end</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>terminationMessagePath</span>: <span style=color:#ae81ff>/dev/termination-log</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>terminationMessagePolicy</span>: <span style=color:#ae81ff>File</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>readinessProbe</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>timeoutSeconds</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>httpGet</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>scheme</span>: <span style=color:#ae81ff>HTTP</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>livenessProbe</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>initialDelaySeconds</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>periodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>timeoutSeconds</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>httpGet</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>scheme</span>: <span style=color:#ae81ff>HTTP</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dnsPolicy</span>: <span style=color:#ae81ff>ClusterFirst</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Always</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>terminationGracePeriodSeconds</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>$K8s_NAMESPACE</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>http</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>31200</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>$APP_NAME</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>sessionAffinity</span>: <span style=color:#ae81ff>None</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span></code></pre></div><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/aa026e83-71fb-4866-ba02-29664cc91c78.png alt></p><h3 id=é€šè¿‡æ¢é’ˆä¼˜é›…çš„è§£å†³æœåŠ¡éƒ¨ç½²è¿‡ç¨‹ä¸­æ³¨å†Œä¸­å¿ƒæœåŠ¡å¹³æ»‘è¿‡æ¸¡é—®é¢˜>é€šè¿‡æ¢é’ˆä¼˜é›…çš„è§£å†³æœåŠ¡éƒ¨ç½²è¿‡ç¨‹ä¸­æ³¨å†Œä¸­å¿ƒæœåŠ¡å¹³æ»‘è¿‡æ¸¡é—®é¢˜</h3><p>æˆ‘ä»¬åç«¯é‡‡ç”¨ Spring Cloudï¼ˆSpring Cloud Alibabaï¼‰å¾®æœåŠ¡ç»“æ„æŠ€æœ¯è·¯çº¿è¿›è¡Œå¼€å‘ï¼Œé‡‡ç”¨ Nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒã€‚è€ŒæœåŠ¡æ³¨å†Œåˆ° Nacos æ˜¯éœ€è¦æ—¶é—´çš„ã€‚è€Œä¸€èˆ¬çš„å®¹å™¨æ¢æµ‹åªæ˜¯æ¢æµ‹æœåŠ¡æ˜¯å¦è¾¾åˆ°äº†å¯ç”¨çš„çŠ¶æ€ï¼Œæ²¡æœ‰è€ƒè™‘åˆ°æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡æ˜¯å¦å¯ç”¨ï¼Œå…¶å®åœ¨å¤šå‰¯æœ¬çš„æƒ…å†µä¸‹åªè¦æ§åˆ¶å¥½æ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼Œåº”è¯¥ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µçš„ã€‚åœ¨ Nacos ä¸­ä¹Ÿæ˜¯æœ‰è´Ÿè½½å‡è¡¡çš„ï¼ŒNacos å®ç°è´Ÿè½½å‡è¡¡æ˜¯é€šè¿‡å†…ç½®çš„ Ribbon å®ç°çš„ã€‚åƒ Gateway ç½‘å…³æœåŠ¡å°¤å…¶é‡è¦ï¼Œå› ä¸ºå®ƒè¿˜è¦è´Ÿè´£æœåŠ¡è½¬å‘ã€‚æ‰€ä»¥ä¿è¯è¿™ç§æœåŠ¡çš„å¯ç”¨æ€§ä¹Ÿå˜å¾—å°¤ä¸ºé‡è¦ã€‚</p><p>ä¾‹å¦‚å•å‰¯æœ¬ Gateway ç½‘å…³æœåŠ¡ï¼Œè‹¥æ˜¯åœ¨å¼€å§‹æ¢æµ‹æ—¶ï¼Œç½‘å…³æœåŠ¡å¹¶æ²¡æœ‰åŠæ—¶æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒé‡Œï¼Œè¿™ä¸ªæ—¶å€™å¼€å§‹æµ‹æ¢ï¼ŒæœåŠ¡æœ¬èº«æ˜¯å¯ç”¨çš„ï¼Œé‚£ä¹ˆæ¢æµ‹æˆåŠŸåï¼Œæ–°çš„ Pod å˜æˆäº† running çŠ¶æ€ï¼Œä¾¿åœæ‰äº†ç¬¬ä¸€ä¸ª Podï¼Œè€Œæ³¨å†Œä¸­å¿ƒä¸­çš„æœåŠ¡å…¶å®å¹¶ä¸å¯ç”¨ï¼Œä¼šå‡ºç°çŸ­æš‚æœåŠ¡ä¸å¯ç”¨ã€‚</p><p>å…¶å®å¥åº·æ¢æµ‹æˆ‘ä»¬è¿˜å¯ä»¥å¾€å‰èµ°ä¸€æ­¥ï¼ŒæŠŠæœåŠ¡æˆåŠŸæ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸­ä½œä¸ºæœåŠ¡å¯ç”¨çš„çŠ¶æ€ã€‚</p><p><strong>è‡ªå·±ç¼–å†™å®¹å™¨æ¢é’ˆæ¥å£ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author å°ç›’å­
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: å®¹å™¨æ¢é’ˆæ¥å£ï¼Œç”¨æ¥è¿›è¡Œæ¢æµ‹æœåŠ¡æ˜¯å¦æ³¨å†Œè¿›å…¥æ³¨å†Œä¸­å¿ƒ
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date 2022/10/22 10:58
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RequestMapping</span>(<span style=color:#e6db74>&#34;nacos&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HealthController</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> DiscoveryClient discoveryClient;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/health/{services}&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getService</span>(<span style=color:#a6e22e>@PathVariable</span>(<span style=color:#e6db74>&#34;services&#34;</span>)String services) <span style=color:#66d9ef>throws</span> NacosException {
</span></span><span style=display:flex><span>        <span style=color:#75715e>//ä»nacosä¸­æ ¹æ®serverIdè·å–å®ä¾‹ æ–¹æ³•ä¸€ï¼ˆé‡‡ç”¨æ­¤æ–¹æ³•ï¼ŒDiscoveryClient ä»£è¡¨çš„å°±æ˜¯ï¼šæœåŠ¡å‘ç°æ“ä½œå¯¹è±¡ï¼‰</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (StringUtils.<span style=color:#a6e22e>isBlank</span>(services)){
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> ResponseEntity<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span>(HttpStatus.<span style=color:#a6e22e>BAD_REQUEST</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>ServiceInstance<span style=color:#f92672>&gt;</span> instances <span style=color:#f92672>=</span> discoveryClient.<span style=color:#a6e22e>getInstances</span>(services);
</span></span><span style=display:flex><span>        Map<span style=color:#f92672>&lt;</span>String, Integer<span style=color:#f92672>&gt;</span> ipMap <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (instances.<span style=color:#a6e22e>size</span>() <span style=color:#f92672>&gt;</span> 0){
</span></span><span style=display:flex><span>            instances.<span style=color:#a6e22e>forEach</span>(key <span style=color:#f92672>-&gt;</span>{
</span></span><span style=display:flex><span>                ipMap.<span style=color:#a6e22e>put</span>(key.<span style=color:#a6e22e>getHost</span>(), key.<span style=color:#a6e22e>getPort</span>());
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#75715e>//ä»nacosä¸­æ ¹æ®serverIdè·å–å®ä¾‹ æ–¹æ³•äºŒ é‡‡ç”¨nacosçš„javaçš„SDK</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        Properties properties = new Properties();</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        properties.put(&#34;serverAddr&#34;, &#34;192.168.4.25:8849&#34;);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        properties.put(&#34;namespace&#34;, &#34;caseretrieval-dev&#34;);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        NamingService naming = NamingFactory.createNamingService(properties);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        List&lt;Instance&gt; instancesList = naming.selectInstances(&#34;case-gateway&#34;, true);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//ä»nacosä¸­æ ¹æ®serverIdè·å–å®ä¾‹ æ–¹æ³•ä¸‰ï¼Œé‡‡ç”¨nacosçš„OPEN-api</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//http://192.168.4.25:8849/nacos/v1/ns/instance/list?serviceName=case-gateway&amp;namespaceId=caseretrieval-dev</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//è·å–æœ¬æœºIPåœ°å€</span>
</span></span><span style=display:flex><span>        String hostAddress <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;127.0.0.1&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            InetAddress localHost <span style=color:#f92672>=</span> InetAddress.<span style=color:#a6e22e>getLocalHost</span>();
</span></span><span style=display:flex><span>            hostAddress <span style=color:#f92672>=</span> localHost.<span style=color:#a6e22e>getHostAddress</span>();
</span></span><span style=display:flex><span>            log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;å½“å‰æœåŠ¡æœ¬æœºipæ˜¯ï¼š&#34;</span><span style=color:#f92672>+</span>hostAddress);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (UnknownHostException e) {
</span></span><span style=display:flex><span>            log.<span style=color:#a6e22e>error</span>(e.<span style=color:#a6e22e>getMessage</span>(), e);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#75715e>//æŸ¥çœ‹æœ¬æœºæœåŠ¡æ˜¯å¦å·²ç»æ³¨å†Œåˆ°nacosä¸­</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (ipMap.<span style=color:#a6e22e>containsKey</span>(hostAddress)){
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> ResponseEntity<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span>(HttpStatus.<span style=color:#a6e22e>OK</span>);
</span></span><span style=display:flex><span>        }<span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> ResponseEntity<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span>(HttpStatus.<span style=color:#a6e22e>SERVICE_UNAVAILABLE</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>å…¶å®æ­£å¸¸æƒ…å†µä¸‹ï¼Œåˆç†çš„æ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼ŒåŠ ä¸Šå°±ç»ªæ€§æ¢æµ‹ã€å­˜æ´»æ€§æ¢æµ‹æˆ–è€…å¯åŠ¨æ¢æµ‹å°±èƒ½è¾¾åˆ°ç›®æ ‡äº†ï¼Œä¹Ÿä¸å¿…è¿™ä¹ˆéº»çƒ¦ã€‚</p></blockquote><h3 id=é€šè¿‡-ingress-æ–¹å¼æš´éœ²é›†ç¾¤å†…éƒ¨å®¹å™¨æœåŠ¡>é€šè¿‡ Ingress æ–¹å¼æš´éœ²é›†ç¾¤å†…éƒ¨å®¹å™¨æœåŠ¡</h3><p>å¦‚æœéœ€è¦ä»é›†ç¾¤å¤–éƒ¨è®¿é—®æœåŠ¡ï¼Œå³å°†æœåŠ¡æš´éœ²ç»™ç”¨æˆ·ä½¿ç”¨ï¼ŒKubernetesService æœ¬èº«æä¾›äº†ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ NodePort ï¼Œå¦å¤–ä¸€ç§æ˜¯ LoadBalancer ã€‚å¦å¤– Ingress ä¹Ÿæ˜¯ä¸€ç§å¸¸ç”¨çš„æš´éœ²æœåŠ¡çš„æ–¹å¼ã€‚</p><p>KubeSphere çš„é¡¹ç›®ç½‘å…³å°±æ˜¯ IngressController ï¼Œæ˜¯ä¸€ä¸ªä¸ƒå±‚è´Ÿè½½å‡è¡¡è°ƒåº¦å™¨ï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚å…ˆåˆ°è¾¾è¿™ä¸ªä¸ƒå±‚è´Ÿè½½å‡è¡¡è°ƒåº¦å™¨ï¼ŒKubeSphere ä¸­çš„åº”ç”¨è·¯ç”±å°±æ˜¯ Ingress ï¼Œæ˜¯å®šä¹‰è§„åˆ™çš„ã€‚æ•°æ®åŒ…èµ°å‘å¦‚ä¸‹å›¾æµç¨‹æ‰€ç¤ºï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/a189e6ef-74b8-4da4-b5a0-88c763eefd54.png alt></p><h4 id=å¼€å¯é¡¹ç›®ç½‘å…³>å¼€å¯é¡¹ç›®ç½‘å…³</h4><p>å¯¹é¡¹ç›®ä¸­çš„å¤–ç½‘è®¿é—®ç½‘å…³ä»¥åŠæœåŠ¡æ²»ç†ç­‰é…ç½®è¿›è¡Œè®¾ç½®å’Œç®¡ç†ã€‚</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/d831cda1-e47f-45e8-808c-814350f20e57.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/1ac36a74-00d1-4386-bb99-ad37433c4706.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/d95bd4ff-96bc-4b1b-b264-bcea278628e1.png alt></p><blockquote><p>KubeSphere ä¸­çš„é¡¹ç›®ç½‘å…³ï¼Œå¼€å¯åä¼šè‡ªåŠ¨å®‰è£… IngressControllerã€‚</p></blockquote><p>å¯¹åº”åœ¨ K8s é›†ç¾¤ä¸­ svc å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/dbea48f5-edee-4ca7-817b-bcf80bd457bd.png alt></p><p>KubeSphere ä¸­åº”ç”¨è·¯ç”±æ˜¯éœ€è¦æ‰‹åŠ¨åˆ›å»ºçš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/8c87a631-6886-476f-83a8-6c7efdadd973.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/347ddd41-fbac-41c8-9f8b-93d3fee6554b.png alt></p><h4 id=è®¾ç½®è·¯ç”±è§„åˆ™>è®¾ç½®è·¯ç”±è§„åˆ™</h4><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/f4d7f58a-20a6-4259-aefe-e036974cd99a.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/6ab8c2dc-d103-4996-85d5-34a71a53332d.png alt></p><blockquote><p>æŒ‡å®šè‡ªå®šä¹‰åŸŸåå¹¶é€šè¿‡æœ¬åœ° hosts æ–‡ä»¶æˆ– DNS æœåŠ¡å™¨å°†åŸŸåè§£æä¸ºç½‘å…³ IP åœ°å€ã€‚</p></blockquote><h4 id=è®¿é—®>è®¿é—® <a href=http://pig.com:32576/ target=_blank rel="noopener noreferrer">http://pig.com:32576/</a></h4><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/f0146856-95b8-4b8e-b11d-0eb14942889f.png alt></p><h3 id=å°†-sonarqube-é›†æˆåˆ°æµæ°´çº¿>å°† SonarQube é›†æˆåˆ°æµæ°´çº¿</h3><p>SonarQube æ˜¯ä¸€ç§ä¸»æµçš„ä»£ç è´¨é‡æŒç»­æ£€æµ‹å·¥å…·ã€‚æ‚¨å¯ä»¥å°†å…¶ç”¨äºä»£ç åº“çš„é™æ€å’ŒåŠ¨æ€åˆ†æã€‚SonarQube é›†æˆåˆ° KubeSphere(Jenkins) æµæ°´çº¿åï¼Œå¦‚æœåœ¨è¿è¡Œçš„æµæ°´çº¿ä¸­æ£€æµ‹åˆ°é—®é¢˜ï¼Œæ‚¨å¯ä»¥ç›´æ¥åœ¨ä»ªè¡¨æ¿ä¸ŠæŸ¥çœ‹å¸¸è§ä»£ç é—®é¢˜ï¼Œä¾‹å¦‚ Bug å’Œæ¼æ´ã€‚</p><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ SonarQube å¾€å¾€æ˜¯åŸºäºç°æœ‰çš„ Gitlabã€Jenkins é›†æˆé…åˆä½¿ç”¨çš„ï¼Œä»¥ä¾¿åœ¨é¡¹ç›®æ‹‰å–ä»£ç åè¿›è¡Œä»£ç å®¡æŸ¥ã€‚è‹¥æ˜¯å­˜åœ¨å¤šå¥—ç¯å¢ƒçš„æƒ…å†µä¸‹ï¼Œä¾‹å¦‚æœ‰å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒç­‰ï¼Œæˆ‘æ˜¯ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å»è¿›è¡Œä»£ç å®¡æŸ¥çš„ï¼Œä¸€æ¥è¿›è¡Œé‡å¤çš„ä»£ç å®¡æŸ¥æ²¡æœ‰æ„ä¹‰ï¼ŒäºŒæ¥æ¯”è¾ƒæµªè´¹æ—¶é—´ï¼Œæ‰€ä»¥å»ºè®®åªåœ¨å¼€å‘ç¯å¢ƒå¼€å¯ä»£ç å®¡æŸ¥å³å¯ã€‚</p><h4 id=åœ¨-jenkins-ä¸­é›†æˆ-sonarqube>åœ¨ Jenkins ä¸­é›†æˆ SonarQube</h4><p>å¾®æœåŠ¡é¡¹ç›®ä¸­éœ€è¦åœ¨æ¯ä¸ªé¡¹ç›®ä¸‹éƒ½å»ºç«‹ sonar-project.properties æ–‡ä»¶ï¼Œåœ¨ Jenkins çš„è„šæœ¬ä¸­éœ€è¦å¾ªç¯å» checking æ¯ä¸ªå¾®æœåŠ¡ã€‚</p><ol><li>åœ¨ sonarQube ä¸­ç”Ÿæˆ token</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/ab423df8-5450-445f-9edb-ef3ea2e53217.png alt></p><ol start=2><li>åœ¨ Jenkins ä¸­å®‰è£… SonarQube Scanner æ’ä»¶</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/3fe3869f-e90c-490a-8b6f-73d7c0e03314.png alt></p><ol start=3><li>åœ¨ Jenkins ä¸­æ·»åŠ  SonarQube å‡­è¯</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/e102fcef-fc0a-4542-83c8-99a8c7349924.png alt></p><blockquote><p>é€‰æ‹© Secret text ä½œä¸ºå‡­è¯ç±»å‹ã€‚</p></blockquote><p>å®Œæˆåå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/eff5d0da-fd37-4e5c-8ab7-c9c23c97fab4.png alt></p><ol start=4><li>åœ¨ Jenkins ç³»ç»Ÿé…ç½®ä¸­é…ç½® SonarQube</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/e4dbeda3-0139-4d6b-b95a-1af85dec03a7.png alt></p><ol start=5><li>åœ¨ Jenkins å…¨å·¥å…·ä¸­å®‰è£… SonarQube Scanner</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/eb9c41a4-37bf-4e49-aba1-fee590083e4b.png alt></p><blockquote><p>sonar-scanner åç§°è‡ªå®šä¹‰ï¼Œåœ¨ jenkinsfile ä¸­è¦ä¿æŒä¸€ç›´ã€‚</p></blockquote><ol start=6><li>å…³é—­å®¡æŸ¥ç»“æœä¸Šä¼  SCM åŠŸèƒ½</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/45cc3cba-7f94-41b7-aaee-e73226bf2bc4.png alt></p><h4 id=åç«¯ä»£ç å®¡æŸ¥>åç«¯ä»£ç å®¡æŸ¥</h4><ol><li>è°ƒæ•´ Jenkins è„šæœ¬</li></ol><p>å¾®æœåŠ¡é¡¹ç›®ä¸­éœ€è¦åœ¨æ¯ä¸ªé¡¹ç›®ä¸‹éƒ½å»ºç«‹ sonar-project.properties æ–‡ä»¶ï¼Œåœ¨ Jenkins çš„è„šæœ¬ä¸­éœ€è¦å¾ªç¯å» checking æ¯ä¸ªå¾®æœåŠ¡ã€‚</p><p>å¦‚ä»¥ä¸‹ç¤ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;sonarQubeä»£ç è´¨é‡æ£€æŸ¥&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                script <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${params.sonarQube}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;yes&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>service <span style=color:#66d9ef>in</span> ServicesBuild<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                          <span style=color:#66d9ef>def</span> workspace <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;pig-&#34;</span>
</span></span><span style=display:flex><span>                          println <span style=color:#e6db74>&#34;å½“å‰è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥æ˜¯ï¼š${service}&#34;</span>
</span></span><span style=display:flex><span>                          <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-gateway&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-auth&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-register&#34;</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                              workspace <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;${workspace}&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>().</span><span style=color:#a6e22e>split</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;-&#34;</span><span style=color:#f92672>)[</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>                           <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                          <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-codegen&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-monitor&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-sentinel-dashboard&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-xxl-job-admin&#34;</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                              workspace <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;pig-visual/&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                          <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                           <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;pig-upms-biz&#34;</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                               workspace <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;pig-upms/&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;${service}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                           <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                           <span style=color:#75715e>//å®šä¹‰å½“å‰Jenkinsçš„SonarQubeScannerå·¥å…·
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                           scannerHome <span style=color:#f92672>=</span> tool <span style=color:#e6db74>&#39;sonar-scanner&#39;</span>
</span></span><span style=display:flex><span>                           <span style=color:#75715e>//å¼•ç”¨å½“å‰JenkinsSonarQubeç¯å¢ƒ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                           withSonarQubeEnv<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;sonarqube9.4&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                               sh <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                               cd ${workspace}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                               ${scannerHome}/bin/sonar-scanner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                           &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>                           <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                       <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span><span style=color:#66d9ef>else</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        println <span style=color:#e6db74>&#34;æ˜¯noï¼Œè·³è¿‡sonarQubeä»£ç è´¨é‡æ£€æŸ¥&#34;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span></code></pre></div><blockquote><p>æ³¨ï¼šsonar-scanner å’Œ sonarqube9.4 åç§°éœ€å’Œ Jenkins ä¸­é…ç½®çš„ä¸€è‡´ã€‚</p></blockquote><ol start=2><li>æ–°å»º sonar-project.properties æ–‡ä»¶</li></ol><p>ä»¥ pig-gateway ä¸ºä¾‹ï¼Œåœ¨ pig é¡¹ç›®ä¸­æ–°å¢ sonar-project.properties æ–‡ä»¶ã€‚</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/855b6cf6-fd5d-433e-8aac-79083d89df0d.png alt></p><p>å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e>#é¡¹ç›®çš„key(è‡ªå®šä¹‰)</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sonar</span>.<span style=color:#a6e22e>projectKey</span>=<span style=color:#a6e22e>pig-gateway</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#é¡¹ç›®åç§°</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sonar</span>.<span style=color:#a6e22e>projectName</span>=<span style=color:#a6e22e>pig-gateway</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#é¡¹ç›®ç‰ˆæœ¬å·</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sonar</span>.<span style=color:#a6e22e>projectVersion</span>=<span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#éœ€è¦åˆ†æçš„æºç çš„ç›®å½•ï¼Œå¤šä¸ªç›®å½•ç”¨è‹±æ–‡é€—å·éš”å¼€</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sonar</span>.<span style=color:#a6e22e>sources</span>=.
</span></span><span style=display:flex><span><span style=color:#75715e>#éœ€è¦å¿½ç•¥çš„ç›®å½•</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sonar</span>.<span style=color:#a6e22e>exclusions</span>=<span style=color:#960050;background-color:#1e0010>**/</span><span style=color:#a6e22e>test</span><span style=color:#960050;background-color:#1e0010>/**</span>,<span style=color:#960050;background-color:#1e0010>**/</span><span style=color:#a6e22e>target</span><span style=color:#960050;background-color:#1e0010>/**</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## å­—èŠ‚ç æ–‡ä»¶æ‰€åœ¨ä½ç½®</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sonar</span>.<span style=color:#a6e22e>java</span>.<span style=color:#a6e22e>binaries</span>=.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sonar</span>.<span style=color:#a6e22e>java</span>.<span style=color:#a6e22e>source</span>=<span style=color:#ae81ff>1.8</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sonar</span>.<span style=color:#a6e22e>java</span>.<span style=color:#a6e22e>target</span>=<span style=color:#ae81ff>1.8</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#sonar.java.libraries=**/target/classes/**</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## Encoding of the source code. Default is default system encoding</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sonar</span>.<span style=color:#a6e22e>sourceEncoding</span>=<span style=color:#a6e22e>UTF-8</span>
</span></span></code></pre></div><p>å‘å¸ƒæµ‹è¯•ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/ed6b41c7-2cb7-4fa3-9c14-ccc77ec20bd9.png alt></p><p>åœ¨ Jenkins ä¸­æŸ¥çœ‹ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/f207282b-3fea-47c5-951f-06e7e177cf20.png alt></p><p>åœ¨ SonarQube ä¸­æŸ¥çœ‹ä»£ç æ£€æµ‹æƒ…å†µï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/a7c9824c-446e-4fda-8e99-a9de4f895101.png alt></p><blockquote><p>pig-gateway çš„ä»£ç è´¨é‡è¿˜æ˜¯å¾ˆé”™çš„ï¼Œä¸è¿‡æœ‰ä¸€ä¸ªæ¼æ´å“¦ã€‚</p></blockquote><h4 id=å‰ç«¯ä»£ç å®¡æŸ¥>å‰ç«¯ä»£ç å®¡æŸ¥</h4><ol><li>è°ƒæ•´ Jenkins è„šæœ¬</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;sonarQubeä»£ç è´¨é‡æ£€æŸ¥&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                script <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${params.sonarQube}&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;yes&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                       println <span style=color:#e6db74>&#34;å½“å‰è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥æ˜¯ï¼š${APP_NAME}&#34;</span>
</span></span><span style=display:flex><span>                       <span style=color:#75715e>//å®šä¹‰å½“å‰Jenkinsçš„SonarQubeScannerå·¥å…·
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                       scannerHome <span style=color:#f92672>=</span> tool <span style=color:#e6db74>&#39;sonar-scanner&#39;</span>
</span></span><span style=display:flex><span>                       <span style=color:#75715e>//å¼•ç”¨å½“å‰JenkinsSonarQubeç¯å¢ƒ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                       withSonarQubeEnv<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;sonarqube9.4&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                           sh <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                           cd .
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                           ${scannerHome}/bin/sonar-scanner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                       &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>                       <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span><span style=color:#66d9ef>else</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        println <span style=color:#e6db74>&#34;æ˜¯noï¼Œè·³è¿‡sonarQubeä»£ç è´¨é‡æ£€æŸ¥&#34;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span></code></pre></div><ol start=2><li>æ–°å»º sonar-project.properties æ–‡ä»¶</li></ol><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/bb601e1f-492e-4598-853b-085edfee25b0.png alt></p><p>å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#a6e22e>sonar</span>.<span style=color:#a6e22e>projectKey</span>=<span style=color:#a6e22e>pig_ui</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sonar</span>.<span style=color:#a6e22e>projectName</span>=<span style=color:#a6e22e>pig_ui</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sonar</span>.<span style=color:#a6e22e>projectVersion</span>=<span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sonar</span>.<span style=color:#a6e22e>sources</span>=.
</span></span></code></pre></div><p>å‘å¸ƒæµ‹è¯•ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/4733f5bc-e0b6-40a6-965c-ad5494c20f9e.png alt></p><p>åœ¨ Jenkins ä¸­æŸ¥çœ‹ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/723a6c74-66ce-41d2-9929-38f0e452f9de.png alt></p><p>åœ¨ SonarQube ä¸­æŸ¥çœ‹ä»£ç æ£€æµ‹æƒ…å†µï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/8cf60ee9-5aca-45cb-b1f0-5a0ab1902655.png alt></p></div></div><div class=share-2><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-pig-practice%2f&text=%e5%9f%ba%e4%ba%8e%20KubeSphere%20%e7%9a%84%e5%bc%80%e6%ba%90%e5%be%ae%e6%9c%8d%e5%8a%a1%e5%bc%80%e5%8f%91%e5%b9%b3%e5%8f%b0%20Pig%20%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-pig-practice%2f&title=%e5%9f%ba%e4%ba%8e%20KubeSphere%20%e7%9a%84%e5%bc%80%e6%ba%90%e5%be%ae%e6%9c%8d%e5%8a%a1%e5%bc%80%e5%8f%91%e5%b9%b3%e5%8f%b0%20Pig%20%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-pig-practice%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-pig-practice%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-pig-practice%2f&t=%e5%9f%ba%e4%ba%8e%20KubeSphere%20%e7%9a%84%e5%bc%80%e6%ba%90%e5%be%ae%e6%9c%8d%e5%8a%a1%e5%bc%80%e5%8f%91%e5%b9%b3%e5%8f%b0%20Pig%20%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div></div><div class=aside><div class=inner-div><div class=title>ç›®å½•</div><div class=tabs><nav id=TableOfContents><ul><li><a href=#å‰è¨€>å‰è¨€</a></li><li><a href=#ä»‹ç»>ä»‹ç»</a><ul><li><a href=#kubesphere>KubeSphere</a></li><li><a href=#pig>Pig</a></li></ul></li><li><a href=#ç¯å¢ƒæ­å»º>ç¯å¢ƒæ­å»º</a></li><li><a href=#æ¶æ„è®¾è®¡>æ¶æ„è®¾è®¡</a><ul><li><a href=#kubesphere-æ¶æ„>KubeSphere æ¶æ„</a></li><li><a href=#pig-æ¶æ„>Pig æ¶æ„</a></li><li><a href=#æ•´ä½“æ¶æ„å›¾>æ•´ä½“æ¶æ„å›¾</a></li><li><a href=#æ•´ä½“å®¹å™¨åŒ–éƒ¨ç½²æµç¨‹å›¾>æ•´ä½“å®¹å™¨åŒ–éƒ¨ç½²æµç¨‹å›¾</a></li></ul></li><li><a href=#éƒ¨ç½²è¿‡ç¨‹>éƒ¨ç½²è¿‡ç¨‹</a><ul><li><a href=#åˆ›å»ºä¼ä¸šç©ºé—´>åˆ›å»ºä¼ä¸šç©ºé—´</a></li><li><a href=#åˆ›å»º-devops-é¡¹ç›®>åˆ›å»º DevOps é¡¹ç›®</a></li><li><a href=#åˆ›å»ºé¡¹ç›®>åˆ›å»ºé¡¹ç›®</a></li><li><a href=#éƒ¨ç½²-mysql>éƒ¨ç½² MySQL</a></li></ul></li><li><a href=#éƒ¨ç½²-redis>éƒ¨ç½² Redis</a></li><li><a href=#åˆ›å»ºå‡­è¯>åˆ›å»ºå‡­è¯</a></li><li><a href=#è®¾ç½®-harbor-é•œåƒä»“åº“>è®¾ç½® harbor é•œåƒä»“åº“</a></li><li><a href=#éƒ¨ç½²-pig-åç«¯æ— çŠ¶æ€æœåŠ¡>éƒ¨ç½² Pig åç«¯æ— çŠ¶æ€æœåŠ¡</a></li><li><a href=#éƒ¨ç½²-pig-å‰ç«¯æ— çŠ¶æ€æœåŠ¡>éƒ¨ç½² Pig å‰ç«¯æ— çŠ¶æ€æœåŠ¡</a><ul><li><a href=#åˆ©ç”¨-kubesphere-ä¸­çš„-jenkins-å‘å¸ƒ>åˆ©ç”¨ KubeSphere ä¸­çš„ Jenkins å‘å¸ƒ</a></li></ul></li><li><a href=#é€šè¿‡-nodeport-æ–¹å¼æš´éœ²é›†ç¾¤å†…éƒ¨å®¹å™¨æœåŠ¡>é€šè¿‡ NodePort æ–¹å¼æš´éœ²é›†ç¾¤å†…éƒ¨å®¹å™¨æœåŠ¡</a></li><li><a href=#ä¼˜åŒ–å’Œæ”¹è¿›>ä¼˜åŒ–å’Œæ”¹è¿›</a><ul><li><a href=#é€šè¿‡æ¢é’ˆä¼˜é›…çš„è§£å†³éƒ¨ç½²è¿‡ç¨‹ä¸­æœåŠ¡å¹³æ»‘è¿‡æ¸¡é—®é¢˜>é€šè¿‡æ¢é’ˆä¼˜é›…çš„è§£å†³éƒ¨ç½²è¿‡ç¨‹ä¸­æœåŠ¡å¹³æ»‘è¿‡æ¸¡é—®é¢˜</a></li><li><a href=#é€šè¿‡æ¢é’ˆä¼˜é›…çš„è§£å†³æœåŠ¡éƒ¨ç½²è¿‡ç¨‹ä¸­æ³¨å†Œä¸­å¿ƒæœåŠ¡å¹³æ»‘è¿‡æ¸¡é—®é¢˜>é€šè¿‡æ¢é’ˆä¼˜é›…çš„è§£å†³æœåŠ¡éƒ¨ç½²è¿‡ç¨‹ä¸­æ³¨å†Œä¸­å¿ƒæœåŠ¡å¹³æ»‘è¿‡æ¸¡é—®é¢˜</a></li><li><a href=#é€šè¿‡-ingress-æ–¹å¼æš´éœ²é›†ç¾¤å†…éƒ¨å®¹å™¨æœåŠ¡>é€šè¿‡ Ingress æ–¹å¼æš´éœ²é›†ç¾¤å†…éƒ¨å®¹å™¨æœåŠ¡</a></li><li><a href=#å°†-sonarqube-é›†æˆåˆ°æµæ°´çº¿>å°† SonarQube é›†æˆåˆ°æµæ°´çº¿</a></li></ul></li></ul></nav></div></div></div></div></section><div class=SubscribeForm><div class=innerBox><img class=close src=/images/home/close.svg alt=close><p class=description>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=blog_formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input-blog type=text placeholder>
<button id=email-submit-blog>è®¢é˜…</button>
<span id=message_blog data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨ style=color:red></span><span id=message1_blog style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span></div></div></div><footer><div class=footer><div class="footer-main common-layout"><div class=up-main><div class=left-div><img src=/images/logo.svg alt class=foot-logo><p>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input type=text placeholder=è¯·è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€>
<button id=email-submit>è®¢é˜…</button></div><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨></span><span id=message1 style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span><script>var bindSubmit=function(){var e=$("#email-input");$("#email-submit").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message").data("message1"),a=$("#message").data("message2"),r=$("#message").data("message3"),c=$("#message1").data("success");if(n)if(validateEmail(n)){if(s=$("#formAddress").data("usesendcloud"),!s)return;o=$("#formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:$("#email-input").val().toString()},success:function(){showSuccessMessage(c),setTimeout(function(){$("#email-input").val("")},1e3)},error:function(){showMessage(r)}})}else t.preventDefault(),showMessage(a);else t.preventDefault(),showMessage(i)})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},showMessage=function(e){$("#message").html(e).show()},showSuccessMessage=function(e){$("#message1").html(e).show()},bindHideMessage=function(){$(window).click(function(){$("#message").hide(),$("#message1").hide()})},bindClose=function(){$(".formBox .close").click(function(e){e.stopPropagation(),$(".formBox").fadeOut()})};bindSubmit(),bindClose(),bindHideMessage()</script><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€!></span></div><div class=right-div><ul class=common-flex-layout><li class=nowrap-li><div class=h3>åº”ç”¨åœºæ™¯</div><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps</a>
<a href=/zh/service-mesh/>åœ¨ K8s è¿è¡Œå¾®æœåŠ¡</a>
<a href=/zh/observability/>æ„å»ºäº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a>
<a href=https://github.com/kubesphere/kubekey target=_blank rel="noopener noreferrer">K8s ä¸€é”®éƒ¨ç½²ä¸è¿ç»´</a>
<a href=https://github.com/OpenFunction/OpenFunction target=_blank rel="noopener noreferrer">æ„å»º FaaS å¹³å°ä¸ Serverless æ¶æ„</a>
<a href=https://github.com/openpitrix/openpitrix target=_blank rel="noopener noreferrer">å¤šäº‘åº”ç”¨ç®¡ç†å¹³å°</a></li><li class=nowrap-li><div class=h3>èµ„æº</div><a href=/zh/projects/>å¼€æºé¡¹ç›®</a>
<a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a>
<a href=/zh/conferences/>å¼€æºå³°ä¼š</a>
<a href=/zh/videos/>è§†é¢‘èµ„æº</a>
<a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li><li class=nowrap-li><div class=h3>æ–‡æ¡£ä¸­å¿ƒ</div><a href=/zh/docs/v4.1/01-intro/01-introduction/>äº§å“ä»‹ç»</a>
<a href=/zh/docs/v4.1/03-installation-and-upgrade/02-install-kubesphere/02-install-kubernetes-and-kubesphere/>å¦‚ä½•å®‰è£…</a>
<a href=/zh/docs/v4.1/02-quickstart/>å¿«é€Ÿå…¥é—¨</a>
<a href=/zh/docs/v3.4/reference/api-docs/>API æ–‡æ¡£</a></li><li class=nowrap-li><div class=h3>å¼€æºç¤¾åŒº</div><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a>
<a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a>
<a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a>
<a href=/zh/partner/>åˆä½œä¼™ä¼´</a>
<a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a>
<a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a>
<a href=https://kubesphere.com.cn/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a>
<a href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ä¸­æ–‡è®ºå›</a>
<a href=https://kubesphere.io target=_blank rel="noopener noreferrer">å…¨çƒç«™</a></li><li class=nowrap-li><div class=h3>äº§å“ä¸æœåŠ¡</div><a href=https://aws.amazon.com/cn/quickstart/architecture/qingcloud-kubesphere/ target=_blank rel="noopener noreferrer">KubeSphere on AWS</a>
<a href=https://market.azure.cn/marketplace/apps/qingcloud.kubesphere target=_blank rel="noopener noreferrer">KubeSphere on Azure</a>
<a href=https://marketplace.digitalocean.com/apps/kubesphere target=_blank rel="noopener noreferrer">KubeSphere on DigitalOcean</a>
<a href=https://www.qingcloud.com/products/kubesphereqke target=_blank rel="noopener noreferrer">KubeSphere on QingCloud(QKE)</a>
<a href=https://kubesphere.com.cn/kse/ target=_blank rel="noopener noreferrer">KubeSphere ä¼ä¸šç‰ˆ</a>
<a href=https://kubesphere.cloud/ksv/ target=_blank rel="noopener noreferrer">KubeSphere è™šæ‹ŸåŒ–å¹³å°</a>
<a href=https://kubesphere.com.cn/marketplace/ target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿæ‰©å±•ç»„ä»¶å¸‚åœº</a>
<a href=https://kubesphere.cloud target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿåº”ç”¨æœåŠ¡å¹³å°</a>
<a href=https://m.qingcloud.com/p/aec50 target=_blank rel="noopener noreferrer">äº†è§£å•†ä¸šäº§å“ä¸å’¨è¯¢åˆä½œ</a></li></ul></div></div><div class=down-main><div class=img-div><a class=wechat href=javascript:void(0); aria-label=wechat><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28"><defs><path id="a" d="M0 0h15.673v12.156H0z"/></defs><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="13" cy="13" r="13" stroke="#B6C2CD"/><g transform="translate(5 7)"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59.0-4.625 1.679-4.625 3.74.0 2.066 2.035 3.738 4.625 3.738.542.0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27.0-.541-.257-.541-.514.0-.256.27-.514.541-.514.41.0.681.258.681.514.0.257-.271.514-.681.514zm2.994.0c-.27.0-.541-.257-.541-.514.0-.256.27-.514.54-.514.41.0.681.258.681.514.0.257-.277.514-.68.514z" mask="url(#b)"/><path fill="currentColor" d="M10.602 3.674c.177.0.356.011.533.029C10.657 1.576 8.27.0 5.543.0 2.498.0.0 1.974.0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17.0.343-.005.515-.022a3.68 3.68.0 01-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417.0.693.263.693.66s-.276.66-.693.66c-.418.0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417.0-.834-.263-.834-.66s.417-.66.834-.66c.418.0.695.263.695.66.0.392-.277.66-.695.66z" mask="url(#b)"/></g></g></svg><div class=hide-div><img src=/images/home/wechat.svg alt></div></a><a class=facebook-a href=https://www.facebook.com/kubesphere target=_blank aria-label=facebook></a><a class=twitter-a href=https://x.com/KubeSphere target=_blank aria-label=twitter rel="noopener noreferrer"></a><a class=linkedin-a href=https://www.linkedin.com/company/kubesphere/ target=_blank aria-label=linkedin rel="noopener noreferrer"></a><a class=bilibili-a href=https://space.bilibili.com/438908638 target=_blank aria-label=bilibili rel="noopener noreferrer"></a><a class=slack-a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank aria-label=slack rel="noopener noreferrer"></a><a class=github-a href=https://github.com/kubesphere/kubesphere target=_blank aria-label=github rel="noopener noreferrer"></a><a class=medium-a href=https://itnext.io/@kubesphere target=_blank aria-label=medium rel="noopener noreferrer"></a></div><p class=p1></p><p class=case><a href=http://www.beian.miit.gov.cn/ target=_blank rel="noopener noreferrer"><span>äº¬ICPå¤‡13019086å·</span>
</a><a target=_blank rel="noopener noreferrer" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502041003"><img src=/images/footer/case-icon.png alt=å¤‡æ¡ˆå›¾æ ‡>
<span>äº¬å…¬ç½‘å®‰å¤‡ 11010502041003å·</span></a></p></div></div></div><div class=cookie><div class=common-layout><p>æ‚¨çš„éšç§å¯¹æˆ‘ä»¬å¾ˆé‡è¦ã€‚æˆ‘ä»¬ä½¿ç”¨Cookieæ¥è®°ä½è®¢é˜…è¯¦ç»†ä¿¡æ¯ï¼Œä¼˜åŒ–ç½‘ç«™åŠŸèƒ½å¹¶äº¤ä»˜æ ¹æ®æ‚¨çš„å…´è¶£é‡èº«å®šåˆ¶çš„å†…å®¹ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„<a href=/zh/privacy>éšç§æ”¿ç­–</a>.</p><button>
æ¥å—å¹¶ç»§ç»­</button></div></div></footer><script>var lazyLoad=function(e,t){for(var n,o,i,s=0;s<t;s++){if(n=e.eq(s),o=n.attr("data-loaded"),o)continue;n.offset().top<parseInt($(window).height())+parseInt($(window).scrollTop())&&(i=n.attr("src"),n.attr("src",i),n.attr("data-loaded",!0))}},bindLayLoad=function(){var e=$("img"),t=e.length;lazyLoad(e,t),$(window).scroll(function(){lazyLoad(e,t)})},bindAddPadding=function(){var e=$("#close-join");e.length>0&&$(".main-section").addClass("padding")},docCookies={getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t){return!!e&&!/^(?:expires|max-age|path|domain|secure)$/i.test(e)&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t),!0)}},bindHideCookie=function(){var t=docCookies.getItem("hasAuth"),e=$(".cookie");t?e.hide():e.show(),e.find("button").on("click",function(){docCookies.setItem("hasAuth","1"),e.hide()})};bindAddPadding(),bindHideCookie()</script><script type=text/javascript src=/js/aside.2d6977c0f16aef4ed3e886dd66675ce74bd0efcd467c2b2bcdb30b92d5e7c7c0e5c6e0c9d8f09a883c22f58df9e6b0b6347fcdd3c9a920b7faba6d7f91a201c3.js integrity="sha512-LWl3wPFq707T6IbdZmdc50vQ781GfCsrzbMLktXnx8DlxuDJ2PCaiDwi9Y355rC2NH/N08mpILf6um1/kaIBww=="></script><script type=text/javascript src=/js/markdown-tab.17f9f46b021adebc7250ce1b07134a577b307e7a436daa4aaf388f218e8463966f53770b26a64817c06c168738a887672d47fb4c29615adfc446e11d09a344cf.js integrity="sha512-F/n0awIa3rxyUM4bBxNKV3swfnpDbapKrziPIY6EY5ZvU3cLJqZIF8BsFoc4qIdnLUf7TClhWt/ERuEdCaNEzw=="></script><script>let forbidForm=!1;var viewer=new Viewer(document.querySelector(".md-body"),{url:"src"}),blogBindSubmit=function(){var e=$("#email-input-blog");$("#email-submit-blog").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message_blog").data("message1"),a=$("#message_blog").data("message2"),r=$("#message_blog").data("message3"),c=$("#message1_blog").data("success");if(n)if(validateEmail(n)){if(s=$("#blog_formAddress").data("usesendcloud"),!s)return;o=$("#blog_formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:n.toString()},success:function(){showSuccessMessage_blog(c),setTimeout(function(){window.onscroll="",$(".SubscribeForm").hide(),$("#email-input-blog").val("")},5e3)},error:function(){showMessage_blog(r)}})}else t.preventDefault(),$("#message_blog").html(a).show();else t.preventDefault(),$("#message_blog").html(i).show()})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},bindHideMessageBlog=function(){$(window).click(function(){$("#message_blog").hide()})},bindCloseBlog=function(){$(".SubscribeForm .close").click(function(e){e.stopPropagation(),$(".SubscribeForm").fadeOut(),window.onscroll=""})},showMessage_blog=function(e){$("#message_blog").html(e).show()},showSuccessMessage_blog=function(e){$("#message1_blog").html(e).show()};window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;forbidForm&&(window.onscroll=""),e+t>n-710?$(".SubscribeForm").hide():$(".SubscribeForm").show()},blogBindSubmit(),bindCloseBlog(),bindHideMessageBlog()</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>