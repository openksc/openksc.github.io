<!doctype html><html lang=en-US><head><meta charset=utf-8><title>在 KubeSphere 中快速部署使用 GitLab 并构建 DevOps 项目</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="本次分享将和大家一起动手来实践一下在 KubeSphere 部署 GitLab CE（Community Edition 社区版）并构建与之联动的 DevOps 项目。"><meta name=keywords content="KubeSphere,GitLab,DevOps"><meta property="og:type" content="article"><meta property="og:title" content="在 KubeSphere 中快速部署使用 GitLab 并构建 DevOps 项目"><meta property="og:description" content="本次分享将和大家一起动手来实践一下在 KubeSphere 部署 GitLab CE（Community Edition 社区版）并构建与之联动的 DevOps 项目。"><meta property="og:image" content="https://pek3b.qingstor.com/kubesphere-community/images/kubesphere-gitlab-devops.png"><meta property="og:url" content="https://openksc.github.io/zh/blogs/kubesphere-gitlab-devops/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeSphere"><meta property="twitter:image" content="https://pek3b.qingstor.com/kubesphere-community/images/kubesphere-gitlab-devops.png"><meta name=docsearch:language content="zh-CN"><meta name=docsearch:version content><link rel=canonical href=https://kubesphere.io/zh/blogs/kubesphere-gitlab-devops/><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=apple-touch-icon href=/images/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/svg+xml href=/images/favicons/favicon.svg><link rel=icon type=image/png href=/images/favicons/favicon.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg color=#00ad6e><meta name=msapplication-config content='/images/favicons/browserconfig.xml'><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/fonts/Roboto/stylesheet.css><link rel=stylesheet href=/fonts/ProximaNova/stylesheet.css><link rel=stylesheet href=/css/jquery.modal.min.css><link rel=stylesheet href=/css/viewer.min.css><link rel=stylesheet href=/swiper/swiper-bundle.min.css><link rel=stylesheet href=/scss/common.min.0c3fdcc05ec210321169846714f74b11c4a1baf09a1833fa9273b2347c81e636.css><script src=/js/jquery-3.7.1.min.js></script><script src=/js/viewer.min.js></script><script src=/js/jquery.modal.min.js></script><script src=/swiper/swiper-bundle.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0888981f1fa45d241b1fb6962da2963e",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YYCVN36HT5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YYCVN36HT5")</script><script type=text/javascript>!function(e,t,n,s,o){e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=("https:"==document.location.protocol?"https://":"http://")+s,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio"),gio("init","8a24ae300cbf8b8c",{}),gio("send")</script><link rel=stylesheet href=/scss/content.min.f73b326fbf8c5bd331900b0de21c7dde608a4926f482f6465f9ae1d9049b83ad.css><link rel=stylesheet href=/scss/markdown.min.db47186481122431dffae72d17dbbd51f90b66f022cc163458645709924e4eac.css></head><body><header class=navigation><div class=join-div><div class=content>🚀 KubeSphere v4.1.3 发布，多项优化与改进，欢迎体验！<a href=/zh/docs/v4.1/20-release-notes/release-v413/ target=_blank rel="noopener noreferrer">请查看 Release notes →</a>
<img id=close-join src=/images/header/close.svg alt=close></div></div><div class=common-layout><div class=header-container><a href=/zh/ aria-label=logo><img src=/images/header/logo.svg alt class=logo></a><ul class=nav><li class=menu-li><span class=menu-span>应用场景</span><ul class="dropdown-menu menu-2"><li><a href=/zh/devops/>拥抱一站式 DevOps 工作流</a></li><li><a href=/zh/service-mesh/>在 Kubernetes 运行微服务</a></li><li><a href=/zh/observability/>构建丰富的云原生可观测性</a></li></ul></li><li class=menu-li><span class=menu-span>资源</span><ul class="dropdown-menu menu-3"><li><a href=/zh/projects/>开源项目</a></li><li><a href=/zh/conferences/>开源峰会</a></li><li><a href=/zh/blogs/>技术博客</a></li><li><a href=/zh/videos/>视频资源</a></li><li><a href=/zh/learn/>云原生实战</a></li></ul></li><li class=menu-li><span class=menu-span>文档中心</span><ul class="dropdown-menu menu-4"><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/ target=_blank rel="noopener noreferrer">扩展组件开发</a></li><li><a href=https://kube.design/ target=_blank rel="noopener noreferrer">Kube Design</a></li></ul></li><li class=menu-li><span class=menu-span>开源社区</span><ul class="dropdown-menu menu-5"><li><a href=/zh/contribution/>参与贡献</a></li><li><a href=/zh/live/>社区活动</a></li><li><a href=/zh/case/>案例学习</a></li><li><a href=/zh/partner/>合作伙伴</a></li><li><a href=/zh/user-group/>用户委员会</a></li><li><a href=/zh/news/>动态</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">版本计划</a></li><li><a href=https://www.kubesphere.io/zh/ target=_blank rel="noopener noreferrer">中国站</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025 target=_blank rel="noopener noreferrer">开源之夏 2025</a></li></ul></li><li><a data-docs=用户论坛 href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">用户论坛</a></li><li><a data-docs=认证 href=https://kubesphere.cloud/certification/ target=_blank rel="noopener noreferrer">认证</a></li></ul><div class=right-menu><ul><li class=language-menu><div><img src=/images/header/black.svg alt>
<span>简体中文</span></div><ul class=dropdown-menu><li onclick='handleLangClick("zh","/zh/blogs/kubesphere-gitlab-devops/")'>简体中文</li></ul></li><li class=github-li><div class=github-star><a class=star-btn href=https://github.com/kubesphere/kubesphere rel="noopener noreferrer" target=_blank><span class=star-img></span>&nbsp;<span>Star</span>
</a><a class=social-count href=https://github.com/kubesphere/kubesphere/stargazers rel="noopener noreferrer" target=_blank></a></div></li><li class=menu-icon><img src=/images/header/menu.svg alt></li></ul></div></div></div><div id=modal-for-menu class=modal><ul class=nav><li data-check=0 class=menu-li><span class=menu-span>应用场景</span><ul class=dropdown-menu><li><a href=/zh/devops/>拥抱一站式 DevOps 工作流</a></li><li><a href=/zh/service-mesh/>在 Kubernetes 运行微服务</a></li><li><a href=/zh/observability/>构建丰富的云原生可观测性</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>资源</span><ul class=dropdown-menu><li><a href=/zh/projects/>开源项目</a></li><li><a href=/zh/conferences/>开源峰会</a></li><li><a href=/zh/blogs/>技术博客</a></li><li><a href=/zh/videos/>视频资源</a></li><li><a href=/zh/learn/>云原生实战</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>文档中心</span><ul class=dropdown-menu><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/>扩展组件开发</a></li><li><a href=https://kube.design/>Kube Design</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>开源社区</span><ul class=dropdown-menu><li><a href=/zh/contribution/>参与贡献</a></li><li><a href=/zh/live/>社区活动</a></li><li><a href=/zh/case/>案例学习</a></li><li><a href=/zh/partner/>合作伙伴</a></li><li><a href=/zh/user-group/>用户委员会</a></li><li><a href=/zh/news/>动态</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md>版本计划</a></li><li><a href=https://www.kubesphere.io/zh/>中国站</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025>开源之夏 2025</a></li></ul></li><li><a data-docs=用户论坛 href=https://ask.kubesphere.io/forum>用户论坛</a></li><li><a data-docs=认证 href=https://kubesphere.cloud/certification/>认证</a></li></ul><div class=link-div><a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank rel="noopener noreferrer" aria-label=slack><img src=/images/header/slack-hover.svg alt>
</a><a href=https://x.com/KubeSphere target=_blank rel="noopener noreferrer" aria-label=twitter><img src=/images/header/twitter-hover.svg alt>
</a><a href=https://github.com/kubesphere/kubesphere target=_blank rel="noopener noreferrer" aria-label=github><img src=/images/header/github-hover.svg alt></a></div></div></header><script>var bindNavMouseEvent,bindScrollChangeHeader,bindClickShowMenu,bindClickModalLi,bindClickClose,language,handleLangClick,githubApiLink="https://api.github.com/repos/kubesphere/kubesphere",getStar=function(){$(".social-count").hide(),$.getJSON(githubApiLink,function(e){$(".social-count").show().html(e.stargazers_count)})};getStar(),bindNavMouseEvent=function(e,t){t||(t=$(e));var n=!1;t.mouseenter(function(){if(n)return!1;n=!0,$(this).find(".dropdown-menu").fadeIn(200,function(){n=!1})}),t.mouseleave(function(){$(this).find(".dropdown-menu").fadeOut(200)})},bindScrollChangeHeader=function(){var t=100,e=$("header");window.addEventListener("scroll",function(){var t=window.scrollY;t>0?e.addClass("navigationScroll"):e.removeClass("navigationScroll")})},bindClickShowMenu=function(){$(".menu-icon").click(function(){$("#modal-for-menu").modal()})},bindClickModalLi=function(){$(".modal .menu-li").click(function(){var e=$(this).data("check");e===0?($(this).data("check",1),$(this).find(".dropdown-menu").slideDown(200)):($(this).data("check",0),$(this).find(".dropdown-menu").slideUp(200)),$(this).find(".menu-span").toggleClass("up")})},bindClickClose=function(){$("#close-join").click(function(){$(".navigation .join-div").hide(),$(".main-section").removeClass("padding")})},language="zh",bindClickClose(),bindScrollChangeHeader(),$(".header-container .menu-li").each(function(){bindNavMouseEvent("",$(this))}),bindNavMouseEvent(".header-container .language-menu"),bindNavMouseEvent(".header-container .btn-li"),bindClickShowMenu(),bindClickModalLi(),handleLangClick=function(e,t){try{localStorage.setItem("lang",e)}catch{}location.href=t}</script><section class=main-section><div class=common-layout><div class=breadcrumb><span><a href=/zh/blogs/>技术博客</a> > </span><span>在 KubeSphere 中快速部署使用 GitLab 并构建 DevOps 项目</span></div><div class='main-div middle-div'><div class=author>张海立</div><span class=date>发布于：2022-02-09</span>&nbsp;&nbsp;&nbsp;
<span style=font-size:14px;color:#919aa3 id=busuanzi_container_page_pv>本文总阅读量：<span id=busuanzi_value_page_pv></span></span><h1>在 KubeSphere 中快速部署使用 GitLab 并构建 DevOps 项目</h1><div class=share-1><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-gitlab-devops%2f&text=%e5%9c%a8%20KubeSphere%20%e4%b8%ad%e5%bf%ab%e9%80%9f%e9%83%a8%e7%bd%b2%e4%bd%bf%e7%94%a8%20GitLab%20%e5%b9%b6%e6%9e%84%e5%bb%ba%20DevOps%20%e9%a1%b9%e7%9b%ae" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-gitlab-devops%2f&title=%e5%9c%a8%20KubeSphere%20%e4%b8%ad%e5%bf%ab%e9%80%9f%e9%83%a8%e7%bd%b2%e4%bd%bf%e7%94%a8%20GitLab%20%e5%b9%b6%e6%9e%84%e5%bb%ba%20DevOps%20%e9%a1%b9%e7%9b%ae" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-gitlab-devops%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-gitlab-devops%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-gitlab-devops%2f&t=%e5%9c%a8%20KubeSphere%20%e4%b8%ad%e5%bf%ab%e9%80%9f%e9%83%a8%e7%bd%b2%e4%bd%bf%e7%94%a8%20GitLab%20%e5%b9%b6%e6%9e%84%e5%bb%ba%20DevOps%20%e9%a1%b9%e7%9b%ae" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div><div class=content><div class=md-body><p>新年伊始，“极狐(GitLab) 联合青云（QingCloud 公有云服务和 KubeSphere 容器平台）、上海云轴（ZStack Cloud 云平台和 ZStack Cube 超融合一体机)、宝德计算、上海恒岳等国内多家知名云厂商和服务器厂商，首发 GitNative 系列产品解决方案，针对不同部署环境和应用场景，推出支持公有云、私有云、本地数据中心部署的 ‘GitNative 一体化 DevOps 平台’ 和 ‘GitNative CI/CD流水线引擎’ 解决方案。”</p><p>在社区看到上面<a href=https://mp.weixin.qq.com/s/3MyvKzPd9GgVUnjkws8YHQ target=_blank rel="noopener noreferrer">这条新闻</a>的时候有种 “虎躯一震” 的感觉，确实很高兴能看到国内的云社区、云厂商能在 DevOps 领域有这样接地气的商业产品合作，相信更多这样跨界合作产品的出现也会推动我们国内的 DevOps 社区及产品有进一步发展。那么对于我们开源社区的小伙伴而言，通过 GitLab 社区版以及 KubeSphere 平台提供的 DevOps 能力，其实也可以自己尝试搭建一套类似的 DevOps 平台来一起感受一下 Kubernetes 时代下 GitOps 体系的魅力。</p><p>所以我们本次分享将和大家一起动手来实践一下在 KubeSphere 部署 GitLab CE（Community Edition 社区版）并构建与之联动的 DevOps 项目。</p><h2 id=前提条件>前提条件</h2><h3 id=安装-kubesphere>安装 KubeSphere</h3><p>安装 KubeSphere 有两种方法。一是在 Linux 上直接安装，可以参考文档：<a href=https://kubesphere.com.cn/docs/quick-start/all-in-one-on-linux/ target=_blank rel="noopener noreferrer">在 Linux 安装 KubeSphere</a>； 二是在已有 Kubernetes 中安装，可以参考文档：<a href=https://kubesphere.com.cn/docs/quick-start/minimal-kubesphere-on-k8s/ target=_blank rel="noopener noreferrer">在 Kubernetes 安装 KubeSphere</a>。</p><h3 id=在-kubesphere-中启用-devops-套件>在 KubeSphere 中启用 DevOps 套件</h3><p>在 KubeSphere 中启用 DevOps 套件可以参考文档：<a href=https://kubesphere.com.cn/docs/pluggable-components/devops/ target=_blank rel="noopener noreferrer">启用可插拔组建 · KubeSphere DevOps 系统</a>。安装完成后可以在「平台管理」页面的「系统组建」部分看到 Jenkins 头像图标。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/d4fe7efb-c452-4e4f-b09a-9abf6cc03dc1.png alt></p><p>基于 <a href=https://jenkins.io/ target=_blank rel="noopener noreferrer">Jenkins</a> 的 KubeSphere DevOps 系统是专为 Kubernetes 中的 CI/CD 工作流设计的，它提供了一站式的解决方案，帮助开发和运维团队用非常简单的方式构建、测试和发布应用到 Kubernetes。它还具有插件管理、<a href=https://kubesphere.com.cn/docs/project-user-guide/image-builder/binary-to-image/ target=_blank rel="noopener noreferrer">Binary-to-Image (B2I)</a>、<a href=https://kubesphere.com.cn/docs/project-user-guide/image-builder/source-to-image/ target=_blank rel="noopener noreferrer">Source-to-Image (S2I)</a>、代码依赖缓存、代码质量分析等功能。文本只会涉及 KubeSphere DevOps 其中关于流水线使用的部分。</p><h2 id=安装-gitlab-ce>安装 GitLab CE</h2><blockquote><p>我们先这次的演练创建一个名为 <code>devops</code>的企业空间，同时创建一个名为 <code>gitlab</code>的项目供 GitLab CE 部署使用。</p></blockquote><h3 id=通过应用仓库部署-gitlab-应用>通过应用仓库部署 GitLab 应用</h3><p>首先我们还是要现在 <code>devops</code>企业空间中添加 GitLab 的官方 Helm Chart 仓库，推荐用这种自管理的方式来保障仓库内容是得到及时同步的。通过「应用管理」下面的「应用仓库」来添加如下的 GitLab 仓库（仓库 URL：<code>https://charts.gitlab.io/</code>）。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/db0734f0-2023-4554-b6f1-06fc9e8eb193.png alt></p><p>接下来进入先前创建的<code>gitlab</code>项目，从「应用负载」下面的「应用」页面创建 GitLab 应用：选择「从应用模版」创建即可得到如下界面，由于仓库内可安装的 Helm Chart 较多，注意选择红框指示的这个应用（撰稿时 Chart 最新版为 <code>5.7.0</code>，对于 GitLab 版本为 <code>14.7.0</code>）。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/4d632828-c9b4-471e-bbb0-87bf345b1362.png alt></p><p>下面这一步十分重要，需要配置 Helm Chart 部署应用的参数。由于 GitLab 默认的可配置项非常多（有上千行），因此我们这次只挑选 <strong>可保障基础业务使用的最小功能集</strong> 的相关参数进行改写，关于每个参数具体代表的含义请参见参数项上一行的注释（并留意【注意】部分）。其它配置项请大家参见 <a href=https://docs.gitlab.cn/charts/#%E6%9E%81%E7%8B%90gitlab-helm-chart-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B%E6%8C%87%E5%8D%97https://docs.gitlab.cn/charts/#%E6%9E%81%E7%8B%90gitlab-helm-chart-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B%E6%8C%87%E5%8D%97 target=_blank rel="noopener noreferrer">极狐GitLab Helm Chart 快速开始指南</a> 及其中的 <a href=https://docs.gitlab.cn/charts/#%E5%AE%8C%E6%95%B4%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8 target=_blank rel="noopener noreferrer">完整属性列表</a>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>global</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e>## 确保使用的版本是 Community Edition</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>edition</span>: <span style=color:#ae81ff>ce</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>## 全局 Host 配置：https://docs.gitlab.cn/charts/charts/globals.html#host-%E9%85%8D%E7%BD%AE</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#【注意】这里我们只绑定 GitLab 主体服务的域名，其它都可以使用默认值（不影响演练使用）</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e>#【注意】这个基础域名需要是 “部署 GitLab 的集群” 内可以访问的域名，否则各组件互联可能存在问题</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>domain</span>: <span style=color:#ae81ff>example.com</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#【注意】我们演练环境为了部署方便不启用 HTTPS，否则需要提供和填写的基础域名对应的证书</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>https</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>gitlab</span>: 
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>gitlab.example.com</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>## 全局 Ingress 配置：https://docs.gitlab.cn/charts/charts/globals.html#ingress-%E9%85%8D%E7%BD%AE</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ingress</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e>#【注意】我们由于全面关闭 HTTPS，所以这里也需要关闭 GitLab 自带的证书生成器</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>configureCertmanager</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#【注意】由于默认是使用自带 Nginx，即使用 &#34;gitlab-nginx&#34;，需要改为 KubeSphere 网关适配的值</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>class</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#【注意】默认是 true，需要强制关闭 HTTPS，和其它配置保持一致</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tls</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e>## 自带的 cert-manager 配置：https://github.com/jetstack/cert-manager</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#【注意】这里强制选择不安装 cert-manager</span>
</span></span><span style=display:flex><span><span style=color:#f92672>certmanager</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>installCRDs</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>install</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e>## 自带的 Nginx Ingress 配置：https://docs.gitlab.cn/charts/charts/nginx/</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#【注意】由于演练会直接使用 KubeSphere 项目/集群网关，这里直接关闭此项的安装配置</span>
</span></span><span style=display:flex><span><span style=color:#f92672>nginx-ingress</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e>## 自带的工件仓库组件：https://docs.gitlab.cn/charts/charts/registry/</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#【注意】由于不开启 HTTPS，使用各类工件仓库会有问题，这里建议就直接关闭此项安装配置</span>
</span></span><span style=display:flex><span><span style=color:#f92672>registry</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#75715e>## 自带的 MinIO 配置：https://docs.gitlab.cn/charts/charts/minio/</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#【注意】由于可以后续自行在 KubeSphere 中开启应用路由，这里建议直接关闭网关路由配置</span>
</span></span><span style=display:flex><span><span style=color:#f92672>minio</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ingress</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e>## 自带的 GitLab Runner 配置：https://docs.gitlab.cn/charts/charts/gitlab/gitlab-runner/</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#【注意】由于演练环境我们直接接入 KubeSphere DevOps 做 CI/CD，这里建议就先不安装 Runner </span>
</span></span><span style=display:flex><span><span style=color:#f92672>gitlab-runner</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>install</span>: <span style=color:#66d9ef>false</span>
</span></span></code></pre></div><p>虽然已经是最小功能集部署，但由于部署的服务及其资源开销较多，部署过程还是比较长的。部署完成后可以在 <code>gitlab</code>应用的「工作负载」部分查看到所有负载都在运行中的状态。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/d00b957e-cb4f-4adf-bebd-975c9cd2c233.png alt></p><p>此时<code>gitlab</code>应用状态处于<code>正在创建</code>，这是由于应用部署超时导致的，只要所有工作负载可以正常进入运行状态，是并不影响应用正常使用的。</p><p>由于部署时间很长，容易导致 MinIO 组件的舒适化 Bucket 任务失败，建议检查「应用负载」下的<code>gitlab-minio-create-buckets-1</code>任务，如果失败可以通过详情页左侧「更多操作」来「重新运行」，最终得到<code>已完成（1/1）</code>的状态即可认为成功。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/df16e14d-e342-4c10-9471-296b348f6362.png alt></p><p>确认所有工作负载运行后，如之前您已经配置过集群或项目网关并使能过<code>gitlab.example.com</code>的域名解析，那么您就可以直接访问该域名来打开 GitLab 的站点页面。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/fe1c3c1e-3531-468f-81b1-4ad150e06668.png alt></p><blockquote><p>关于如何在 KubeSphere 中设置集群或项目网关，您可以参考我们之前的 <a href=https://www.yuque.com/serviceup/cloud-native-talks/apisix-in-kubesphere target=_blank rel="noopener noreferrer">技术博客</a>。<strong>同时请确保您的网关是可以直接使用 HTTP 标准的</strong><code>**80**</code><strong>端口来提供访问能力的！</strong></p></blockquote><h3 id=在-gitlab-中创建一个示例项目>在 GitLab 中创建一个示例项目</h3><p>首先让我们来登陆 GitLab。GitLab 的初始密码被作为 Secret 保存，我们可以回到项目首页，在「配置」下的「保密字典」中搜索<code>initial</code>可以找到 <code>gitlab-initial-root-password</code>的条目。点击该字典条目，并在「数据」区块中点击最右侧的眼睛图标来展示<code>password</code>数据项的内容。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/e7ed83d8-f0a1-4b06-8667-57f1e38ef918.png alt></p><p>复制该密码，并使用<code>root</code>作为用户名，即可登陆 GitLab 得到如下图所示的界面。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/720ba387-e190-44d3-ba89-1118329f1116.png alt></p><p>点击「New Project」按钮进入创建项目的页面，通过「Create from Template」我们可以来创建一个示例项目用于后面的流水线演练。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/d0481a65-ef8a-478c-9463-fed7afde3da8.png alt></p><p>让我们选择<code>NodeJS Express</code>这个项目模版来创建应用，所有模版都可以通过 Preview 按钮来预览其中的内容，使用模版后得到如下创建项目界面。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/b5eb9243-f962-4530-bea9-105b3f6f30e6.png alt></p><p>填入您偏好的项目名称，并在项目可见度这里选择默认的<code>Private</code>来创建私有项目，以便于后续演示如果访问私有项目。完成导入后可以得到如下的项目页面。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/24a420d2-7f9d-407b-a70c-0a0317d82671.png alt></p><h3 id=关闭-auto-devops-并创建-jenkinsfile>关闭 Auto DevOps 并创建 Jenkinsfile</h3><p>由于我们后续要使用 KubeSphere DevOps，而 GitLab 默认开启了 Auto DevOps 功能（会为无 CI 配置的项目自动提供流水线支持），为了避免混乱，我们先暂时关闭 Auto DevOps。</p><p>找到项目页面中间部位的文件及功能快捷入口区域，点击「Auto DevOps enabled」按钮块，进入配置页面后取消<code>Default to Auto DevOps pipeline</code>的勾选并「Save changes」，即可完成 Auto DevOps 功能的关闭。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/331c4732-c852-49a6-af67-70697a8b789e.png alt></p><p>接下来，我们还需要为这个项目创建一个 Jenkinsfile 用于后续 KubeSphere DevOps 流水线的构建。在<code>master</code>分支下直接创建一个名为<code>Jenkinsfile</code>的文件，填入以下内容即可。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>pipeline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    agent any
</span></span><span style=display:flex><span>    stages <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;Example&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                echo <span style=color:#e6db74>&#39;Hello World&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    post <span style=color:#f92672>{</span> 
</span></span><span style=display:flex><span>        always <span style=color:#f92672>{</span> 
</span></span><span style=display:flex><span>            echo <span style=color:#e6db74>&#39;I will always say Hello again!&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=使用-kubesphere-devops-为-gitlab-提供流水线>使用 KubeSphere DevOps 为 GitLab 提供流水线</h2><blockquote><p>我们首先在<code>devops</code>的企业空间中创建一个名为<code>demo</code>的 DevOps 项目，用于后续演练如何为 GitLab 创建流水线。</p></blockquote><h3 id=将-gitlab-与-kubesphere-jenkins-进行绑定>将 GitLab 与 KubeSphere Jenkins 进行绑定</h3><blockquote><p>由于 KubeSphere Jenkins 默认绑定的 GitLab 服务是官方的<code>gitlab.com</code>，因此在创建流水线前需要先重新绑定到我们创建的私有 GitLab 服务上。</p></blockquote><p>首先，我们需要打开 KubeSphere Jenkins 的页面，为了操作方便，我们直接为<code>kubesphere-devops-system</code>命名空间下的<code>devops-jenkins</code>开放 NodePort。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/e3070904-7260-4178-b70d-ae49dd26fa6e.png alt></p><p>使用 KubeSphere 账号登陆 Jenkins（<strong>如果登陆失败可能是账号同步问题，可以修改一次密码再次尝试</strong>）。通过「Manage Jenkins ➡️ Configure System」进入系统配置页面，找到 <code>GitLab Servers</code>配置区，点击「Add GitLab Server」开始添加我们的 GitLab 服务。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/05d054da-942c-4943-abc9-08ac810e04af.png alt></p><p>如上图所示，需要填写或编辑的配置项一共有三项：</p><ul><li><code>Server URL</code>：这里填入我们刚刚部署完成的 GitLab 服务的访问方式（如果是域名访问，一定需要是 Jenkins 也可达的域名）</li><li><code>Crendentials</code>：这里选择或创建一个 Jenkins 的的凭证项，该凭证需要是 GitLab 某个用户的 Personal Access Token（下面我们会继续说明如何创建）</li><li><code>Web Hook</code>：这个一定要勾选 <code>Manage Web Hooks</code>这项，用于我们之后同步 Jenkins Pipeline 的状态到我们的 GitLab 服务中</li></ul><h4 id=创建-gitlab-personal-access-token-的-jenkins-crendential>创建 GitLab Personal Access Token 的 Jenkins Crendential</h4><p>首先，我们回到 GitLab 中，可以直接通过<code>&lt;gitlab-url>/-/profile/personal_access_tokens</code>（例如本文可使用<code>[http://gitlab.example.com/-/profile/personal_access_tokens](http://gitlab.example.com:30433/-/profile/personal_access_tokens)</code>）来访问 Personal Access Tokens 的创建页面。按 Jenkins 的要求，我们创建一个名为 <code>jenkins</code>且具备<code>api``read_repository``write_repository</code>权限的令牌，复制令牌字符串备用。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/45441243-d2bc-47f5-b4ea-64ee17b0704a.png alt></p><p>然后我们回到 Jenkins 首页，从「Manage Jenkins ➡️ Manage Crendentials ➡️ Stores scoped to Jenkins ➡️ Jenkins ➡️ Global crendentials (unrestricted)」进入凭证创建页面。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/c0ddbf8c-32ae-4d2d-8b6a-c3bb8f45e80d.png alt></p><p>点击左侧面板的「Add Credentials」即可开始创建凭证，填写完成后点击<code>Ok</code>保存即可完成凭证创建：</p><ul><li><code>Kind</code>选择<code>GitLab Personal Access Token</code></li><li><code>Scope</code>选择默认的<code>Global</code>，<code>ID</code>填入任意不产生命名冲突的 ID</li><li><code>Token</code>填入刚刚复制备用的 GitLab 令牌字符串（可忽略字符串长度的提示）</li></ul><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/4a10b91e-17a5-4acf-aaec-72b95a76232b.png alt></p><p>完成这部分配置之后，KubeSphere DevOps 流水线的状态也会和我们 GitLab 中的 Pipeline 状态形成联动，大家可以参看视频中的效果。</p><ul><li><a href=https://www.bilibili.com/video/BV18U4y1T7tv target=_blank rel="noopener noreferrer">https://www.bilibili.com/video/BV18U4y1T7tv</a></li></ul><h3 id=使用-jenkinsfile-创建-kubesphere-devops-流水线>使用 Jenkinsfile 创建 KubeSphere DevOps 流水线</h3><p>让我们进入之前创建的<code>demo</code>DevOps 项目，开始「创建」流水线。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/056320e3-311f-4b89-b1f4-3ddbc88aa717.png alt></p><p>在弹出的「创建流水线」对话框中，我们填入一个流水线「名称」并点击下方「代码仓库（可选）」这个区域来进行代码仓库绑定。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/90a47783-b5d2-4f80-990c-ff02818cefe7.png alt></p><p>进入到「选择代码仓库」面板后，我们选择<code>GitLab</code>标签页，然后在「GitLab 服务器地址」下拉框中选择我们上一小节在 Jenkins 中添加到<code>GitLab CE</code>服务器。
由于我们演练的是私有仓库访问，下面需要先选择一个凭证用于访问私有代码仓库。在之前没有创建的情况下，这里我们点击绿色的「创建凭证」链接开始创建。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/5f27f7bd-a54d-4337-a71a-77bd49e06204.png alt></p><p>在弹出的「创建凭证」对话框中，输入「名称」后选定类型为<code>用户名和密码</code>；然后在「用户名」文本框中输入我们的账号<code>root</code>，在「密码/令牌」中输入之前从保密字典中获取到的初始密码。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/e9cf1db6-df96-4890-a846-7a91c4668a35.png alt></p><p>通过「确定」按钮保存凭证后回到「选择代码面板」，在「凭证」下拉框中选择刚刚创建的<code>gitlab-root</code>，然后在「项目组/所有者」文本库中填入我们的账号<code>root</code>，点击「代码仓库」下拉框可看到<code>root</code>账号下所有的代码仓库，这里我们可以看到并选择之前创建的示例项目<code>root/nodejs-demo</code>。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/87a13f60-a690-4fa8-b5ca-8999d1ec8270.png alt></p><p>通过 ☑️ 按钮确认并保存配置后会再次回到「创建流水线」面板，此时可以看到「代码仓库」已出现我们选择的<code>root/nodejs-demo</code>项目，点击「下一步」进入「高级设置」标签页，这里我们不做额外的配置，直接点击「确定」来创建流水线。创建成功后，我们可以看到如下一个「分支数量」为<code>0</code>并且健康的流水线。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/8c5175e9-05c4-4d50-b991-309dc6cd7468.png alt></p><p>稍后片刻点击进入新建的<code>file</code>流水线，可以看到系统已经扫描到带有<code>Jenkinsfile</code>的<code>master</code>分支并已经开始运行流水线。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/21f166fc-bb9a-46c0-8142-4014784e5a9f.png alt></p><p>点击<code>master</code>分支进入分支详情页面，不管运行成功还是失败都可以进一步点击「运行 ID」一栏中的序号来查看详细的运行日志及制品等。</p><p>等待一段时间后运行成功，进入运行 ID 为<code>1</code>的运行记录可以看到如下图展示的界面。进一步我们可以点击右上角的「查看日志」按钮来了解详细的流水线执行情况。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/498520b2-7264-44b0-96d4-5a71357cd22e.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/fc7f8e5c-794a-40f3-a0ef-82071046e78d.png alt></p><blockquote><p>注意：对于多分支流水线，默认会先执行<code>checkout scm</code>步骤，然后再执行 Jenkinsfile 中定义的流水线内容。</p></blockquote><h3 id=使用图形编辑器创建-kubesphere-devops-流水线>使用图形编辑器创建 KubeSphere DevOps 流水线</h3><blockquote><p>本小节内容可参考 KubeSphere 官方文档：DevOps 用户指南 / 使用 DevOps / <a href=https://kubesphere.com.cn/docs/devops-user-guide/how-to-use/create-a-pipeline-using-graphical-editing-panel/ target=_blank rel="noopener noreferrer">使用图形编辑面板创建流水线</a></p></blockquote><p>KubeSphere DevOps 流水线也可以通过图形编辑界面来进行创建，让我们重新回到<code>demo</code>DevOps 项目首页，「创建」一个新流水线。这次在「创建流水线」面板中我们不绑定代码仓库，直接「下一步」再直接「创建」一个名为<code>gui</code>的流水线。</p><p>进入流水线详情页面后，我们可以在右侧面板看到「编辑流水线」的按钮，点击后在弹出的「选择流水线模版」对话框中，我们选择<code>自定义流水线</code>。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/49f0b26c-5b20-4c40-b248-0e8d5e605678.png alt></p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/d7aeae17-2d68-49bb-a432-d04f14338be9.png alt></p><p>另两个流水线模版包含了更完整的 CI / CD 流水线构建示例，但内容相对复杂，欢迎大家线下自行选用进行体验！</p><p>下面我们尝试用图形编辑器复现前一小节的两个操作步骤，即拉起代码，并打印一条 Hello World 消息。首先，我们点击左侧面板的<code>+</code>按钮，然后选中添加出来的一个阶段块。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/0a8c15d9-2b59-4953-8cf2-cd3a498b32d3.png alt></p><p>接着我们点击左侧阶段块上的「+ 添加步骤」，并在右侧刷出的「添加步骤」面板中选则<code>git</code>步骤，在弹出的对话框中填入我们示例代码仓库的地址 HTTP Git 地址（如<code>[http://gitlab.example.com/root/nodejs-demo.git](http://gitlab.example.com/root/nodejs-demo.git)</code>），凭证选用之前创建的<code>gitlab-root</code>，分支填写<code>master</code>。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/1703dfa7-9b9f-4404-b3fa-239babd71c4a.png alt></p><p>完成后我们依样画葫芦，再次添加一个<code>打印消息</code>步骤并填入<code>Hello World!</code>作为内容，最后得到如下图所示的整体效果。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/98efe644-03e7-4e48-a56f-c5dab4f99863.png alt></p><p>完成编辑后「确定」再「确定」来保存流水线，回到详情页面后，可以通过右上角的「运行」按钮来执行流水线。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/72c60398-fbcb-4535-ba2f-57b58c31a3ba.png alt></p><p>运行成功后可以再次查看流水线运行记录，并查看运行日志，得到如下图所示结果。</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/e6ece6e7-9f24-4120-a2da-e1de564cb8e2.png alt></p><h2 id=番外使用-ssh-访问-kubernetes-集群中的-gitlab-代码仓库>【番外】使用 SSH 访问 Kubernetes 集群中的 GitLab 代码仓库</h2><p>前文介绍的代码仓库的访问方式都是通过 HTTP 的形式，但现实工作中我们最常用的还是 SSH 的访问方式，那是否可以直接通过<code>git clone git@gitlab.example.com:root/nodejs-demo.git</code>这样的方式来拉取和推送代码呢？</p><p>答案是肯定的：可以！但是这里有一个大坑需要注意 —— 默认 SSH 用的是<code>22</code>端口，但多了一层 Kubernetes 网络之后，不管是否使用这个默认端口都需要处理好 GitLab 如何对外暴露 SSH 服务。</p><p>假设我们可以接受重新绑定一个端口来使用 GitLab SSH，那么可以这样操作：</p><ul><li>首先，我们回到 GitLab 部署项目中，找到 <code>gitlab-shell</code>服务并为它开放 NodePort 外部访问端口</li></ul><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/2847f737-9126-4464-9dc5-3d99791b7568.png alt></p><ul><li>基于这个端口，把 Git 访问的地址都改为<code>ssh://git@&lt;gitlab-url>:&lt;gitlab-shell-port>/&lt;username>/&lt;repo>.git</code>的形式，例如<code>ssh://git@gitlab.example.com:32222/root/nodejs-demo.git</code></li></ul><blockquote><p>写在最后：感谢您这么耐心的看完这整个教程！如果您觉得这些内容如果自己部署起来确实有点挑战，那推荐可以看看 <a href=https://gitlab.cn/ target=_blank rel="noopener noreferrer">极狐GitLab</a> 和 <a href=https://kubesphere.cloud/ target=_blank rel="noopener noreferrer">KubeSphere Cloud</a> 的一些商业产品，让专业的人做专业的事儿，释放大家的时间更好的打磨自己的业务产品。也期待看到更多的开源社区和商业产品的良性互动，一起推动我们国内的软件产业在虎年 “虎踞龙盘今胜昔，天翻地覆慨而慷”！</p></blockquote></div></div><div class=share-2><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-gitlab-devops%2f&text=%e5%9c%a8%20KubeSphere%20%e4%b8%ad%e5%bf%ab%e9%80%9f%e9%83%a8%e7%bd%b2%e4%bd%bf%e7%94%a8%20GitLab%20%e5%b9%b6%e6%9e%84%e5%bb%ba%20DevOps%20%e9%a1%b9%e7%9b%ae" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-gitlab-devops%2f&title=%e5%9c%a8%20KubeSphere%20%e4%b8%ad%e5%bf%ab%e9%80%9f%e9%83%a8%e7%bd%b2%e4%bd%bf%e7%94%a8%20GitLab%20%e5%b9%b6%e6%9e%84%e5%bb%ba%20DevOps%20%e9%a1%b9%e7%9b%ae" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-gitlab-devops%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-gitlab-devops%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubesphere-gitlab-devops%2f&t=%e5%9c%a8%20KubeSphere%20%e4%b8%ad%e5%bf%ab%e9%80%9f%e9%83%a8%e7%bd%b2%e4%bd%bf%e7%94%a8%20GitLab%20%e5%b9%b6%e6%9e%84%e5%bb%ba%20DevOps%20%e9%a1%b9%e7%9b%ae" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div></div><div class=aside><div class=inner-div><div class=title>目录</div><div class=tabs><nav id=TableOfContents><ul><li><a href=#前提条件>前提条件</a><ul><li><a href=#安装-kubesphere>安装 KubeSphere</a></li><li><a href=#在-kubesphere-中启用-devops-套件>在 KubeSphere 中启用 DevOps 套件</a></li></ul></li><li><a href=#安装-gitlab-ce>安装 GitLab CE</a><ul><li><a href=#通过应用仓库部署-gitlab-应用>通过应用仓库部署 GitLab 应用</a></li><li><a href=#在-gitlab-中创建一个示例项目>在 GitLab 中创建一个示例项目</a></li><li><a href=#关闭-auto-devops-并创建-jenkinsfile>关闭 Auto DevOps 并创建 Jenkinsfile</a></li></ul></li><li><a href=#使用-kubesphere-devops-为-gitlab-提供流水线>使用 KubeSphere DevOps 为 GitLab 提供流水线</a><ul><li><a href=#将-gitlab-与-kubesphere-jenkins-进行绑定>将 GitLab 与 KubeSphere Jenkins 进行绑定</a></li><li><a href=#使用-jenkinsfile-创建-kubesphere-devops-流水线>使用 Jenkinsfile 创建 KubeSphere DevOps 流水线</a></li><li><a href=#使用图形编辑器创建-kubesphere-devops-流水线>使用图形编辑器创建 KubeSphere DevOps 流水线</a></li></ul></li><li><a href=#番外使用-ssh-访问-kubernetes-集群中的-gitlab-代码仓库>【番外】使用 SSH 访问 Kubernetes 集群中的 GitLab 代码仓库</a></li></ul></nav></div></div></div></div></section><div class=SubscribeForm><div class=innerBox><img class=close src=/images/home/close.svg alt=close><p class=description>通过邮件接收 KubeSphere 最新的技术博客与产品更新的通知</p><div id=blog_formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input-blog type=text placeholder>
<button id=email-submit-blog>订阅</button>
<span id=message_blog data-message1=请提供您的邮箱 data-message2=请输入有效的邮箱地址! data-message3=邮箱地址已经存在 style=color:red></span><span id=message1_blog style=color:#00a971 data-success=订阅成功啦，我们保证不会给你发垃圾邮件的啦></span></div></div></div><footer><div class=footer><div class="footer-main common-layout"><div class=up-main><div class=left-div><img src=/images/logo.svg alt class=foot-logo><p>通过邮件接收 KubeSphere 最新的技术博客与产品更新的通知</p><div id=formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input type=text placeholder=请输入您的邮箱地址>
<button id=email-submit>订阅</button></div><span id=message data-message1=请提供您的邮箱 data-message2=请输入有效的邮箱地址! data-message3=邮箱地址已经存在></span><span id=message1 style=color:#00a971 data-success=订阅成功啦，我们保证不会给你发垃圾邮件的啦></span><script>var bindSubmit=function(){var e=$("#email-input");$("#email-submit").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message").data("message1"),a=$("#message").data("message2"),r=$("#message").data("message3"),c=$("#message1").data("success");if(n)if(validateEmail(n)){if(s=$("#formAddress").data("usesendcloud"),!s)return;o=$("#formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:$("#email-input").val().toString()},success:function(){showSuccessMessage(c),setTimeout(function(){$("#email-input").val("")},1e3)},error:function(){showMessage(r)}})}else t.preventDefault(),showMessage(a);else t.preventDefault(),showMessage(i)})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},showMessage=function(e){$("#message").html(e).show()},showSuccessMessage=function(e){$("#message1").html(e).show()},bindHideMessage=function(){$(window).click(function(){$("#message").hide(),$("#message1").hide()})},bindClose=function(){$(".formBox .close").click(function(e){e.stopPropagation(),$(".formBox").fadeOut()})};bindSubmit(),bindClose(),bindHideMessage()</script><span id=message data-message1=请提供您的邮箱 data-message2=请输入有效的邮箱地址!></span></div><div class=right-div><ul class=common-flex-layout><li class=nowrap-li><div class=h3>应用场景</div><a href=/zh/devops/>拥抱一站式 DevOps</a>
<a href=/zh/service-mesh/>在 K8s 运行微服务</a>
<a href=/zh/observability/>构建云原生可观测性</a>
<a href=https://github.com/kubesphere/kubekey target=_blank rel="noopener noreferrer">K8s 一键部署与运维</a>
<a href=https://github.com/OpenFunction/OpenFunction target=_blank rel="noopener noreferrer">构建 FaaS 平台与 Serverless 架构</a>
<a href=https://github.com/openpitrix/openpitrix target=_blank rel="noopener noreferrer">多云应用管理平台</a></li><li class=nowrap-li><div class=h3>资源</div><a href=/zh/projects/>开源项目</a>
<a href=/zh/blogs/>技术博客</a>
<a href=/zh/conferences/>开源峰会</a>
<a href=/zh/videos/>视频资源</a>
<a href=/zh/learn/>云原生实战</a></li><li class=nowrap-li><div class=h3>文档中心</div><a href=/zh/docs/v4.1/01-intro/01-introduction/>产品介绍</a>
<a href=/zh/docs/v4.1/03-installation-and-upgrade/02-install-kubesphere/02-install-kubernetes-and-kubesphere/>如何安装</a>
<a href=/zh/docs/v4.1/02-quickstart/>快速入门</a>
<a href=/zh/docs/v3.4/reference/api-docs/>API 文档</a></li><li class=nowrap-li><div class=h3>开源社区</div><a href=/zh/contribution/>参与贡献</a>
<a href=/zh/live/>社区活动</a>
<a href=/zh/case/>案例学习</a>
<a href=/zh/partner/>合作伙伴</a>
<a href=/zh/user-group/>用户委员会</a>
<a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">版本计划</a>
<a href=https://kubesphere.com.cn/ target=_blank rel="noopener noreferrer">中国站</a>
<a href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">中文论坛</a>
<a href=https://kubesphere.io target=_blank rel="noopener noreferrer">全球站</a></li><li class=nowrap-li><div class=h3>产品与服务</div><a href=https://aws.amazon.com/cn/quickstart/architecture/qingcloud-kubesphere/ target=_blank rel="noopener noreferrer">KubeSphere on AWS</a>
<a href=https://market.azure.cn/marketplace/apps/qingcloud.kubesphere target=_blank rel="noopener noreferrer">KubeSphere on Azure</a>
<a href=https://marketplace.digitalocean.com/apps/kubesphere target=_blank rel="noopener noreferrer">KubeSphere on DigitalOcean</a>
<a href=https://www.qingcloud.com/products/kubesphereqke target=_blank rel="noopener noreferrer">KubeSphere on QingCloud(QKE)</a>
<a href=https://kubesphere.com.cn/kse/ target=_blank rel="noopener noreferrer">KubeSphere 企业版</a>
<a href=https://kubesphere.cloud/ksv/ target=_blank rel="noopener noreferrer">KubeSphere 虚拟化平台</a>
<a href=https://kubesphere.com.cn/marketplace/ target=_blank rel="noopener noreferrer">云原生扩展组件市场</a>
<a href=https://kubesphere.cloud target=_blank rel="noopener noreferrer">云原生应用服务平台</a>
<a href=https://m.qingcloud.com/p/aec50 target=_blank rel="noopener noreferrer">了解商业产品与咨询合作</a></li></ul></div></div><div class=down-main><div class=img-div><a class=wechat href=javascript:void(0); aria-label=wechat><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28"><defs><path id="a" d="M0 0h15.673v12.156H0z"/></defs><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="13" cy="13" r="13" stroke="#B6C2CD"/><g transform="translate(5 7)"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59.0-4.625 1.679-4.625 3.74.0 2.066 2.035 3.738 4.625 3.738.542.0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27.0-.541-.257-.541-.514.0-.256.27-.514.541-.514.41.0.681.258.681.514.0.257-.271.514-.681.514zm2.994.0c-.27.0-.541-.257-.541-.514.0-.256.27-.514.54-.514.41.0.681.258.681.514.0.257-.277.514-.68.514z" mask="url(#b)"/><path fill="currentColor" d="M10.602 3.674c.177.0.356.011.533.029C10.657 1.576 8.27.0 5.543.0 2.498.0.0 1.974.0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17.0.343-.005.515-.022a3.68 3.68.0 01-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417.0.693.263.693.66s-.276.66-.693.66c-.418.0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417.0-.834-.263-.834-.66s.417-.66.834-.66c.418.0.695.263.695.66.0.392-.277.66-.695.66z" mask="url(#b)"/></g></g></svg><div class=hide-div><img src=/images/home/wechat.svg alt></div></a><a class=facebook-a href=https://www.facebook.com/kubesphere target=_blank aria-label=facebook></a><a class=twitter-a href=https://x.com/KubeSphere target=_blank aria-label=twitter rel="noopener noreferrer"></a><a class=linkedin-a href=https://www.linkedin.com/company/kubesphere/ target=_blank aria-label=linkedin rel="noopener noreferrer"></a><a class=bilibili-a href=https://space.bilibili.com/438908638 target=_blank aria-label=bilibili rel="noopener noreferrer"></a><a class=slack-a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank aria-label=slack rel="noopener noreferrer"></a><a class=github-a href=https://github.com/kubesphere/kubesphere target=_blank aria-label=github rel="noopener noreferrer"></a><a class=medium-a href=https://itnext.io/@kubesphere target=_blank aria-label=medium rel="noopener noreferrer"></a></div><p class=p1></p><p class=case><a href=http://www.beian.miit.gov.cn/ target=_blank rel="noopener noreferrer"><span>京ICP备13019086号</span>
</a><a target=_blank rel="noopener noreferrer" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502041003"><img src=/images/footer/case-icon.png alt=备案图标>
<span>京公网安备 11010502041003号</span></a></p></div></div></div><div class=cookie><div class=common-layout><p>您的隐私对我们很重要。我们使用Cookie来记住订阅详细信息，优化网站功能并交付根据您的兴趣量身定制的内容。要了解更多信息，请参阅我们的<a href=/zh/privacy>隐私政策</a>.</p><button>
接受并继续</button></div></div></footer><script>var lazyLoad=function(e,t){for(var n,o,i,s=0;s<t;s++){if(n=e.eq(s),o=n.attr("data-loaded"),o)continue;n.offset().top<parseInt($(window).height())+parseInt($(window).scrollTop())&&(i=n.attr("src"),n.attr("src",i),n.attr("data-loaded",!0))}},bindLayLoad=function(){var e=$("img"),t=e.length;lazyLoad(e,t),$(window).scroll(function(){lazyLoad(e,t)})},bindAddPadding=function(){var e=$("#close-join");e.length>0&&$(".main-section").addClass("padding")},docCookies={getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t){return!!e&&!/^(?:expires|max-age|path|domain|secure)$/i.test(e)&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t),!0)}},bindHideCookie=function(){var t=docCookies.getItem("hasAuth"),e=$(".cookie");t?e.hide():e.show(),e.find("button").on("click",function(){docCookies.setItem("hasAuth","1"),e.hide()})};bindAddPadding(),bindHideCookie()</script><script type=text/javascript src=/js/aside.2d6977c0f16aef4ed3e886dd66675ce74bd0efcd467c2b2bcdb30b92d5e7c7c0e5c6e0c9d8f09a883c22f58df9e6b0b6347fcdd3c9a920b7faba6d7f91a201c3.js integrity="sha512-LWl3wPFq707T6IbdZmdc50vQ781GfCsrzbMLktXnx8DlxuDJ2PCaiDwi9Y355rC2NH/N08mpILf6um1/kaIBww=="></script><script type=text/javascript src=/js/markdown-tab.17f9f46b021adebc7250ce1b07134a577b307e7a436daa4aaf388f218e8463966f53770b26a64817c06c168738a887672d47fb4c29615adfc446e11d09a344cf.js integrity="sha512-F/n0awIa3rxyUM4bBxNKV3swfnpDbapKrziPIY6EY5ZvU3cLJqZIF8BsFoc4qIdnLUf7TClhWt/ERuEdCaNEzw=="></script><script>let forbidForm=!1;var viewer=new Viewer(document.querySelector(".md-body"),{url:"src"}),blogBindSubmit=function(){var e=$("#email-input-blog");$("#email-submit-blog").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message_blog").data("message1"),a=$("#message_blog").data("message2"),r=$("#message_blog").data("message3"),c=$("#message1_blog").data("success");if(n)if(validateEmail(n)){if(s=$("#blog_formAddress").data("usesendcloud"),!s)return;o=$("#blog_formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:n.toString()},success:function(){showSuccessMessage_blog(c),setTimeout(function(){window.onscroll="",$(".SubscribeForm").hide(),$("#email-input-blog").val("")},5e3)},error:function(){showMessage_blog(r)}})}else t.preventDefault(),$("#message_blog").html(a).show();else t.preventDefault(),$("#message_blog").html(i).show()})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},bindHideMessageBlog=function(){$(window).click(function(){$("#message_blog").hide()})},bindCloseBlog=function(){$(".SubscribeForm .close").click(function(e){e.stopPropagation(),$(".SubscribeForm").fadeOut(),window.onscroll=""})},showMessage_blog=function(e){$("#message_blog").html(e).show()},showSuccessMessage_blog=function(e){$("#message1_blog").html(e).show()};window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;forbidForm&&(window.onscroll=""),e+t>n-710?$(".SubscribeForm").hide():$(".SubscribeForm").show()},blogBindSubmit(),bindCloseBlog(),bindHideMessageBlog()</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>