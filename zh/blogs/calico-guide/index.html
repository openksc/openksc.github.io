<!doctype html><html lang=en-US><head><meta charset=utf-8><title>Calico è·¯ç”±åå°„æ¨¡å¼æƒå¨æŒ‡å—</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ä½œä¸º Kubernetes æœ€é•¿ä½¿ç”¨çš„ä¸€ç§ç½‘ç»œæ’ä»¶ï¼ŒCalico å…·æœ‰å¾ˆå¼ºçš„æ‰©å±•æ€§ï¼Œè¾ƒä¼˜çš„èµ„æºåˆ©ç”¨å’Œè¾ƒå°‘çš„ä¾èµ–ï¼Œç›¸è¾ƒäº Flannel æ’ä»¶é‡‡ç”¨ Overlay çš„ç½‘ç»œï¼ŒCalico å¯ä»¥é€šè¿‡ä¸‰å±‚è·¯ç”±çš„æ–¹å¼é‡‡ç”¨æ€§èƒ½æ›´ä½³çš„ Underlay ç½‘ç»œï¼ŒCalico ç½‘ç»œæ’ä»¶çš„è½¬å‘æ•ˆç‡æ˜¯æ‰€æœ‰æ–¹æ¡ˆä¸­è¾ƒé«˜çš„ã€‚"><meta name=keywords content="Kubernetes,KubeSphere,Calico,ç½‘ç»œæ’ä»¶,CNI"><meta property="og:type" content="article"><meta property="og:title" content="Calico è·¯ç”±åå°„æ¨¡å¼æƒå¨æŒ‡å—"><meta property="og:description" content="ä½œä¸º Kubernetes æœ€é•¿ä½¿ç”¨çš„ä¸€ç§ç½‘ç»œæ’ä»¶ï¼ŒCalico å…·æœ‰å¾ˆå¼ºçš„æ‰©å±•æ€§ï¼Œè¾ƒä¼˜çš„èµ„æºåˆ©ç”¨å’Œè¾ƒå°‘çš„ä¾èµ–ï¼Œç›¸è¾ƒäº Flannel æ’ä»¶é‡‡ç”¨ Overlay çš„ç½‘ç»œï¼ŒCalico å¯ä»¥é€šè¿‡ä¸‰å±‚è·¯ç”±çš„æ–¹å¼é‡‡ç”¨æ€§èƒ½æ›´ä½³çš„ Underlay ç½‘ç»œï¼ŒCalico ç½‘ç»œæ’ä»¶çš„è½¬å‘æ•ˆç‡æ˜¯æ‰€æœ‰æ–¹æ¡ˆä¸­è¾ƒé«˜çš„ã€‚"><meta property="og:image" content="https://pek3b.qingstor.com/kubesphere-community/images/calico-cover.png"><meta property="og:url" content="https://openksc.github.io/zh/blogs/calico-guide/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeSphere"><meta property="twitter:image" content="https://pek3b.qingstor.com/kubesphere-community/images/calico-cover.png"><meta name=docsearch:language content="zh-CN"><meta name=docsearch:version content><link rel=canonical href=https://kubesphere.io/zh/blogs/calico-guide/><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=apple-touch-icon href=/images/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/svg+xml href=/images/favicons/favicon.svg><link rel=icon type=image/png href=/images/favicons/favicon.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg color=#00ad6e><meta name=msapplication-config content='/images/favicons/browserconfig.xml'><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/fonts/Roboto/stylesheet.css><link rel=stylesheet href=/fonts/ProximaNova/stylesheet.css><link rel=stylesheet href=/css/jquery.modal.min.css><link rel=stylesheet href=/css/viewer.min.css><link rel=stylesheet href=/swiper/swiper-bundle.min.css><link rel=stylesheet href=/scss/common.min.0c3fdcc05ec210321169846714f74b11c4a1baf09a1833fa9273b2347c81e636.css><script src=/js/jquery-3.7.1.min.js></script><script src=/js/viewer.min.js></script><script src=/js/jquery.modal.min.js></script><script src=/swiper/swiper-bundle.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0888981f1fa45d241b1fb6962da2963e",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YYCVN36HT5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YYCVN36HT5")</script><script type=text/javascript>!function(e,t,n,s,o){e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=("https:"==document.location.protocol?"https://":"http://")+s,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio"),gio("init","8a24ae300cbf8b8c",{}),gio("send")</script><link rel=stylesheet href=/scss/content.min.f73b326fbf8c5bd331900b0de21c7dde608a4926f482f6465f9ae1d9049b83ad.css><link rel=stylesheet href=/scss/markdown.min.db47186481122431dffae72d17dbbd51f90b66f022cc163458645709924e4eac.css></head><body><header class=navigation><div class=join-div><div class=content>ğŸš€ KubeSphere v4.1.3 å‘å¸ƒï¼Œå¤šé¡¹ä¼˜åŒ–ä¸æ”¹è¿›ï¼Œæ¬¢è¿ä½“éªŒï¼<a href=/zh/docs/v4.1/20-release-notes/release-v413/ target=_blank rel="noopener noreferrer">è¯·æŸ¥çœ‹ Release notes â†’</a>
<img id=close-join src=/images/header/close.svg alt=close></div></div><div class=common-layout><div class=header-container><a href=/zh/ aria-label=logo><img src=/images/header/logo.svg alt class=logo></a><ul class=nav><li class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class="dropdown-menu menu-2"><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li class=menu-li><span class=menu-span>èµ„æº</span><ul class="dropdown-menu menu-3"><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class="dropdown-menu menu-4"><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/ target=_blank rel="noopener noreferrer">æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/ target=_blank rel="noopener noreferrer">Kube Design</a></li></ul></li><li class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class="dropdown-menu menu-5"><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025 target=_blank rel="noopener noreferrer">å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/ target=_blank rel="noopener noreferrer">è®¤è¯</a></li></ul><div class=right-menu><ul><li class=language-menu><div><img src=/images/header/black.svg alt>
<span>ç®€ä½“ä¸­æ–‡</span></div><ul class=dropdown-menu><li onclick='handleLangClick("zh","/zh/blogs/calico-guide/")'>ç®€ä½“ä¸­æ–‡</li></ul></li><li class=github-li><div class=github-star><a class=star-btn href=https://github.com/kubesphere/kubesphere rel="noopener noreferrer" target=_blank><span class=star-img></span>&nbsp;<span>Star</span>
</a><a class=social-count href=https://github.com/kubesphere/kubesphere/stargazers rel="noopener noreferrer" target=_blank></a></div></li><li class=menu-icon><img src=/images/header/menu.svg alt></li></ul></div></div></div><div id=modal-for-menu class=modal><ul class=nav><li data-check=0 class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class=dropdown-menu><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>èµ„æº</span><ul class=dropdown-menu><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class=dropdown-menu><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/>æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/>Kube Design</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class=dropdown-menu><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md>ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/>ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025>å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum>ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/>è®¤è¯</a></li></ul><div class=link-div><a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank rel="noopener noreferrer" aria-label=slack><img src=/images/header/slack-hover.svg alt>
</a><a href=https://x.com/KubeSphere target=_blank rel="noopener noreferrer" aria-label=twitter><img src=/images/header/twitter-hover.svg alt>
</a><a href=https://github.com/kubesphere/kubesphere target=_blank rel="noopener noreferrer" aria-label=github><img src=/images/header/github-hover.svg alt></a></div></div></header><script>var bindNavMouseEvent,bindScrollChangeHeader,bindClickShowMenu,bindClickModalLi,bindClickClose,language,handleLangClick,githubApiLink="https://api.github.com/repos/kubesphere/kubesphere",getStar=function(){$(".social-count").hide(),$.getJSON(githubApiLink,function(e){$(".social-count").show().html(e.stargazers_count)})};getStar(),bindNavMouseEvent=function(e,t){t||(t=$(e));var n=!1;t.mouseenter(function(){if(n)return!1;n=!0,$(this).find(".dropdown-menu").fadeIn(200,function(){n=!1})}),t.mouseleave(function(){$(this).find(".dropdown-menu").fadeOut(200)})},bindScrollChangeHeader=function(){var t=100,e=$("header");window.addEventListener("scroll",function(){var t=window.scrollY;t>0?e.addClass("navigationScroll"):e.removeClass("navigationScroll")})},bindClickShowMenu=function(){$(".menu-icon").click(function(){$("#modal-for-menu").modal()})},bindClickModalLi=function(){$(".modal .menu-li").click(function(){var e=$(this).data("check");e===0?($(this).data("check",1),$(this).find(".dropdown-menu").slideDown(200)):($(this).data("check",0),$(this).find(".dropdown-menu").slideUp(200)),$(this).find(".menu-span").toggleClass("up")})},bindClickClose=function(){$("#close-join").click(function(){$(".navigation .join-div").hide(),$(".main-section").removeClass("padding")})},language="zh",bindClickClose(),bindScrollChangeHeader(),$(".header-container .menu-li").each(function(){bindNavMouseEvent("",$(this))}),bindNavMouseEvent(".header-container .language-menu"),bindNavMouseEvent(".header-container .btn-li"),bindClickShowMenu(),bindClickModalLi(),handleLangClick=function(e,t){try{localStorage.setItem("lang",e)}catch{}location.href=t}</script><section class=main-section><div class=common-layout><div class=breadcrumb><span><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a> > </span><span>Calico è·¯ç”±åå°„æ¨¡å¼æƒå¨æŒ‡å—</span></div><div class='main-div middle-div'><div class=author>æ­¦çŒ®é›¨</div><span class=date>å‘å¸ƒäºï¼š2021-06-02</span>&nbsp;&nbsp;&nbsp;
<span style=font-size:14px;color:#919aa3 id=busuanzi_container_page_pv>æœ¬æ–‡æ€»é˜…è¯»é‡ï¼š<span id=busuanzi_value_page_pv></span></span><h1>Calico è·¯ç”±åå°„æ¨¡å¼æƒå¨æŒ‡å—</h1><div class=share-1><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fcalico-guide%2f&text=Calico%20%e8%b7%af%e7%94%b1%e5%8f%8d%e5%b0%84%e6%a8%a1%e5%bc%8f%e6%9d%83%e5%a8%81%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fcalico-guide%2f&title=Calico%20%e8%b7%af%e7%94%b1%e5%8f%8d%e5%b0%84%e6%a8%a1%e5%bc%8f%e6%9d%83%e5%a8%81%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fcalico-guide%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fcalico-guide%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fcalico-guide%2f&t=Calico%20%e8%b7%af%e7%94%b1%e5%8f%8d%e5%b0%84%e6%a8%a1%e5%bc%8f%e6%9d%83%e5%a8%81%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div><div class=content><div class=md-body><h2 id=æ¦‚è¿°>æ¦‚è¿°</h2><p>ä½œä¸º Kubernetes æœ€é•¿ä½¿ç”¨çš„ä¸€ç§ç½‘ç»œæ’ä»¶ï¼ŒCalico å…·æœ‰å¾ˆå¼ºçš„æ‰©å±•æ€§ï¼Œè¾ƒä¼˜çš„èµ„æºåˆ©ç”¨å’Œè¾ƒå°‘çš„ä¾èµ–ï¼Œç›¸è¾ƒäº Flannel æ’ä»¶é‡‡ç”¨ Overlay çš„ç½‘ç»œï¼ŒCalico å¯ä»¥é€šè¿‡ä¸‰å±‚è·¯ç”±çš„æ–¹å¼é‡‡ç”¨æ€§èƒ½æ›´ä½³çš„ Underlay ç½‘ç»œï¼ŒCalico ç½‘ç»œæ’ä»¶çš„è½¬å‘æ•ˆç‡æ˜¯æ‰€æœ‰æ–¹æ¡ˆä¸­è¾ƒé«˜çš„ã€‚</p><p>åœ¨ä½¿ç”¨ Calico ç½‘ç»œæ’ä»¶çš„å®é™…ç”Ÿäº§ç¯å¢ƒå½“ä¸­ï¼Œä¸ºäº†æé«˜ç½‘ç»œçš„æ€§èƒ½å’Œçµæ´»æ€§ï¼Œéœ€è¦å°† K8s çš„å·¥ä½œèŠ‚ç‚¹å’Œç‰©ç†ç½‘ç»œä¸­çš„ leaf äº¤æ¢æœºå»ºç«‹ BGP é‚»å±…å…³ç³»ï¼ŒåŒæ­¥ BGP è·¯ç”±ä¿¡æ¯ï¼Œå¯ä»¥å°† pod ç½‘ç»œçš„è·¯ç”±å‘å¸ƒåˆ°ç‰©ç†ç½‘ç»œä¸­ã€‚Calico ç»™å‡ºäº†ä¸‰ç§ç±»å‹çš„ BGP äº’è”æ–¹æ¡ˆï¼Œåˆ†åˆ«æ˜¯ <strong>Full-mesh</strong>ã€<strong>Route reflectors</strong> å’Œ <strong>Top of Rack (ToR)</strong>ã€‚</p><h3 id=full-mesh>Full-mesh</h3><p>å…¨äº’è”æ¨¡å¼ï¼Œå¯ç”¨äº† BGP ä¹‹åï¼ŒCalico çš„é»˜è®¤è¡Œä¸ºæ˜¯åœ¨æ¯ä¸ªèŠ‚ç‚¹å½¼æ­¤å¯¹ç­‰çš„æƒ…å†µä¸‹åˆ›å»ºå®Œæ•´çš„å†…éƒ¨ BGPï¼ˆiBGPï¼‰è¿æ¥ï¼Œè¿™ä½¿ Calico å¯ä»¥åœ¨ä»»ä½• L2 ç½‘ç»œï¼ˆæ— è®ºæ˜¯å…¬æœ‰äº‘è¿˜æ˜¯ç§æœ‰äº‘ï¼‰ä¸Šè¿è¡Œï¼Œæˆ–è€…è¯´ï¼ˆå¦‚æœé…äº† IPIPï¼‰å¯ä»¥åœ¨ä»»ä½•ä¸ç¦æ­¢ IPIP æµé‡çš„ç½‘ç»œä¸Šä½œä¸º Overlay è¿è¡Œã€‚å¯¹äº vxlan overlayï¼ŒCalico ä¸ä½¿ç”¨ BGPã€‚</p><p>Full-mesh æ¨¡å¼å¯¹äº 100 ä¸ªä»¥å†…çš„å·¥ä½œèŠ‚ç‚¹æˆ–æ›´å°‘èŠ‚ç‚¹çš„ä¸­å°è§„æ¨¡éƒ¨ç½²éå¸¸æœ‰ç”¨ï¼Œä½†æ˜¯åœ¨è¾ƒå¤§çš„è§„æ¨¡ä¸Šï¼ŒFull-mesh æ¨¡å¼æ•ˆç‡ä¼šé™ä½ï¼Œè¾ƒå¤§è§„æ¨¡æƒ…å†µä¸‹ï¼ŒCalico å®˜æ–¹å»ºè®®ä½¿ç”¨ Route reflectorsã€‚</p><h3 id=route-reflectors>Route reflectors</h3><p>å¦‚æœæƒ³æ„å»ºå†…éƒ¨ BGPï¼ˆiBGPï¼‰å¤§è§„æ¨¡é›†ç¾¤ï¼Œå¯ä»¥ä½¿ç”¨ BGP è·¯ç”±åå°„å™¨æ¥å‡å°‘æ¯ä¸ªèŠ‚ç‚¹ä¸Šä½¿ç”¨ BGP å¯¹ç­‰ä½“çš„æ•°é‡ã€‚åœ¨æ­¤æ¨¡å‹ä¸­ï¼ŒæŸäº›èŠ‚ç‚¹å……å½“è·¯ç”±åå°„å™¨ï¼Œå¹¶é…ç½®ä¸ºåœ¨å®ƒä»¬ä¹‹é—´å»ºç«‹å®Œæ•´çš„ç½‘æ ¼ã€‚ç„¶åï¼Œå°†å…¶ä»–èŠ‚ç‚¹é…ç½®ä¸ºä¸è¿™äº›è·¯ç”±åå°„å™¨çš„å­é›†ï¼ˆé€šå¸¸ä¸ºå†—ä½™ï¼Œé€šå¸¸ä¸º 2 ä¸ªï¼‰è¿›è¡Œå¯¹ç­‰ï¼Œä»è€Œä¸å…¨ç½‘æ ¼ç›¸æ¯”å‡å°‘äº† BGP å¯¹ç­‰è¿æ¥çš„æ€»æ•°ã€‚</p><h3 id=top-of-racktor>Top of Rackï¼ˆToRï¼‰</h3><p>åœ¨æœ¬åœ°éƒ¨ç½²ä¸­ï¼Œå¯ä»¥å°† Calico é…ç½®ä¸ºç›´æ¥ä¸ç‰©ç†ç½‘ç»œåŸºç¡€ç»“æ„å¯¹ç­‰ã€‚é€šå¸¸ï¼Œè¿™éœ€è¦æ¶‰åŠåˆ°ç¦ç”¨ Calico çš„é»˜è®¤ Full-mesh è¡Œä¸ºï¼Œå°†æ‰€æœ‰ Calico èŠ‚ç‚¹ä¸ L3 ToR è·¯ç”±å™¨å¯¹ç­‰ã€‚</p><p>æœ¬ç¯‡æ–‡ç« é‡ç‚¹ä¼šä»‹ç»å¦‚ä½•åœ¨ BGP ç½‘ç»œç¯å¢ƒä¸‹é…ç½® Calico è·¯ç”±åå°„å™¨ï¼Œæœ¬ç¯‡ä¸»è¦ä»‹ç»å°† K8S å·¥ä½œèŠ‚ç‚¹ä½œä¸ºè·¯ç”±åå°„å™¨å’Œç‰©ç†äº¤æ¢æœºå»ºç«‹ BGP è¿æ¥ã€‚é…ç½®ç¯å¢ƒæ‹“æ‰‘å¦‚ä¸‹ï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/20210602104325.png alt></p><p>åœ¨æœ¬æ¬¡ç¯å¢ƒä¸­ï¼Œåˆ†åˆ«æœ‰ä¸€å° spine äº¤æ¢æœºå’Œä¸¤å° leaf äº¤æ¢æœºæ¥å»ºç«‹ EBGP è¿æ¥ã€‚æ‰€æœ‰ leaf äº¤æ¢æœºéƒ½å±äºä¸€ä¸ªç‹¬ç«‹çš„è‡ªæ²»ç³»ç»Ÿï¼Œæ‰€æœ‰ leaf äº¤æ¢æœºä¸‹çš„ node éƒ½å±äºä¸€ä¸ªç‹¬ç«‹çš„è‡ªæ²»ç³»ç»Ÿã€‚Kubernetes é›†ç¾¤èŠ‚ç‚¹ä¸­æ¯ä¸ª leaf ä¸‹ç”±ä¸¤å°å·¥ä½œèŠ‚ç‚¹ä½œä¸º CalicoRRï¼ˆè·¯ç”±åå°„å™¨ï¼‰ï¼Œä¹‹æ‰€ä»¥ç”¨ä¸¤å° node ä½œä¸ºè·¯ç”±åå°„å™¨æ˜¯è€ƒè™‘å†—ä½™æ€§ï¼Œæ‰€æœ‰ Calico RR éƒ½è·Ÿè‡ªå·±ä¸Šè”çš„ leaf äº¤æ¢æœºå»ºç«‹ EBGP è¿æ¥ã€‚Calico RR å’Œè‡ªå·±æ‰€å±çš„ node ä¹‹é—´å»ºç«‹ iBGP è¿æ¥ã€‚</p><h2 id=å®‰è£…-calicoctl>å®‰è£… calicoctl</h2><p>Calico RR æ‰€æœ‰é…ç½®æ“ä½œéƒ½éœ€è¦é€šè¿‡ calicoctl å·¥å…·æ¥å®Œæˆï¼Œ calicoctl å…è®¸ä»å‘½ä»¤åˆ›å»ºï¼Œè¯»å–ï¼Œæ›´æ–°å’Œåˆ é™¤ Calico å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦åœ¨ Kubernetes æ‰€æœ‰çš„å·¥ä½œèŠ‚ç‚¹ä¸Šå®‰è£… calicoctl å·¥å…·ã€‚</p><p>é‡‡ç”¨äºŒè¿›åˆ¶æ–¹å¼å®‰è£… calicoctl å·¥å…·ã€‚</p><p>ç™»å½•åˆ°ä¸»æœºï¼Œæ‰“å¼€ç»ˆç«¯æç¤ºç¬¦ï¼Œç„¶åå¯¼èˆªåˆ°å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶ä½ç½®ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ calicoctl å®‰è£…åˆ° /usr/local/bin/ã€‚</p><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸‹è½½ calicoctl äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç‰ˆæœ¬å·é€‰æ‹©è‡ªå·± Calico çš„ç‰ˆæœ¬ã€‚</p><pre tabindex=0><code>$ curl -O -L  https://github.com/projectcalico/calicoctl/releases/download/v3.17.2/calicoctl
</code></pre><p>å°†æ–‡ä»¶è®¾ç½®ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><pre tabindex=0><code>$ chmod +x calicoctl
</code></pre><p>æ¯æ¬¡æ‰§è¡Œ calicoctl ä¹‹å‰éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</p><pre tabindex=0><code>$ export DATASTORE_TYPE=kubernetes
$ export KUBECONFIG=~/.kube/config
</code></pre><p>å¦‚æœä¸å¸Œæœ›æ¯æ¬¡æ‰§è¡Œ calicoctl ä¹‹å‰éƒ½éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥å°†ç¯å¢ƒå˜é‡ä¿¡æ¯å†™åˆ°æ°¸ä¹…å†™å…¥åˆ° /etc/calico/calicoctl.cfg æ–‡ä»¶é‡Œï¼Œcalicoctl.cfg é…ç½®æ–‡ä»¶ç¼–è¾‘å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>projectcalico.org/v3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>CalicoAPIConfig</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>datastoreType</span>: <span style=color:#e6db74>&#34;kubernetes&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>kubeconfig</span>: <span style=color:#e6db74>&#34;/root/.kube/config&#34;</span>
</span></span></code></pre></div><p>å‘½ä»¤ä½¿ç”¨ï¼š</p><pre tabindex=0><code>[root@node1 ~]# calicoctl -h
Usage:
  calicoctl [options] &lt;command&gt; [&lt;args&gt;...]

    create       Create a resource by filename or stdin.
    replace      Replace a resource by filename or stdin.
    apply        Apply a resource by filename or stdin.  This creates a resource
                 if it does not exist, and replaces a resource if it does exists.
    patch        Patch a pre-exisiting resource in place.
    delete       Delete a resource identified by file, stdin or resource type and
                 name.
    get          Get a resource identified by file, stdin or resource type and
                 name.
    label        Add or update labels of resources.
    convert      Convert config files between different API versions.
    ipam         IP address management.
    node         Calico node management.
    version      Display the version of calicoctl.
    export       Export the Calico datastore objects for migration
    import       Import the Calico datastore objects for migration
    datastore    Calico datastore management.

Options:
  -h --help               Show this screen.
  -l --log-level=&lt;level&gt;  Set the log level (one of panic, fatal, error,
                          warn, info, debug) [default: panic]

Description:
  The calicoctl command line tool is used to manage Calico network and security
  policy, to view and manage endpoint configuration, and to manage a Calico
  node instance.

  See &#39;calicoctl &lt;command&gt; --help&#39; to read about a specific subcommand.
</code></pre><h2 id=å…³é—­-full-mesh-æ¨¡å¼>å…³é—­ Full-mesh æ¨¡å¼</h2><p>Calico é»˜è®¤æ˜¯ Full-mesh å…¨äº’è”æ¨¡å¼ï¼ŒCalico é›†ç¾¤ä¸­çš„çš„èŠ‚ç‚¹ä¹‹é—´éƒ½ä¼šå»ºç«‹è¿æ¥ï¼Œè¿›è¡Œè·¯ç”±äº¤æ¢ã€‚ä½†æ˜¯éšç€é›†ç¾¤è§„æ¨¡çš„æ‰©å¤§ï¼Œmesh æ¨¡å¼å°†å½¢æˆä¸€ä¸ªå·¨å¤§æœåŠ¡ç½‘æ ¼ï¼Œè¿æ¥æ•°æˆå€å¢åŠ ã€‚è¿™æ—¶å°±éœ€è¦ä½¿ç”¨ Route Reflectorï¼ˆè·¯ç”±å™¨åå°„ï¼‰æ¨¡å¼è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç¡®å®šä¸€ä¸ªæˆ–å¤šä¸ª Calico èŠ‚ç‚¹å……å½“è·¯ç”±åå°„å™¨ï¼Œè®©å…¶ä»–èŠ‚ç‚¹ä»è¿™ä¸ª RR èŠ‚ç‚¹è·å–è·¯ç”±ä¿¡æ¯ã€‚</p><p>å…³é—­ node-to-node BGP ç½‘ç»œï¼Œå…·ä½“æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p><p>æ·»åŠ  default BGP é…ç½®ï¼Œè°ƒæ•´ nodeToNodeMeshEnabled å’Œ asNumberï¼š</p><pre tabindex=0><code>[root@node1 calico]# cat bgpconf.yaml
apiVersion: projectcalico.org/v3
kind: BGPConfiguration
metadata:
  name: default
spec:
  logSeverityScreen: Info
  nodeToNodeMeshEnabled: false
  asNumber: 64512
</code></pre><p>ç›´æ¥åº”ç”¨ä¸€ä¸‹ï¼Œåº”ç”¨ä¹‹åä¼šé©¬ä¸Šç¦ç”¨ Full-meshï¼š</p><pre tabindex=0><code>[root@node1 calico]# calicoctl apply -f bgpconf.yaml
Successfully applied 1 &#39;BGPConfiguration&#39; resource(s)
</code></pre><p>æŸ¥çœ‹ bgp ç½‘ç»œé…ç½®æƒ…å†µï¼Œfalse ä¸ºå…³é—­ï¼š</p><pre tabindex=0><code>[root@node1 calico]# calicoctl get bgpconfig
NAME      LOGSEVERITY   MESHENABLED   ASNUMBER
default   Info          false         64512
</code></pre><h2 id=ä¿®æ”¹å·¥ä½œèŠ‚ç‚¹çš„-calico-é…ç½®>ä¿®æ”¹å·¥ä½œèŠ‚ç‚¹çš„ Calico é…ç½®</h2><p>é€šè¿‡ calicoctl get nodes --output=wide å¯ä»¥è·å–å„èŠ‚ç‚¹çš„ ASN å·ï¼š</p><pre tabindex=0><code>[root@node1 calico]# calicoctl get nodes --output=wide
NAME    ASN      IPV4             IPV6
node1   (64512)   172.20.0.11/24
node2   (64512)   172.20.0.12/24
node3   (64512)   172.20.0.13/24
node4   (64512)   173.20.0.11/24
node5   (64512)   173.20.0.12/24
node6   (64512)   173.20.0.13/24
</code></pre><p>å¯ä»¥çœ‹åˆ°è·å–çš„ ASN å·éƒ½æ˜¯â€œï¼ˆ64512ï¼‰â€ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœä¸ç»™æ¯ä¸ªèŠ‚ç‚¹æŒ‡å®š ASN å·ï¼Œé»˜è®¤éƒ½æ˜¯ 64512ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰ç…§æ‹“æ‰‘å›¾é…ç½®å„ä¸ªèŠ‚ç‚¹çš„ ASN å·ï¼Œä¸åŒ leaf äº¤æ¢æœºä¸‹çš„èŠ‚ç‚¹ï¼ŒASN å·ä¸ä¸€æ ·ï¼Œæ¯ä¸ª leaf äº¤æ¢æœºä¸‹çš„å·¥ä½œèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹è‡ªæ²»ç³»ç»Ÿã€‚</p><p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼Œè·å–å·¥ä½œèŠ‚ç‚¹çš„ Calico é…ç½®ä¿¡æ¯ï¼š</p><pre tabindex=0><code>$ calicoctl get node node1 -o yaml &gt; node1.yaml
</code></pre><p>æ¯ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹çš„ Calico é…ç½®ä¿¡æ¯éƒ½éœ€è¦è·å–ä¸€ä¸‹ï¼Œè¾“å‡ºä¸º yaml æ–‡ä»¶ï¼Œâ€œnode1â€ä¸º Calico èŠ‚ç‚¹çš„åç§°ã€‚</p><p>æŒ‰ç…§å¦‚ä¸‹æ ¼å¼è¿›è¡Œä¿®æ”¹ï¼š</p><pre tabindex=0><code>[root@node1 calico]# cat node1.yaml
apiVersion: projectcalico.org/v3
kind: Node
metadata:
  annotations:
    projectcalico.org/kube-labels: &#39;{&#34;beta.kubernetes.io/arch&#34;:&#34;amd64&#34;,&#34;beta.kubernetes.io/os&#34;:&#34;linux&#34;,&#34;kubernetes.io/arch&#34;:&#34;amd64&#34;,&#34;kubernetes.io/hostname&#34;:&#34;node1&#34;,&#34;kubernetes.io/os&#34;:&#34;linux&#34;,&#34;node-role.kubernetes.io/master&#34;:&#34;&#34;,&#34;node-role.kubernetes.io/worker&#34;:&#34;&#34;,&#34;rr-group&#34;:&#34;rr1&#34;,&#34;rr-id&#34;:&#34;rr1&#34;}&#39;
  creationTimestamp: null
  labels:
    beta.kubernetes.io/arch: amd64
    beta.kubernetes.io/os: linux
    kubernetes.io/arch: amd64
    kubernetes.io/hostname: node1
    kubernetes.io/os: linux
    node-role.kubernetes.io/master: &#34;&#34;
    node-role.kubernetes.io/worker: &#34;&#34;
  name: node1
spec:
  bgp:
    asNumber: 64512                           ## asNumberæ ¹æ®è‡ªå·±éœ€è¦è¿›è¡Œä¿®æ”¹

    ipv4Address: 172.20.0.11/24
    routeReflectorClusterID: 172.20.0.11      ## routeReflectorClusterIDä¸€èˆ¬æ”¹æˆè‡ªå·±èŠ‚ç‚¹çš„IPåœ°å€
  orchRefs:
  - nodeName: node1
    orchestrator: k8s
status:
  podCIDRs:
  - &#34;&#34;
  - 10.233.64.0/24
</code></pre><p>å°†æ‰€æœ‰èŠ‚ç‚¹çš„ Calico é…ç½®ä¿¡æ¯å…¨éƒ¨ä¿®æ”¹ä¹‹åï¼Œé€šè¿‡ calicoctl get nodes -o wide å‘½ä»¤è·å–åˆ°çš„èŠ‚ç‚¹ä¿¡æ¯å¦‚ä¸‹ï¼š</p><pre tabindex=0><code>[root@node1 calico]# calicoctl get nodes -o wide
NAME    ASN     IPV4             IPV6
node1   64512   172.20.0.11/24
node2   64512   172.20.0.12/24
node3   64512   172.20.0.13/24
node4   64513   173.20.0.11/24
node5   64513   173.20.0.12/24
node6   64513   173.20.0.13/24
</code></pre><p>ä¸Šé¢å¯ä»¥å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„ ASN å¥½éƒ½å·²å˜ä¸ºæ‰‹åŠ¨æŒ‡å®šçš„ï¼Œä¸åœ¨æ˜¯å…¨å±€é»˜è®¤çš„ã€‚</p><h2 id=ä¸º-node-èŠ‚ç‚¹è¿›è¡Œåˆ†ç»„æ·»åŠ -label>ä¸º node èŠ‚ç‚¹è¿›è¡Œåˆ†ç»„ï¼ˆæ·»åŠ  labelï¼‰</h2><p>ä¸ºæ–¹ä¾¿è®© BGPPeer è½»æ¾é€‰æ‹©èŠ‚ç‚¹ï¼Œåœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†æ‰€æœ‰èŠ‚ç‚¹é€šè¿‡æ‰“ label çš„æ–¹å¼è¿›è¡Œåˆ†ç»„ï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬å°† label æ ‡ç­¾åˆ†ä¸ºä¸‹é¢å‡ ç§ï¼š</p><ul><li>rr-group è¿™é‡Œå®šä¹‰ä¸ºèŠ‚ç‚¹æ‰€å±çš„ Calico RR ç»„ï¼Œä¸»è¦æœ‰ rr1 å’Œ rr2 ä¸¤ç§ï¼Œä¸ºä¸åŒ leaf äº¤æ¢æœºä¸‹çš„ Calico RR</li><li>rr-id è¿™é‡Œå®šä¹‰ä¸ºæ‰€å± Calico RR çš„ IDï¼ŒèŠ‚ç‚¹æ·»åŠ äº†è¯¥æ ‡ç­¾è¯´æ˜è¯¥èŠ‚ç‚¹ä½œä¸ºäº†è·¯ç”±åå°„å™¨ï¼Œä¸»è¦æœ‰ rr1 å’Œ rr2 ä¸¤ç§ï¼Œä¸ºä¸åŒ leaf äº¤æ¢æœºä¸‹çš„ Calico RR</li></ul><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/20210602104444.png alt></p><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤ä¸ºæ¯ä¸ªèŠ‚ç‚¹æ·»åŠ  labelï¼š</p><pre tabindex=0><code>$ kubectl label nodes node1 rr-group=rr1
$ kubectl label nodes node1 rr-id=rr1
</code></pre><p>æŸ¥çœ‹æœ€ç»ˆè®¾ç½®æƒ…å†µï¼š</p><pre tabindex=0><code>[root@node1 calico]# kubectl get nodes --show-labels
NAME         STATUS           ROLES            AGE          VERSION         LABELS
node1   Ready    master,worker   31d   v1.17.9   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node1,kubernetes.io/os=linux,node-role.kubernetes.io/master=,node-role.kubernetes.io/worker=,rr-group=rr1,rr-id=rr1
node2   Ready    master,worker   31d   v1.17.9   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node2,kubernetes.io/os=linux,node-role.kubernetes.io/master=,node-role.kubernetes.io/worker=,rr-group=rr1,rr-id=rr1
node3   Ready    master,worker   31d   v1.17.9   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node3,kubernetes.io/os=linux,node-role.kubernetes.io/master=,node-role.kubernetes.io/worker=,rr-group=rr1
node4   Ready    worker          16d   v1.17.9   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node4,kubernetes.io/os=linux,node-role.kubernetes.io/worker=,rr-group=rr2,rr-id=rr2
node5   Ready    worker          16d   v1.17.9   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node5,kubernetes.io/os=linux,node-role.kubernetes.io/worker=,rr-group=rr2,rr-id=rr2
node6   Ready    worker          16d   v1.17.9   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node5,kubernetes.io/os=linux,node-role.kubernetes.io/worker=,rr-group=rr2,rr-id=rr2
</code></pre><h2 id=é…ç½®-bgppeer>é…ç½® BGPPeer</h2><p>åœ¨é…ç½® BGPPeer ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæŸ¥çœ‹ä¸€ä¸‹å„ä¸ª node BGP çš„èŠ‚ç‚¹çŠ¶æ€ï¼Œå› ä¸ºå·²ç»ç¦ç”¨äº† Full-meshï¼Œå¹¶ä¸”ç°åœ¨è¿˜æ²¡æœ‰é…ç½® BGPPeerï¼Œæ‰€ä»¥æ‰€æœ‰èŠ‚ç‚¹é‡Œçš„ä¿¡æ¯éƒ½æ˜¯ç©ºçš„ã€‚</p><pre tabindex=0><code>[root@node3 ~]# calicoctl node status
Calico process is running.

IPv4 BGP status
No IPv4 peers found.

IPv6 BGP status
No IPv6 peers found.
</code></pre><p>æ ¹æ®ç¯å¢ƒæ‹“æ‰‘ï¼Œnode1 å’Œ node2 ä½œä¸º Calico RRï¼Œéœ€è¦å’Œ leaf01 äº¤æ¢æœºå»ºç«‹ BGP è¿æ¥ï¼›node4 å’Œ node5 ä½œä¸º Calico RR éœ€è¦å’Œ leaf02 äº¤æ¢æœºå»ºç«‹ BGP è¿æ¥ï¼›node1ã€node2 å’Œ node3 éœ€è¦å’Œ RR1 å»ºç«‹ BGP è¿æ¥ï¼›node4ã€node5 å’Œ node6 éœ€è¦å’Œ RR2 å»ºç«‹ BGP è¿æ¥ã€‚æŒ‰ç…§ä¸‹é¢æ­¥éª¤ä¾æ¬¡é…ç½®ï¼š</p><ol><li>RR1 å’Œ leaf01 å»ºç«‹ BGP è¿æ¥</li></ol><p>ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œå–åä¸ºâ€œrr1-to-leaf1-peer.yamlâ€ï¼Œé…ç½®æ–‡ä»¶ç¼–è¾‘å¦‚ä¸‹ï¼š</p><pre tabindex=0><code>[root@node1 calico]# cat rr1-to-leaf1-peer.yaml
apiVersion: projectcalico.org/v3
kind: BGPPeer
metadata:
  name: rr1-to-leaf1-peer        ## ç»™BGPPeerå–ä¸€ä¸ªåç§°ï¼Œæ–¹ä¾¿è¯†åˆ«

spec:
  nodeSelector: rr-id == &#39;rr1&#39;   ## é€šè¿‡èŠ‚ç‚¹é€‰æ‹©å™¨æ·»åŠ æœ‰rr-id == &#39;rr1&#39;æ ‡ç­¾çš„èŠ‚ç‚¹

  peerIP: 172.20.0.254           ##  leaf01äº¤æ¢æœºçš„åœ°å€
  asNumber: 65009                ##  leaf01äº¤æ¢æœºçš„ASå·
</code></pre><p>åº”ç”¨è¯¥é…ç½®ï¼š</p><pre tabindex=0><code>[root@node1 calico]# calicoctl apply -f rr1-to-leaf1-peer.yaml
Successfully applied 1 &#39;BGPPeer&#39; resource(s)
</code></pre><ol start=2><li>RR1 å’Œè‡ªå·±æ‰€å±çš„èŠ‚ç‚¹å»ºç«‹ BGP è¿æ¥</li></ol><p>RR1 æ‰€å±çš„èŠ‚ç‚¹ä¸»è¦æœ‰ node1ã€node2 å’Œ node3ï¼Œä¹Ÿå°±æ˜¯æ‰“äº† rr-group=rr1 æ ‡ç­¾çš„èŠ‚ç‚¹ï¼Œé…ç½®æ–‡ä»¶ç¼–å†™å¦‚ä¸‹ï¼š</p><pre tabindex=0><code>[root@node1 calico]# cat rr1-to-node-peer.yaml
apiVersion: projectcalico.org/v3
kind: BGPPeer
metadata:
  name: rr1-to-node-peer              ## ç»™BGPPeerå–ä¸€ä¸ªåç§°ï¼Œæ–¹ä¾¿è¯†åˆ«

spec:
  nodeSelector: rr-group == &#39;rr1&#39;     ## é€šè¿‡èŠ‚ç‚¹é€‰æ‹©å™¨æ·»åŠ æœ‰rr-group == â€˜rr1â€™æ ‡ç­¾çš„èŠ‚ç‚¹

  peerSelector: rr-id  == &#39;rr1&#39;       ## é€šè¿‡peeré€‰æ‹©å™¨æ·»åŠ æœ‰rr-id == â€˜rr1â€™æ ‡ç­¾çš„è·¯ç”±åå°„å™¨
</code></pre><p>åº”ç”¨è¯¥é…ç½®ï¼š</p><pre tabindex=0><code>[root@node1 calico]# calicoctl apply -f rr1-to-node-peer.yaml
Successfully applied 1 &#39;BGPPeer&#39; resource(s)
</code></pre><ol start=3><li>åœ¨ leaf01 äº¤æ¢æœºä¸Šæ“ä½œï¼Œå»ºç«‹ leaf01 äº¤æ¢æœºå’Œ RR1 çš„ BGP è¿æ¥ï¼Œäº¤æ¢æœºé…ç½®å®Œæˆåï¼Œå¯ä»¥æŸ¥çœ‹äº¤æ¢æœº bgp peer çš„è¿æ¥çŠ¶æ€</li></ol><pre tabindex=0><code>[leaf01]show bgp peer ipv4

 BGP local router ID: 2.2.2.2
 Local AS number: 65009
 Total number of peers: 3		  Peers in established state: 3

  * - Dynamically created peer
  Peer                    AS  MsgRcvd  MsgSent OutQ PrefRcv Up/Down  State

  100.0.0.1            65008     1696     1677    0       8 23:52:28 Established
  172.20.0.11          64512     1648     1506    0       4 23:51:50 Established
  172.20.0.12          64512     1647     1659    0       4 23:51:44 Established
</code></pre><p>ä¸Šé¢ 172.20.0.11 å’Œ 172.20.0.12 æ˜¯ node1 å’Œ node2 èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ RR1ã€‚çŠ¶æ€æ˜¾ç¤ºä¸ºâ€œEstablishedâ€œè¯´æ˜ BGP è¿ç»“å·²å»ºç«‹ã€‚</p><ol start=4><li>RR2 å’Œ leaf02 å»ºç«‹ BGP è¿æ¥</li></ol><p>ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œå–åä¸ºâ€œrr2-to-leaf2-peer.yamlâ€ï¼Œé…ç½®æ–‡ä»¶ç¼–è¾‘å¦‚ä¸‹ï¼š</p><pre tabindex=0><code>[root@node1 calico]# cat rr2-to-leaf2-peer.yaml
apiVersion: projectcalico.org/v3
kind: BGPPeer
metadata:
  name: rr2-to-leaf2-peer        ## ç»™BGPPeerå–ä¸€ä¸ªåç§°ï¼Œæ–¹ä¾¿è¯†åˆ«

spec:
  nodeSelector: rr-id == &#39;rr2&#39;   ## é€šè¿‡èŠ‚ç‚¹é€‰æ‹©å™¨æ·»åŠ æœ‰rr-id == &#39;rr2&#39;æ ‡ç­¾çš„èŠ‚ç‚¹
  peerIP: 173.20.0.254           ##  leaf02äº¤æ¢æœºçš„åœ°å€
  asNumber: 65010                ##  leaf02äº¤æ¢æœºçš„ASå·
</code></pre><p>åº”ç”¨è¯¥é…ç½®ï¼š</p><pre tabindex=0><code>[root@node1 calico]# calicoctl apply -f rr2-to-leaf2-peer.yaml
Successfully applied 1 &#39;BGPPeer&#39; resource(s)
</code></pre><ol start=5><li>RR2 å’Œè‡ªå·±æ‰€å±çš„èŠ‚ç‚¹å»ºç«‹ BGP è¿æ¥</li></ol><p>RR2 æ‰€å±çš„èŠ‚ç‚¹ä¸»è¦æœ‰ node4ã€node5 å’Œ node6ï¼Œä¹Ÿå°±æ˜¯æ‰“äº† rr-group=rr2 æ ‡ç­¾çš„èŠ‚ç‚¹ï¼Œé…ç½®æ–‡ä»¶ç¼–å†™å¦‚ä¸‹ï¼š</p><pre tabindex=0><code>[root@node1 calico]# cat rr2-to-node-peer.yaml
apiVersion: projectcalico.org/v3
kind: BGPPeer
metadata:
  name: rr2-to-node-peer              ## ç»™BGPPeerå–ä¸€ä¸ªåç§°ï¼Œæ–¹ä¾¿è¯†åˆ«

spec:
  nodeSelector: rr-group == &#39;rr2&#39;     ## é€šè¿‡èŠ‚ç‚¹é€‰æ‹©å™¨æ·»åŠ æœ‰rr-group == â€˜rr2â€™æ ‡ç­¾çš„èŠ‚ç‚¹
  peerSelector: rr-id  == &#39;rr2&#39;       ## é€šè¿‡peeré€‰æ‹©å™¨æ·»åŠ æœ‰rr-id == â€˜rr2â€™æ ‡ç­¾çš„è·¯ç”±åå°„å™¨
</code></pre><p>åº”ç”¨è¯¥é…ç½®ï¼š</p><pre tabindex=0><code>[root@node1 calico]# calicoctl apply -f rr2-to-node-peer.yaml
Successfully applied 1 &#39;BGPPeer&#39; resource(s)
</code></pre><ol start=6><li>åœ¨ leaf02 äº¤æ¢æœºä¸Šæ“ä½œï¼Œå»ºç«‹ leaf02 äº¤æ¢æœºå’Œ RR2 çš„ BGP è¿æ¥</li></ol><p>äº¤æ¢æœºé…ç½®å®Œæˆåï¼Œå¯ä»¥æŸ¥çœ‹äº¤æ¢æœº bgp peer çš„è¿æ¥çŠ¶æ€ï¼š</p><pre tabindex=0><code>&lt;leaf02&gt;sys
System View: return to User View with Ctrl+Z.
[leaf02]show bgp peer ipv4

 BGP local router ID: 3.3.3.3
 Local AS number: 65010
 Total number of peers: 3		  Peers in established state: 3

  * - Dynamically created peer
  Peer                    AS  MsgRcvd  MsgSent OutQ PrefRcv Up/Down  State

  100.0.0.5            65008     1561     1686    0      11 24:01:03 Established
  173.20.0.11          64513     1655     1650    0       2 23:59:44 Established
  173.20.0.12          64513     1661     1883    0       2 23:59:56 Established
</code></pre><p>ä¸Šé¢ 173.20.0.11 å’Œ 173.20.0.12 æ˜¯ node4 å’Œ node5 èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ RR2ã€‚çŠ¶æ€æ˜¾ç¤ºä¸ºâ€œEstablishedâ€œè¯´æ˜ BGP è¿ç»“å·²å»ºç«‹ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ calicoctl get bgppeer å‘½ä»¤æ¥æŸ¥çœ‹æ‰€æœ‰çš„ BGPPeer é…ç½®æ¡ç›®ï¼š</p><pre tabindex=0><code>[root@node1 calico]# calicoctl get bgppeer
NAME                PEERIP         NODE                ASN
rr1-to-leaf1-peer   172.20.0.254   rr-id == &#39;rr1&#39;      65009
rr1-to-node-peer                   rr-group == &#39;rr1&#39;   0
rr2-to-leaf2-peer   173.20.0.254   rr-id == &#39;rr2&#39;      65010
rr2-to-node-peer                   rr-group == &#39;rr2&#39;   0
</code></pre><p>å¦‚æœæƒ³åˆ é™¤æŸä¸ª BGPPeer æ¡ç›®ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼š</p><pre tabindex=0><code>$ calicoctl delete bgppeer rr2-to-node-peer
</code></pre><h2 id=å·¥ä½œèŠ‚ç‚¹é…ç½®éªŒè¯>å·¥ä½œèŠ‚ç‚¹é…ç½®éªŒè¯</h2><p>è‡³æ­¤ï¼ŒBGPPeer é…ç½®å·²å®Œæˆï¼Œå¯ä»¥åœ¨å„ä¸ªèŠ‚ç‚¹é‡Œå†æ¬¡æŸ¥çœ‹ BGPPeer çŠ¶æ€ä¿¡æ¯ã€‚</p><p>åœ¨ node1 èŠ‚ç‚¹æ“ä½œï¼š</p><pre tabindex=0><code>[root@node1 calico]# calicoctl node status
Calico process is running.

IPv4 BGP status
+--------------+---------------+-------+------------+-------------+
| PEER ADDRESS |   PEER TYPE   | STATE |   SINCE    |    INFO     |
+--------------+---------------+-------+------------+-------------+
| 172.20.0.12  | node specific | up    | 2021-02-16 | Established |
| 172.20.0.13  | node specific | up    | 2021-02-16 | Established |
| 172.20.0.254 | node specific | up    | 2021-02-16 | Established |
+--------------+---------------+-------+------------+-------------+

IPv6 BGP status
No IPv6 peers found.
</code></pre><p>å¯ä»¥çœ‹åˆ°è¯¥èŠ‚ç‚¹å·²ç»å’Œ leaf01 äº¤æ¢æœºã€node2 å’Œ node3 èŠ‚ç‚¹å»ºç«‹äº† BGP è¿æ¥ã€‚</p><p>åœ¨ node2 èŠ‚ç‚¹æ“ä½œï¼š</p><pre tabindex=0><code>[root@node2 ~]# calicoctl node status
Calico process is running.

IPv4 BGP status
+--------------+---------------+-------+------------+-------------+
| PEER ADDRESS |   PEER TYPE   | STATE |   SINCE    |    INFO     |
+--------------+---------------+-------+------------+-------------+
| 172.20.0.11  | node specific | up    | 2021-02-16 | Established |
| 172.20.0.13  | node specific | up    | 2021-02-16 | Established |
| 172.20.0.254 | node specific | up    | 2021-02-16 | Established |
+--------------+---------------+-------+------------+-------------+

IPv6 BGP status
No IPv6 peers found.
</code></pre><p>å¯ä»¥çœ‹åˆ°è¯¥èŠ‚ç‚¹å·²ç»å’Œ leaf01 äº¤æ¢æœºã€node1 å’Œ node3 èŠ‚ç‚¹å»ºç«‹äº† BGP è¿æ¥ã€‚</p><p>åœ¨ node3 èŠ‚ç‚¹æ“ä½œï¼š</p><pre tabindex=0><code>[root@node3 ~]# calicoctl node status
Calico process is running.

IPv4 BGP status
+--------------+---------------+-------+------------+-------------+
| PEER ADDRESS |   PEER TYPE   | STATE |   SINCE    |    INFO     |
+--------------+---------------+-------+------------+-------------+
| 172.20.0.11  | node specific | up    | 2021-02-16 | Established |
| 172.20.0.12  | node specific | up    | 2021-02-16 | Established |
+--------------+---------------+-------+------------+-------------+

IPv6 BGP status
No IPv6 peers found.
</code></pre><p>å¯ä»¥çœ‹åˆ°è¯¥èŠ‚ç‚¹å·²ç»å’Œ node1 å’Œ node2 èŠ‚ç‚¹å»ºç«‹äº† BGP è¿æ¥ï¼Œå› ä¸ºè¯¥èŠ‚ç‚¹ä¸ä½œä¸ºè·¯ç”±åå°„å™¨èŠ‚ç‚¹ï¼Œæ‰€ä»¥å¹¶ä¸ºä¸ leaf01 äº¤æ¢æœºå»ºç«‹ BGP è¿æ¥ã€‚</p><p>åœ¨ node4 èŠ‚ç‚¹æ“ä½œï¼š</p><pre tabindex=0><code>[root@node4 ~]# calicoctl node status
Calico process is running.

IPv4 BGP status
+--------------+---------------+-------+------------+-------------+
| PEER ADDRESS |   PEER TYPE   | STATE |   SINCE    |    INFO     |
+--------------+---------------+-------+------------+-------------+
| 173.20.0.12  | node specific | up    | 2021-02-16 | Established |
| 173.20.0.13  | node specific | up    | 2021-02-16 | Established |
| 173.20.0.254 | node specific | up    | 2021-02-16 | Established |
+--------------+---------------+-------+------------+-------------+

IPv6 BGP status
No IPv6 peers found.
</code></pre><p>å¯ä»¥çœ‹åˆ°è¯¥èŠ‚ç‚¹å·²ç»å’Œ leaf02 äº¤æ¢æœºã€node5 å’Œ node6 èŠ‚ç‚¹å»ºç«‹äº† BGP è¿æ¥ã€‚</p><p>åœ¨ node5 èŠ‚ç‚¹æ“ä½œï¼š</p><pre tabindex=0><code>[root@node5 ~]# calicoctl node status
Calico process is running.

IPv4 BGP status
+--------------+---------------+-------+------------+-------------+
| PEER ADDRESS |   PEER TYPE   | STATE |   SINCE    |    INFO     |
+--------------+---------------+-------+------------+-------------+
| 173.20.0.11  | node specific | up    | 2021-02-16 | Established |
| 173.20.0.13  | node specific | up    | 2021-02-16 | Established |
| 173.20.0.254 | node specific | up    | 2021-02-16 | Established |
+--------------+---------------+-------+------------+-------------+

IPv6 BGP status
No IPv6 peers found.
</code></pre><p>å¯ä»¥çœ‹åˆ°è¯¥èŠ‚ç‚¹å·²ç»å’Œ leaf02 äº¤æ¢æœºã€node4 å’Œ node6 èŠ‚ç‚¹å»ºç«‹äº† BGP è¿æ¥ã€‚</p><p>åœ¨ node6 èŠ‚ç‚¹æ“ä½œï¼š</p><pre tabindex=0><code>[root@node6 ~]# calicoctl node status
Calico process is running.

IPv4 BGP status
+--------------+---------------+-------+------------+-------------+
| PEER ADDRESS |   PEER TYPE   | STATE |   SINCE    |    INFO     |
+--------------+---------------+-------+------------+-------------+
| 173.20.0.11  | node specific | up    | 2021-02-16 | Established |
| 173.20.0.12  | node specific | up    | 2021-02-16 | Established |
+--------------+---------------+-------+------------+-------------+

IPv6 BGP status
No IPv6 peers found.
</code></pre><p>å¯ä»¥çœ‹åˆ°è¯¥èŠ‚ç‚¹å·²ç»å’Œ node4 å’Œ node5 èŠ‚ç‚¹å»ºç«‹äº† BGP è¿æ¥ï¼Œå› ä¸ºè¯¥èŠ‚ç‚¹ä¸ä½œä¸ºè·¯ç”±åå°„å™¨èŠ‚ç‚¹ï¼Œæ‰€ä»¥å¹¶ä¸ºä¸ leaf02 äº¤æ¢æœºå»ºç«‹ BGP è¿æ¥ã€‚</p><h2 id=äº¤æ¢æœºé…ç½®éªŒè¯>äº¤æ¢æœºé…ç½®éªŒè¯</h2><p>æˆ‘ä»¬å¯ä»¥åœ¨æ‰€æœ‰äº¤æ¢æœºé‡Œå»æŸ¥çœ‹ BGP åŒæ­¥çš„è·¯ç”±ä¿¡æ¯æœ‰æ²¡æœ‰ç½²äº pod çš„è·¯ç”±åœ°å€ã€‚</p><p>Spine äº¤æ¢æœºæ“ä½œï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/20210602104537.png alt></p><p>Leaf01 äº¤æ¢æœºæ“ä½œï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/20210602104556.png alt></p><p>Leaf02 äº¤æ¢æœºæ“ä½œï¼š</p><p><img src=https://pek3b.qingstor.com/kubesphere-community/images/20210602104612.png alt></p><p>åœ¨ä¸Šé¢äº¤æ¢æœºæ“ä½œæˆªå›¾ä¸­ï¼Œ10.233 å¼€å¤´çš„åœ°å€æ®µéƒ½æ˜¯ pod åœ°å€æ®µçš„è·¯ç”±ä¿¡æ¯ã€‚</p><h2 id=å°†-service-åœ°å€è·¯ç”±åŒæ­¥åˆ°ç‰©ç†ç½‘ç»œ>å°† Service åœ°å€è·¯ç”±åŒæ­¥åˆ°ç‰©ç†ç½‘ç»œ</h2><p>æœ‰äº›æ—¶å€™ä¸å…‰éœ€è¦ Pod åœ°å€å¯ä»¥åœ¨ç°ç½‘å¯è¢«è·¯ç”±ï¼ŒService åœ°å€ä¹Ÿä¼šæœ‰è¿™ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ bgpconfig é…ç½®æ¥å®ç° Service åœ°å€çš„è·¯ç”±åŒæ­¥ã€‚</p><p>é¦–å…ˆæ£€æŸ¥æ˜¯å¦å…·æœ‰é»˜è®¤çš„ BGP é…ç½®ï¼š</p><pre tabindex=0><code>[root@node1 ~]# calicoctl get bgpconfig default
NAME      LOGSEVERITY   MESHENABLED   ASNUMBER
default   Info          false         64512
</code></pre><p>é»˜è®¤çš„ BGP é…ç½®æ˜¯å­˜åœ¨çš„ï¼Œæ›´æ–° BGP é…ç½®ï¼š</p><pre tabindex=0><code>[root@node1 ~]# calicoctl patch BGPConfig default --patch \
&gt; &#39;{&#34;spec&#34;: {&#34;serviceClusterIPs&#34;: [{&#34;cidr&#34;: &#34;10.233.0.0/18&#34;}]}}&#39;
Successfully patched 1 &#39;BGPConfiguration&#39; resource
</code></pre><p>æ³¨æ„å°†ä¸Šé¢ 10.233.0.0./18 åœ°å€æ®µä¿®æ”¹ä¸º Service çš„åœ°å€æ®µã€‚</p><p>ä¸Šè¿°é…ç½®å®Œæˆä¹‹åï¼Œä¾¿å¯ä»¥åœ¨äº¤æ¢æœºé‡Œçœ‹åˆ°å·²ç»åŒæ­¥è¿‡æ¥çš„ Service åœ°å€æ®µçš„è·¯ç”±ä¿¡æ¯ã€‚</p><h2 id=æ–‡æ¡£å‚è€ƒé“¾æ¥>æ–‡æ¡£å‚è€ƒé“¾æ¥</h2><p>ç»å¤§å¤šæ•°é…ç½®éƒ½å¯ä»¥é€šè¿‡ Calico å®˜æ–¹æ–‡æ¡£è·å–ï¼Œä»¥ä¸‹å°±æ˜¯æ’°å†™æœ¬æ–‡å‚è€ƒçš„ä¸»è¦å®˜æ–¹æ–‡æ¡£é“¾æ¥ï¼š</p><ul><li><a href=https://docs.projectcalico.org/networking/bgp title=https://docs.projectcalico.org/networking/bgp target=_blank rel="noopener noreferrer">https://docs.projectcalico.org/networking/bgp</a></li><li><a href=https://docs.projectcalico.org/getting-started/clis/calicoctl/install title=https://docs.projectcalico.org/getting-started/clis/calicoctl/install target=_blank rel="noopener noreferrer">https://docs.projectcalico.org/getting-started/clis/calicoctl/install</a></li><li><a href=https://docs.projectcalico.org/networking/advertise-service-ips#advertise-service-cluster-ip-addresses title=https://docs.projectcalico.org/networking/advertise-service-ips#advertise-service-cluster-ip-addresses target=_blank rel="noopener noreferrer">https://docs.projectcalico.org/networking/advertise-service-ips#advertise-service-cluster-ip-addresses</a></li></ul></div></div><div class=share-2><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fcalico-guide%2f&text=Calico%20%e8%b7%af%e7%94%b1%e5%8f%8d%e5%b0%84%e6%a8%a1%e5%bc%8f%e6%9d%83%e5%a8%81%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fcalico-guide%2f&title=Calico%20%e8%b7%af%e7%94%b1%e5%8f%8d%e5%b0%84%e6%a8%a1%e5%bc%8f%e6%9d%83%e5%a8%81%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fcalico-guide%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fcalico-guide%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fcalico-guide%2f&t=Calico%20%e8%b7%af%e7%94%b1%e5%8f%8d%e5%b0%84%e6%a8%a1%e5%bc%8f%e6%9d%83%e5%a8%81%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div></div><div class=aside><div class=inner-div><div class=title>ç›®å½•</div><div class=tabs><nav id=TableOfContents><ul><li><a href=#æ¦‚è¿°>æ¦‚è¿°</a><ul><li><a href=#full-mesh>Full-mesh</a></li><li><a href=#route-reflectors>Route reflectors</a></li><li><a href=#top-of-racktor>Top of Rackï¼ˆToRï¼‰</a></li></ul></li><li><a href=#å®‰è£…-calicoctl>å®‰è£… calicoctl</a></li><li><a href=#å…³é—­-full-mesh-æ¨¡å¼>å…³é—­ Full-mesh æ¨¡å¼</a></li><li><a href=#ä¿®æ”¹å·¥ä½œèŠ‚ç‚¹çš„-calico-é…ç½®>ä¿®æ”¹å·¥ä½œèŠ‚ç‚¹çš„ Calico é…ç½®</a></li><li><a href=#ä¸º-node-èŠ‚ç‚¹è¿›è¡Œåˆ†ç»„æ·»åŠ -label>ä¸º node èŠ‚ç‚¹è¿›è¡Œåˆ†ç»„ï¼ˆæ·»åŠ  labelï¼‰</a></li><li><a href=#é…ç½®-bgppeer>é…ç½® BGPPeer</a></li><li><a href=#å·¥ä½œèŠ‚ç‚¹é…ç½®éªŒè¯>å·¥ä½œèŠ‚ç‚¹é…ç½®éªŒè¯</a></li><li><a href=#äº¤æ¢æœºé…ç½®éªŒè¯>äº¤æ¢æœºé…ç½®éªŒè¯</a></li><li><a href=#å°†-service-åœ°å€è·¯ç”±åŒæ­¥åˆ°ç‰©ç†ç½‘ç»œ>å°† Service åœ°å€è·¯ç”±åŒæ­¥åˆ°ç‰©ç†ç½‘ç»œ</a></li><li><a href=#æ–‡æ¡£å‚è€ƒé“¾æ¥>æ–‡æ¡£å‚è€ƒé“¾æ¥</a></li></ul></nav></div></div></div></div></section><div class=SubscribeForm><div class=innerBox><img class=close src=/images/home/close.svg alt=close><p class=description>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=blog_formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input-blog type=text placeholder>
<button id=email-submit-blog>è®¢é˜…</button>
<span id=message_blog data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨ style=color:red></span><span id=message1_blog style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span></div></div></div><footer><div class=footer><div class="footer-main common-layout"><div class=up-main><div class=left-div><img src=/images/logo.svg alt class=foot-logo><p>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input type=text placeholder=è¯·è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€>
<button id=email-submit>è®¢é˜…</button></div><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨></span><span id=message1 style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span><script>var bindSubmit=function(){var e=$("#email-input");$("#email-submit").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message").data("message1"),a=$("#message").data("message2"),r=$("#message").data("message3"),c=$("#message1").data("success");if(n)if(validateEmail(n)){if(s=$("#formAddress").data("usesendcloud"),!s)return;o=$("#formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:$("#email-input").val().toString()},success:function(){showSuccessMessage(c),setTimeout(function(){$("#email-input").val("")},1e3)},error:function(){showMessage(r)}})}else t.preventDefault(),showMessage(a);else t.preventDefault(),showMessage(i)})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},showMessage=function(e){$("#message").html(e).show()},showSuccessMessage=function(e){$("#message1").html(e).show()},bindHideMessage=function(){$(window).click(function(){$("#message").hide(),$("#message1").hide()})},bindClose=function(){$(".formBox .close").click(function(e){e.stopPropagation(),$(".formBox").fadeOut()})};bindSubmit(),bindClose(),bindHideMessage()</script><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€!></span></div><div class=right-div><ul class=common-flex-layout><li class=nowrap-li><div class=h3>åº”ç”¨åœºæ™¯</div><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps</a>
<a href=/zh/service-mesh/>åœ¨ K8s è¿è¡Œå¾®æœåŠ¡</a>
<a href=/zh/observability/>æ„å»ºäº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a>
<a href=https://github.com/kubesphere/kubekey target=_blank rel="noopener noreferrer">K8s ä¸€é”®éƒ¨ç½²ä¸è¿ç»´</a>
<a href=https://github.com/OpenFunction/OpenFunction target=_blank rel="noopener noreferrer">æ„å»º FaaS å¹³å°ä¸ Serverless æ¶æ„</a>
<a href=https://github.com/openpitrix/openpitrix target=_blank rel="noopener noreferrer">å¤šäº‘åº”ç”¨ç®¡ç†å¹³å°</a></li><li class=nowrap-li><div class=h3>èµ„æº</div><a href=/zh/projects/>å¼€æºé¡¹ç›®</a>
<a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a>
<a href=/zh/conferences/>å¼€æºå³°ä¼š</a>
<a href=/zh/videos/>è§†é¢‘èµ„æº</a>
<a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li><li class=nowrap-li><div class=h3>æ–‡æ¡£ä¸­å¿ƒ</div><a href=/zh/docs/v4.1/01-intro/01-introduction/>äº§å“ä»‹ç»</a>
<a href=/zh/docs/v4.1/03-installation-and-upgrade/02-install-kubesphere/02-install-kubernetes-and-kubesphere/>å¦‚ä½•å®‰è£…</a>
<a href=/zh/docs/v4.1/02-quickstart/>å¿«é€Ÿå…¥é—¨</a>
<a href=/zh/docs/v3.4/reference/api-docs/>API æ–‡æ¡£</a></li><li class=nowrap-li><div class=h3>å¼€æºç¤¾åŒº</div><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a>
<a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a>
<a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a>
<a href=/zh/partner/>åˆä½œä¼™ä¼´</a>
<a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a>
<a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a>
<a href=https://kubesphere.com.cn/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a>
<a href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ä¸­æ–‡è®ºå›</a>
<a href=https://kubesphere.io target=_blank rel="noopener noreferrer">å…¨çƒç«™</a></li><li class=nowrap-li><div class=h3>äº§å“ä¸æœåŠ¡</div><a href=https://aws.amazon.com/cn/quickstart/architecture/qingcloud-kubesphere/ target=_blank rel="noopener noreferrer">KubeSphere on AWS</a>
<a href=https://market.azure.cn/marketplace/apps/qingcloud.kubesphere target=_blank rel="noopener noreferrer">KubeSphere on Azure</a>
<a href=https://marketplace.digitalocean.com/apps/kubesphere target=_blank rel="noopener noreferrer">KubeSphere on DigitalOcean</a>
<a href=https://www.qingcloud.com/products/kubesphereqke target=_blank rel="noopener noreferrer">KubeSphere on QingCloud(QKE)</a>
<a href=https://kubesphere.com.cn/kse/ target=_blank rel="noopener noreferrer">KubeSphere ä¼ä¸šç‰ˆ</a>
<a href=https://kubesphere.cloud/ksv/ target=_blank rel="noopener noreferrer">KubeSphere è™šæ‹ŸåŒ–å¹³å°</a>
<a href=https://kubesphere.com.cn/marketplace/ target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿæ‰©å±•ç»„ä»¶å¸‚åœº</a>
<a href=https://kubesphere.cloud target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿåº”ç”¨æœåŠ¡å¹³å°</a>
<a href=https://m.qingcloud.com/p/aec50 target=_blank rel="noopener noreferrer">äº†è§£å•†ä¸šäº§å“ä¸å’¨è¯¢åˆä½œ</a></li></ul></div></div><div class=down-main><div class=img-div><a class=wechat href=javascript:void(0); aria-label=wechat><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28"><defs><path id="a" d="M0 0h15.673v12.156H0z"/></defs><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="13" cy="13" r="13" stroke="#B6C2CD"/><g transform="translate(5 7)"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59.0-4.625 1.679-4.625 3.74.0 2.066 2.035 3.738 4.625 3.738.542.0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27.0-.541-.257-.541-.514.0-.256.27-.514.541-.514.41.0.681.258.681.514.0.257-.271.514-.681.514zm2.994.0c-.27.0-.541-.257-.541-.514.0-.256.27-.514.54-.514.41.0.681.258.681.514.0.257-.277.514-.68.514z" mask="url(#b)"/><path fill="currentColor" d="M10.602 3.674c.177.0.356.011.533.029C10.657 1.576 8.27.0 5.543.0 2.498.0.0 1.974.0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17.0.343-.005.515-.022a3.68 3.68.0 01-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417.0.693.263.693.66s-.276.66-.693.66c-.418.0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417.0-.834-.263-.834-.66s.417-.66.834-.66c.418.0.695.263.695.66.0.392-.277.66-.695.66z" mask="url(#b)"/></g></g></svg><div class=hide-div><img src=/images/home/wechat.svg alt></div></a><a class=facebook-a href=https://www.facebook.com/kubesphere target=_blank aria-label=facebook></a><a class=twitter-a href=https://x.com/KubeSphere target=_blank aria-label=twitter rel="noopener noreferrer"></a><a class=linkedin-a href=https://www.linkedin.com/company/kubesphere/ target=_blank aria-label=linkedin rel="noopener noreferrer"></a><a class=bilibili-a href=https://space.bilibili.com/438908638 target=_blank aria-label=bilibili rel="noopener noreferrer"></a><a class=slack-a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank aria-label=slack rel="noopener noreferrer"></a><a class=github-a href=https://github.com/kubesphere/kubesphere target=_blank aria-label=github rel="noopener noreferrer"></a><a class=medium-a href=https://itnext.io/@kubesphere target=_blank aria-label=medium rel="noopener noreferrer"></a></div><p class=p1></p><p class=case><a href=http://www.beian.miit.gov.cn/ target=_blank rel="noopener noreferrer"><span>äº¬ICPå¤‡13019086å·</span>
</a><a target=_blank rel="noopener noreferrer" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502041003"><img src=/images/footer/case-icon.png alt=å¤‡æ¡ˆå›¾æ ‡>
<span>äº¬å…¬ç½‘å®‰å¤‡ 11010502041003å·</span></a></p></div></div></div><div class=cookie><div class=common-layout><p>æ‚¨çš„éšç§å¯¹æˆ‘ä»¬å¾ˆé‡è¦ã€‚æˆ‘ä»¬ä½¿ç”¨Cookieæ¥è®°ä½è®¢é˜…è¯¦ç»†ä¿¡æ¯ï¼Œä¼˜åŒ–ç½‘ç«™åŠŸèƒ½å¹¶äº¤ä»˜æ ¹æ®æ‚¨çš„å…´è¶£é‡èº«å®šåˆ¶çš„å†…å®¹ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„<a href=/zh/privacy>éšç§æ”¿ç­–</a>.</p><button>
æ¥å—å¹¶ç»§ç»­</button></div></div></footer><script>var lazyLoad=function(e,t){for(var n,o,i,s=0;s<t;s++){if(n=e.eq(s),o=n.attr("data-loaded"),o)continue;n.offset().top<parseInt($(window).height())+parseInt($(window).scrollTop())&&(i=n.attr("src"),n.attr("src",i),n.attr("data-loaded",!0))}},bindLayLoad=function(){var e=$("img"),t=e.length;lazyLoad(e,t),$(window).scroll(function(){lazyLoad(e,t)})},bindAddPadding=function(){var e=$("#close-join");e.length>0&&$(".main-section").addClass("padding")},docCookies={getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t){return!!e&&!/^(?:expires|max-age|path|domain|secure)$/i.test(e)&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t),!0)}},bindHideCookie=function(){var t=docCookies.getItem("hasAuth"),e=$(".cookie");t?e.hide():e.show(),e.find("button").on("click",function(){docCookies.setItem("hasAuth","1"),e.hide()})};bindAddPadding(),bindHideCookie()</script><script type=text/javascript src=/js/aside.2d6977c0f16aef4ed3e886dd66675ce74bd0efcd467c2b2bcdb30b92d5e7c7c0e5c6e0c9d8f09a883c22f58df9e6b0b6347fcdd3c9a920b7faba6d7f91a201c3.js integrity="sha512-LWl3wPFq707T6IbdZmdc50vQ781GfCsrzbMLktXnx8DlxuDJ2PCaiDwi9Y355rC2NH/N08mpILf6um1/kaIBww=="></script><script type=text/javascript src=/js/markdown-tab.17f9f46b021adebc7250ce1b07134a577b307e7a436daa4aaf388f218e8463966f53770b26a64817c06c168738a887672d47fb4c29615adfc446e11d09a344cf.js integrity="sha512-F/n0awIa3rxyUM4bBxNKV3swfnpDbapKrziPIY6EY5ZvU3cLJqZIF8BsFoc4qIdnLUf7TClhWt/ERuEdCaNEzw=="></script><script>let forbidForm=!1;var viewer=new Viewer(document.querySelector(".md-body"),{url:"src"}),blogBindSubmit=function(){var e=$("#email-input-blog");$("#email-submit-blog").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message_blog").data("message1"),a=$("#message_blog").data("message2"),r=$("#message_blog").data("message3"),c=$("#message1_blog").data("success");if(n)if(validateEmail(n)){if(s=$("#blog_formAddress").data("usesendcloud"),!s)return;o=$("#blog_formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:n.toString()},success:function(){showSuccessMessage_blog(c),setTimeout(function(){window.onscroll="",$(".SubscribeForm").hide(),$("#email-input-blog").val("")},5e3)},error:function(){showMessage_blog(r)}})}else t.preventDefault(),$("#message_blog").html(a).show();else t.preventDefault(),$("#message_blog").html(i).show()})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},bindHideMessageBlog=function(){$(window).click(function(){$("#message_blog").hide()})},bindCloseBlog=function(){$(".SubscribeForm .close").click(function(e){e.stopPropagation(),$(".SubscribeForm").fadeOut(),window.onscroll=""})},showMessage_blog=function(e){$("#message_blog").html(e).show()},showSuccessMessage_blog=function(e){$("#message1_blog").html(e).show()};window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;forbidForm&&(window.onscroll=""),e+t>n-710?$(".SubscribeForm").hide():$(".SubscribeForm").show()},blogBindSubmit(),bindCloseBlog(),bindHideMessageBlog()</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>