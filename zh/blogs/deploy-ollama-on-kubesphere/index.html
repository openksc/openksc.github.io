<!doctype html><html lang=en-US><head><meta charset=utf-8><title>åœ¨ KubeSphere ä¸Šéƒ¨ç½² AI å¤§æ¨¡å‹ Ollama</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="é€šè¿‡é˜…è¯»æœ¬æ–‡ï¼Œæ‚¨å°†è·å¾— Kubernetes ä¸Š ç®¡ç† GPU èµ„æºçš„çŸ¥è¯†å’ŒæŠ€å·§ï¼Œå¸®åŠ©æ‚¨åœ¨äº‘åŸç”Ÿç¯å¢ƒä¸­ï¼Œå……åˆ†åˆ©ç”¨ GPU èµ„æºï¼Œæ¨åŠ¨ AI åº”ç”¨çš„å¿«é€Ÿå‘å±•ã€‚"><meta name=keywords content="Kubernetes,KubeSphere,AI,Ollama"><meta property="og:type" content="article"><meta property="og:title" content="åœ¨ KubeSphere ä¸Šéƒ¨ç½² AI å¤§æ¨¡å‹ Ollama"><meta property="og:description" content="é€šè¿‡é˜…è¯»æœ¬æ–‡ï¼Œæ‚¨å°†è·å¾— Kubernetes ä¸Š ç®¡ç† GPU èµ„æºçš„çŸ¥è¯†å’ŒæŠ€å·§ï¼Œå¸®åŠ©æ‚¨åœ¨äº‘åŸç”Ÿç¯å¢ƒä¸­ï¼Œå……åˆ†åˆ©ç”¨ GPU èµ„æºï¼Œæ¨åŠ¨ AI åº”ç”¨çš„å¿«é€Ÿå‘å±•ã€‚"><meta property="og:image" content="https://pek3b.qingstor.com/kubesphere-community/images/ollama-on-kubesphere-cover.png"><meta property="og:url" content="https://openksc.github.io/zh/blogs/deploy-ollama-on-kubesphere/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeSphere"><meta property="twitter:image" content="https://pek3b.qingstor.com/kubesphere-community/images/ollama-on-kubesphere-cover.png"><meta name=docsearch:language content="zh-CN"><meta name=docsearch:version content><link rel=canonical href=https://kubesphere.io/zh/blogs/deploy-ollama-on-kubesphere/><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=apple-touch-icon href=/images/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/svg+xml href=/images/favicons/favicon.svg><link rel=icon type=image/png href=/images/favicons/favicon.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg color=#00ad6e><meta name=msapplication-config content='/images/favicons/browserconfig.xml'><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/fonts/Roboto/stylesheet.css><link rel=stylesheet href=/fonts/ProximaNova/stylesheet.css><link rel=stylesheet href=/css/jquery.modal.min.css><link rel=stylesheet href=/css/viewer.min.css><link rel=stylesheet href=/swiper/swiper-bundle.min.css><link rel=stylesheet href=/scss/common.min.0c3fdcc05ec210321169846714f74b11c4a1baf09a1833fa9273b2347c81e636.css><script src=/js/jquery-3.7.1.min.js></script><script src=/js/viewer.min.js></script><script src=/js/jquery.modal.min.js></script><script src=/swiper/swiper-bundle.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0888981f1fa45d241b1fb6962da2963e",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YYCVN36HT5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YYCVN36HT5")</script><script type=text/javascript>!function(e,t,n,s,o){e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=("https:"==document.location.protocol?"https://":"http://")+s,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio"),gio("init","8a24ae300cbf8b8c",{}),gio("send")</script><link rel=stylesheet href=/scss/content.min.f73b326fbf8c5bd331900b0de21c7dde608a4926f482f6465f9ae1d9049b83ad.css><link rel=stylesheet href=/scss/markdown.min.db47186481122431dffae72d17dbbd51f90b66f022cc163458645709924e4eac.css></head><body><header class=navigation><div class=join-div><div class=content>ğŸš€ KubeSphere v4.1.3 å‘å¸ƒï¼Œå¤šé¡¹ä¼˜åŒ–ä¸æ”¹è¿›ï¼Œæ¬¢è¿ä½“éªŒï¼<a href=/zh/docs/v4.1/20-release-notes/release-v413/ target=_blank rel="noopener noreferrer">è¯·æŸ¥çœ‹ Release notes â†’</a>
<img id=close-join src=/images/header/close.svg alt=close></div></div><div class=common-layout><div class=header-container><a href=/zh/ aria-label=logo><img src=/images/header/logo.svg alt class=logo></a><ul class=nav><li class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class="dropdown-menu menu-2"><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li class=menu-li><span class=menu-span>èµ„æº</span><ul class="dropdown-menu menu-3"><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class="dropdown-menu menu-4"><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/ target=_blank rel="noopener noreferrer">æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/ target=_blank rel="noopener noreferrer">Kube Design</a></li></ul></li><li class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class="dropdown-menu menu-5"><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025 target=_blank rel="noopener noreferrer">å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/ target=_blank rel="noopener noreferrer">è®¤è¯</a></li></ul><div class=right-menu><ul><li class=language-menu><div><img src=/images/header/black.svg alt>
<span>ç®€ä½“ä¸­æ–‡</span></div><ul class=dropdown-menu><li onclick='handleLangClick("zh","/zh/blogs/deploy-ollama-on-kubesphere/")'>ç®€ä½“ä¸­æ–‡</li></ul></li><li class=github-li><div class=github-star><a class=star-btn href=https://github.com/kubesphere/kubesphere rel="noopener noreferrer" target=_blank><span class=star-img></span>&nbsp;<span>Star</span>
</a><a class=social-count href=https://github.com/kubesphere/kubesphere/stargazers rel="noopener noreferrer" target=_blank></a></div></li><li class=menu-icon><img src=/images/header/menu.svg alt></li></ul></div></div></div><div id=modal-for-menu class=modal><ul class=nav><li data-check=0 class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class=dropdown-menu><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>èµ„æº</span><ul class=dropdown-menu><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class=dropdown-menu><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/>æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/>Kube Design</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class=dropdown-menu><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md>ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/>ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025>å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum>ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/>è®¤è¯</a></li></ul><div class=link-div><a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank rel="noopener noreferrer" aria-label=slack><img src=/images/header/slack-hover.svg alt>
</a><a href=https://x.com/KubeSphere target=_blank rel="noopener noreferrer" aria-label=twitter><img src=/images/header/twitter-hover.svg alt>
</a><a href=https://github.com/kubesphere/kubesphere target=_blank rel="noopener noreferrer" aria-label=github><img src=/images/header/github-hover.svg alt></a></div></div></header><script>var bindNavMouseEvent,bindScrollChangeHeader,bindClickShowMenu,bindClickModalLi,bindClickClose,language,handleLangClick,githubApiLink="https://api.github.com/repos/kubesphere/kubesphere",getStar=function(){$(".social-count").hide(),$.getJSON(githubApiLink,function(e){$(".social-count").show().html(e.stargazers_count)})};getStar(),bindNavMouseEvent=function(e,t){t||(t=$(e));var n=!1;t.mouseenter(function(){if(n)return!1;n=!0,$(this).find(".dropdown-menu").fadeIn(200,function(){n=!1})}),t.mouseleave(function(){$(this).find(".dropdown-menu").fadeOut(200)})},bindScrollChangeHeader=function(){var t=100,e=$("header");window.addEventListener("scroll",function(){var t=window.scrollY;t>0?e.addClass("navigationScroll"):e.removeClass("navigationScroll")})},bindClickShowMenu=function(){$(".menu-icon").click(function(){$("#modal-for-menu").modal()})},bindClickModalLi=function(){$(".modal .menu-li").click(function(){var e=$(this).data("check");e===0?($(this).data("check",1),$(this).find(".dropdown-menu").slideDown(200)):($(this).data("check",0),$(this).find(".dropdown-menu").slideUp(200)),$(this).find(".menu-span").toggleClass("up")})},bindClickClose=function(){$("#close-join").click(function(){$(".navigation .join-div").hide(),$(".main-section").removeClass("padding")})},language="zh",bindClickClose(),bindScrollChangeHeader(),$(".header-container .menu-li").each(function(){bindNavMouseEvent("",$(this))}),bindNavMouseEvent(".header-container .language-menu"),bindNavMouseEvent(".header-container .btn-li"),bindClickShowMenu(),bindClickModalLi(),handleLangClick=function(e,t){try{localStorage.setItem("lang",e)}catch{}location.href=t}</script><section class=main-section><div class=common-layout><div class=breadcrumb><span><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a> > </span><span>åœ¨ KubeSphere ä¸Šéƒ¨ç½² AI å¤§æ¨¡å‹ Ollama</span></div><div class='main-div middle-div'><div class=author>è¿ç»´æœ‰æœ¯</div><span class=date>å‘å¸ƒäºï¼š2024-07-09</span>&nbsp;&nbsp;&nbsp;
<span style=font-size:14px;color:#919aa3 id=busuanzi_container_page_pv>æœ¬æ–‡æ€»é˜…è¯»é‡ï¼š<span id=busuanzi_value_page_pv></span></span><h1>åœ¨ KubeSphere ä¸Šéƒ¨ç½² AI å¤§æ¨¡å‹ Ollama</h1><div class=share-1><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-ollama-on-kubesphere%2f&text=%e5%9c%a8%20KubeSphere%20%e4%b8%8a%e9%83%a8%e7%bd%b2%20AI%20%e5%a4%a7%e6%a8%a1%e5%9e%8b%20Ollama" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-ollama-on-kubesphere%2f&title=%e5%9c%a8%20KubeSphere%20%e4%b8%8a%e9%83%a8%e7%bd%b2%20AI%20%e5%a4%a7%e6%a8%a1%e5%9e%8b%20Ollama" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-ollama-on-kubesphere%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-ollama-on-kubesphere%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-ollama-on-kubesphere%2f&t=%e5%9c%a8%20KubeSphere%20%e4%b8%8a%e9%83%a8%e7%bd%b2%20AI%20%e5%a4%a7%e6%a8%a1%e5%9e%8b%20Ollama" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div><div class=content><div class=md-body><p>éšç€äººå·¥æ™ºèƒ½ã€æœºå™¨å­¦ä¹ ã€AI å¤§æ¨¡å‹æŠ€æœ¯çš„è¿…çŒ›å‘å±•ï¼Œæˆ‘ä»¬å¯¹è®¡ç®—èµ„æºçš„éœ€æ±‚ä¹Ÿåœ¨ä¸æ–­æ”€å‡ã€‚ç‰¹åˆ«æ˜¯å¯¹äºéœ€è¦å¤„ç†å¤§è§„æ¨¡æ•°æ®å’Œå¤æ‚ç®—æ³•çš„ AI å¤§æ¨¡å‹ï¼ŒGPU èµ„æºçš„ä½¿ç”¨å˜å¾—è‡³å…³é‡è¦ã€‚å¯¹äºè¿ç»´å·¥ç¨‹å¸ˆè€Œè¨€ï¼ŒæŒæ¡å¦‚ä½•åœ¨ Kubernetes é›†ç¾¤ä¸Šç®¡ç†å’Œé…ç½® GPU èµ„æºï¼Œä»¥åŠå¦‚ä½•é«˜æ•ˆéƒ¨ç½²ä¾èµ–è¿™äº›èµ„æºçš„åº”ç”¨ï¼Œå·²æˆä¸ºä¸€é¡¹ä¸å¯æˆ–ç¼ºçš„æŠ€èƒ½ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘å°†å¸¦é¢†å¤§å®¶æ·±å…¥äº†è§£å¦‚ä½•åœ¨ KubeSphere å¹³å°ä¸Šï¼Œåˆ©ç”¨ Kubernetes å¼ºå¤§çš„ç”Ÿæ€å’Œå·¥å…·ï¼Œå®ç° GPU èµ„æºçš„ç®¡ç†å’Œåº”ç”¨éƒ¨ç½²ã€‚ä»¥ä¸‹æ˜¯æœ¬æ–‡å°†è¦æ¢è®¨çš„ä¸‰ä¸ªæ ¸å¿ƒä¸»é¢˜ï¼š</p><ol><li><strong>é›†ç¾¤æ‰©å®¹ä¸ GPU èŠ‚ç‚¹é›†æˆ</strong>ï¼šæˆ‘ä»¬å°†é€šè¿‡ KubeKey å·¥å…·ï¼Œæ‰©å±• Kubernetes é›†ç¾¤å¹¶å¢åŠ å…·å¤‡ GPU èƒ½åŠ›çš„ Worker èŠ‚ç‚¹ï¼Œä¸º AI åº”ç”¨æä¾›å¿…è¦çš„ç¡¬ä»¶æ”¯æŒã€‚</li><li><strong>GPU èµ„æºçš„ Kubernetes é›†æˆ</strong>ï¼šä½¿ç”¨ Helm å®‰è£…å’Œé…ç½® NVIDIA GPU Operatorï¼Œè¿™æ˜¯ NVIDIA å®˜æ–¹æä¾›çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæ—¨åœ¨ç®€åŒ– Kubernetes é›†ç¾¤ä¸­ GPU èµ„æºçš„è°ƒç”¨å’Œç®¡ç†ã€‚</li><li><strong>å®æˆ˜éƒ¨ç½²ï¼šOllama å¤§æ¨¡å‹ç®¡ç†å·¥å…·</strong>ï¼šæˆ‘ä»¬å°†åœ¨ KubeSphere ä¸Šéƒ¨ç½² Ollamaï¼Œä¸€ä¸ªä¸“ä¸º AI å¤§æ¨¡å‹è®¾è®¡çš„ç®¡ç†å·¥å…·ï¼Œä»¥éªŒè¯ GPU èµ„æºæ˜¯å¦èƒ½å¤Ÿè¢«æ­£ç¡®è°ƒåº¦å’Œé«˜æ•ˆä½¿ç”¨ã€‚</li></ol><p>é€šè¿‡é˜…è¯»æœ¬æ–‡ï¼Œæ‚¨å°†è·å¾— Kubernetes ä¸Š ç®¡ç† GPU èµ„æºçš„çŸ¥è¯†å’ŒæŠ€å·§ï¼Œå¸®åŠ©æ‚¨åœ¨äº‘åŸç”Ÿç¯å¢ƒä¸­ï¼Œå……åˆ†åˆ©ç”¨ GPU èµ„æºï¼Œæ¨åŠ¨ AI åº”ç”¨çš„å¿«é€Ÿå‘å±•ã€‚</p><p><strong>KubeSphere æœ€ä½³å®æˆ˜ã€Œ2024ã€</strong> ç³»åˆ—æ–‡æ¡£çš„å®éªŒç¯å¢ƒç¡¬ä»¶é…ç½®å’Œè½¯ä»¶ä¿¡æ¯å¦‚ä¸‹ï¼š</p><p><strong>å®æˆ˜æœåŠ¡å™¨é…ç½®(æ¶æ„1:1å¤åˆ»å°è§„æ¨¡ç”Ÿäº§ç¯å¢ƒï¼Œé…ç½®ç•¥æœ‰ä¸åŒ)</strong></p><table><thead><tr><th style=text-align:center>ä¸»æœºå</th><th style=text-align:center>IP</th><th style=text-align:center>CPU</th><th style=text-align:center>å†…å­˜</th><th style=text-align:center>ç³»ç»Ÿç›˜</th><th style=text-align:center>æ•°æ®ç›˜</th><th style=text-align:center>ç”¨é€”</th></tr></thead><tbody><tr><td style=text-align:center>ksp-registry</td><td style=text-align:center>192.168.9.90</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>200</td><td style=text-align:center>Harbor é•œåƒä»“åº“</td></tr><tr><td style=text-align:center>ksp-control-1</td><td style=text-align:center>192.168.9.91</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>KubeSphere/k8s-control-plane</td></tr><tr><td style=text-align:center>ksp-control-2</td><td style=text-align:center>192.168.9.92</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>KubeSphere/k8s-control-plane</td></tr><tr><td style=text-align:center>ksp-control-3</td><td style=text-align:center>192.168.9.93</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>KubeSphere/k8s-control-plane</td></tr><tr><td style=text-align:center>ksp-worker-1</td><td style=text-align:center>192.168.9.94</td><td style=text-align:center>4</td><td style=text-align:center>16</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>k8s-worker/CI</td></tr><tr><td style=text-align:center>ksp-worker-2</td><td style=text-align:center>192.168.9.95</td><td style=text-align:center>4</td><td style=text-align:center>16</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>k8s-worker</td></tr><tr><td style=text-align:center>ksp-worker-3</td><td style=text-align:center>192.168.9.96</td><td style=text-align:center>4</td><td style=text-align:center>16</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>k8s-worker</td></tr><tr><td style=text-align:center>ksp-storage-1</td><td style=text-align:center>192.168.9.97</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>300+</td><td style=text-align:center>ElasticSearch/Ceph/Longhorn/NFS/</td></tr><tr><td style=text-align:center>ksp-storage-2</td><td style=text-align:center>192.168.9.98</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>300+</td><td style=text-align:center>ElasticSearch//Ceph/Longhorn</td></tr><tr><td style=text-align:center>ksp-storage-3</td><td style=text-align:center>192.168.9.99</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>300+</td><td style=text-align:center>ElasticSearch//Ceph/Longhorn</td></tr><tr><td style=text-align:center>ksp-gpu-worker-1</td><td style=text-align:center>192.168.9.101</td><td style=text-align:center>4</td><td style=text-align:center>16</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>k8s-worker(GPU NVIDIA Tesla M40 24G)</td></tr><tr><td style=text-align:center>ksp-gpu-worker-2</td><td style=text-align:center>192.168.9.102</td><td style=text-align:center>4</td><td style=text-align:center>16</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>k8s-worker(GPU NVIDIA Tesla P100 16G)</td></tr><tr><td style=text-align:center>ksp-gateway-1</td><td style=text-align:center>192.168.9.103</td><td style=text-align:center>2</td><td style=text-align:center>4</td><td style=text-align:center>40</td><td style=text-align:center></td><td style=text-align:center>è‡ªå»ºåº”ç”¨æœåŠ¡ä»£ç†ç½‘å…³/VIPï¼š192.168.9.100</td></tr><tr><td style=text-align:center>ksp-gateway-2</td><td style=text-align:center>192.168.9.104</td><td style=text-align:center>2</td><td style=text-align:center>4</td><td style=text-align:center>40</td><td style=text-align:center></td><td style=text-align:center>è‡ªå»ºåº”ç”¨æœåŠ¡ä»£ç†ç½‘å…³/VIPï¼š192.168.9.100</td></tr><tr><td style=text-align:center>ksp-mid</td><td style=text-align:center>192.168.9.105</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>éƒ¨ç½²åœ¨ k8s é›†ç¾¤ä¹‹å¤–çš„æœåŠ¡èŠ‚ç‚¹ï¼ˆGitlab ç­‰ï¼‰</td></tr><tr><td style=text-align:center>åˆè®¡</td><td style=text-align:center>15</td><td style=text-align:center>56</td><td style=text-align:center>152</td><td style=text-align:center>600</td><td style=text-align:center>2000</td><td style=text-align:center></td></tr></tbody></table><p><strong>å®æˆ˜ç¯å¢ƒæ¶‰åŠè½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯</strong></p><ul><li>æ“ä½œç³»ç»Ÿï¼š<strong>openEuler 22.03 LTS SP3 x86_64</strong></li><li>KubeSphereï¼š<strong>v3.4.1</strong></li><li>Kubernetesï¼š<strong>v1.28.8</strong></li><li>KubeKey: <strong>v3.1.1</strong></li><li>Containerdï¼š<strong>1.7.13</strong></li><li>NVIDIA GPU Operatorï¼š<strong>v24.3.0</strong></li><li>NVIDIA æ˜¾å¡é©±åŠ¨ï¼š<strong>550.54.15</strong></li></ul><h2 id=1-å‰ç½®æ¡ä»¶>1. å‰ç½®æ¡ä»¶</h2><h3 id=11-å‡†å¤‡å¸¦æœ‰æ˜¾å¡çš„-worker-èŠ‚ç‚¹>1.1 å‡†å¤‡å¸¦æœ‰æ˜¾å¡çš„ Worker èŠ‚ç‚¹</h3><p>é‰´äºèµ„æºå’Œæˆæœ¬çš„é™åˆ¶ï¼Œæˆ‘æ²¡æœ‰é«˜ç«¯ç‰©ç†ä¸»æœºå’Œæ˜¾å¡æ¥åšå®éªŒã€‚åªèƒ½å¢åŠ ä¸¤å°é…å¤‡å…¥é—¨çº§ GPU æ˜¾å¡çš„è™šæ‹Ÿæœºï¼Œä½œä¸ºé›†ç¾¤çš„ Worker èŠ‚ç‚¹ã€‚</p><ul><li>èŠ‚ç‚¹ 1ï¼Œé…ç½® GPU NVIDIA Tesla M40 24G æ˜¾å¡ã€‚å”¯ä¸€ä¼˜ç‚¹ 24G å¤§æ˜¾å­˜ï¼Œæ€§èƒ½ä½ã€‚</li><li>èŠ‚ç‚¹ 2ï¼Œé…ç½® GPU NVIDIA Tesla P100 16G æ˜¾å¡ã€‚æ˜¾å­˜å°ï¼Œä½†æ˜¯é€Ÿåº¦å¿«äº M40ã€P40 ç­‰æ˜¾å¡ã€‚</li></ul><p>å°½ç®¡è¿™äº›æ˜¾å¡åœ¨æ€§èƒ½ä¸Šä¸åŠé«˜ç«¯å‹å·ï¼Œä½†å®ƒä»¬è¶³ä»¥åº”å¯¹å¤§å¤šæ•°å­¦ä¹ å’Œå¼€å‘ä»»åŠ¡ï¼Œåœ¨èµ„æºæœ‰é™çš„æƒ…å†µä¸‹ï¼Œè¿™æ ·çš„é…ç½®ä¸ºæˆ‘æä¾›äº†å®è´µçš„å®è·µæœºä¼šï¼Œè®©æˆ‘èƒ½å¤Ÿæ·±å…¥æ¢ç´¢ Kubernetes é›†ç¾¤ä¸­ GPU èµ„æºçš„ç®¡ç†å’Œè°ƒåº¦ç­–ç•¥ã€‚</p><h3 id=12-æ“ä½œç³»ç»Ÿåˆå§‹åŒ–é…ç½®>1.2 æ“ä½œç³»ç»Ÿåˆå§‹åŒ–é…ç½®</h3><p>è¯·å‚è€ƒ <a href=https://mp.weixin.qq.com/s/YDnvnuTqYfmgvF3HGOJ4WQ target=_blank rel="noopener noreferrer">Kubernetes é›†ç¾¤èŠ‚ç‚¹ openEuler 22.03 LTS SP3 ç³»ç»Ÿåˆå§‹åŒ–æŒ‡å—</a>ï¼Œå®Œæˆæ“ä½œç³»ç»Ÿåˆå§‹åŒ–é…ç½®ã€‚</p><p><strong>åˆå§‹åŒ–é…ç½®æŒ‡å—ä¸­æ²¡æœ‰æ¶‰åŠæ“ä½œç³»ç»Ÿå‡çº§çš„ä»»åŠ¡ï¼Œåœ¨èƒ½è”ç½‘çš„ç¯å¢ƒåˆå§‹åŒ–ç³»ç»Ÿçš„æ—¶å€™ä¸€å®šè¦å‡çº§æ“ä½œç³»ç»Ÿï¼Œç„¶åé‡å¯èŠ‚ç‚¹ã€‚</strong></p><h2 id=2-ä½¿ç”¨-kubekey-æ‰©å®¹-gpu-worker-èŠ‚ç‚¹>2. ä½¿ç”¨ KubeKey æ‰©å®¹ GPU Worker èŠ‚ç‚¹</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ KubeKey å°†æ–°å¢åŠ çš„ GPU èŠ‚ç‚¹åŠ å…¥åˆ°å·²æœ‰çš„ Kubernetes é›†ç¾¤ï¼Œå‚è€ƒå®˜æ–¹è¯´æ˜æ–‡æ¡£ï¼Œæ•´ä¸ªè¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œä»…éœ€ä¸¤æ­¥ã€‚</p><ul><li>ä¿®æ”¹ KubeKey éƒ¨ç½²æ—¶ä½¿ç”¨çš„é›†ç¾¤é…ç½®æ–‡ä»¶</li><li>æ‰§è¡Œå¢åŠ èŠ‚ç‚¹çš„å‘½ä»¤</li></ul><h3 id=21-ä¿®æ”¹é›†ç¾¤é…ç½®æ–‡ä»¶>2.1 ä¿®æ”¹é›†ç¾¤é…ç½®æ–‡ä»¶</h3><p>åœ¨ Control-1 èŠ‚ç‚¹ï¼Œåˆ‡æ¢åˆ°éƒ¨ç½²ç”¨çš„ KubeKey ç›®å½•ï¼Œä¿®æ”¹åŸæœ‰çš„é›†ç¾¤é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å®æˆ˜ä¸­ä½¿ç”¨çš„åå­—ä¸º <strong>ksp-v341-v1288.yaml</strong>ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ ã€‚</p><p>ä¸»è¦ä¿®æ”¹ç‚¹ï¼š</p><ul><li>spec.hosts éƒ¨åˆ†ï¼šå¢åŠ æ–°çš„ worker èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚</li><li>spec.roleGroups.worker éƒ¨åˆ†ï¼šå¢åŠ æ–°çš„ worker èŠ‚ç‚¹çš„ä¿¡æ¯</li></ul><p>ä¿®æ”¹åçš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kubekey.kubesphere.io/v1alpha2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Cluster</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>opsxlab</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>......(ä¿æŒä¸å˜)</span>
</span></span><span style=display:flex><span>  - {<span style=color:#f92672>name: ksp-gpu-worker-1, address: 192.168.9.101, internalAddress: 192.168.9.101, user: root, password</span>: <span style=color:#e6db74>&#34;OpsXlab@2024&#34;</span>}
</span></span><span style=display:flex><span>  - {<span style=color:#f92672>name: ksp-gpu-worker-2, address: 192.168.9.102, internalAddress: 192.168.9.102, user: root, password</span>: <span style=color:#e6db74>&#34;OpsXlab@2024&#34;</span>}
</span></span><span style=display:flex><span>  <span style=color:#f92672>roleGroups</span>:
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>......(ä¿æŒä¸å˜)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>worker</span>:
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>......(ä¿æŒä¸å˜)</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ksp-gpu-worker-1</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ksp-gpu-worker-2</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#75715e># ä¸‹é¢çš„å†…å®¹ä¿æŒä¸å˜</span>
</span></span></code></pre></div><h3 id=22-ä½¿ç”¨-kubekey-å¢åŠ èŠ‚ç‚¹>2.2 ä½¿ç”¨ KubeKey å¢åŠ èŠ‚ç‚¹</h3><p>åœ¨å¢åŠ èŠ‚ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬å†ç¡®è®¤ä¸€ä¸‹å½“å‰é›†ç¾¤çš„èŠ‚ç‚¹ä¿¡æ¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get nodes -o wide
</span></span><span style=display:flex><span>NAME            STATUS   ROLES           AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                    KERNEL-VERSION                       CONTAINER-RUNTIME
</span></span><span style=display:flex><span>ksp-control-1   Ready    control-plane   24h   v1.28.8   192.168.9.91   &lt;none&gt;        openEuler 22.03 <span style=color:#f92672>(</span>LTS-SP3<span style=color:#f92672>)</span>   5.10.0-182.0.0.95.oe2203sp3.x86_64   containerd://1.7.13
</span></span><span style=display:flex><span>ksp-control-2   Ready    control-plane   24h   v1.28.8   192.168.9.92   &lt;none&gt;        openEuler 22.03 <span style=color:#f92672>(</span>LTS-SP3<span style=color:#f92672>)</span>   5.10.0-182.0.0.95.oe2203sp3.x86_64   containerd://1.7.13
</span></span><span style=display:flex><span>ksp-control-3   Ready    control-plane   24h   v1.28.8   192.168.9.93   &lt;none&gt;        openEuler 22.03 <span style=color:#f92672>(</span>LTS-SP3<span style=color:#f92672>)</span>   5.10.0-182.0.0.95.oe2203sp3.x86_64   containerd://1.7.13
</span></span><span style=display:flex><span>ksp-worker-1    Ready    worker          24h   v1.28.8   192.168.9.94   &lt;none&gt;        openEuler 22.03 <span style=color:#f92672>(</span>LTS-SP3<span style=color:#f92672>)</span>   5.10.0-182.0.0.95.oe2203sp3.x86_64   containerd://1.7.13
</span></span><span style=display:flex><span>ksp-worker-2    Ready    worker          24h   v1.28.8   192.168.9.95   &lt;none&gt;        openEuler 22.03 <span style=color:#f92672>(</span>LTS-SP3<span style=color:#f92672>)</span>   5.10.0-182.0.0.95.oe2203sp3.x86_64   containerd://1.7.13
</span></span><span style=display:flex><span>ksp-worker-3    Ready    worker          24h   v1.28.8   192.168.9.96   &lt;none&gt;        openEuler 22.03 <span style=color:#f92672>(</span>LTS-SP3<span style=color:#f92672>)</span>   5.10.0-182.0.0.95.oe2203sp3.x86_64   containerd://1.7.13
</span></span></code></pre></div><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä½¿ç”¨ä¿®æ”¹åçš„é…ç½®æ–‡ä»¶å°†æ–°å¢çš„ Worker èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>export KKZONE<span style=color:#f92672>=</span>cn
</span></span><span style=display:flex><span>./kk add nodes -f ksp-v341-v1288.yaml
</span></span></code></pre></div><p>ä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œåï¼ŒKubeKey å…ˆæ£€æŸ¥éƒ¨ç½² Kubernetes çš„ä¾èµ–åŠå…¶å®ƒé…ç½®æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚é€šè¿‡æ£€æŸ¥åï¼Œç³»ç»Ÿå°†æç¤ºæ‚¨ç¡®è®¤å®‰è£…ã€‚è¾“å…¥ <strong>yes</strong> å¹¶æŒ‰ ENTER ç»§ç»­éƒ¨ç½²ã€‚</p><p>éƒ¨ç½²å®Œæˆéœ€è¦å¤§çº¦ 5 åˆ†é’Ÿå·¦å³ï¼Œå…·ä½“æ—¶é—´çœ‹ç½‘é€Ÿã€æœºå™¨é…ç½®ã€å¢åŠ çš„èŠ‚ç‚¹æ•°é‡ã€‚</p><p>éƒ¨ç½²å®Œæˆåï¼Œæ‚¨åº”è¯¥ä¼šåœ¨ç»ˆç«¯ä¸Šçœ‹åˆ°ç±»ä¼¼äºä¸‹é¢çš„è¾“å‡ºã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>......
</span></span><span style=display:flex><span>19:29:26 CST <span style=color:#f92672>[</span>AutoRenewCertsModule<span style=color:#f92672>]</span> Generate k8s certs renew script
</span></span><span style=display:flex><span>19:29:27 CST success: <span style=color:#f92672>[</span>ksp-control-2<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>19:29:27 CST success: <span style=color:#f92672>[</span>ksp-control-1<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>19:29:27 CST success: <span style=color:#f92672>[</span>ksp-control-3<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>19:29:27 CST <span style=color:#f92672>[</span>AutoRenewCertsModule<span style=color:#f92672>]</span> Generate k8s certs renew service
</span></span><span style=display:flex><span>19:29:29 CST success: <span style=color:#f92672>[</span>ksp-control-3<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>19:29:29 CST success: <span style=color:#f92672>[</span>ksp-control-2<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>19:29:29 CST success: <span style=color:#f92672>[</span>ksp-control-1<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>19:29:29 CST <span style=color:#f92672>[</span>AutoRenewCertsModule<span style=color:#f92672>]</span> Generate k8s certs renew timer
</span></span><span style=display:flex><span>19:29:30 CST success: <span style=color:#f92672>[</span>ksp-control-2<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>19:29:30 CST success: <span style=color:#f92672>[</span>ksp-control-1<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>19:29:30 CST success: <span style=color:#f92672>[</span>ksp-control-3<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>19:29:30 CST <span style=color:#f92672>[</span>AutoRenewCertsModule<span style=color:#f92672>]</span> Enable k8s certs renew service
</span></span><span style=display:flex><span>19:29:30 CST success: <span style=color:#f92672>[</span>ksp-control-3<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>19:29:30 CST success: <span style=color:#f92672>[</span>ksp-control-2<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>19:29:30 CST success: <span style=color:#f92672>[</span>ksp-control-1<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>19:29:30 CST Pipeline<span style=color:#f92672>[</span>AddNodesPipeline<span style=color:#f92672>]</span> execute successfully
</span></span></code></pre></div><h2 id=3-æ‰©å®¹åé›†ç¾¤çŠ¶æ€éªŒè¯>3. æ‰©å®¹åé›†ç¾¤çŠ¶æ€éªŒè¯</h2><h3 id=31-kubesphere-ç®¡ç†æ§åˆ¶å°éªŒè¯é›†ç¾¤çŠ¶æ€>3.1 KubeSphere ç®¡ç†æ§åˆ¶å°éªŒè¯é›†ç¾¤çŠ¶æ€</h3><p>æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨è®¿é—® Control-1 èŠ‚ç‚¹çš„ IP åœ°å€å’Œç«¯å£ <strong>30880</strong>ï¼Œç™»é™† KubeSphere ç®¡ç†æ§åˆ¶å°çš„ç™»å½•é¡µé¢ã€‚</p><p>è¿›å…¥é›†ç¾¤ç®¡ç†ç•Œé¢ï¼Œå•å‡»å·¦ä¾§ã€ŒèŠ‚ç‚¹ã€èœå•ï¼Œç‚¹å‡»ã€Œé›†ç¾¤èŠ‚ç‚¹ã€æŸ¥çœ‹ Kubernetes é›†ç¾¤å¯ç”¨èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//ksp-clusters-nodes-add-v341-v128.png alt></p><h3 id=32-kubectl-å‘½ä»¤è¡ŒéªŒè¯é›†ç¾¤çŠ¶æ€>3.2 Kubectl å‘½ä»¤è¡ŒéªŒè¯é›†ç¾¤çŠ¶æ€</h3><ul><li>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯</li></ul><p>åœ¨ Control-1 èŠ‚ç‚¹è¿è¡Œ kubectl å‘½ä»¤è·å– Kubernetes é›†ç¾¤çš„èŠ‚ç‚¹ä¿¡æ¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get nodes -o wide
</span></span></code></pre></div><p>åœ¨è¾“å‡ºç»“æœä¸­å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰çš„ Kubernetes é›†ç¾¤æœ‰ 8ä¸ªèŠ‚ç‚¹ï¼Œå¹¶è¯¦ç»†å±•ç¤ºæ¯ä¸ªèŠ‚ç‚¹çš„åå­—ã€çŠ¶æ€ã€è§’è‰²ã€å­˜æ´»æ—¶é—´ã€Kubernetes ç‰ˆæœ¬å·ã€å†…éƒ¨ IPã€æ“ä½œç³»ç»Ÿç±»å‹ã€å†…æ ¸ç‰ˆæœ¬å’Œå®¹å™¨è¿è¡Œæ—¶ç­‰ä¿¡æ¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get nodes -o wide
</span></span><span style=display:flex><span>NAME               STATUS     ROLES           AGE   VERSION   INTERNAL-IP     EXTERNAL-IP   OS-IMAGE                    KERNEL-VERSION                        CONTAINER-RUNTIME
</span></span><span style=display:flex><span>ksp-control-1      Ready      control-plane   25h   v1.28.8   192.168.9.91    &lt;none&gt;        openEuler 22.03 <span style=color:#f92672>(</span>LTS-SP3<span style=color:#f92672>)</span>   5.10.0-182.0.0.95.oe2203sp3.x86_64    containerd://1.7.13
</span></span><span style=display:flex><span>ksp-control-2      Ready      control-plane   25h   v1.28.8   192.168.9.92    &lt;none&gt;        openEuler 22.03 <span style=color:#f92672>(</span>LTS-SP3<span style=color:#f92672>)</span>   5.10.0-182.0.0.95.oe2203sp3.x86_64    containerd://1.7.13
</span></span><span style=display:flex><span>ksp-control-3      Ready      control-plane   25h   v1.28.8   192.168.9.93    &lt;none&gt;        openEuler 22.03 <span style=color:#f92672>(</span>LTS-SP3<span style=color:#f92672>)</span>   5.10.0-182.0.0.95.oe2203sp3.x86_64    containerd://1.7.13
</span></span><span style=display:flex><span>ksp-gpu-worker-1   Ready      worker          59m   v1.28.8   192.168.9.101   &lt;none&gt;        openEuler 22.03 <span style=color:#f92672>(</span>LTS-SP3<span style=color:#f92672>)</span>   5.10.0-199.0.0.112.oe2203sp3.x86_64   containerd://1.7.13
</span></span><span style=display:flex><span>ksp-gpu-worker-2   Ready      worker          59m   v1.28.8   192.168.9.102   &lt;none&gt;        openEuler 22.03 <span style=color:#f92672>(</span>LTS-SP3<span style=color:#f92672>)</span>   5.10.0-199.0.0.112.oe2203sp3.x86_64   containerd://1.7.13
</span></span><span style=display:flex><span>ksp-worker-1       Ready      worker          25h   v1.28.8   192.168.9.94    &lt;none&gt;        openEuler 22.03 <span style=color:#f92672>(</span>LTS-SP3<span style=color:#f92672>)</span>   5.10.0-182.0.0.95.oe2203sp3.x86_64    containerd://1.7.13
</span></span><span style=display:flex><span>ksp-worker-2       Ready      worker          25h   v1.28.8   192.168.9.95    &lt;none&gt;        openEuler 22.03 <span style=color:#f92672>(</span>LTS-SP3<span style=color:#f92672>)</span>   5.10.0-182.0.0.95.oe2203sp3.x86_64    containerd://1.7.13
</span></span><span style=display:flex><span>ksp-worker-3       Ready      worker          25h   v1.28.8   192.168.9.96    &lt;none&gt;        openEuler 22.03 <span style=color:#f92672>(</span>LTS-SP3<span style=color:#f92672>)</span>   5.10.0-182.0.0.95.oe2203sp3.x86_64    containerd://1.7.13
</span></span></code></pre></div><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†åˆ©ç”¨ Kubekey åœ¨ç°æœ‰çš„ 3ä¸ª Master èŠ‚ç‚¹å’Œ 3ä¸ª Worker èŠ‚ç‚¹ç»„æˆçš„ Kubernetes é›†ç¾¤ä¸­å¢åŠ  2 ä¸ª Worker èŠ‚ç‚¹çš„å…¨éƒ¨ä»»åŠ¡ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å®‰è£… NVIDIA å®˜æ–¹å‡ºå“çš„ NVIDIA GPU Operatorï¼Œå®ç° K8s è°ƒåº¦ Pod ä½¿ç”¨ GPU èµ„æºã€‚</p><h2 id=4-å®‰è£…é…ç½®-nvidia-gpu-operator>4. å®‰è£…é…ç½® NVIDIA GPU Operator</h2><h3 id=41--å®‰è£…-nvidia-æ˜¾å¡é©±åŠ¨>4.1 å®‰è£… NVIDIA æ˜¾å¡é©±åŠ¨</h3><p>NVIDIA GPU Operator æ”¯æŒè‡ªåŠ¨å®‰è£…æ˜¾å¡é©±åŠ¨ï¼Œä½†æ˜¯åª CentOS 7ã€8 å’Œ Ubuntu 20.04ã€22.04 ç­‰ç‰ˆæœ¬ï¼Œå¹¶ä¸æ”¯æŒ openEulerï¼Œæ‰€ä»¥éœ€è¦æ‰‹å·¥å®‰è£…æ˜¾å¡é©±åŠ¨ã€‚</p><p>è¯·å‚è€ƒ <a href=https://mp.weixin.qq.com/s/Naugx0rUmgR2UywYXpjEHQ target=_blank rel="noopener noreferrer">KubeSphere æœ€ä½³å®æˆ˜ï¼šopenEuler 22.03 LTS SP3 å®‰è£… NVIDIA æ˜¾å¡é©±åŠ¨</a>ï¼Œå®Œæˆæ˜¾å¡é©±åŠ¨å®‰è£…ã€‚</p><h3 id=42-å‰ææ¡ä»¶>4.2 å‰ææ¡ä»¶</h3><p>Node Feature Discovery (NFD) æ£€æµ‹åŠŸèƒ½æ£€æŸ¥ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get nodes -o json | jq <span style=color:#e6db74>&#39;.items[].metadata.labels | keys | any(startswith(&#34;feature.node.kubernetes.io&#34;))&#39;</span>
</span></span></code></pre></div><p>ä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œç»“æœä¸º <code>true</code>, è¯´æ˜ <code>NFD</code> å·²ç»åœ¨é›†ç¾¤ä¸­è¿è¡Œã€‚å¦‚æœNFDå·²ç»åœ¨é›†ç¾¤ä¸­è¿è¡Œï¼Œé‚£ä¹ˆåœ¨å®‰è£… Operator æ—¶å¿…é¡»ç¦ç”¨éƒ¨ç½² NFDã€‚</p><blockquote><p><strong>è¯´æ˜ï¼š</strong> ä½¿ç”¨ KubeSphere éƒ¨ç½²çš„ K8s é›†ç¾¤é»˜è®¤ä¸ä¼šå®‰è£…é…ç½® NFDã€‚</p></blockquote><h3 id=43-å®‰è£…-nvidia-gpu-operator>4.3 å®‰è£… NVIDIA GPU Operator</h3><ol><li>æ·»åŠ  NVIDIA Helm repository</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add nvidia https://helm.ngc.nvidia.com/nvidia <span style=color:#f92672>&amp;&amp;</span> helm repo update
</span></span></code></pre></div><ol start=2><li>å®‰è£… GPU Operator</li></ol><p>ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œç¦ç”¨è‡ªåŠ¨å®‰è£…æ˜¾å¡é©±åŠ¨åŠŸèƒ½ï¼Œå®‰è£… GPU Operatorã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install -n gpu-operator --create-namespace gpu-operator nvidia/gpu-operator --set driver.enabled<span style=color:#f92672>=</span>false
</span></span></code></pre></div><blockquote><p>æ³¨æ„ï¼š ç”±äºå®‰è£…çš„é•œåƒæ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥åˆæ¬¡å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°è¶…æ—¶çš„æƒ…å½¢ï¼Œè¯·æ£€æŸ¥ä½ çš„é•œåƒæ˜¯å¦æˆåŠŸæ‹‰å–ï¼å¯ä»¥è€ƒè™‘ä½¿ç”¨ç¦»çº¿å®‰è£…è§£å†³è¯¥ç±»é—®é¢˜ã€‚</p></blockquote><ol start=3><li>ä½¿ç”¨è‡ªå®šä¹‰ values å®‰è£… GPU Operatorï¼ˆ<strong>å¯é€‰ï¼Œç¦»çº¿æˆ–æ˜¯è‡ªå®šä¹‰é…ç½®æ—¶ä½¿ç”¨</strong>ï¼‰</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install -f gpu-operator-values.yaml -n gpu-operator --create-namespace gpu-operator nvidia/gpu-operator --set driver.enabled<span style=color:#f92672>=</span>false
</span></span></code></pre></div><p>æ­£ç¡®æ‰§è¡Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ helm install -n gpu-operator --create-namespace gpu-operator nvidia/gpu-operator --set driver.enabled<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>NAME: gpu-operator
</span></span><span style=display:flex><span>LAST DEPLOYED: Tue Jul  <span style=color:#ae81ff>2</span> 21:40:29 <span style=color:#ae81ff>2024</span>
</span></span><span style=display:flex><span>NAMESPACE: gpu-operator
</span></span><span style=display:flex><span>STATUS: deployed
</span></span><span style=display:flex><span>REVISION: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>TEST SUITE: None
</span></span></code></pre></div><h3 id=44-å‘½ä»¤è¡Œæ£€æŸ¥-gpu-operator-éƒ¨ç½²çŠ¶æ€>4.4 å‘½ä»¤è¡Œæ£€æŸ¥ GPU Operator éƒ¨ç½²çŠ¶æ€</h3><p>æ‰§è¡Œå®‰è£… GPU Operator çš„å‘½ä»¤åè¯·è€å¿ƒç­‰å¾…æ‰€æœ‰é•œåƒæˆåŠŸæ‹‰å–ï¼Œæ‰€æœ‰ Pod éƒ½å¤„äº Running çŠ¶æ€ã€‚</p><ol><li>å‘½ä»¤è¡Œæ£€æŸ¥ pods çŠ¶æ€</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get pods -n gpu-operator
</span></span><span style=display:flex><span>NAME                                                          READY   STATUS      RESTARTS   AGE
</span></span><span style=display:flex><span>gpu-feature-discovery-czdf5                                   1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>gpu-feature-discovery-q9qlm                                   1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>gpu-operator-67c68ddccf-x29pm                                 1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>gpu-operator-node-feature-discovery-gc-57457b6d8f-zjqhr       1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>gpu-operator-node-feature-discovery-master-5fb74ff754-fzbzm   1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>gpu-operator-node-feature-discovery-worker-68459              1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>gpu-operator-node-feature-discovery-worker-74ps5              1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>gpu-operator-node-feature-discovery-worker-dpmg9              1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>gpu-operator-node-feature-discovery-worker-jvk4t              1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>gpu-operator-node-feature-discovery-worker-k5kwq              1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>gpu-operator-node-feature-discovery-worker-ll4bk              1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>gpu-operator-node-feature-discovery-worker-p4q5q              1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>gpu-operator-node-feature-discovery-worker-rmk99              1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>nvidia-container-toolkit-daemonset-9zcnj                      1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>nvidia-container-toolkit-daemonset-kcz9g                      1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>nvidia-cuda-validator-l8vjb                                   0/1     Completed   <span style=color:#ae81ff>0</span>          14m
</span></span><span style=display:flex><span>nvidia-cuda-validator-svn2p                                   0/1     Completed   <span style=color:#ae81ff>0</span>          13m
</span></span><span style=display:flex><span>nvidia-dcgm-exporter-9lq4c                                    1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>nvidia-dcgm-exporter-qhmkg                                    1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>nvidia-device-plugin-daemonset-7rvfm                          1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>nvidia-device-plugin-daemonset-86gx2                          1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>nvidia-operator-validator-csr2z                               1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span><span style=display:flex><span>nvidia-operator-validator-svlc4                               1/1     Running     <span style=color:#ae81ff>0</span>          15m
</span></span></code></pre></div><ol start=2><li>æŸ¥çœ‹èŠ‚ç‚¹å¯åˆ†é…çš„ GPU èµ„æº</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl describe node ksp-gpu-worker-1 | grep <span style=color:#e6db74>&#34;^Capacity&#34;</span> -A <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>Capacity:
</span></span><span style=display:flex><span>  cpu:                <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>  ephemeral-storage:  35852924Ki
</span></span><span style=display:flex><span>  hugepages-1Gi:      <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  hugepages-2Mi:      <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  memory:             15858668Ki
</span></span><span style=display:flex><span>  nvidia.com/gpu:     <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  pods:               <span style=color:#ae81ff>110</span>
</span></span></code></pre></div><blockquote><p><strong>è¯´æ˜ï¼š</strong> é‡ç‚¹å…³æ³¨ <code>nvidia.com/gpu: </code>å­—æ®µçš„å€¼ã€‚</p></blockquote><h3 id=45-kubesphere-æ§åˆ¶å°æŸ¥çœ‹-gpu-operator-éƒ¨ç½²çŠ¶æ€>4.5 KubeSphere æ§åˆ¶å°æŸ¥çœ‹ GPU Operator éƒ¨ç½²çŠ¶æ€</h3><p>åˆ›å»ºæˆåŠŸçš„å·¥ä½œè´Ÿè½½å¦‚ä¸‹ï¼š</p><ul><li>Deployments</li></ul><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//ksp-gpu-operator-deployments.png alt></p><ul><li>Daemonsets</li></ul><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//ksp-gpu-operator-daemonsets.png alt></p><h2 id=5-gpu-åŠŸèƒ½éªŒè¯æµ‹è¯•>5. GPU åŠŸèƒ½éªŒè¯æµ‹è¯•</h2><h3 id=51-æµ‹è¯•ç¤ºä¾‹1-éªŒè¯æµ‹è¯•-cuda>5.1 æµ‹è¯•ç¤ºä¾‹1-éªŒè¯æµ‹è¯• CUDA</h3><p>GPU Operator æ­£ç¡®å®‰è£…å®Œæˆåï¼Œä½¿ç”¨ CUDA åŸºç¡€é•œåƒï¼Œæµ‹è¯• K8s æ˜¯å¦èƒ½æ­£ç¡®åˆ›å»ºä½¿ç”¨ GPU èµ„æºçš„ Podã€‚</p><ol><li>åˆ›å»ºèµ„æºæ¸…å•æ–‡ä»¶ï¼Œ<code>vi cuda-ubuntu.yaml</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Pod
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: cuda-ubuntu2204
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  restartPolicy: OnFailure
</span></span><span style=display:flex><span>  containers:
</span></span><span style=display:flex><span>  - name: cuda-ubuntu2204
</span></span><span style=display:flex><span>    image: <span style=color:#e6db74>&#34;nvcr.io/nvidia/cuda:12.4.0-base-ubuntu22.04&#34;</span>
</span></span><span style=display:flex><span>    resources:
</span></span><span style=display:flex><span>      limits:
</span></span><span style=display:flex><span>        nvidia.com/gpu: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    command: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;nvidia-smi&#34;</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><ol start=2><li>åˆ›å»ºèµ„æº</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f cuda-ubuntu.yaml
</span></span></code></pre></div><ol start=3><li>æŸ¥çœ‹åˆ›å»ºçš„èµ„æº</li></ol><p>ä»ç»“æœä¸­å¯ä»¥çœ‹åˆ° pod åˆ›å»ºåœ¨äº† ksp-gpu-worker-2 èŠ‚ç‚¹ï¼ˆ<strong>è¯¥èŠ‚ç‚¹æ˜¾å¡å‹å· Tesla P100-PCIE-16GB</strong>ï¼‰ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get pods -o wide
</span></span><span style=display:flex><span>NAME                      READY   STATUS      RESTARTS   AGE   IP             NODE               NOMINATED NODE   READINESS GATES
</span></span><span style=display:flex><span>cuda-ubuntu2204           0/1     Completed   <span style=color:#ae81ff>0</span>          73s   10.233.99.15   ksp-gpu-worker-2   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>ollama-79688d46b8-vxmhg   1/1     Running     <span style=color:#ae81ff>0</span>          47m   10.233.72.17   ksp-gpu-worker-1   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><ol start=4><li>æŸ¥çœ‹ Pod æ—¥å¿—</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl logs pod/cuda-ubuntu2204
</span></span></code></pre></div><p>æ­£ç¡®æ‰§è¡Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl logs pod/cuda-ubuntu2204
</span></span><span style=display:flex><span>Mon Jul  <span style=color:#ae81ff>8</span> 11:10:59 <span style=color:#ae81ff>2024</span>
</span></span><span style=display:flex><span>+-----------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span>| NVIDIA-SMI 550.54.15              Driver Version: 550.54.15      CUDA Version: 12.4     |
</span></span><span style=display:flex><span>|-----------------------------------------+------------------------+----------------------+
</span></span><span style=display:flex><span>| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
</span></span><span style=display:flex><span>| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
</span></span><span style=display:flex><span>|                                         |                        |               MIG M. |
</span></span><span style=display:flex><span>|<span style=color:#f92672>=========================================</span>+<span style=color:#f92672>========================</span>+<span style=color:#f92672>======================</span>|
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>0</span>  Tesla P100-PCIE-16GB           Off |   00000000:00:10.0 Off |                    <span style=color:#ae81ff>0</span> |
</span></span><span style=display:flex><span>| N/A   40C    P0             26W /  250W |       0MiB /  16384MiB |      0%      Default |
</span></span><span style=display:flex><span>|                                         |                        |                  N/A |
</span></span><span style=display:flex><span>+-----------------------------------------+------------------------+----------------------+
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>+-----------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span>| Processes:                                                                              |
</span></span><span style=display:flex><span>|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |
</span></span><span style=display:flex><span>|        ID   ID                                                               Usage      |
</span></span><span style=display:flex><span>|<span style=color:#f92672>=========================================================================================</span>|
</span></span><span style=display:flex><span>|  No running processes found                                                             |
</span></span><span style=display:flex><span>+-----------------------------------------------------------------------------------------+
</span></span></code></pre></div><ol start=5><li>æ¸…ç†æµ‹è¯•èµ„æº</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>kubectl apply -f cuda-ubuntu.yaml</span>
</span></span></code></pre></div><h3 id=52-æµ‹è¯•ç¤ºä¾‹-2-å®˜æ–¹-gpu-applications-ç¤ºä¾‹>5.2 æµ‹è¯•ç¤ºä¾‹ 2-å®˜æ–¹ GPU Applications ç¤ºä¾‹</h3><p>æ‰§è¡Œä¸€ä¸ªç®€å•çš„ CUDA ç¤ºä¾‹ï¼Œç”¨äºå°†ä¸¤ä¸ªå‘é‡ï¼ˆvectorsï¼‰ç›¸åŠ ã€‚</p><ol><li>åˆ›å»ºèµ„æºæ¸…å•æ–‡ä»¶ï¼Œ<code>vi cuda-vectoradd.yaml</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Pod
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: cuda-vectoradd
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  restartPolicy: OnFailure
</span></span><span style=display:flex><span>  containers:
</span></span><span style=display:flex><span>  - name: cuda-vectoradd
</span></span><span style=display:flex><span>    image: <span style=color:#e6db74>&#34;nvcr.io/nvidia/k8s/cuda-sample:vectoradd-cuda11.7.1-ubuntu20.04&#34;</span>
</span></span><span style=display:flex><span>    resources:
</span></span><span style=display:flex><span>      limits:
</span></span><span style=display:flex><span>        nvidia.com/gpu: <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><ol start=2><li>æ‰§è¡Œå‘½ä»¤åˆ›å»º Pod</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl apply -f cuda-vectoradd.yaml
</span></span></code></pre></div><ol start=3><li>æŸ¥çœ‹ Pod æ‰§è¡Œç»“æœ</li></ol><p>Pod åˆ›å»ºæˆåŠŸï¼Œå¯åŠ¨åä¼šè¿è¡Œ <code>vectorAdd</code> å‘½ä»¤å¹¶é€€å‡ºã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl logs pod/cuda-vectoradd
</span></span></code></pre></div><p>æ­£ç¡®æ‰§è¡Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><pre tabindex=0><code>[Vector addition of 50000 elements]
Copy input data from the host memory to the CUDA device
CUDA kernel launch with 196 blocks of 256 threads
Copy output data from the CUDA device to the host memory
Test PASSED
Done
</code></pre><ol start=4><li>æ¸…ç†æµ‹è¯•èµ„æº</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete -f cuda-vectoradd.yaml
</span></span></code></pre></div><h2 id=6-kubesphere-éƒ¨ç½²-ollama>6. KubeSphere éƒ¨ç½² Ollama</h2><p>é€šè¿‡ä¸Šé¢çš„éªŒè¯æµ‹è¯•ï¼Œè¯æ˜å¯ä»¥åœ¨ K8s é›†ç¾¤ä¸Šåˆ›å»ºä½¿ç”¨ GPU çš„ Pod èµ„æºï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»“åˆå®é™…ä½¿ç”¨éœ€æ±‚ï¼Œåˆ©ç”¨ KubeSphere åœ¨ K8s é›†ç¾¤åˆ›å»ºä¸€å¥—å¤§æ¨¡å‹ç®¡ç†å·¥å…· Ollamaã€‚</p><h3 id=61-åˆ›å»ºéƒ¨ç½²èµ„æºæ¸…å•>6.1 åˆ›å»ºéƒ¨ç½²èµ„æºæ¸…å•</h3><p>æœ¬ç¤ºä¾‹å±äºç®€å•æµ‹è¯•ï¼Œå­˜å‚¨é€‰æ‹©äº† <strong>hostPath</strong> æ¨¡å¼ï¼Œå®é™…ä½¿ç”¨ä¸­è¯·æ›¿æ¢ä¸ºå­˜å‚¨ç±»æˆ–æ˜¯å…¶ä»–ç±»å‹çš„æŒä¹…åŒ–å­˜å‚¨ã€‚</p><ol><li>åˆ›å»ºèµ„æºæ¸…å•ï¼Œ<code>vi deploy-ollama.yaml</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ollama</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>ollama</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>ollama</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>ollama</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ollama-models</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>hostPath</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/data/openebs/local/ollama</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>host-time</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>hostPath</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/etc/localtime</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ollama</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>image</span>: <span style=color:#e6db74>&#39;ollama/ollama:latest&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>http-11434</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>11434</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>nvidia.com/gpu</span>: <span style=color:#e6db74>&#39;1&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>nvidia.com/gpu</span>: <span style=color:#e6db74>&#39;1&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ollama-models</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/root/.ollama</span>
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>host-time</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>readOnly</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/etc/localtime</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>imagePullPolicy</span>: <span style=color:#ae81ff>IfNotPresent</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Always</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ollama</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>ollama</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>http-11434</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>11434</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>11434</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>31434</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>ollama</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span></code></pre></div><blockquote><p><strong>ç‰¹æ®Šè¯´æ˜ï¼š</strong> KubeSphere çš„ç®¡ç†æ§åˆ¶å°æ”¯æŒå›¾å½¢åŒ–é…ç½® Deployment ç­‰èµ„æºä½¿ç”¨ GPU èµ„æºï¼Œé…ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªè¡Œç ”ç©¶ã€‚</p></blockquote><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//ksp-deployments-ollama-resource-status.png alt></p><h3 id=62-éƒ¨ç½²-ollama-æœåŠ¡>6.2 éƒ¨ç½² Ollama æœåŠ¡</h3><ul><li>åˆ›å»º Ollama</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f deploy-ollama.yaml
</span></span></code></pre></div><ul><li>æŸ¥çœ‹ Pod åˆ›å»ºç»“æœ</li></ul><p>ä»ç»“æœä¸­å¯ä»¥çœ‹åˆ° pod åˆ›å»ºåœ¨äº† ksp-gpu-worker-1 èŠ‚ç‚¹ï¼ˆ<strong>è¯¥èŠ‚ç‚¹æ˜¾å¡å‹å· Tesla M40 24GB</strong>ï¼‰ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get pods -o wide
</span></span><span style=display:flex><span>NAME                      READY   STATUS    RESTARTS   AGE   IP             NODE               NOMINATED NODE   READINESS GATES
</span></span><span style=display:flex><span>k   1/1     Running   <span style=color:#ae81ff>0</span>          12s   10.233.72.17   ksp-gpu-worker-1   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><ul><li>æŸ¥çœ‹å®¹å™¨ log</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-control-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl logs ollama-79688d46b8-vxmhg</span>
</span></span><span style=display:flex><span>2024/07/08 18:24:27 routes.go:1064: INFO server config env<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;map[CUDA_VISIBLE_DEVICES: GPU_DEVICE_ORDINAL: HIP_VISIBLE_DEVICES: HSA_OVERRIDE_GFX_VERSION: OLLAMA_DEBUG:false OLLAMA_FLASH_ATTENTION:false OLLAMA_HOST:http://0.0.0.0:11434 OLLAMA_INTEL_GPU:false OLLAMA_KEEP_ALIVE: OLLAMA_LLM_LIBRARY: OLLAMA_MAX_LOADED_MODELS:1 OLLAMA_MAX_QUEUE:512 OLLAMA_MAX_VRAM:0 OLLAMA_MODELS:/root/.ollama/models OLLAMA_NOHISTORY:false OLLAMA_NOPRUNE:false OLLAMA_NUM_PARALLEL:1 OLLAMA_ORIGINS:[http://localhost https://localhost http://localhost:* https://localhost:* http://127.0.0.1 https://127.0.0.1 http://127.0.0.1:* https://127.0.0.1:* http://0.0.0.0 https://0.0.0.0 http://0.0.0.0:* https://0.0.0.0:* app://* file://* tauri://*] OLLAMA_RUNNERS_DIR: OLLAMA_SCHED_SPREAD:false OLLAMA_TMPDIR: ROCR_VISIBLE_DEVICES:]&#34;</span>
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2024-07-08T18:24:27.829+08:00 level<span style=color:#f92672>=</span>INFO source<span style=color:#f92672>=</span>images.go:730 msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;total blobs: 5&#34;</span>
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2024-07-08T18:24:27.829+08:00 level<span style=color:#f92672>=</span>INFO source<span style=color:#f92672>=</span>images.go:737 msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;total unused blobs removed: 0&#34;</span>
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2024-07-08T18:24:27.830+08:00 level<span style=color:#f92672>=</span>INFO source<span style=color:#f92672>=</span>routes.go:1111 msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Listening on [::]:11434 (version 0.1.48)&#34;</span>
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2024-07-08T18:24:27.830+08:00 level<span style=color:#f92672>=</span>INFO source<span style=color:#f92672>=</span>payload.go:30 msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;extracting embedded files&#34;</span> dir<span style=color:#f92672>=</span>/tmp/ollama2414166698/runners
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2024-07-08T18:24:32.454+08:00 level<span style=color:#f92672>=</span>INFO source<span style=color:#f92672>=</span>payload.go:44 msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Dynamic LLM libraries [cpu cpu_avx cpu_avx2 cuda_v11 rocm_v60101]&#34;</span>
</span></span><span style=display:flex><span>time<span style=color:#f92672>=</span>2024-07-08T18:24:32.567+08:00 level<span style=color:#f92672>=</span>INFO source<span style=color:#f92672>=</span>types.go:98 msg<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;inference compute&#34;</span> id<span style=color:#f92672>=</span>GPU-9e48dc13-f8f1-c6bb-860f-c82c96df22a4 library<span style=color:#f92672>=</span>cuda compute<span style=color:#f92672>=</span>5.2 driver<span style=color:#f92672>=</span>12.4 name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Tesla M40 24GB&#34;</span> total<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;22.4 GiB&#34;</span> available<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;22.3 GiB&#34;</span>
</span></span></code></pre></div><h3 id=63-æ‹‰å–-ollama-ä½¿ç”¨çš„å¤§æ¨¡å‹>6.3 æ‹‰å– Ollama ä½¿ç”¨çš„å¤§æ¨¡å‹</h3><ul><li>Ollama æ‹‰å–æ¨¡å‹</li></ul><p>æœ¬ç¤ºä¾‹ä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œé‡‡ç”¨é˜¿é‡Œå¼€æºçš„ qwen2 1.5b å°å°ºå¯¸æ¨¡å‹ä½œä¸ºæµ‹è¯•æ¨¡å‹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl exec -it ollama-79688d46b8-vxmhg -- ollama pull qwen2:1.5b
</span></span></code></pre></div><p>æ­£ç¡®æ‰§è¡Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ksp-control-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl exec -it ollama-79688d46b8-vxmhg -- ollama pull qwen2:1.5b</span>
</span></span><span style=display:flex><span>pulling manifest
</span></span><span style=display:flex><span>pulling 405b56374e02... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– <span style=color:#ae81ff>934</span> MB
</span></span><span style=display:flex><span>pulling 62fbfd9ed093... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  <span style=color:#ae81ff>182</span> B
</span></span><span style=display:flex><span>pulling c156170b718e... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  <span style=color:#ae81ff>11</span> KB
</span></span><span style=display:flex><span>pulling f02dd72bb242... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   <span style=color:#ae81ff>59</span> B
</span></span><span style=display:flex><span>pulling c9f5e9ffbc5f... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  <span style=color:#ae81ff>485</span> B
</span></span><span style=display:flex><span>verifying sha256 digest
</span></span><span style=display:flex><span>writing manifest
</span></span><span style=display:flex><span>removing any unused layers
</span></span><span style=display:flex><span>success
</span></span></code></pre></div><ul><li>æŸ¥çœ‹æ¨¡å‹æ–‡ä»¶çš„å†…å®¹</li></ul><p>åœ¨ <strong>ksp-gpu-worker-1</strong> èŠ‚ç‚¹æ‰§è¡Œä¸‹é¢çš„æŸ¥çœ‹å‘½ä»¤</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ls -R /data/openebs/local/ollama/
</span></span><span style=display:flex><span>/data/openebs/local/ollama/:
</span></span><span style=display:flex><span>id_ed25519  id_ed25519.pub  models
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/data/openebs/local/ollama/models:
</span></span><span style=display:flex><span>blobs  manifests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/data/openebs/local/ollama/models/blobs:
</span></span><span style=display:flex><span>sha256-405b56374e02b21122ae1469db646be0617c02928fd78e246723ebbb98dbca3e
</span></span><span style=display:flex><span>sha256-62fbfd9ed093d6e5ac83190c86eec5369317919f4b149598d2dbb38900e9faef
</span></span><span style=display:flex><span>sha256-c156170b718ec29139d3653d40ed1986fd92fb7e0959b5c71f3c48f62e6636f4
</span></span><span style=display:flex><span>sha256-c9f5e9ffbc5f14febb85d242942bd3d674a8e4c762aaab034ec88d6ba839b596
</span></span><span style=display:flex><span>sha256-f02dd72bb2423204352eabc5637b44d79d17f109fdb510a7c51455892aa2d216
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/data/openebs/local/ollama/models/manifests:
</span></span><span style=display:flex><span>registry.ollama.ai
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/data/openebs/local/ollama/models/manifests/registry.ollama.ai:
</span></span><span style=display:flex><span>library
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/data/openebs/local/ollama/models/manifests/registry.ollama.ai/library:
</span></span><span style=display:flex><span>qwen2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/data/openebs/local/ollama/models/manifests/registry.ollama.ai/library/qwen2:
</span></span><span style=display:flex><span>1.5b
</span></span></code></pre></div><h3 id=64-æ¨¡å‹èƒ½åŠ›æµ‹è¯•>6.4 æ¨¡å‹èƒ½åŠ›æµ‹è¯•</h3><ul><li>è°ƒç”¨æ¥å£æµ‹è¯•</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl http://192.168.9.91:31434/api/chat -d <span style=color:#e6db74>&#39;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;model&#34;: &#34;qwen2:1.5b&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;messages&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    { &#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;ç”¨20ä¸ªå­—ï¼Œä»‹ç»ä½ è‡ªå·±&#34; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}&#39;</span>
</span></span></code></pre></div><ul><li>æµ‹è¯•ç»“æœ</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl http://192.168.9.91:31434/api/chat -d <span style=color:#e6db74>&#39;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;model&#34;: &#34;qwen2:1.5b&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;messages&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    { &#34;role&#34;: &#34;user&#34;, &#34;content&#34;: &#34;ç”¨20ä¸ªå­—ï¼Œä»‹ç»ä½ è‡ªå·±&#34; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;model&#34;</span>:<span style=color:#e6db74>&#34;qwen2:1.5b&#34;</span>,<span style=color:#e6db74>&#34;created_at&#34;</span>:<span style=color:#e6db74>&#34;2024-07-08T09:54:48.011798927Z&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;assistant&#34;</span>,<span style=color:#e6db74>&#34;content&#34;</span>:<span style=color:#e6db74>&#34;æˆ‘&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;done&#34;</span>:false<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;model&#34;</span>:<span style=color:#e6db74>&#34;qwen2:1.5b&#34;</span>,<span style=color:#e6db74>&#34;created_at&#34;</span>:<span style=color:#e6db74>&#34;2024-07-08T09:54:48.035291669Z&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;assistant&#34;</span>,<span style=color:#e6db74>&#34;content&#34;</span>:<span style=color:#e6db74>&#34;æ˜¯ä¸€ä¸ª&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;done&#34;</span>:false<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;model&#34;</span>:<span style=color:#e6db74>&#34;qwen2:1.5b&#34;</span>,<span style=color:#e6db74>&#34;created_at&#34;</span>:<span style=color:#e6db74>&#34;2024-07-08T09:54:48.06360233Z&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;assistant&#34;</span>,<span style=color:#e6db74>&#34;content&#34;</span>:<span style=color:#e6db74>&#34;äººå·¥æ™ºèƒ½&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;done&#34;</span>:false<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;model&#34;</span>:<span style=color:#e6db74>&#34;qwen2:1.5b&#34;</span>,<span style=color:#e6db74>&#34;created_at&#34;</span>:<span style=color:#e6db74>&#34;2024-07-08T09:54:48.092411266Z&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;assistant&#34;</span>,<span style=color:#e6db74>&#34;content&#34;</span>:<span style=color:#e6db74>&#34;åŠ©æ‰‹&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;done&#34;</span>:false<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;model&#34;</span>:<span style=color:#e6db74>&#34;qwen2:1.5b&#34;</span>,<span style=color:#e6db74>&#34;created_at&#34;</span>:<span style=color:#e6db74>&#34;2024-07-08T09:54:48.12016935Z&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;assistant&#34;</span>,<span style=color:#e6db74>&#34;content&#34;</span>:<span style=color:#e6db74>&#34;ï¼Œ&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;done&#34;</span>:false<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;model&#34;</span>:<span style=color:#e6db74>&#34;qwen2:1.5b&#34;</span>,<span style=color:#e6db74>&#34;created_at&#34;</span>:<span style=color:#e6db74>&#34;2024-07-08T09:54:48.144921623Z&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;assistant&#34;</span>,<span style=color:#e6db74>&#34;content&#34;</span>:<span style=color:#e6db74>&#34;ä¸“æ³¨äº&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;done&#34;</span>:false<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;model&#34;</span>:<span style=color:#e6db74>&#34;qwen2:1.5b&#34;</span>,<span style=color:#e6db74>&#34;created_at&#34;</span>:<span style=color:#e6db74>&#34;2024-07-08T09:54:48.169803961Z&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;assistant&#34;</span>,<span style=color:#e6db74>&#34;content&#34;</span>:<span style=color:#e6db74>&#34;æä¾›&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;done&#34;</span>:false<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;model&#34;</span>:<span style=color:#e6db74>&#34;qwen2:1.5b&#34;</span>,<span style=color:#e6db74>&#34;created_at&#34;</span>:<span style=color:#e6db74>&#34;2024-07-08T09:54:48.194796364Z&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;assistant&#34;</span>,<span style=color:#e6db74>&#34;content&#34;</span>:<span style=color:#e6db74>&#34;ä¿¡æ¯&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;done&#34;</span>:false<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;model&#34;</span>:<span style=color:#e6db74>&#34;qwen2:1.5b&#34;</span>,<span style=color:#e6db74>&#34;created_at&#34;</span>:<span style=color:#e6db74>&#34;2024-07-08T09:54:48.21978104Z&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;assistant&#34;</span>,<span style=color:#e6db74>&#34;content&#34;</span>:<span style=color:#e6db74>&#34;å’Œ&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;done&#34;</span>:false<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;model&#34;</span>:<span style=color:#e6db74>&#34;qwen2:1.5b&#34;</span>,<span style=color:#e6db74>&#34;created_at&#34;</span>:<span style=color:#e6db74>&#34;2024-07-08T09:54:48.244976103Z&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;assistant&#34;</span>,<span style=color:#e6db74>&#34;content&#34;</span>:<span style=color:#e6db74>&#34;å¸®åŠ©&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;done&#34;</span>:false<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;model&#34;</span>:<span style=color:#e6db74>&#34;qwen2:1.5b&#34;</span>,<span style=color:#e6db74>&#34;created_at&#34;</span>:<span style=color:#e6db74>&#34;2024-07-08T09:54:48.270233992Z&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;assistant&#34;</span>,<span style=color:#e6db74>&#34;content&#34;</span>:<span style=color:#e6db74>&#34;ã€‚&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;done&#34;</span>:false<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;model&#34;</span>:<span style=color:#e6db74>&#34;qwen2:1.5b&#34;</span>,<span style=color:#e6db74>&#34;created_at&#34;</span>:<span style=color:#e6db74>&#34;2024-07-08T09:54:48.29548561Z&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;role&#34;</span>:<span style=color:#e6db74>&#34;assistant&#34;</span>,<span style=color:#e6db74>&#34;content&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;done_reason&#34;</span>:<span style=color:#e6db74>&#34;stop&#34;</span>,<span style=color:#e6db74>&#34;done&#34;</span>:true,<span style=color:#e6db74>&#34;total_duration&#34;</span>:454377627,<span style=color:#e6db74>&#34;load_duration&#34;</span>:1535754,<span style=color:#e6db74>&#34;prompt_eval_duration&#34;</span>:36172000,<span style=color:#e6db74>&#34;eval_count&#34;</span>:12,<span style=color:#e6db74>&#34;eval_duration&#34;</span>:287565000<span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=65-æŸ¥çœ‹-gpu-åˆ†é…ä¿¡æ¯>6.5 æŸ¥çœ‹ GPU åˆ†é…ä¿¡æ¯</h3><ul><li>æŸ¥çœ‹ Worker èŠ‚ç‚¹å·²åˆ†é…çš„ GPU èµ„æº</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>$ kubectl describe node ksp-gpu-worker-1 | grep &#34;Allocated resources&#34; -A 9</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Allocated resources</span>:
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>(Total limits may be over 100 percent, i.e., overcommitted.)</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>Resource           Requests        Limits</span>
</span></span><span style=display:flex><span>  --------           --------        ------
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>cpu                487m (13%)      2 (55%)</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>memory             315115520 (2%)  800Mi (5%)</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>ephemeral-storage  0 (0%)          0 (0%)</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>hugepages-1Gi      0 (0%)          0 (0%)</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>hugepages-2Mi      0 (0%)          0 (0%)</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>nvidia.com/gpu     1               1</span>
</span></span></code></pre></div><ul><li>Ollama è¿è¡Œæ—¶ç‰©ç† GPU ä½¿ç”¨æƒ…å†µ</li></ul><p>åœ¨ Worker èŠ‚ç‚¹ä¸Šæ‰§è¡Œ <code>nvidia-smi -l </code>è§‚å¯Ÿ GPU çš„ä½¿ç”¨æƒ…å†µã€‚</p><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//ksp-ollama-gpu-util-M40.png alt></p><blockquote><p><strong>å…è´£å£°æ˜ï¼š</strong></p></blockquote><ul><li>ç¬”è€…æ°´å¹³æœ‰é™ï¼Œå°½ç®¡ç»è¿‡å¤šæ¬¡éªŒè¯å’Œæ£€æŸ¥ï¼Œå°½åŠ›ç¡®ä¿å†…å®¹çš„å‡†ç¡®æ€§ï¼Œ<strong>ä½†ä»å¯èƒ½å­˜åœ¨ç–æ¼ä¹‹å¤„</strong>ã€‚æ•¬è¯·ä¸šç•Œä¸“å®¶å¤§ä½¬ä¸åæŒ‡æ•™ã€‚</li><li>æœ¬æ–‡æ‰€è¿°å†…å®¹ä»…é€šè¿‡å®æˆ˜ç¯å¢ƒéªŒè¯æµ‹è¯•ï¼Œè¯»è€…å¯å­¦ä¹ ã€å€Ÿé‰´ï¼Œä½†<strong>ä¸¥ç¦ç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒ</strong>ã€‚<strong>ç”±æ­¤å¼•å‘çš„ä»»ä½•é—®é¢˜ï¼Œä½œè€…æ¦‚ä¸è´Ÿè´£</strong>ï¼</li></ul></div></div><div class=share-2><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-ollama-on-kubesphere%2f&text=%e5%9c%a8%20KubeSphere%20%e4%b8%8a%e9%83%a8%e7%bd%b2%20AI%20%e5%a4%a7%e6%a8%a1%e5%9e%8b%20Ollama" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-ollama-on-kubesphere%2f&title=%e5%9c%a8%20KubeSphere%20%e4%b8%8a%e9%83%a8%e7%bd%b2%20AI%20%e5%a4%a7%e6%a8%a1%e5%9e%8b%20Ollama" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-ollama-on-kubesphere%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-ollama-on-kubesphere%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-ollama-on-kubesphere%2f&t=%e5%9c%a8%20KubeSphere%20%e4%b8%8a%e9%83%a8%e7%bd%b2%20AI%20%e5%a4%a7%e6%a8%a1%e5%9e%8b%20Ollama" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div></div><div class=aside><div class=inner-div><div class=title>ç›®å½•</div><div class=tabs><nav id=TableOfContents><ul><li><a href=#1-å‰ç½®æ¡ä»¶>1. å‰ç½®æ¡ä»¶</a><ul><li><a href=#11-å‡†å¤‡å¸¦æœ‰æ˜¾å¡çš„-worker-èŠ‚ç‚¹>1.1 å‡†å¤‡å¸¦æœ‰æ˜¾å¡çš„ Worker èŠ‚ç‚¹</a></li><li><a href=#12-æ“ä½œç³»ç»Ÿåˆå§‹åŒ–é…ç½®>1.2 æ“ä½œç³»ç»Ÿåˆå§‹åŒ–é…ç½®</a></li></ul></li><li><a href=#2-ä½¿ç”¨-kubekey-æ‰©å®¹-gpu-worker-èŠ‚ç‚¹>2. ä½¿ç”¨ KubeKey æ‰©å®¹ GPU Worker èŠ‚ç‚¹</a><ul><li><a href=#21-ä¿®æ”¹é›†ç¾¤é…ç½®æ–‡ä»¶>2.1 ä¿®æ”¹é›†ç¾¤é…ç½®æ–‡ä»¶</a></li><li><a href=#22-ä½¿ç”¨-kubekey-å¢åŠ èŠ‚ç‚¹>2.2 ä½¿ç”¨ KubeKey å¢åŠ èŠ‚ç‚¹</a></li></ul></li><li><a href=#3-æ‰©å®¹åé›†ç¾¤çŠ¶æ€éªŒè¯>3. æ‰©å®¹åé›†ç¾¤çŠ¶æ€éªŒè¯</a><ul><li><a href=#31-kubesphere-ç®¡ç†æ§åˆ¶å°éªŒè¯é›†ç¾¤çŠ¶æ€>3.1 KubeSphere ç®¡ç†æ§åˆ¶å°éªŒè¯é›†ç¾¤çŠ¶æ€</a></li><li><a href=#32-kubectl-å‘½ä»¤è¡ŒéªŒè¯é›†ç¾¤çŠ¶æ€>3.2 Kubectl å‘½ä»¤è¡ŒéªŒè¯é›†ç¾¤çŠ¶æ€</a></li></ul></li><li><a href=#4-å®‰è£…é…ç½®-nvidia-gpu-operator>4. å®‰è£…é…ç½® NVIDIA GPU Operator</a><ul><li><a href=#41--å®‰è£…-nvidia-æ˜¾å¡é©±åŠ¨>4.1 å®‰è£… NVIDIA æ˜¾å¡é©±åŠ¨</a></li><li><a href=#42-å‰ææ¡ä»¶>4.2 å‰ææ¡ä»¶</a></li><li><a href=#43-å®‰è£…-nvidia-gpu-operator>4.3 å®‰è£… NVIDIA GPU Operator</a></li><li><a href=#44-å‘½ä»¤è¡Œæ£€æŸ¥-gpu-operator-éƒ¨ç½²çŠ¶æ€>4.4 å‘½ä»¤è¡Œæ£€æŸ¥ GPU Operator éƒ¨ç½²çŠ¶æ€</a></li><li><a href=#45-kubesphere-æ§åˆ¶å°æŸ¥çœ‹-gpu-operator-éƒ¨ç½²çŠ¶æ€>4.5 KubeSphere æ§åˆ¶å°æŸ¥çœ‹ GPU Operator éƒ¨ç½²çŠ¶æ€</a></li></ul></li><li><a href=#5-gpu-åŠŸèƒ½éªŒè¯æµ‹è¯•>5. GPU åŠŸèƒ½éªŒè¯æµ‹è¯•</a><ul><li><a href=#51-æµ‹è¯•ç¤ºä¾‹1-éªŒè¯æµ‹è¯•-cuda>5.1 æµ‹è¯•ç¤ºä¾‹1-éªŒè¯æµ‹è¯• CUDA</a></li><li><a href=#52-æµ‹è¯•ç¤ºä¾‹-2-å®˜æ–¹-gpu-applications-ç¤ºä¾‹>5.2 æµ‹è¯•ç¤ºä¾‹ 2-å®˜æ–¹ GPU Applications ç¤ºä¾‹</a></li></ul></li><li><a href=#6-kubesphere-éƒ¨ç½²-ollama>6. KubeSphere éƒ¨ç½² Ollama</a><ul><li><a href=#61-åˆ›å»ºéƒ¨ç½²èµ„æºæ¸…å•>6.1 åˆ›å»ºéƒ¨ç½²èµ„æºæ¸…å•</a></li><li><a href=#62-éƒ¨ç½²-ollama-æœåŠ¡>6.2 éƒ¨ç½² Ollama æœåŠ¡</a></li><li><a href=#63-æ‹‰å–-ollama-ä½¿ç”¨çš„å¤§æ¨¡å‹>6.3 æ‹‰å– Ollama ä½¿ç”¨çš„å¤§æ¨¡å‹</a></li><li><a href=#64-æ¨¡å‹èƒ½åŠ›æµ‹è¯•>6.4 æ¨¡å‹èƒ½åŠ›æµ‹è¯•</a></li><li><a href=#65-æŸ¥çœ‹-gpu-åˆ†é…ä¿¡æ¯>6.5 æŸ¥çœ‹ GPU åˆ†é…ä¿¡æ¯</a></li></ul></li></ul></nav></div></div></div></div></section><div class=SubscribeForm><div class=innerBox><img class=close src=/images/home/close.svg alt=close><p class=description>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=blog_formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input-blog type=text placeholder>
<button id=email-submit-blog>è®¢é˜…</button>
<span id=message_blog data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨ style=color:red></span><span id=message1_blog style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span></div></div></div><footer><div class=footer><div class="footer-main common-layout"><div class=up-main><div class=left-div><img src=/images/logo.svg alt class=foot-logo><p>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input type=text placeholder=è¯·è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€>
<button id=email-submit>è®¢é˜…</button></div><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨></span><span id=message1 style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span><script>var bindSubmit=function(){var e=$("#email-input");$("#email-submit").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message").data("message1"),a=$("#message").data("message2"),r=$("#message").data("message3"),c=$("#message1").data("success");if(n)if(validateEmail(n)){if(s=$("#formAddress").data("usesendcloud"),!s)return;o=$("#formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:$("#email-input").val().toString()},success:function(){showSuccessMessage(c),setTimeout(function(){$("#email-input").val("")},1e3)},error:function(){showMessage(r)}})}else t.preventDefault(),showMessage(a);else t.preventDefault(),showMessage(i)})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},showMessage=function(e){$("#message").html(e).show()},showSuccessMessage=function(e){$("#message1").html(e).show()},bindHideMessage=function(){$(window).click(function(){$("#message").hide(),$("#message1").hide()})},bindClose=function(){$(".formBox .close").click(function(e){e.stopPropagation(),$(".formBox").fadeOut()})};bindSubmit(),bindClose(),bindHideMessage()</script><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€!></span></div><div class=right-div><ul class=common-flex-layout><li class=nowrap-li><div class=h3>åº”ç”¨åœºæ™¯</div><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps</a>
<a href=/zh/service-mesh/>åœ¨ K8s è¿è¡Œå¾®æœåŠ¡</a>
<a href=/zh/observability/>æ„å»ºäº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a>
<a href=https://github.com/kubesphere/kubekey target=_blank rel="noopener noreferrer">K8s ä¸€é”®éƒ¨ç½²ä¸è¿ç»´</a>
<a href=https://github.com/OpenFunction/OpenFunction target=_blank rel="noopener noreferrer">æ„å»º FaaS å¹³å°ä¸ Serverless æ¶æ„</a>
<a href=https://github.com/openpitrix/openpitrix target=_blank rel="noopener noreferrer">å¤šäº‘åº”ç”¨ç®¡ç†å¹³å°</a></li><li class=nowrap-li><div class=h3>èµ„æº</div><a href=/zh/projects/>å¼€æºé¡¹ç›®</a>
<a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a>
<a href=/zh/conferences/>å¼€æºå³°ä¼š</a>
<a href=/zh/videos/>è§†é¢‘èµ„æº</a>
<a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li><li class=nowrap-li><div class=h3>æ–‡æ¡£ä¸­å¿ƒ</div><a href=/zh/docs/v4.1/01-intro/01-introduction/>äº§å“ä»‹ç»</a>
<a href=/zh/docs/v4.1/03-installation-and-upgrade/02-install-kubesphere/02-install-kubernetes-and-kubesphere/>å¦‚ä½•å®‰è£…</a>
<a href=/zh/docs/v4.1/02-quickstart/>å¿«é€Ÿå…¥é—¨</a>
<a href=/zh/docs/v3.4/reference/api-docs/>API æ–‡æ¡£</a></li><li class=nowrap-li><div class=h3>å¼€æºç¤¾åŒº</div><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a>
<a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a>
<a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a>
<a href=/zh/partner/>åˆä½œä¼™ä¼´</a>
<a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a>
<a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a>
<a href=https://kubesphere.com.cn/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a>
<a href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ä¸­æ–‡è®ºå›</a>
<a href=https://kubesphere.io target=_blank rel="noopener noreferrer">å…¨çƒç«™</a></li><li class=nowrap-li><div class=h3>äº§å“ä¸æœåŠ¡</div><a href=https://aws.amazon.com/cn/quickstart/architecture/qingcloud-kubesphere/ target=_blank rel="noopener noreferrer">KubeSphere on AWS</a>
<a href=https://market.azure.cn/marketplace/apps/qingcloud.kubesphere target=_blank rel="noopener noreferrer">KubeSphere on Azure</a>
<a href=https://marketplace.digitalocean.com/apps/kubesphere target=_blank rel="noopener noreferrer">KubeSphere on DigitalOcean</a>
<a href=https://www.qingcloud.com/products/kubesphereqke target=_blank rel="noopener noreferrer">KubeSphere on QingCloud(QKE)</a>
<a href=https://kubesphere.com.cn/kse/ target=_blank rel="noopener noreferrer">KubeSphere ä¼ä¸šç‰ˆ</a>
<a href=https://kubesphere.cloud/ksv/ target=_blank rel="noopener noreferrer">KubeSphere è™šæ‹ŸåŒ–å¹³å°</a>
<a href=https://kubesphere.com.cn/marketplace/ target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿæ‰©å±•ç»„ä»¶å¸‚åœº</a>
<a href=https://kubesphere.cloud target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿåº”ç”¨æœåŠ¡å¹³å°</a>
<a href=https://m.qingcloud.com/p/aec50 target=_blank rel="noopener noreferrer">äº†è§£å•†ä¸šäº§å“ä¸å’¨è¯¢åˆä½œ</a></li></ul></div></div><div class=down-main><div class=img-div><a class=wechat href=javascript:void(0); aria-label=wechat><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28"><defs><path id="a" d="M0 0h15.673v12.156H0z"/></defs><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="13" cy="13" r="13" stroke="#B6C2CD"/><g transform="translate(5 7)"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59.0-4.625 1.679-4.625 3.74.0 2.066 2.035 3.738 4.625 3.738.542.0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27.0-.541-.257-.541-.514.0-.256.27-.514.541-.514.41.0.681.258.681.514.0.257-.271.514-.681.514zm2.994.0c-.27.0-.541-.257-.541-.514.0-.256.27-.514.54-.514.41.0.681.258.681.514.0.257-.277.514-.68.514z" mask="url(#b)"/><path fill="currentColor" d="M10.602 3.674c.177.0.356.011.533.029C10.657 1.576 8.27.0 5.543.0 2.498.0.0 1.974.0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17.0.343-.005.515-.022a3.68 3.68.0 01-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417.0.693.263.693.66s-.276.66-.693.66c-.418.0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417.0-.834-.263-.834-.66s.417-.66.834-.66c.418.0.695.263.695.66.0.392-.277.66-.695.66z" mask="url(#b)"/></g></g></svg><div class=hide-div><img src=/images/home/wechat.svg alt></div></a><a class=facebook-a href=https://www.facebook.com/kubesphere target=_blank aria-label=facebook></a><a class=twitter-a href=https://x.com/KubeSphere target=_blank aria-label=twitter rel="noopener noreferrer"></a><a class=linkedin-a href=https://www.linkedin.com/company/kubesphere/ target=_blank aria-label=linkedin rel="noopener noreferrer"></a><a class=bilibili-a href=https://space.bilibili.com/438908638 target=_blank aria-label=bilibili rel="noopener noreferrer"></a><a class=slack-a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank aria-label=slack rel="noopener noreferrer"></a><a class=github-a href=https://github.com/kubesphere/kubesphere target=_blank aria-label=github rel="noopener noreferrer"></a><a class=medium-a href=https://itnext.io/@kubesphere target=_blank aria-label=medium rel="noopener noreferrer"></a></div><p class=p1></p><p class=case><a href=http://www.beian.miit.gov.cn/ target=_blank rel="noopener noreferrer"><span>äº¬ICPå¤‡13019086å·</span>
</a><a target=_blank rel="noopener noreferrer" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502041003"><img src=/images/footer/case-icon.png alt=å¤‡æ¡ˆå›¾æ ‡>
<span>äº¬å…¬ç½‘å®‰å¤‡ 11010502041003å·</span></a></p></div></div></div><div class=cookie><div class=common-layout><p>æ‚¨çš„éšç§å¯¹æˆ‘ä»¬å¾ˆé‡è¦ã€‚æˆ‘ä»¬ä½¿ç”¨Cookieæ¥è®°ä½è®¢é˜…è¯¦ç»†ä¿¡æ¯ï¼Œä¼˜åŒ–ç½‘ç«™åŠŸèƒ½å¹¶äº¤ä»˜æ ¹æ®æ‚¨çš„å…´è¶£é‡èº«å®šåˆ¶çš„å†…å®¹ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„<a href=/zh/privacy>éšç§æ”¿ç­–</a>.</p><button>
æ¥å—å¹¶ç»§ç»­</button></div></div></footer><script>var lazyLoad=function(e,t){for(var n,o,i,s=0;s<t;s++){if(n=e.eq(s),o=n.attr("data-loaded"),o)continue;n.offset().top<parseInt($(window).height())+parseInt($(window).scrollTop())&&(i=n.attr("src"),n.attr("src",i),n.attr("data-loaded",!0))}},bindLayLoad=function(){var e=$("img"),t=e.length;lazyLoad(e,t),$(window).scroll(function(){lazyLoad(e,t)})},bindAddPadding=function(){var e=$("#close-join");e.length>0&&$(".main-section").addClass("padding")},docCookies={getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t){return!!e&&!/^(?:expires|max-age|path|domain|secure)$/i.test(e)&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t),!0)}},bindHideCookie=function(){var t=docCookies.getItem("hasAuth"),e=$(".cookie");t?e.hide():e.show(),e.find("button").on("click",function(){docCookies.setItem("hasAuth","1"),e.hide()})};bindAddPadding(),bindHideCookie()</script><script type=text/javascript src=/js/aside.2d6977c0f16aef4ed3e886dd66675ce74bd0efcd467c2b2bcdb30b92d5e7c7c0e5c6e0c9d8f09a883c22f58df9e6b0b6347fcdd3c9a920b7faba6d7f91a201c3.js integrity="sha512-LWl3wPFq707T6IbdZmdc50vQ781GfCsrzbMLktXnx8DlxuDJ2PCaiDwi9Y355rC2NH/N08mpILf6um1/kaIBww=="></script><script type=text/javascript src=/js/markdown-tab.17f9f46b021adebc7250ce1b07134a577b307e7a436daa4aaf388f218e8463966f53770b26a64817c06c168738a887672d47fb4c29615adfc446e11d09a344cf.js integrity="sha512-F/n0awIa3rxyUM4bBxNKV3swfnpDbapKrziPIY6EY5ZvU3cLJqZIF8BsFoc4qIdnLUf7TClhWt/ERuEdCaNEzw=="></script><script>let forbidForm=!1;var viewer=new Viewer(document.querySelector(".md-body"),{url:"src"}),blogBindSubmit=function(){var e=$("#email-input-blog");$("#email-submit-blog").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message_blog").data("message1"),a=$("#message_blog").data("message2"),r=$("#message_blog").data("message3"),c=$("#message1_blog").data("success");if(n)if(validateEmail(n)){if(s=$("#blog_formAddress").data("usesendcloud"),!s)return;o=$("#blog_formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:n.toString()},success:function(){showSuccessMessage_blog(c),setTimeout(function(){window.onscroll="",$(".SubscribeForm").hide(),$("#email-input-blog").val("")},5e3)},error:function(){showMessage_blog(r)}})}else t.preventDefault(),$("#message_blog").html(a).show();else t.preventDefault(),$("#message_blog").html(i).show()})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},bindHideMessageBlog=function(){$(window).click(function(){$("#message_blog").hide()})},bindCloseBlog=function(){$(".SubscribeForm .close").click(function(e){e.stopPropagation(),$(".SubscribeForm").fadeOut(),window.onscroll=""})},showMessage_blog=function(e){$("#message_blog").html(e).show()},showSuccessMessage_blog=function(e){$("#message1_blog").html(e).show()};window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;forbidForm&&(window.onscroll=""),e+t>n-710?$(".SubscribeForm").hide():$(".SubscribeForm").show()},blogBindSubmit(),bindCloseBlog(),bindHideMessageBlog()</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>