<!doctype html><html lang=en-US><head><meta charset=utf-8><title>æ‰‹æŠŠæ‰‹ä»é›¶éƒ¨ç½²ä¸è¿è¥ç”Ÿäº§çº§çš„ Kubernetes é›†ç¾¤ä¸ KubeSphere</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="KubeSphere æ˜¯åœ¨ Kubernetes ä¹‹ä¸Šæ„å»ºçš„ä»¥åº”ç”¨ä¸ºä¸­å¿ƒçš„å¤šç§Ÿæˆ·å®¹å™¨å¹³å°ï¼Œæä¾›å…¨æ ˆçš„ IT è‡ªåŠ¨åŒ–è¿ç»´çš„èƒ½åŠ›ï¼Œç®€åŒ–ä¼ä¸šçš„ DevOps å·¥ä½œæµã€‚KubeSphere æä¾›äº†è¿ç»´å‹å¥½çš„å‘å¯¼å¼æ“ä½œç•Œé¢ï¼Œå¸®åŠ©ä¼ä¸šå¿«é€Ÿæ„å»ºä¸€ä¸ªå¼ºå¤§å’ŒåŠŸèƒ½ä¸°å¯Œçš„å®¹å™¨äº‘å¹³å°ã€‚"><meta name=keywords content="Kubernetes,KubeSphere"><meta property="og:type" content="article"><meta property="og:title" content="æ‰‹æŠŠæ‰‹ä»é›¶éƒ¨ç½²ä¸è¿è¥ç”Ÿäº§çº§çš„ Kubernetes é›†ç¾¤ä¸ KubeSphere"><meta property="og:description" content="KubeSphere æ˜¯åœ¨ Kubernetes ä¹‹ä¸Šæ„å»ºçš„ä»¥åº”ç”¨ä¸ºä¸­å¿ƒçš„å¤šç§Ÿæˆ·å®¹å™¨å¹³å°ï¼Œæä¾›å…¨æ ˆçš„ IT è‡ªåŠ¨åŒ–è¿ç»´çš„èƒ½åŠ›ï¼Œç®€åŒ–ä¼ä¸šçš„ DevOps å·¥ä½œæµã€‚KubeSphere æä¾›äº†è¿ç»´å‹å¥½çš„å‘å¯¼å¼æ“ä½œç•Œé¢ï¼Œå¸®åŠ©ä¼ä¸šå¿«é€Ÿæ„å»ºä¸€ä¸ªå¼ºå¤§å’ŒåŠŸèƒ½ä¸°å¯Œçš„å®¹å™¨äº‘å¹³å°ã€‚"><meta property="og:image" content="https://92uu-blog.oss-cn-beijing.aliyuncs.com/2020-03-25-091655.png"><meta property="og:url" content="https://openksc.github.io/zh/blogs/kubernetes-kubesphere-ha/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeSphere"><meta property="twitter:image" content="https://92uu-blog.oss-cn-beijing.aliyuncs.com/2020-03-25-091655.png"><meta name=docsearch:language content="zh-CN"><meta name=docsearch:version content><link rel=canonical href=https://kubesphere.io/zh/blogs/kubernetes-kubesphere-ha/><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=apple-touch-icon href=/images/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/svg+xml href=/images/favicons/favicon.svg><link rel=icon type=image/png href=/images/favicons/favicon.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg color=#00ad6e><meta name=msapplication-config content='/images/favicons/browserconfig.xml'><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/fonts/Roboto/stylesheet.css><link rel=stylesheet href=/fonts/ProximaNova/stylesheet.css><link rel=stylesheet href=/css/jquery.modal.min.css><link rel=stylesheet href=/css/viewer.min.css><link rel=stylesheet href=/swiper/swiper-bundle.min.css><link rel=stylesheet href=/scss/common.min.0c3fdcc05ec210321169846714f74b11c4a1baf09a1833fa9273b2347c81e636.css><script src=/js/jquery-3.7.1.min.js></script><script src=/js/viewer.min.js></script><script src=/js/jquery.modal.min.js></script><script src=/swiper/swiper-bundle.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0888981f1fa45d241b1fb6962da2963e",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YYCVN36HT5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YYCVN36HT5")</script><script type=text/javascript>!function(e,t,n,s,o){e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=("https:"==document.location.protocol?"https://":"http://")+s,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio"),gio("init","8a24ae300cbf8b8c",{}),gio("send")</script><link rel=stylesheet href=/scss/content.min.f73b326fbf8c5bd331900b0de21c7dde608a4926f482f6465f9ae1d9049b83ad.css><link rel=stylesheet href=/scss/markdown.min.db47186481122431dffae72d17dbbd51f90b66f022cc163458645709924e4eac.css></head><body><header class=navigation><div class=join-div><div class=content>ğŸš€ KubeSphere v4.1.3 å‘å¸ƒï¼Œå¤šé¡¹ä¼˜åŒ–ä¸æ”¹è¿›ï¼Œæ¬¢è¿ä½“éªŒï¼<a href=/zh/docs/v4.1/20-release-notes/release-v413/ target=_blank rel="noopener noreferrer">è¯·æŸ¥çœ‹ Release notes â†’</a>
<img id=close-join src=/images/header/close.svg alt=close></div></div><div class=common-layout><div class=header-container><a href=/zh/ aria-label=logo><img src=/images/header/logo.svg alt class=logo></a><ul class=nav><li class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class="dropdown-menu menu-2"><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li class=menu-li><span class=menu-span>èµ„æº</span><ul class="dropdown-menu menu-3"><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class="dropdown-menu menu-4"><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/ target=_blank rel="noopener noreferrer">æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/ target=_blank rel="noopener noreferrer">Kube Design</a></li></ul></li><li class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class="dropdown-menu menu-5"><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025 target=_blank rel="noopener noreferrer">å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/ target=_blank rel="noopener noreferrer">è®¤è¯</a></li></ul><div class=right-menu><ul><li class=language-menu><div><img src=/images/header/black.svg alt>
<span>ç®€ä½“ä¸­æ–‡</span></div><ul class=dropdown-menu><li onclick='handleLangClick("zh","/zh/blogs/kubernetes-kubesphere-ha/")'>ç®€ä½“ä¸­æ–‡</li></ul></li><li class=github-li><div class=github-star><a class=star-btn href=https://github.com/kubesphere/kubesphere rel="noopener noreferrer" target=_blank><span class=star-img></span>&nbsp;<span>Star</span>
</a><a class=social-count href=https://github.com/kubesphere/kubesphere/stargazers rel="noopener noreferrer" target=_blank></a></div></li><li class=menu-icon><img src=/images/header/menu.svg alt></li></ul></div></div></div><div id=modal-for-menu class=modal><ul class=nav><li data-check=0 class=menu-li><span class=menu-span>åº”ç”¨åœºæ™¯</span><ul class=dropdown-menu><li><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps å·¥ä½œæµ</a></li><li><a href=/zh/service-mesh/>åœ¨ Kubernetes è¿è¡Œå¾®æœåŠ¡</a></li><li><a href=/zh/observability/>æ„å»ºä¸°å¯Œçš„äº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>èµ„æº</span><ul class=dropdown-menu><li><a href=/zh/projects/>å¼€æºé¡¹ç›®</a></li><li><a href=/zh/conferences/>å¼€æºå³°ä¼š</a></li><li><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a></li><li><a href=/zh/videos/>è§†é¢‘èµ„æº</a></li><li><a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>æ–‡æ¡£ä¸­å¿ƒ</span><ul class=dropdown-menu><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/>æ‰©å±•ç»„ä»¶å¼€å‘</a></li><li><a href=https://kube.design/>Kube Design</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>å¼€æºç¤¾åŒº</span><ul class=dropdown-menu><li><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a></li><li><a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a></li><li><a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a></li><li><a href=/zh/partner/>åˆä½œä¼™ä¼´</a></li><li><a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a></li><li><a href=/zh/news/>åŠ¨æ€</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md>ç‰ˆæœ¬è®¡åˆ’</a></li><li><a href=https://www.kubesphere.io/zh/>ä¸­å›½ç«™</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025>å¼€æºä¹‹å¤ 2025</a></li></ul></li><li><a data-docs=ç”¨æˆ·è®ºå› href=https://ask.kubesphere.io/forum>ç”¨æˆ·è®ºå›</a></li><li><a data-docs=è®¤è¯ href=https://kubesphere.cloud/certification/>è®¤è¯</a></li></ul><div class=link-div><a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank rel="noopener noreferrer" aria-label=slack><img src=/images/header/slack-hover.svg alt>
</a><a href=https://x.com/KubeSphere target=_blank rel="noopener noreferrer" aria-label=twitter><img src=/images/header/twitter-hover.svg alt>
</a><a href=https://github.com/kubesphere/kubesphere target=_blank rel="noopener noreferrer" aria-label=github><img src=/images/header/github-hover.svg alt></a></div></div></header><script>var bindNavMouseEvent,bindScrollChangeHeader,bindClickShowMenu,bindClickModalLi,bindClickClose,language,handleLangClick,githubApiLink="https://api.github.com/repos/kubesphere/kubesphere",getStar=function(){$(".social-count").hide(),$.getJSON(githubApiLink,function(e){$(".social-count").show().html(e.stargazers_count)})};getStar(),bindNavMouseEvent=function(e,t){t||(t=$(e));var n=!1;t.mouseenter(function(){if(n)return!1;n=!0,$(this).find(".dropdown-menu").fadeIn(200,function(){n=!1})}),t.mouseleave(function(){$(this).find(".dropdown-menu").fadeOut(200)})},bindScrollChangeHeader=function(){var t=100,e=$("header");window.addEventListener("scroll",function(){var t=window.scrollY;t>0?e.addClass("navigationScroll"):e.removeClass("navigationScroll")})},bindClickShowMenu=function(){$(".menu-icon").click(function(){$("#modal-for-menu").modal()})},bindClickModalLi=function(){$(".modal .menu-li").click(function(){var e=$(this).data("check");e===0?($(this).data("check",1),$(this).find(".dropdown-menu").slideDown(200)):($(this).data("check",0),$(this).find(".dropdown-menu").slideUp(200)),$(this).find(".menu-span").toggleClass("up")})},bindClickClose=function(){$("#close-join").click(function(){$(".navigation .join-div").hide(),$(".main-section").removeClass("padding")})},language="zh",bindClickClose(),bindScrollChangeHeader(),$(".header-container .menu-li").each(function(){bindNavMouseEvent("",$(this))}),bindNavMouseEvent(".header-container .language-menu"),bindNavMouseEvent(".header-container .btn-li"),bindClickShowMenu(),bindClickModalLi(),handleLangClick=function(e,t){try{localStorage.setItem("lang",e)}catch{}location.href=t}</script><section class=main-section><div class=common-layout><div class=breadcrumb><span><a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a> > </span><span>æ‰‹æŠŠæ‰‹ä»é›¶éƒ¨ç½²ä¸è¿è¥ç”Ÿäº§çº§çš„ Kubernetes é›†ç¾¤ä¸ KubeSphere</span></div><div class='main-div middle-div'><div class=author>Liu_wt</div><span class=date>å‘å¸ƒäºï¼š2020-03-26</span>&nbsp;&nbsp;&nbsp;
<span style=font-size:14px;color:#919aa3 id=busuanzi_container_page_pv>æœ¬æ–‡æ€»é˜…è¯»é‡ï¼š<span id=busuanzi_value_page_pv></span></span><h1>æ‰‹æŠŠæ‰‹ä»é›¶éƒ¨ç½²ä¸è¿è¥ç”Ÿäº§çº§çš„ Kubernetes é›†ç¾¤ä¸ KubeSphere</h1><div class=share-1><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-kubesphere-ha%2f&text=%e6%89%8b%e6%8a%8a%e6%89%8b%e4%bb%8e%e9%9b%b6%e9%83%a8%e7%bd%b2%e4%b8%8e%e8%bf%90%e8%90%a5%e7%94%9f%e4%ba%a7%e7%ba%a7%e7%9a%84%20Kubernetes%20%e9%9b%86%e7%be%a4%e4%b8%8e%20KubeSphere" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-kubesphere-ha%2f&title=%e6%89%8b%e6%8a%8a%e6%89%8b%e4%bb%8e%e9%9b%b6%e9%83%a8%e7%bd%b2%e4%b8%8e%e8%bf%90%e8%90%a5%e7%94%9f%e4%ba%a7%e7%ba%a7%e7%9a%84%20Kubernetes%20%e9%9b%86%e7%be%a4%e4%b8%8e%20KubeSphere" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-kubesphere-ha%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-kubesphere-ha%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-kubesphere-ha%2f&t=%e6%89%8b%e6%8a%8a%e6%89%8b%e4%bb%8e%e9%9b%b6%e9%83%a8%e7%bd%b2%e4%b8%8e%e8%bf%90%e8%90%a5%e7%94%9f%e4%ba%a7%e7%ba%a7%e7%9a%84%20Kubernetes%20%e9%9b%86%e7%be%a4%e4%b8%8e%20KubeSphere" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div><div class=content><div class=md-body><p><img src=https://pek3b.qingstor.com/kubesphere-docs/png/20200327191533.png alt></p><blockquote><p>æœ¬æ–‡æ¥è‡ª KubeSphere ç¤¾åŒºç”¨æˆ· <strong>Liu_wt</strong> æŠ•ç¨¿ï¼Œæ¬¢è¿æ‰€æœ‰ç¤¾åŒºç”¨æˆ·å‚ä¸æŠ•ç¨¿æˆ–åˆ†äº«ç»éªŒæ¡ˆä¾‹ã€‚</p></blockquote><p>æœ¬æ–‡å°†ä»é›¶å¼€å§‹ï¼Œåœ¨å¹²å‡€çš„æœºå™¨ä¸Šå®‰è£… Dockerã€Kubernetes (ä½¿ç”¨ kubeadm)ã€Calicoã€Helm ä¸ KubeSphereï¼Œé€šè¿‡æ‰‹æŠŠæ‰‹çš„æ•™ç¨‹æ¼”ç¤ºå¦‚ä½•æ­å»ºä¸€ä¸ªé«˜å¯ç”¨ç”Ÿäº§çº§çš„ Kubernetesï¼Œå¹¶åœ¨ Kubernetes é›†ç¾¤ä¹‹ä¸Šå®‰è£… KubeSphere å®¹å™¨å¹³å°å¯è§†åŒ–è¿è¥é›†ç¾¤ç¯å¢ƒã€‚</p><h2 id=ä¸€å‡†å¤‡ç¯å¢ƒ>ä¸€ã€å‡†å¤‡ç¯å¢ƒ</h2><p>å¼€å§‹éƒ¨ç½²ä¹‹å‰ï¼Œè¯·å…ˆç¡®å®šå½“å‰æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼Œæœ¬æ¬¡é›†ç¾¤æ­å»ºï¼Œæ‰€æœ‰æœºå™¨å¤„äºåŒä¸€å†…ç½‘ç½‘æ®µï¼Œå¹¶ä¸”å¯ä»¥äº’ç›¸é€šä¿¡ã€‚</p><p>âš ï¸âš ï¸âš ï¸ï¼š<strong>è¯·è¯¦ç»†é˜…è¯»ç¬¬ä¸€éƒ¨åˆ†ï¼Œåé¢çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸºäºè¿™ä¸ªç¯å¢ƒçš„ï¼Œä¸ºäº†é¿å…åé¢éƒ¨ç½²é›†ç¾¤å‡ºç°å„ç§å„æ ·çš„é—®é¢˜ï¼Œå¼ºçƒˆå»ºè®®ä½ å®Œå…¨æ»¡è¶³ç¬¬ä¸€éƒ¨åˆ†çš„ç¯å¢ƒè¦æ±‚</strong></p><blockquote><ul><li>ä¸¤å°ä»¥ä¸Šä¸»æœº</li><li>æ¯å°ä¸»æœºçš„ä¸»æœºåã€Mac åœ°å€ã€UUID ä¸ç›¸åŒ</li><li>CentOS 7ï¼ˆæœ¬æ–‡ç”¨ 7.6/7.7ï¼‰</li><li>æ¯å°æœºå™¨æœ€å¥½æœ‰ 2G å†…å­˜æˆ–ä»¥ä¸Š</li><li>Control-plane/Masterè‡³å°‘ 2U æˆ–ä»¥ä¸Š</li><li>å„ä¸ªä¸»æœºä¹‹é—´ç½‘ç»œç›¸é€š</li><li>ç¦ç”¨äº¤æ¢åˆ†åŒº</li><li>ç¦ç”¨ SELINUX</li><li>å…³é—­é˜²ç«å¢™ï¼ˆæˆ‘è‡ªå·±çš„é€‰æ‹©ï¼Œä½ ä¹Ÿå¯ä»¥è®¾ç½®ç›¸å…³é˜²ç«å¢™è§„åˆ™ï¼‰</li><li>Control-plane/Masterå’ŒWorkerèŠ‚ç‚¹åˆ†åˆ«å¼€æ”¾å¦‚ä¸‹ç«¯å£</li></ul></blockquote><p><strong>MasterèŠ‚ç‚¹</strong></p><table><thead><tr><th>åè®®</th><th>æ–¹å‘</th><th>ç«¯å£èŒƒå›´</th><th>ä½œç”¨</th><th>ä½¿ç”¨è€…</th></tr></thead><tbody><tr><td>TCP</td><td>å…¥ç«™</td><td>6443*</td><td>Kubernetes API æœåŠ¡å™¨</td><td>æ‰€æœ‰ç»„ä»¶</td></tr><tr><td>TCP</td><td>å…¥ç«™</td><td>2379-2380</td><td>etcd server client API</td><td>kube-apiserver, etcd</td></tr><tr><td>TCP</td><td>å…¥ç«™</td><td>10250</td><td>Kubelet API</td><td>kubelet è‡ªèº«ã€æ§åˆ¶å¹³é¢ç»„ä»¶</td></tr><tr><td>TCP</td><td>å…¥ç«™</td><td>10251</td><td>kube-scheduler</td><td>kube-scheduler è‡ªèº«</td></tr><tr><td>TCP</td><td>å…¥ç«™</td><td>10252</td><td>kube-controller-manager</td><td>kube-controller-manager è‡ªèº«</td></tr></tbody></table><p><strong>WorkerèŠ‚ç‚¹</strong></p><table><thead><tr><th>åè®®</th><th>æ–¹å‘</th><th>ç«¯å£èŒƒå›´</th><th>ä½œç”¨</th><th>ä½¿ç”¨è€…</th></tr></thead><tbody><tr><td>TCP</td><td>å…¥ç«™</td><td>10250</td><td>Kubelet API</td><td>kubelet è‡ªèº«ã€æ§åˆ¶å¹³é¢ç»„ä»¶</td></tr><tr><td>TCP</td><td>å…¥ç«™</td><td>30000-32767</td><td>NodePort æœåŠ¡**</td><td>æ‰€æœ‰ç»„ä»¶</td></tr></tbody></table><p>å…¶ä»–ç›¸å…³æ“ä½œå¦‚ä¸‹ï¼š</p><blockquote><p>å‹æƒ…æç¤ºğŸ˜Šï¼Œå¦‚æœé›†ç¾¤è¿‡å¤šï¼Œå¯ä»¥äº†è§£ä¸‹ ansibleï¼Œæ‰¹é‡ç®¡ç†ä½ çš„å¤šå°æœºå™¨ï¼Œæ–¹ä¾¿å®ç”¨çš„å·¥å…·ã€‚</p></blockquote><p>å…ˆè¿›è¡Œé˜²ç«å¢™ã€äº¤æ¢åˆ†åŒºè®¾ç½®</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ä¸ºäº†æ–¹ä¾¿æœ¬æ“ä½œå…³é—­äº†é˜²ç«å¢™ï¼Œä¹Ÿå»ºè®®ä½ è¿™æ ·æ“ä½œ</span>
</span></span><span style=display:flex><span>systemctl stop firewalld
</span></span><span style=display:flex><span>systemctl disable firewalld
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…³é—­ SeLinux</span>
</span></span><span style=display:flex><span>setenforce <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#34;s/SELINUX=enforcing/SELINUX=disabled/g&#34;</span> /etc/selinux/config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…³é—­ swap</span>
</span></span><span style=display:flex><span>swapoff -a
</span></span><span style=display:flex><span>yes | cp /etc/fstab /etc/fstab_bak
</span></span><span style=display:flex><span>cat /etc/fstab_bak |grep -v swap &gt; /etc/fstab
</span></span></code></pre></div><p>æ›´æ¢CentOS YUMæºä¸ºé˜¿é‡Œäº‘yumæº</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å®‰è£…wget</span>
</span></span><span style=display:flex><span>yum install wget -y
</span></span><span style=display:flex><span><span style=color:#75715e># å¤‡ä»½</span>
</span></span><span style=display:flex><span>mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup
</span></span><span style=display:flex><span><span style=color:#75715e># è·å–é˜¿é‡Œäº‘yumæº</span>
</span></span><span style=display:flex><span>wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
</span></span><span style=display:flex><span><span style=color:#75715e># è·å–é˜¿é‡Œäº‘epelæº</span>
</span></span><span style=display:flex><span>wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo
</span></span><span style=display:flex><span><span style=color:#75715e># æ¸…ç†ç¼“å­˜å¹¶åˆ›å»ºæ–°çš„ç¼“å­˜</span>
</span></span><span style=display:flex><span>yum clean all <span style=color:#f92672>&amp;&amp;</span> yum makecache
</span></span><span style=display:flex><span><span style=color:#75715e># ç³»ç»Ÿæ›´æ–°</span>
</span></span><span style=display:flex><span>yum update -y
</span></span></code></pre></div><p>è¿›è¡Œæ—¶é—´åŒæ­¥ï¼Œå¹¶ç¡®è®¤æ—¶é—´åŒæ­¥æˆåŠŸ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>timedatectl
</span></span><span style=display:flex><span>timedatectl set-ntp true
</span></span></code></pre></div><blockquote><p>âš ï¸âš ï¸âš ï¸ä»¥ä¸‹æ“ä½œè¯·ä¸¥æ ¼æŒ‰ç…§å£°æ˜çš„ç‰ˆæœ¬è¿›è¡Œéƒ¨ç½²ï¼Œå¦åˆ™å°†ç¢°åˆ°ä¹±ä¸ƒå…«ç³Ÿçš„é—®é¢˜</p></blockquote><h1 id=äºŒå®‰è£…-docker>äºŒã€å®‰è£… Docker</h1><h2 id=21å®‰è£…-docker>2.1ã€å®‰è£… Docker</h2><p>æ‚¨éœ€è¦åœ¨æ¯å°æœºå™¨ä¸Šå®‰è£… Dockerï¼Œæˆ‘è¿™é‡Œå®‰è£…çš„æ˜¯ <code>docker-ce-19.03.4</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å®‰è£… Docker CE</span>
</span></span><span style=display:flex><span><span style=color:#75715e># è®¾ç½®ä»“åº“</span>
</span></span><span style=display:flex><span><span style=color:#75715e># å®‰è£…æ‰€éœ€åŒ…</span>
</span></span><span style=display:flex><span>yum install -y yum-utils <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    device-mapper-persistent-data <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    lvm2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ–°å¢ Docker ä»“åº“,é€Ÿåº¦æ…¢çš„å¯ä»¥æ¢é˜¿é‡Œäº‘çš„æºã€‚</span>
</span></span><span style=display:flex><span>yum-config-manager <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --add-repo <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    https://download.docker.com/linux/centos/docker-ce.repo
</span></span><span style=display:flex><span><span style=color:#75715e># é˜¿é‡Œäº‘æºåœ°å€</span>
</span></span><span style=display:flex><span><span style=color:#75715e># http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å®‰è£… Docker CE.</span>
</span></span><span style=display:flex><span>yum install -y containerd.io-1.2.10 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    docker-ce-19.03.4 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    docker-ce-cli-19.03.4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¯åŠ¨ Docker å¹¶æ·»åŠ å¼€æœºå¯åŠ¨</span>
</span></span><span style=display:flex><span>systemctl start docker
</span></span><span style=display:flex><span>systemctl enable docker
</span></span></code></pre></div><h2 id=22ä¿®æ”¹-cgroup-driver>2.2ã€ä¿®æ”¹ Cgroup Driver</h2><p>éœ€è¦å°†Docker çš„ Cgroup Driver ä¿®æ”¹ä¸º systemdï¼Œä¸ç„¶åœ¨ä¸ºKubernetes é›†ç¾¤æ·»åŠ èŠ‚ç‚¹æ—¶ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ‰§è¡Œ kubeadm join çš„ WARNING ä¿¡æ¯</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>WARNING IsDockerSystemdCheck<span style=color:#f92672>]</span>: detected <span style=color:#e6db74>&#34;cgroupfs&#34;</span> as the Docker cgroup driver. The recommended driver is <span style=color:#e6db74>&#34;systemd&#34;</span>. Please follow the guide at https://kubernetes.io/docs/setup/cri/
</span></span></code></pre></div><p>ç›®å‰ Docker çš„ Cgroup Driver çœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker info|grep <span style=color:#e6db74>&#34;Cgroup Driver&#34;</span>
</span></span><span style=display:flex><span>  Cgroup Driver: cgroupfs
</span></span></code></pre></div><p>éœ€è¦å°†è¿™ä¸ªå€¼ä¿®æ”¹ä¸º systemd ï¼ŒåŒæ—¶æˆ‘å°†registryæ›¿æ¢æˆå›½å†…çš„ä¸€äº›ä»“åº“åœ°å€ï¼Œä»¥å…ç›´æ¥åœ¨å®˜æ–¹ä»“åº“æ‹‰å–é•œåƒä¼šå¾ˆæ…¢ï¼Œæ“ä½œå¦‚ä¸‹ã€‚</p><blockquote><p>âš ï¸âš ï¸âš ï¸ï¼šæ³¨æ„ç¼©è¿›ï¼Œç›´æ¥å¤åˆ¶çš„ç¼©è¿›å¯èƒ½æœ‰é—®é¢˜ï¼Œè¯·ç¡®ä¿ç¼©è¿›ä¸ºæ­£ç¡®çš„ Json æ ¼å¼ï¼›å¦‚æœ Docker é‡å¯åæŸ¥çœ‹çŠ¶æ€ä¸æ­£å¸¸ï¼Œå¤§æ¦‚ç‡æ˜¯æ­¤æ–‡ä»¶ç¼©è¿›æœ‰é—®é¢˜ï¼ŒJsonæ ¼å¼çš„ç¼©è¿›è‡ªå·±äº†è§£ä¸€ä¸‹ã€‚</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Setup daemon.</span>
</span></span><span style=display:flex><span>cat &gt; /etc/docker/daemon.json <span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;exec-opts&#34;: [&#34;native.cgroupdriver=systemd&#34;],
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;log-driver&#34;: &#34;json-file&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;log-opts&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;max-size&#34;: &#34;100m&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;storage-driver&#34;: &#34;overlay2&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;registry-mirrors&#34;:[
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;https://kfwkfulq.mirror.aliyuncs.com&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;https://2lqq34jg.mirror.aliyuncs.com&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;https://pee6w651.mirror.aliyuncs.com&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;http://hub-mirror.c.163.com&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;https://docker.mirrors.ustc.edu.cn&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;https://registry.docker-cn.com&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mkdir -p /etc/systemd/system/docker.service.d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Restart docker.</span>
</span></span><span style=display:flex><span>systemctl daemon-reload
</span></span><span style=display:flex><span>systemctl restart docker
</span></span></code></pre></div><h1 id=ä¸‰å®‰è£…-kubeadmkubelet-å’Œ-kubectl>ä¸‰ã€å®‰è£… kubeadmã€kubelet å’Œ kubectl</h1><h2 id=31å®‰è£…å‡†å¤‡>3.1ã€å®‰è£…å‡†å¤‡</h2><p>éœ€è¦åœ¨æ¯å°æœºå™¨ä¸Šå®‰è£…ä»¥ä¸‹çš„è½¯ä»¶åŒ…ï¼š</p><ul><li><p><code>kubeadm</code>ï¼šç”¨æ¥åˆå§‹åŒ–é›†ç¾¤çš„æŒ‡ä»¤ã€‚</p></li><li><p><code>kubelet</code>ï¼šåœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨ pod å’Œå®¹å™¨ç­‰ã€‚</p></li><li><p><code>kubectl</code>ï¼šç”¨æ¥ä¸é›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·ï¼ˆWorker èŠ‚ç‚¹å¯ä»¥ä¸è£…ï¼Œä½†æ˜¯æˆ‘è£…äº†ï¼Œä¸å½±å“ä»€ä¹ˆï¼‰ã€‚</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># é…ç½®K8Sçš„yumæº</span>
</span></span><span style=display:flex><span><span style=color:#75715e># è¿™éƒ¨åˆ†ç”¨æ˜¯é˜¿é‡Œäº‘çš„æºï¼Œå¦‚æœå¯ä»¥è®¿é—®Googleï¼Œåˆ™å»ºè®®ç”¨å®˜æ–¹çš„æº</span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[kubernetes]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>name=Kubernetes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
</span></span></span><span style=display:flex><span><span style=color:#e6db74>enabled=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>repo_gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg       http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å®˜æ–¹æºé…ç½®å¦‚ä¸‹</span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[kubernetes]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>name=Kubernetes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
</span></span></span><span style=display:flex><span><span style=color:#e6db74>enabled=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>repo_gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h2 id=32å¼€å§‹å®‰è£…>3.2ã€å¼€å§‹å®‰è£…</h2><p>å®‰è£…æŒ‡å®šç‰ˆæœ¬ <code>kubelet</code>ã€ <code>kubeadm</code> ã€<code>kubectl</code>ï¼Œ æˆ‘è¿™é‡Œé€‰æ‹©å½“å‰è¾ƒæ–°çš„ç¨³å®šç‰ˆ Kubernetes 1.17.3ï¼Œå¦‚æœé€‰æ‹©çš„ç‰ˆæœ¬ä¸ä¸€æ ·ï¼Œåœ¨æ‰§è¡Œé›†ç¾¤åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ³¨æ„ <code>--kubernetes-version</code> çš„å€¼ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å¢åŠ é…ç½®</span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.ipv4.ip_forward=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span><span style=color:#75715e># åŠ è½½</span>
</span></span><span style=display:flex><span>sysctl --system
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å®‰è£…</span>
</span></span><span style=display:flex><span>yum install -y kubelet-1.17.3 kubeadm-1.17.3 kubectl-1.17.3 --disableexcludes<span style=color:#f92672>=</span>kubernetes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¯åŠ¨å¹¶è®¾ç½® kubelet å¼€æœºå¯åŠ¨</span>
</span></span><span style=display:flex><span>systemctl start kubelet
</span></span><span style=display:flex><span>systemctl enable --now kubelet
</span></span></code></pre></div><blockquote><p>âš ï¸âš ï¸âš ï¸WARNING</p><p>å¦‚æœæ­¤æ—¶æ‰§è¡Œ <code>systemctl status kubelet</code> å‘½ä»¤ï¼Œç³»ç»Ÿæ—¥å¿—å°†å¾—åˆ° kubelet å¯åŠ¨å¤±è´¥çš„é”™è¯¯æç¤ºï¼Œè¯·å¿½ç•¥æ­¤é”™è¯¯ï¼Œå› ä¸ºå¿…é¡»å®Œæˆåç»­æ­¥éª¤ä¸­ kubeadm init çš„æ“ä½œï¼Œkubelet æ‰èƒ½æ­£å¸¸å¯åŠ¨</p></blockquote><h1 id=å››ä½¿ç”¨-kubeadm-åˆ›å»ºé›†ç¾¤>å››ã€ä½¿ç”¨ Kubeadm åˆ›å»ºé›†ç¾¤</h1><h2 id=41åˆå§‹åŒ–-control-planemaster-èŠ‚ç‚¹>4.1ã€åˆå§‹åŒ– Control-plane/Master èŠ‚ç‚¹</h2><p>åœ¨ç¬¬ä¸€å° Master ä¸Šæ‰§è¡Œåˆå§‹åŒ–ï¼Œæ‰§è¡Œåˆå§‹åŒ–ä½¿ç”¨ <code>kubeadm init</code> å‘½ä»¤ã€‚åˆå§‹åŒ–é¦–å…ˆä¼šæ‰§è¡Œä¸€ç³»åˆ—çš„è¿è¡Œå‰æ£€æŸ¥æ¥ç¡®ä¿æœºå™¨æ»¡è¶³è¿è¡Œ Kubernetes çš„æ¡ä»¶ï¼Œè¿™äº›æ£€æŸ¥ä¼šæŠ›å‡ºè­¦å‘Šå¹¶åœ¨å‘ç°é”™è¯¯çš„æ—¶å€™ç»ˆæ­¢æ•´ä¸ªåˆå§‹åŒ–è¿›ç¨‹ã€‚ ç„¶å <code>kubeadm init</code> ä¼šä¸‹è½½å¹¶å®‰è£…é›†ç¾¤çš„ Control-plane ç»„ä»¶ã€‚</p><p>åœ¨åˆå§‹åŒ–ä¹‹å‰ï¼Œéœ€è¦å…ˆè®¾ç½®ä¸€ä¸‹ hosts è§£æï¼Œä¸ºäº†é¿å…å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼Œåé¢çš„ Worker èŠ‚ç‚¹æˆ‘ä¹Ÿè¿›è¡Œäº†åŒæ ·çš„æ“ä½œã€‚æ³¨æ„æŒ‰ç…§ä½ çš„å®é™…æƒ…å†µä¿®æ”¹MasterèŠ‚ç‚¹çš„IPï¼Œå¹¶ä¸”æ³¨æ„ <code>APISERVER_NAME</code> çš„å€¼ï¼Œå¦‚æœä½ å°†è¿™ä¸ª apiserver åç§°è®¾ç½®ä¸ºåˆ«çš„å€¼ï¼Œä¸‹é¢åˆå§‹åŒ–æ—¶å€™çš„ <code>--control-plane-endpoint</code> çš„å€¼ä¿æŒä¸€è‡´ã€‚</p><blockquote><p>æç¤ºï¼šä¸ºäº†ä½¿ Kubernetes é›†ç¾¤é«˜å¯ç”¨ï¼Œå»ºè®®ç»™é›†ç¾¤çš„æ§åˆ¶èŠ‚ç‚¹é…ç½®è´Ÿè½½å‡è¡¡å™¨ï¼Œå¦‚ HAproxy + Keepalived æˆ– Nginxï¼Œäº‘ä¸Šå¯ä»¥ä½¿ç”¨å…¬æœ‰äº‘çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œç„¶ååœ¨ä»¥ä¸‹éƒ¨åˆ†è®¾ç½® <code>MASTER_IP</code> å’Œ <code>APISERVER_NAME</code> ä¸ºè´Ÿè½½å‡è¡¡å™¨çš„åœ°å€ï¼ˆIP:6443ï¼‰ å’ŒåŸŸåã€‚</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># è®¾ç½®hosts</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;127.0.0.1 </span><span style=color:#66d9ef>$(</span>hostname<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> &gt;&gt; /etc/hosts
</span></span><span style=display:flex><span>export MASTER_IP<span style=color:#f92672>=</span>192.168.115.49
</span></span><span style=display:flex><span>export APISERVER_NAME<span style=color:#f92672>=</span>kuber4s.api
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>MASTER_IP<span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>${</span>APISERVER_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> &gt;&gt; /etc/hosts
</span></span></code></pre></div><blockquote><p>å‹æƒ…æç¤ºğŸ™‚ğŸ™‚ğŸ™‚ï¼š</p><p>æˆªæ­¢2020å¹´01æœˆ29æ—¥ï¼Œå®˜æ–¹æ–‡æ¡£å£°æ˜äº†ä½¿ç”¨ kubeadm åˆå§‹åŒ– master æ—¶ï¼Œ--config è¿™ä¸ªå‚æ•°æ˜¯å®éªŒæ€§è´¨çš„ï¼Œæ‰€ä»¥å°±ä¸ç”¨äº†ï¼›æˆ‘ä»¬ç”¨å…¶ä»–å‚æ•°ä¸€æ ·å¯ä»¥å®Œæˆ master çš„åˆå§‹åŒ–ã€‚</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>--config string   kubeadm é…ç½®æ–‡ä»¶ã€‚ è­¦å‘Šï¼šé…ç½®æ–‡ä»¶çš„ä½¿ç”¨æ˜¯è¯•éªŒæ€§çš„ã€‚
</span></span></code></pre></div><p>ä¸‹é¢æœ‰ä¸å¸¦æ³¨é‡Šçš„åˆå§‹åŒ–å‘½ä»¤ï¼Œå»ºè®®å…ˆæŸ¥çœ‹å¸¦æ³¨é‡Šçš„æ¯ä¸ªå‚æ•°å¯¹åº”çš„æ„ä¹‰ï¼Œç¡®ä¿ä¸ä½ çš„å½“å‰é…ç½®çš„ç¯å¢ƒæ˜¯ä¸€è‡´çš„ï¼Œç„¶åå†æ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œé¿å…è¸©é›·ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆå§‹åŒ– Control-plane/Master èŠ‚ç‚¹</span>
</span></span><span style=display:flex><span>kubeadm init <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --apiserver-advertise-address 0.0.0.0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    <span style=color:#75715e># API æœåŠ¡å™¨æ‰€å…¬å¸ƒçš„å…¶æ­£åœ¨ç›‘å¬çš„ IP åœ°å€,æŒ‡å®šâ€œ0.0.0.0â€ä»¥ä½¿ç”¨é»˜è®¤ç½‘ç»œæ¥å£çš„åœ°å€</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># åˆ‡è®°åªå¯ä»¥æ˜¯å†…ç½‘IPï¼Œä¸èƒ½æ˜¯å¤–ç½‘IPï¼Œå¦‚æœæœ‰å¤šç½‘å¡ï¼Œå¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹æŒ‡å®šæŸä¸ªç½‘å¡</span>
</span></span><span style=display:flex><span>    --apiserver-bind-port <span style=color:#ae81ff>6443</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    <span style=color:#75715e># API æœåŠ¡å™¨ç»‘å®šçš„ç«¯å£,é»˜è®¤ 6443</span>
</span></span><span style=display:flex><span>    --cert-dir /etc/kubernetes/pki <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    <span style=color:#75715e># ä¿å­˜å’Œå­˜å‚¨è¯ä¹¦çš„è·¯å¾„ï¼Œé»˜è®¤å€¼ï¼š&#34;/etc/kubernetes/pki&#34;</span>
</span></span><span style=display:flex><span>    --control-plane-endpoint kuber4s.api <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    <span style=color:#75715e># ä¸ºæ§åˆ¶å¹³é¢æŒ‡å®šä¸€ä¸ªç¨³å®šçš„ IP åœ°å€æˆ– DNS åç§°,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># è¿™é‡ŒæŒ‡å®šçš„ kuber4s.api å·²ç»åœ¨ /etc/hosts é…ç½®è§£æä¸ºæœ¬æœºIP</span>
</span></span><span style=display:flex><span>    --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    <span style=color:#75715e># é€‰æ‹©ç”¨äºæ‹‰å–Control-planeçš„é•œåƒçš„å®¹å™¨ä»“åº“ï¼Œé»˜è®¤å€¼ï¼š&#34;k8s.gcr.io&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># å›  Googleè¢«å¢™ï¼Œè¿™é‡Œé€‰æ‹©å›½å†…ä»“åº“</span>
</span></span><span style=display:flex><span>    --kubernetes-version 1.17.3 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    <span style=color:#75715e># ä¸ºControl-planeé€‰æ‹©ä¸€ä¸ªç‰¹å®šçš„ Kubernetes ç‰ˆæœ¬ï¼Œ é»˜è®¤å€¼ï¼š&#34;stable-1&#34;</span>
</span></span><span style=display:flex><span>    --node-name master01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    <span style=color:#75715e>#  æŒ‡å®šèŠ‚ç‚¹çš„åç§°,ä¸æŒ‡å®šçš„è¯ä¸ºä¸»æœºhostnameï¼Œé»˜è®¤å¯ä»¥ä¸æŒ‡å®š</span>
</span></span><span style=display:flex><span>    --pod-network-cidr 10.10.0.0/16 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    <span style=color:#75715e># æŒ‡å®špodçš„IPåœ°å€èŒƒå›´</span>
</span></span><span style=display:flex><span>    --service-cidr 10.20.0.0/16 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    <span style=color:#75715e># æŒ‡å®šServiceçš„VIPåœ°å€èŒƒå›´</span>
</span></span><span style=display:flex><span>    --service-dns-domain cluster.local <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    <span style=color:#75715e># ä¸ºServiceå¦å¤–æŒ‡å®šåŸŸåï¼Œé»˜è®¤&#34;cluster.local&#34;</span>
</span></span><span style=display:flex><span>    --upload-certs
</span></span><span style=display:flex><span>    <span style=color:#75715e># å°† Control-plane è¯ä¹¦ä¸Šä¼ åˆ° kubeadm-certs Secret</span>
</span></span></code></pre></div><p>ä¸å¸¦æ³¨é‡Šçš„å†…å®¹å¦‚ä¸‹ï¼Œå¦‚æœåˆå§‹åŒ–è¶…æ—¶ï¼Œå¯ä»¥ä¿®æ”¹DNSä¸º8.8.8.8åé‡å¯ç½‘ç»œæœåŠ¡å†æ¬¡å°è¯•ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm init <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> --apiserver-advertise-address 0.0.0.0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> --apiserver-bind-port <span style=color:#ae81ff>6443</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> --cert-dir /etc/kubernetes/pki <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> --control-plane-endpoint kuber4s.api <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> --kubernetes-version 1.17.3 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> --pod-network-cidr 10.10.0.0/16 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> --service-cidr 10.20.0.0/16 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> --service-dns-domain cluster.local <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> --upload-certs
</span></span></code></pre></div><p>æ¥ä¸‹æ¥è¿™ä¸ªè¿‡ç¨‹æœ‰ç‚¹æ¼«é•¿ï¼ˆåˆå§‹åŒ–ä¼šä¸‹è½½é•œåƒã€åˆ›å»ºé…ç½®æ–‡ä»¶ã€å¯åŠ¨å®¹å™¨ç­‰æ“ä½œï¼‰ï¼Œæ³¡æ¯èŒ¶ï¼Œè€å¿ƒç­‰å¾…ï¼Œä½ ä¹Ÿå¯ä»¥æ‰§è¡Œ <code>tailf /var/log/messages</code> æ¥å®æ—¶æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼Œè§‚å¯Ÿ Master çš„åˆå§‹åŒ–è¿›å±•ï¼ŒæœŸé—´ç¢°åˆ°ä¸€äº›æŠ¥é”™ä¸è¦ç´§å¼ ï¼Œå¯èƒ½åªæ˜¯æš‚æ—¶çš„é”™è¯¯ï¼Œç­‰å¾…æœ€ç»ˆåé¦ˆçš„ç»“æœå³å¯ã€‚</p><p>å¦‚æœåˆå§‹åŒ–æœ€ç»ˆæˆåŠŸæ‰§è¡Œï¼Œä½ å°†çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Your Kubernetes control-plane has initialized successfully!
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To start using your cluster, you need to run the following as a regular user:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mkdir -p $HOME/.kube
</span></span><span style=display:flex><span>  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span style=display:flex><span>  sudo chown <span style=color:#66d9ef>$(</span>id -u<span style=color:#66d9ef>)</span>:<span style=color:#66d9ef>$(</span>id -g<span style=color:#66d9ef>)</span> $HOME/.kube/config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>You should now deploy a pod network to the cluster.
</span></span><span style=display:flex><span>Run <span style=color:#e6db74>&#34;kubectl apply -f [podnetwork].yaml&#34;</span> with one of the options listed at:
</span></span><span style=display:flex><span>  https://kubernetes.io/docs/concepts/cluster-administration/addons/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>You can now join any number of the control-plane node running the following command on each as root:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  kubeadm join kuber4s.api:6443 --token 0j287q.jw9zfjxud8w85tis <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --discovery-token-ca-cert-hash sha256:5e8bcad5ec97c1025e8044f4b8fd0a4514ecda4bac2b3944f7f39ccae9e4921f <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --control-plane --certificate-key 528b0b9f2861f8f02dfd4a59fc54ad21e42a7dea4dc5552ac24d9c650c5d4d80
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Please note that the certificate-key gives access to cluster sensitive data, keep it secret!
</span></span><span style=display:flex><span>As a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;kubeadm init phase upload-certs --upload-certs&#34;</span> to reload certs afterward.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Then you can join any number of worker nodes by running the following on each as root:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubeadm join kuber4s.api:6443 --token 0j287q.jw9zfjxud8w85tis <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --discovery-token-ca-cert-hash sha256:5e8bcad5ec97c1025e8044f4b8fd0a4514ecda4bac2b3944f7f39ccae9e4921f
</span></span></code></pre></div><p>ä¸ºæ™®é€šç”¨æˆ·æ·»åŠ  <code>kubectl</code> è¿è¡Œæƒé™ï¼Œå‘½ä»¤å†…å®¹åœ¨åˆå§‹åŒ–æˆåŠŸåçš„è¾“å‡ºå†…å®¹ä¸­å¯ä»¥çœ‹åˆ°ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p $HOME/.kube
</span></span><span style=display:flex><span>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span style=display:flex><span>sudo chown <span style=color:#66d9ef>$(</span>id -u<span style=color:#66d9ef>)</span>:<span style=color:#66d9ef>$(</span>id -g<span style=color:#66d9ef>)</span> $HOME/.kube/config
</span></span></code></pre></div><p>å»ºè®®rootç”¨æˆ·ä¹Ÿè¿›è¡Œä»¥ä¸Šæ“ä½œï¼Œä½œè€…ä½¿ç”¨çš„æ˜¯rootç”¨æˆ·æ‰§è¡Œçš„åˆå§‹åŒ–æ“ä½œï¼Œç„¶ååœ¨æ“ä½œå®ŒæˆåæŸ¥çœ‹é›†ç¾¤çŠ¶æ€çš„æ—¶å€™ï¼Œå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>The connection to the server localhost:8080 was refused - did you specify the right host or port?
</span></span></code></pre></div><p>è¿™æ—¶å€™è¯·å¤‡ä»½å¥½ <code>kubeadm init</code> è¾“å‡ºä¸­çš„ <code>kubeadm join</code> å‘½ä»¤ï¼Œå› ä¸ºå°†ä¼šéœ€è¦è¿™ä¸ªå‘½ä»¤æ¥ç»™é›†ç¾¤æ·»åŠ èŠ‚ç‚¹ã€‚</p><blockquote><p>âš ï¸âš ï¸âš ï¸æç¤ºï¼šä»¤ç‰Œæ˜¯ä¸»èŠ‚ç‚¹å’Œæ–°æ·»åŠ çš„èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œç›¸äº’èº«ä»½éªŒè¯çš„ï¼Œå› æ­¤è¯·ç¡®ä¿å…¶å®‰å…¨ã€‚ä»»ä½•äººåªè¦çŸ¥é“äº†è¿™äº›ä»¤ç‰Œï¼Œå°±å¯ä»¥éšä¾¿ç»™æ‚¨çš„é›†ç¾¤æ·»åŠ èŠ‚ç‚¹ã€‚ ä½ å¯ä»¥ä½¿ç”¨ <code>kubeadm token</code> å‘½ä»¤æ¥æŸ¥çœ‹ã€åˆ›å»ºå’Œåˆ é™¤è¿™ç±»ä»¤ç‰Œã€‚</p></blockquote><h2 id=42å®‰è£…-pod-ç½‘ç»œé™„åŠ ç»„ä»¶>4.2ã€å®‰è£… Pod ç½‘ç»œé™„åŠ ç»„ä»¶</h2><p>å…³äº Kubernetes ç½‘ç»œï¼Œå»ºè®®è¯»å®Œè¿™ç¯‡ <a href=https://yuerblog.cc/2019/02/25/flannel-and-calico/ target=_blank rel="noopener noreferrer">æ–‡ç« </a>ï¼Œä»¥åŠæ–‡æœ«çš„å…¶ä»–é“¾æ¥ï¼Œå¦‚<a href=https://juejin.im/entry/599d33ad6fb9a0247804d430 target=_blank rel="noopener noreferrer">è¿™ä¸ª</a>ã€‚</p><p>é›†ç¾¤å¿…é¡»å®‰è£…Podç½‘ç»œæ’ä»¶ï¼Œä»¥ä½¿Podå¯ä»¥ç›¸äº’é€šä¿¡ï¼Œåªéœ€è¦åœ¨MasterèŠ‚ç‚¹æ“ä½œï¼Œå…¶ä»–æ–°åŠ å…¥çš„èŠ‚ç‚¹ä¼šè‡ªåŠ¨åˆ›å»ºç›¸å…³podã€‚</p><p>å¿…é¡»åœ¨ä»»ä½•åº”ç”¨ç¨‹åºä¹‹å‰éƒ¨ç½²ç½‘ç»œç»„ä»¶ã€‚å¦å¤–ï¼Œåœ¨å®‰è£…ç½‘ç»œä¹‹å‰ï¼ŒCoreDNSå°†ä¸ä¼šå¯åŠ¨ï¼ˆä½ å¯ä»¥é€šè¿‡å‘½ä»¤ <code>kubectl get pods --all-namespaces|grep coredns</code> æŸ¥çœ‹ CoreDNS çš„çŠ¶æ€ï¼‰ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æŸ¥çœ‹ CoreDNS çš„çŠ¶æ€,å¹¶ä¸æ˜¯ Running çŠ¶æ€</span>
</span></span><span style=display:flex><span>$ kubectl get pods --all-namespaces|grep coredns
</span></span><span style=display:flex><span>kube-system   coredns-7f9c544f75-bzksd    0/1   Pending   <span style=color:#ae81ff>0</span>     14m
</span></span><span style=display:flex><span>kube-system   coredns-7f9c544f75-mtrwq    0/1   Pending   <span style=color:#ae81ff>0</span>     14m
</span></span></code></pre></div><p>kubeadm æ”¯æŒå¤šç§ç½‘ç»œæ’ä»¶ï¼Œæˆ‘ä»¬é€‰æ‹© Calico ç½‘ç»œæ’ä»¶ï¼ˆkubeadm ä»…æ”¯æŒåŸºäºå®¹å™¨ç½‘ç»œæ¥å£ï¼ˆCNIï¼‰çš„ç½‘ç»œï¼ˆä¸æ”¯æŒkubenetï¼‰ã€‚ï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒç»™å‡ºçš„podçš„IPæ®µåœ°å€æ˜¯ <code>192.168.0.0/16</code> ,å¦‚æœä½ çš„æœºå™¨å·²ç»ä½¿ç”¨äº†æ­¤IPæ®µï¼Œå°±éœ€è¦ä¿®æ”¹è¿™ä¸ªé…ç½®é¡¹ï¼Œå°†å…¶å€¼æ”¹ä¸ºåœ¨åˆå§‹åŒ– Master èŠ‚ç‚¹æ—¶ä½¿ç”¨ <code>kubeadm init --pod-network-cidr=x.x.x.x/x</code> çš„IPåœ°å€æ®µï¼Œå³æˆ‘ä»¬ä¸Šé¢é…ç½®çš„ <code>10.10.0.0/16</code> ï¼Œå¤§æ¦‚åœ¨625è¡Œå·¦å³ï¼Œæ“ä½œå¦‚ä¸‹:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># è·å–é…ç½®æ–‡ä»¶</span>
</span></span><span style=display:flex><span>mkdir calico <span style=color:#f92672>&amp;&amp;</span> cd calico
</span></span><span style=display:flex><span>wget https://docs.projectcalico.org/v3.8/manifests/calico.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰¾åˆ° 625 è¡Œå·¦å³çš„ 192.168.0.0/16 ï¼Œå¹¶ä¿®æ”¹ä¸ºæˆ‘ä»¬åˆå§‹åŒ–æ—¶é…ç½®çš„ 10.10.0.0/16</span>
</span></span><span style=display:flex><span>vim calico.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éƒ¨ç½² Pod ç½‘ç»œç»„ä»¶</span>
</span></span><span style=display:flex><span>kubectl apply -f calico.yaml
</span></span></code></pre></div><p>ç¨ç­‰ç‰‡åˆ»æŸ¥è¯¢ pod è¯¦æƒ…ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>watch</code> å‘½ä»¤æ¥å®æ—¶æŸ¥çœ‹ pod çš„çŠ¶æ€ï¼Œç­‰å¾… Pod ç½‘ç»œç»„ä»¶éƒ¨ç½²æˆåŠŸåï¼Œå°±å¯ä»¥çœ‹åˆ°ä¸€äº›ä¿¡æ¯äº†ï¼ŒåŒ…æ‹¬ Pod çš„ IP åœ°å€ä¿¡æ¯ï¼Œè¿™ä¸ªè¿‡ç¨‹æ—¶é—´å¯èƒ½ä¼šæœ‰ç‚¹é•¿ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>watch -n <span style=color:#ae81ff>2</span> kubectl get pods --all-namespaces -o wide
</span></span></code></pre></div><h2 id=43å°†-worker-èŠ‚ç‚¹æ·»åŠ åˆ°-kubernetes>4.3ã€å°† Worker èŠ‚ç‚¹æ·»åŠ åˆ° Kubernetes</h2><p>è¯·é¦–å…ˆç¡®è®¤ Worker èŠ‚ç‚¹æ»¡è¶³ç¬¬ä¸€éƒ¨åˆ†çš„ç¯å¢ƒè¯´æ˜ï¼Œå¹¶ä¸”å·²ç»å®‰è£…äº† Docker å’Œ kubeadmã€kubelet ã€kubectlï¼Œå¹¶ä¸”å·²ç»å¯åŠ¨ kubeletã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ·»åŠ  Hosts è§£æ</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;127.0.0.1 </span><span style=color:#66d9ef>$(</span>hostname<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> &gt;&gt; /etc/hosts
</span></span><span style=display:flex><span>export MASTER_IP<span style=color:#f92672>=</span>192.168.115.49
</span></span><span style=display:flex><span>export APISERVER_NAME<span style=color:#f92672>=</span>kuber4s.api
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>MASTER_IP<span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>${</span>APISERVER_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> &gt;&gt; /etc/hosts
</span></span></code></pre></div><p>å°† Worker èŠ‚ç‚¹æ·»åŠ åˆ°é›†ç¾¤ï¼Œè¿™é‡Œæ³¨æ„ï¼Œæ‰§è¡Œåå¯èƒ½ä¼šæŠ¥é”™ï¼Œæœ‰å¹¸çš„è¯ä½ ä¼šè·³è¿›è¿™ä¸ªå‘ï¼Œè¿™æ˜¯å› ä¸º Worker èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„å‘½ä»¤å®é™…ä¸Šåœ¨åˆå§‹åŒ– master æ—¶å·²ç»æœ‰æç¤ºå‡ºæ¥äº†ï¼Œä¸è¿‡ä¸¤å°æ—¶åä¼šåˆ é™¤ä¸Šä¼ çš„è¯ä¹¦ï¼Œæ‰€ä»¥å¦‚æœä½ æ­¤æ—¶åŠ å…¥é›†ç¾¤çš„æ—¶å€™æç¤ºè¯ä¹¦ç›¸å…³çš„é”™è¯¯ï¼Œè¯·æ‰§è¡Œ <code>kubeadm init phase upload-certs --upload-certs</code> é‡æ–°åŠ è½½è¯ä¹¦ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm join kuber4s.api:6443 --token 0y1dj2.ih27ainxwyib0911 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --discovery-token-ca-cert-hash sha256:5204b3e358a0d568e147908cba8036bdb63e604d4f4c1c3730398f33144fac61 <span style=color:#ae81ff>\
</span></span></span></code></pre></div><p>æ‰§è¡ŒåŠ å…¥æ“ä½œï¼Œä½ å¯èƒ½ä¼šå‘ç°å¡ç€ä¸åŠ¨ï¼Œå¤§æ¦‚ç‡æ˜¯å› ä¸ºä»¤ç‰ŒIDå¯¹æ­¤é›†ç¾¤æ— æ•ˆæˆ–å·²è¿‡ 2 å°æ—¶çš„æœ‰æ•ˆæœŸï¼ˆé€šè¿‡æ‰§è¡Œ <code>kubeadm join --v=5</code> æ¥è·å–è¯¦ç»†çš„åŠ å…¥è¿‡ç¨‹ï¼Œçœ‹åˆ°äº†å†…å®¹ä¸º â€token id "0y1dj2" is invalid for this cluster or it has expiredâ€œ çš„æç¤ºï¼‰ï¼Œæ¥ä¸‹æ¥éœ€è¦åœ¨ Master ä¸Šé€šè¿‡ <code>kubeadm token create</code> æ¥åˆ›å»ºæ–°çš„ä»¤ç‰Œã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubeadm token create --print-join-command
</span></span><span style=display:flex><span>W0129 19:10:04.842735   <span style=color:#ae81ff>15533</span> validation.go:28<span style=color:#f92672>]</span> Cannot validate kube-proxy config - no validator is available
</span></span><span style=display:flex><span>W0129 19:10:04.842808   <span style=color:#ae81ff>15533</span> validation.go:28<span style=color:#f92672>]</span> Cannot validate kubelet config - no validator is available
</span></span><span style=display:flex><span><span style=color:#75715e># è¾“å‡ºç»“æœå¦‚ä¸‹</span>
</span></span><span style=display:flex><span>kubeadm join kuber4s.api:6443 --token 1hk9bc.oz7f3lmtbzf15x9b     --discovery-token-ca-cert-hash sha256:5e8bcad5ec97c1025e8044f4b8fd0a4514ecda4bac2b3944f7f39ccae9e4921f
</span></span></code></pre></div><p>åœ¨ Worker èŠ‚ç‚¹ä¸Šé‡æ–°æ‰§è¡ŒåŠ å…¥é›†ç¾¤å‘½ä»¤</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm join kuber4s.api:6443 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --token 1hk9bc.oz7f3lmtbzf15x9b <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --discovery-token-ca-cert-hash sha256:5e8bcad5ec97c1025e8044f4b8fd0a4514ecda4bac2b3944f7f39ccae9e4921f
</span></span></code></pre></div><p>æ¥ä¸‹æ¥åœ¨Masterä¸ŠæŸ¥çœ‹ Worker èŠ‚ç‚¹åŠ å…¥çš„çŠ¶å†µï¼Œç›´åˆ° Worker èŠ‚ç‚¹çš„çŠ¶æ€å˜ä¸º Ready ä¾¿è¯æ˜åŠ å…¥æˆåŠŸï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šæœ‰ç‚¹æ¼«é•¿ï¼Œ30 åˆ†é’Ÿä»¥å†…éƒ½ç®—æ­£å¸¸çš„ï¼Œä¸»è¦çœ‹ä½ ç½‘ç»œçš„æƒ…å†µæˆ–è€…è¯´æ‹‰å–é•œåƒçš„é€Ÿåº¦ï¼›å¦å¤–ä¸è¦ä¸€çœ‹åˆ° <code>/var/log/messages</code> é‡Œé¢æŠ¥é”™å°±æ…Œäº†ï¼Œé‚£ä¹Ÿå¾—çœ‹å…·ä½“æŠ¥ä»€ä¹ˆé”™ï¼Œçœ‹ä¸æ‡‚å°±ç¨å¾®ç­‰ä¸€ä¸‹ï¼Œä¸€èˆ¬åœ¨ Master ä¸Šèƒ½çœ‹åˆ°å·²ç»åŠ å…¥ï¼ˆè™½ç„¶æ²¡æœ‰Readyï¼‰å°±æ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>watch kubectl get nodes -o wide
</span></span></code></pre></div><h2 id=44æ·»åŠ -master-èŠ‚ç‚¹>4.4ã€æ·»åŠ  Master èŠ‚ç‚¹</h2><p>éœ€è¦è‡³å°‘2ä¸ªCPUæ ¸å¿ƒï¼Œå¦åˆ™ä¼šæŠ¥é”™</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm join kuber4s.api:6443 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --token 1hk9bc.oz7f3lmtbzf15x9b <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --discovery-token-ca-cert-hash sha256:5e8bcad5ec97c1025e8044f4b8fd0a4514ecda4bac2b3944f7f39ccae9e4921f <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --control-plane --certificate-key 5253fc7e9a4e6204d0683ed2d60db336b3ff64ddad30ba59b4c0bf40d8ccadcd
</span></span></code></pre></div><h2 id=45è¡¥å……å†…å®¹>4.5ã€è¡¥å……å†…å®¹</h2><ul><li><a href=https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-init/ target=_blank rel="noopener noreferrer">kubeadm init</a> åˆå§‹åŒ– Kubernetes ä¸»èŠ‚ç‚¹</li><li><a href=https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-token/ target=_blank rel="noopener noreferrer">kubeadm token</a> ç®¡ç† <code>kubeadm join</code> çš„ä»¤ç‰Œ</li><li><a href=https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-reset/ target=_blank rel="noopener noreferrer">kubeadm reset</a> å°† <code>kubeadm init</code> æˆ– <code>kubeadm join</code> å¯¹ä¸»æœºçš„æ›´æ”¹æ¢å¤åˆ°ä¹‹å‰çŠ¶æ€ï¼Œä¸€èˆ¬ä¸ <code>-f</code> å‚æ•°ä½¿ç”¨</li></ul><p>ç§»é™¤ worker èŠ‚ç‚¹</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œä½ æ— éœ€ç§»é™¤ worker èŠ‚ç‚¹ï¼Œå¦‚æœè¦ç§»é™¤ï¼Œåœ¨å‡†å¤‡ç§»é™¤çš„ worker èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</p><pre tabindex=0><code>kubeadm reset -f
</code></pre><p>æˆ–è€…åœ¨ Control-plane ä¸Šæ‰§è¡Œ</p><pre tabindex=0><code>kubectl delete node nodename
</code></pre><blockquote><ul><li>å°† nodename æ›¿æ¢ä¸ºè¦ç§»é™¤çš„ worker èŠ‚ç‚¹çš„åå­—</li><li>worker èŠ‚ç‚¹çš„åå­—å¯ä»¥é€šè¿‡åœ¨ Control-plane ä¸Šæ‰§è¡Œ kubectl get nodes å‘½ä»¤è·å¾—</li></ul></blockquote><h1 id=äº”kubernetes-é«˜å¯ç”¨é›†ç¾¤>äº”ã€Kubernetes é«˜å¯ç”¨é›†ç¾¤</h1><h2 id=51ç¯å¢ƒè¯´æ˜>5.1ã€ç¯å¢ƒè¯´æ˜</h2><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ä»¥ä¸Šæ–¹æ³•éƒ¨ç½²ä½ çš„ Kubernetes é›†ç¾¤ï¼Œæƒ³åœ¨å½“å‰åŸºç¡€ä¸Šè¿›è¡Œé«˜å¯ç”¨é›†ç¾¤çš„åˆ›å»ºï¼Œåˆ™å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤ç»§ç»­è¿›è¡Œã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæ²¡æœ‰å°†ETCDæ”¾åœ¨Masterå¤–çš„æœºå™¨ä¸Šï¼Œè€Œæ˜¯ä½¿ç”¨é»˜è®¤çš„æ¶æ„ï¼Œå³å®˜æ–¹çš„ Stacked etcd topology æ–¹å¼çš„é›†ç¾¤</p><p><img src=https://92uu-blog.oss-cn-beijing.aliyuncs.com/2020-03-25-091655.png alt></p><p>ä½ éœ€è¦è‡³å°‘ 3 å° Master èŠ‚ç‚¹å’Œ 3 å° Worker èŠ‚ç‚¹ï¼Œæˆ–è€…æ›´å¤šçš„æœºå™¨ï¼Œä½†è¦ä¿è¯æ˜¯ Master å’Œ Worker èŠ‚ç‚¹æ•°éƒ½æ˜¯å¥‡æ•°çš„ï¼Œä»¥é˜²æ­¢ leader é€‰ä¸¾æ—¶å‡ºç°è„‘è£‚çŠ¶å†µã€‚</p><table><thead><tr><th>æœºå™¨åç§°</th><th>æœºå™¨IP</th><th>å·¥ä½œå†…å®¹</th></tr></thead><tbody><tr><td>master01</td><td>192.168.115.49</td><td>masterã€etcd</td></tr><tr><td>master02</td><td>192.168.115.41</td><td>masterã€etcd</td></tr><tr><td>master03</td><td>192.168.115.42</td><td>masterã€etcd</td></tr><tr><td>node01</td><td>192.168.115.46</td><td>worker</td></tr><tr><td>node02</td><td>192.168.115.47</td><td>worker</td></tr><tr><td>node03</td><td>192.168.115.48</td><td>worker</td></tr><tr><td>nfs</td><td>192.168.115.50</td><td>å­˜å‚¨</td></tr></tbody></table><h2 id=52é«˜å¯ç”¨æ‰©å±•>5.2ã€é«˜å¯ç”¨æ‰©å±•</h2><p>Kubernetes çš„é«˜å¯ç”¨æ‰©å±•å…¶å®æŒºç®€å•ï¼Œä½ åªéœ€è¦å°†ä¸åŒçš„ Master å’Œ Worker èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­å°±è¡Œäº†ã€‚åŠ å…¥çš„æŒ‡ä»¤åœ¨ä½ åˆå§‹åŒ–é›†ç¾¤æ—¶å·²ç»ç»™å‡ºäº†ã€‚</p><ul><li>æ·»åŠ  Master èŠ‚ç‚¹ï¼š</li></ul><p>éœ€è¦è‡³å°‘ 2 ä¸ª CPU æ ¸å¿ƒï¼Œå¦åˆ™ä¼šæŠ¥é”™</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm join kuber4s.api:6443 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> --token 1hk9bc.oz7f3lmtbzf15x9b <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> --discovery-token-ca-cert-hash sha256:5e8bcad5ec97c1025e8044f4b8fd0a4514ecda4bac2b3944f7f39ccae9e4921f <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span> --control-plane --certificate-key 5253fc7e9a4e6204d0683ed2d60db336b3ff64ddad30ba59b4c0bf40d8ccadcd
</span></span></code></pre></div><ul><li>æ·»åŠ  Worker èŠ‚ç‚¹</li></ul><p>åœ¨ Worker èŠ‚ç‚¹ä¸Šé‡æ–°æ‰§è¡ŒåŠ å…¥é›†ç¾¤å‘½ä»¤</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm join kuber4s.api:6443 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--token 1hk9bc.oz7f3lmtbzf15x9b <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--discovery-token-ca-cert-hash sha256:5e8bcad5ec97c1025e8044f4b8fd0a4514ecda4bac2b3944f7f39ccae9e4921f
</span></span></code></pre></div><h1 id=å…­å®‰è£…-kubesphere>å…­ã€å®‰è£… KubeSphere</h1><h2 id=61kubesphereç®€ä»‹>6.1ã€KubeSphereç®€ä»‹</h2><p>Kubernetes å®˜æ–¹æœ‰æä¾›ä¸€å¥— Dashboardï¼Œä½†æ˜¯æˆ‘è¿™é‡Œé€‰æ‹©åŠŸèƒ½æ›´å¼ºå¤§çš„ KubeSphereï¼Œä»¥ä¸‹å†…å®¹å¼•ç”¨è‡ª KubeSphere å®˜ç½‘ï¼š</p><p><a href=https://kubesphere.com.cn/docs/zh-CN/ target=_blank rel="noopener noreferrer">KubeSphere</a> æ˜¯åœ¨ <a href=https://kubernetes.io/ target=_blank rel="noopener noreferrer">Kubernetes</a> ä¹‹ä¸Šæ„å»ºçš„ä»¥åº”ç”¨ä¸ºä¸­å¿ƒçš„å®¹å™¨å¹³å°ï¼Œæä¾›ç®€å•æ˜“ç”¨çš„æ“ä½œç•Œé¢ä»¥åŠå‘å¯¼å¼æ“ä½œæ–¹å¼ï¼Œåœ¨é™ä½ç”¨æˆ·ä½¿ç”¨å®¹å™¨è°ƒåº¦å¹³å°å­¦ä¹ æˆæœ¬çš„åŒæ—¶ï¼Œæå¤§å‡è½»å¼€å‘ã€æµ‹è¯•ã€è¿ç»´çš„æ—¥å¸¸å·¥ä½œçš„å¤æ‚åº¦ï¼Œæ—¨åœ¨è§£å†³ Kubernetes æœ¬èº«å­˜åœ¨çš„å­˜å‚¨ã€ç½‘ç»œã€å®‰å…¨å’Œæ˜“ç”¨æ€§ç­‰ç—›ç‚¹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¹³å°å·²ç»æ•´åˆå¹¶ä¼˜åŒ–äº†å¤šä¸ªé€‚ç”¨äºå®¹å™¨åœºæ™¯çš„åŠŸèƒ½æ¨¡å—ï¼Œä»¥å®Œæ•´çš„è§£å†³æ–¹æ¡ˆå¸®åŠ©ä¼ä¸šè½»æ¾åº”å¯¹æ•æ·å¼€å‘ä¸è‡ªåŠ¨åŒ–è¿ç»´ã€DevOpsã€å¾®æœåŠ¡æ²»ç†ã€ç°åº¦å‘å¸ƒã€å¤šç§Ÿæˆ·ç®¡ç†ã€å·¥ä½œè´Ÿè½½å’Œé›†ç¾¤ç®¡ç†ã€ç›‘æ§å‘Šè­¦ã€æ—¥å¿—æŸ¥è¯¢ä¸æ”¶é›†ã€æœåŠ¡ä¸ç½‘ç»œã€åº”ç”¨å•†åº—ã€é•œåƒæ„å»ºä¸é•œåƒä»“åº“ç®¡ç†å’Œå­˜å‚¨ç®¡ç†ç­‰å¤šç§åœºæ™¯ã€‚åç»­ç‰ˆæœ¬å°†æä¾›å’Œæ”¯æŒå¤šé›†ç¾¤ç®¡ç†ã€å¤§æ•°æ®ã€AI ç­‰åœºæ™¯ã€‚</p><p><img src=https://pek3b.qingstor.com/kubesphere-docs/png/20200327114511.png alt></p><h2 id=62å®‰è£…è¦æ±‚>6.2ã€å®‰è£…è¦æ±‚</h2><p>KubeSphere æ”¯æŒç›´æ¥åœ¨ Linux ä¸Šéƒ¨ç½²é›†ç¾¤ï¼Œä¹Ÿæ”¯æŒåœ¨ Kubernetes ä¸Šéƒ¨ç½²ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©åè€…ï¼ŒåŸºæœ¬çš„è¦æ±‚å¦‚ä¸‹ï¼š</p><ul><li><code>Kubernetes</code> ç‰ˆæœ¬ï¼š<code>1.15.x â‰¤ K8s version â‰¤ 1.17.x</code>ï¼›</li><li><code>Helm</code> ç‰ˆæœ¬ï¼š<code>2.10.0 â‰¤ Helm Version ï¼œ 3.0.0</code>ï¼ˆä¸æ”¯æŒ helm 2.16.0<a href=https://github.com/helm/helm/issues/6894 target=_blank rel="noopener noreferrer">#6894</a>ï¼‰ï¼Œä¸”å·²å®‰è£…äº† Tillerï¼Œå‚è€ƒ <a href=https://devopscube.com/install-configure-helm-kubernetes/ target=_blank rel="noopener noreferrer">å¦‚ä½•å®‰è£…ä¸é…ç½® Helm</a>ï¼ˆé¢„è®¡ 3.0 æ”¯æŒ Helm v3ï¼‰ï¼›</li><li>é›†ç¾¤å·²æœ‰é»˜è®¤çš„å­˜å‚¨ç±»å‹ï¼ˆStorageClassï¼‰ï¼Œè‹¥è¿˜æ²¡æœ‰å‡†å¤‡å­˜å‚¨è¯·å‚è€ƒ<a href=https://kubesphere.com.cn/docs/zh-CN/appendix/install-openebs target=_blank rel="noopener noreferrer">å®‰è£… OpenEBS åˆ›å»º LocalPV å­˜å‚¨ç±»å‹</a>ç”¨ä½œå¼€å‘æµ‹è¯•ç¯å¢ƒã€‚</li><li>é›†ç¾¤èƒ½å¤Ÿè®¿é—®å¤–ç½‘ï¼Œè‹¥æ— å¤–ç½‘è¯·å‚è€ƒ <a href=https://kubesphere.com.cn/docs/installation/install-on-k8s-airgapped/ target=_blank rel="noopener noreferrer">åœ¨ Kubernetes ç¦»çº¿å®‰è£… KubeSphere</a>ã€‚</li></ul><h2 id=63å®‰è£…-helm>6.3ã€å®‰è£… Helm</h2><h3 id=631helm-ç®€ä»‹>6.3.1ã€Helm ç®€ä»‹</h3><p>Helm åŸºæœ¬æ€æƒ³å¦‚å›¾æ‰€ç¤º</p><p><img src=https://92uu-blog.oss-cn-beijing.aliyuncs.com/2020-03-25-095440.png alt></p><p>ä»¥ä¸‹å†…å®¹å¼•ç”¨è‡ª <a href=https://blog.csdn.net/weixin_30566063/article/details/99247145 target=_blank rel="noopener noreferrer">æ­¤ç¯‡æ–‡ç« </a></p><p><strong>Helm åŸºæœ¬æ¦‚å¿µ</strong></p><p>Helm å¯ä»¥ç†è§£ä¸º Kubernetes çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å‘ç°ã€å…±äº«å’Œä½¿ç”¨ä¸ºKubernetesæ„å»ºçš„åº”ç”¨ï¼Œå®ƒåŒ…å«å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ul><li>Chartï¼šä¸€ä¸ª Helm åŒ…ï¼Œå…¶ä¸­åŒ…å«äº†è¿è¡Œä¸€ä¸ªåº”ç”¨æ‰€éœ€è¦çš„é•œåƒã€ä¾èµ–å’Œèµ„æºå®šä¹‰ç­‰ï¼Œè¿˜å¯èƒ½åŒ…å« Kubernetes é›†ç¾¤ä¸­çš„æœåŠ¡å®šä¹‰</li><li>Release: åœ¨ Kubernetes é›†ç¾¤ä¸Šè¿è¡Œçš„ Chart çš„ä¸€ä¸ªå®ä¾‹ã€‚åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸Šï¼Œä¸€ä¸ª Chart å¯ä»¥å®‰è£…å¾ˆå¤šæ¬¡ã€‚æ¯æ¬¡å®‰è£…éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ releaseã€‚ä¾‹å¦‚ä¸€ä¸ª MySQL Chartï¼Œå¦‚æœæƒ³åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä¸¤ä¸ªæ•°æ®åº“ï¼Œå°±å¯ä»¥æŠŠè¿™ä¸ª Chart å®‰è£…ä¸¤æ¬¡ã€‚æ¯æ¬¡å®‰è£…éƒ½ä¼šç”Ÿæˆè‡ªå·±çš„ Releaseï¼Œä¼šæœ‰è‡ªå·±çš„ Release åç§°ã€‚</li><li>Repositoryï¼šç”¨äºå‘å¸ƒå’Œå­˜å‚¨ Chart çš„ä»“åº“ã€‚</li></ul><h3 id=632helmå®‰è£…>6.3.2ã€Helmå®‰è£…</h3><p>å®‰è£…è¿‡ç¨‹å¦‚ä¸‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºéƒ¨ç½²ç›®å½•å¹¶ä¸‹è½½Helm</span>
</span></span><span style=display:flex><span>mkdir tiller
</span></span><span style=display:flex><span>cd tiller
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…ˆä½¿ç”¨å®˜æ–¹çš„æ–¹å¼å®‰è£…ï¼Œå¦‚æœå®‰è£…ä¸äº†ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹è½½æ–‡ä»¶çš„åœ°å€ï¼Œç„¶åæ‰‹åŠ¨ä¸‹è½½è§£å‹</span>
</span></span><span style=display:flex><span>curl -L https://git.io/get_helm.sh | bash
</span></span><span style=display:flex><span><span style=color:#75715e># è·å–åˆ°ä¸‹è½½åœ°å€åï¼Œæƒ³åŠæ³•ä¸‹è½½</span>
</span></span><span style=display:flex><span>wget https://get.helm.sh/helm-v2.16.3-linux-amd64.tar.gz
</span></span><span style=display:flex><span>tar zxf helm-v2.16.3-linux-amd64.tar.gz
</span></span><span style=display:flex><span>mv linux-amd64/helm /usr/local/bin/helm
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éªŒè¯</span>
</span></span><span style=display:flex><span>helm version
</span></span></code></pre></div><p>éƒ¨ç½² Tillerï¼Œå³ Helm çš„æœåŠ¡ç«¯ã€‚å…ˆåˆ›å»º SA</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># yamlæ–‡ä»¶å¦‚ä¸‹</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>$ cat /root/tiller/helm-rbac.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ServiceAccount</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span> <span style=color:#f92672>name</span>: <span style=color:#ae81ff>tiller</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>kube-system</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterRoleBinding</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span> <span style=color:#f92672>name</span>: <span style=color:#ae81ff>tiller</span>
</span></span><span style=display:flex><span><span style=color:#f92672>roleRef</span>:
</span></span><span style=display:flex><span> <span style=color:#f92672>apiGroup</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterRole</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cluster-admin</span>
</span></span><span style=display:flex><span><span style=color:#f92672>subjects</span>:
</span></span><span style=display:flex><span> - <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ServiceAccount</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>name</span>: <span style=color:#ae81ff>tiller</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>kube-system</span>
</span></span></code></pre></div><p>åˆ›å»º RBACï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f helm-rbac.yaml
</span></span></code></pre></div><p>åˆå§‹åŒ–ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¸ä¼šæˆåŠŸï¼Œå…·ä½“æ¥ç€å¾€ä¸‹çœ‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm init --service-account<span style=color:#f92672>=</span>tiller --history-max <span style=color:#ae81ff>300</span>
</span></span></code></pre></div><p>æ£€æŸ¥åˆå§‹åŒ–çš„æƒ…å†µï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼Œå¢™å†…ç”¨æˆ·çœ‹podè¯¦æƒ…å¯ä»¥çœ‹åˆ°è·å–ä¸åˆ°é•œåƒçš„é”™è¯¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get deployment tiller-deploy -n kube-system
</span></span></code></pre></div><p>å¦‚æœä¸€ç›´è·å–ä¸åˆ°é•œåƒï¼Œå¯ä»¥é€šè¿‡æ›´æ¢åˆ°Azureä¸­å›½é•œåƒæºæ¥è§£å†³ï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ç¼–è¾‘ deploy</span>
</span></span><span style=display:flex><span>kubectl edit deploy tiller-deploy -n kube-system
</span></span><span style=display:flex><span><span style=color:#75715e># æŸ¥æ‰¾åˆ°imageåœ°å€ï¼Œæ›¿æ¢ä¸ºå¦‚ä¸‹åœ°å€ï¼Œä¿å­˜é€€å‡º</span>
</span></span><span style=display:flex><span>gcr.azk8s.cn/kubernetes-helm/tiller:v2.16.3
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ç¨ç­‰ç‰‡åˆ»ï¼Œå†æ¬¡æŸ¥çœ‹deploymentå’Œpodè¯¦æƒ…ï¼Œå°±æ­£å¸¸äº†</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get deployment tiller-deploy -n kube-system
</span></span></code></pre></div><h2 id=64å®‰è£…-storageclass>6.4ã€å®‰è£… StorageClass</h2><p>Kubernetes æ”¯æŒå¤šç§ StorageClassï¼Œæˆ‘è¿™é€‰æ‹© NFS ä½œä¸ºé›†ç¾¤çš„ StorageClassã€‚</p><p>å‚è€ƒåœ°å€ï¼š<a href=https://github.com/kubernetes-incubator/external-storage/tree/master/nfs-client target=_blank rel="noopener noreferrer">https://github.com/kubernetes-incubator/external-storage/tree/master/nfs-client</a></p><h3 id=641ä¸‹è½½æ‰€éœ€æ–‡ä»¶>6.4.1ã€ä¸‹è½½æ‰€éœ€æ–‡ä»¶</h3><p>ä¸‹è½½æ‰€éœ€æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œå†…å®¹è°ƒæ•´</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir nfsvolume <span style=color:#f92672>&amp;&amp;</span> cd nfsvolume
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> file in class.yaml deployment.yaml rbac.yaml ; <span style=color:#66d9ef>do</span> wget https://raw.githubusercontent.com/kubernetes-incubator/external-storage/master/nfs-client/deploy/$file ; <span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p>ä¿®æ”¹ deployment.yaml ä¸­çš„ä¸¤å¤„ NFS æœåŠ¡å™¨ IP å’Œç›®å½•</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>...
</span></span><span style=display:flex><span>          <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>PROVISIONER_NAME</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>value</span>: <span style=color:#ae81ff>fuseim.pri/ifs</span>
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>NFS_SERVER</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>value</span>: <span style=color:#ae81ff>192.168.115.50</span>
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>NFS_PATH</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>value</span>: <span style=color:#ae81ff>/data/k8s</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nfs-client-root</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>nfs</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>server</span>: <span style=color:#ae81ff>192.168.115.50</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/data/k8s</span>
</span></span></code></pre></div><h2 id=642éƒ¨ç½²åˆ›å»º>6.4.2ã€éƒ¨ç½²åˆ›å»º</h2><p>å…·ä½“çš„è¯´æ˜å¯ä»¥å»å®˜ç½‘æŸ¥çœ‹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create -f rbac.yaml
</span></span><span style=display:flex><span>kubectl create -f class.yaml
</span></span><span style=display:flex><span>kubectl create -f deployment.yaml
</span></span></code></pre></div><p>å¦‚æœæ—¥å¿—ä¸­çœ‹åˆ°â€œä¸Šæœ‰åè¶…çº§å—â€ï¼Œè¯·åœ¨é›†ç¾¤å†…æ‰€æœ‰æœºå™¨ä¸Šå®‰è£…nfs-utilså¹¶å¯åŠ¨ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum -y install nfs-utils
</span></span><span style=display:flex><span>systemctl start nfs-utils
</span></span><span style=display:flex><span>systemctl enable nfs-utils
</span></span><span style=display:flex><span>rpcinfo -p
</span></span></code></pre></div><p>æŸ¥çœ‹storageclass</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get storageclass
</span></span><span style=display:flex><span>NAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGE
</span></span><span style=display:flex><span>managed-nfs-storage fuseim.pri/ifs Delete Immediate false 10m
</span></span></code></pre></div><h3 id=643æ ‡è®°ä¸€ä¸ªé»˜è®¤çš„-storageclass>6.4.3ã€æ ‡è®°ä¸€ä¸ªé»˜è®¤çš„ StorageClass</h3><p>æ“ä½œå‘½ä»¤æ ¼å¼å¦‚ä¸‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl patch storageclass  -p <span style=color:#e6db74>&#39;{&#34;metadata&#34;: {&#34;annotations&#34;:{&#34;storageclass.kubernetes.io/is-default-class&#34;:&#34;true&#34;}}}&#39;</span>
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œæœ€å¤šåªèƒ½æœ‰ä¸€ä¸ª StorageClass èƒ½å¤Ÿè¢«æ ‡è®°ä¸ºé»˜è®¤ã€‚</p><p>éªŒè¯æ ‡è®°æ˜¯å¦æˆåŠŸ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get storageclass
</span></span><span style=display:flex><span>NAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGE
</span></span><span style=display:flex><span>managed-nfs-storage <span style=color:#f92672>(</span>default<span style=color:#f92672>)</span> fuseim.pri/ifs Delete Immediate false 12m
</span></span></code></pre></div><h2 id=65éƒ¨ç½²-kubesphere>6.5ã€éƒ¨ç½² KubeSphere</h2><p>è¿‡ç¨‹å¾ˆç®€å•ï¼Œå¦‚æœä½ çš„æœºå™¨èµ„æºè¶³å¤Ÿï¼Œå»ºè®®ä½ è¿›è¡Œå®Œæ•´å®‰è£…ï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ã€‚å¦‚æœä½ çš„èµ„æºä¸æ˜¯å¾ˆå……è¶³ï¼Œåˆ™å¯ä»¥è¿›è¡Œæœ€å°åŒ–å®‰è£…ï¼Œ<a href=https://kubesphere.com.cn/docs/zh-CN/installation/prerequisites/ target=_blank rel="noopener noreferrer">å‚è€ƒåœ°å€</a>ã€‚æˆ‘å½“ç„¶æ˜¯é€‰æ‹©å®Œæ•´å®‰è£…äº†ï¼Œé¦™ï¼</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ä¸‹è½½ yaml æ–‡ä»¶</span>
</span></span><span style=display:flex><span>mkdir kubesphere <span style=color:#f92672>&amp;&amp;</span> cd kubesphere
</span></span><span style=display:flex><span>wget https://raw.githubusercontent.com/kubesphere/ks-installer/master/kubesphere-complete-setup.yaml
</span></span><span style=display:flex><span><span style=color:#75715e># éƒ¨ç½² KubeSphere</span>
</span></span><span style=display:flex><span>kubectl apply -f kubesphere-complete-setup.yaml
</span></span></code></pre></div><p>è¿™ä¸ªè¿‡ç¨‹æ ¹æ®ä½ å®é™…ç½‘é€Ÿï¼Œå®é™…ä½¿ç”¨æ—¶é—´é•¿åº¦æœ‰æ‰€ä¸åŒã€‚ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å®æ—¶çš„æ—¥å¿—è¾“å‡ºã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl logs -n kubesphere-system <span style=color:#66d9ef>$(</span>kubectl get pod -n kubesphere-system -l app<span style=color:#f92672>=</span>ks-install -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.items[0].metadata.name}&#39;</span><span style=color:#66d9ef>)</span> -f
</span></span></code></pre></div><p>å½“ä½ çœ‹åˆ°å¦‚ä¸‹æ—¥å¿—è¾“å‡ºï¼Œè¯æ˜ä½ çš„ KubeSphere éƒ¨ç½²æˆåŠŸ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>**************************************************
</span></span><span style=display:flex><span>task monitoring status is successful
</span></span><span style=display:flex><span>task notification status is successful
</span></span><span style=display:flex><span>task devops status is successful
</span></span><span style=display:flex><span>task alerting status is successful
</span></span><span style=display:flex><span>task logging status is successful
</span></span><span style=display:flex><span>task openpitrix status is successful
</span></span><span style=display:flex><span>task servicemesh status is successful
</span></span><span style=display:flex><span>total: <span style=color:#ae81ff>7</span>     completed:7
</span></span><span style=display:flex><span>**************************************************
</span></span><span style=display:flex><span><span style=color:#75715e>#####################################################</span>
</span></span><span style=display:flex><span><span style=color:#75715e>###              Welcome to KubeSphere!           ###</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#####################################################</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Console: http://192.168.115.49:30880
</span></span><span style=display:flex><span>Account: admin
</span></span><span style=display:flex><span>Password: P@88w0rd
</span></span><span style=display:flex><span><span style=color:#75715e>#####################################################</span>
</span></span></code></pre></div><p>ç¡®è®¤ Pod éƒ½æ­£å¸¸è¿è¡Œåï¼Œå¯ä½¿ç”¨<code>IP:30880</code>è®¿é—® KubeSphere UI ç•Œé¢ï¼Œé»˜è®¤çš„é›†ç¾¤ç®¡ç†å‘˜è´¦å·ä¸º<code>admin/P@88w0rd</code>ï¼ŒEnjoy itï¼ŒğŸ˜ï¼</p><p><img src=https://92uu-blog.oss-cn-beijing.aliyuncs.com/2020-03-25-103029.png alt></p><p><img src=https://92uu-blog.oss-cn-beijing.aliyuncs.com/2020-03-25-145648.png alt></p><h2 id=å‚è€ƒ>å‚è€ƒ</h2><p>æœ¬æ–‡å‡ºå¤„ Segmentfaultï¼š<code>https://segmentfault.com/a/1190000022146020</code></p></div></div><div class=share-2><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-kubesphere-ha%2f&text=%e6%89%8b%e6%8a%8a%e6%89%8b%e4%bb%8e%e9%9b%b6%e9%83%a8%e7%bd%b2%e4%b8%8e%e8%bf%90%e8%90%a5%e7%94%9f%e4%ba%a7%e7%ba%a7%e7%9a%84%20Kubernetes%20%e9%9b%86%e7%be%a4%e4%b8%8e%20KubeSphere" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-kubesphere-ha%2f&title=%e6%89%8b%e6%8a%8a%e6%89%8b%e4%bb%8e%e9%9b%b6%e9%83%a8%e7%bd%b2%e4%b8%8e%e8%bf%90%e8%90%a5%e7%94%9f%e4%ba%a7%e7%ba%a7%e7%9a%84%20Kubernetes%20%e9%9b%86%e7%be%a4%e4%b8%8e%20KubeSphere" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-kubesphere-ha%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-kubesphere-ha%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fkubernetes-kubesphere-ha%2f&t=%e6%89%8b%e6%8a%8a%e6%89%8b%e4%bb%8e%e9%9b%b6%e9%83%a8%e7%bd%b2%e4%b8%8e%e8%bf%90%e8%90%a5%e7%94%9f%e4%ba%a7%e7%ba%a7%e7%9a%84%20Kubernetes%20%e9%9b%86%e7%be%a4%e4%b8%8e%20KubeSphere" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div></div><div class=aside><div class=inner-div><div class=title>ç›®å½•</div><div class=tabs><nav id=TableOfContents><ul><li><a href=#ä¸€å‡†å¤‡ç¯å¢ƒ>ä¸€ã€å‡†å¤‡ç¯å¢ƒ</a></li></ul><ul><li><a href=#21å®‰è£…-docker>2.1ã€å®‰è£… Docker</a></li><li><a href=#22ä¿®æ”¹-cgroup-driver>2.2ã€ä¿®æ”¹ Cgroup Driver</a></li></ul><ul><li><a href=#31å®‰è£…å‡†å¤‡>3.1ã€å®‰è£…å‡†å¤‡</a></li><li><a href=#32å¼€å§‹å®‰è£…>3.2ã€å¼€å§‹å®‰è£…</a></li></ul><ul><li><a href=#41åˆå§‹åŒ–-control-planemaster-èŠ‚ç‚¹>4.1ã€åˆå§‹åŒ– Control-plane/Master èŠ‚ç‚¹</a></li><li><a href=#42å®‰è£…-pod-ç½‘ç»œé™„åŠ ç»„ä»¶>4.2ã€å®‰è£… Pod ç½‘ç»œé™„åŠ ç»„ä»¶</a></li><li><a href=#43å°†-worker-èŠ‚ç‚¹æ·»åŠ åˆ°-kubernetes>4.3ã€å°† Worker èŠ‚ç‚¹æ·»åŠ åˆ° Kubernetes</a></li><li><a href=#44æ·»åŠ -master-èŠ‚ç‚¹>4.4ã€æ·»åŠ  Master èŠ‚ç‚¹</a></li><li><a href=#45è¡¥å……å†…å®¹>4.5ã€è¡¥å……å†…å®¹</a></li></ul><ul><li><a href=#51ç¯å¢ƒè¯´æ˜>5.1ã€ç¯å¢ƒè¯´æ˜</a></li><li><a href=#52é«˜å¯ç”¨æ‰©å±•>5.2ã€é«˜å¯ç”¨æ‰©å±•</a></li></ul><ul><li><a href=#61kubesphereç®€ä»‹>6.1ã€KubeSphereç®€ä»‹</a></li><li><a href=#62å®‰è£…è¦æ±‚>6.2ã€å®‰è£…è¦æ±‚</a></li><li><a href=#63å®‰è£…-helm>6.3ã€å®‰è£… Helm</a><ul><li><a href=#631helm-ç®€ä»‹>6.3.1ã€Helm ç®€ä»‹</a></li><li><a href=#632helmå®‰è£…>6.3.2ã€Helmå®‰è£…</a></li></ul></li><li><a href=#64å®‰è£…-storageclass>6.4ã€å®‰è£… StorageClass</a><ul><li><a href=#641ä¸‹è½½æ‰€éœ€æ–‡ä»¶>6.4.1ã€ä¸‹è½½æ‰€éœ€æ–‡ä»¶</a></li></ul></li><li><a href=#642éƒ¨ç½²åˆ›å»º>6.4.2ã€éƒ¨ç½²åˆ›å»º</a><ul><li><a href=#643æ ‡è®°ä¸€ä¸ªé»˜è®¤çš„-storageclass>6.4.3ã€æ ‡è®°ä¸€ä¸ªé»˜è®¤çš„ StorageClass</a></li></ul></li><li><a href=#65éƒ¨ç½²-kubesphere>6.5ã€éƒ¨ç½² KubeSphere</a></li><li><a href=#å‚è€ƒ>å‚è€ƒ</a></li></ul></nav></div></div></div></div></section><div class=SubscribeForm><div class=innerBox><img class=close src=/images/home/close.svg alt=close><p class=description>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=blog_formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input-blog type=text placeholder>
<button id=email-submit-blog>è®¢é˜…</button>
<span id=message_blog data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨ style=color:red></span><span id=message1_blog style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span></div></div></div><footer><div class=footer><div class="footer-main common-layout"><div class=up-main><div class=left-div><img src=/images/logo.svg alt class=foot-logo><p>é€šè¿‡é‚®ä»¶æ¥æ”¶ KubeSphere æœ€æ–°çš„æŠ€æœ¯åšå®¢ä¸äº§å“æ›´æ–°çš„é€šçŸ¥</p><div id=formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input type=text placeholder=è¯·è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€>
<button id=email-submit>è®¢é˜…</button></div><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€! data-message3=é‚®ç®±åœ°å€å·²ç»å­˜åœ¨></span><span id=message1 style=color:#00a971 data-success=è®¢é˜…æˆåŠŸå•¦ï¼Œæˆ‘ä»¬ä¿è¯ä¸ä¼šç»™ä½ å‘åƒåœ¾é‚®ä»¶çš„å•¦></span><script>var bindSubmit=function(){var e=$("#email-input");$("#email-submit").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message").data("message1"),a=$("#message").data("message2"),r=$("#message").data("message3"),c=$("#message1").data("success");if(n)if(validateEmail(n)){if(s=$("#formAddress").data("usesendcloud"),!s)return;o=$("#formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:$("#email-input").val().toString()},success:function(){showSuccessMessage(c),setTimeout(function(){$("#email-input").val("")},1e3)},error:function(){showMessage(r)}})}else t.preventDefault(),showMessage(a);else t.preventDefault(),showMessage(i)})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},showMessage=function(e){$("#message").html(e).show()},showSuccessMessage=function(e){$("#message1").html(e).show()},bindHideMessage=function(){$(window).click(function(){$("#message").hide(),$("#message1").hide()})},bindClose=function(){$(".formBox .close").click(function(e){e.stopPropagation(),$(".formBox").fadeOut()})};bindSubmit(),bindClose(),bindHideMessage()</script><span id=message data-message1=è¯·æä¾›æ‚¨çš„é‚®ç®± data-message2=è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€!></span></div><div class=right-div><ul class=common-flex-layout><li class=nowrap-li><div class=h3>åº”ç”¨åœºæ™¯</div><a href=/zh/devops/>æ‹¥æŠ±ä¸€ç«™å¼ DevOps</a>
<a href=/zh/service-mesh/>åœ¨ K8s è¿è¡Œå¾®æœåŠ¡</a>
<a href=/zh/observability/>æ„å»ºäº‘åŸç”Ÿå¯è§‚æµ‹æ€§</a>
<a href=https://github.com/kubesphere/kubekey target=_blank rel="noopener noreferrer">K8s ä¸€é”®éƒ¨ç½²ä¸è¿ç»´</a>
<a href=https://github.com/OpenFunction/OpenFunction target=_blank rel="noopener noreferrer">æ„å»º FaaS å¹³å°ä¸ Serverless æ¶æ„</a>
<a href=https://github.com/openpitrix/openpitrix target=_blank rel="noopener noreferrer">å¤šäº‘åº”ç”¨ç®¡ç†å¹³å°</a></li><li class=nowrap-li><div class=h3>èµ„æº</div><a href=/zh/projects/>å¼€æºé¡¹ç›®</a>
<a href=/zh/blogs/>æŠ€æœ¯åšå®¢</a>
<a href=/zh/conferences/>å¼€æºå³°ä¼š</a>
<a href=/zh/videos/>è§†é¢‘èµ„æº</a>
<a href=/zh/learn/>äº‘åŸç”Ÿå®æˆ˜</a></li><li class=nowrap-li><div class=h3>æ–‡æ¡£ä¸­å¿ƒ</div><a href=/zh/docs/v4.1/01-intro/01-introduction/>äº§å“ä»‹ç»</a>
<a href=/zh/docs/v4.1/03-installation-and-upgrade/02-install-kubesphere/02-install-kubernetes-and-kubesphere/>å¦‚ä½•å®‰è£…</a>
<a href=/zh/docs/v4.1/02-quickstart/>å¿«é€Ÿå…¥é—¨</a>
<a href=/zh/docs/v3.4/reference/api-docs/>API æ–‡æ¡£</a></li><li class=nowrap-li><div class=h3>å¼€æºç¤¾åŒº</div><a href=/zh/contribution/>å‚ä¸è´¡çŒ®</a>
<a href=/zh/live/>ç¤¾åŒºæ´»åŠ¨</a>
<a href=/zh/case/>æ¡ˆä¾‹å­¦ä¹ </a>
<a href=/zh/partner/>åˆä½œä¼™ä¼´</a>
<a href=/zh/user-group/>ç”¨æˆ·å§”å‘˜ä¼š</a>
<a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">ç‰ˆæœ¬è®¡åˆ’</a>
<a href=https://kubesphere.com.cn/ target=_blank rel="noopener noreferrer">ä¸­å›½ç«™</a>
<a href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">ä¸­æ–‡è®ºå›</a>
<a href=https://kubesphere.io target=_blank rel="noopener noreferrer">å…¨çƒç«™</a></li><li class=nowrap-li><div class=h3>äº§å“ä¸æœåŠ¡</div><a href=https://aws.amazon.com/cn/quickstart/architecture/qingcloud-kubesphere/ target=_blank rel="noopener noreferrer">KubeSphere on AWS</a>
<a href=https://market.azure.cn/marketplace/apps/qingcloud.kubesphere target=_blank rel="noopener noreferrer">KubeSphere on Azure</a>
<a href=https://marketplace.digitalocean.com/apps/kubesphere target=_blank rel="noopener noreferrer">KubeSphere on DigitalOcean</a>
<a href=https://www.qingcloud.com/products/kubesphereqke target=_blank rel="noopener noreferrer">KubeSphere on QingCloud(QKE)</a>
<a href=https://kubesphere.com.cn/kse/ target=_blank rel="noopener noreferrer">KubeSphere ä¼ä¸šç‰ˆ</a>
<a href=https://kubesphere.cloud/ksv/ target=_blank rel="noopener noreferrer">KubeSphere è™šæ‹ŸåŒ–å¹³å°</a>
<a href=https://kubesphere.com.cn/marketplace/ target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿæ‰©å±•ç»„ä»¶å¸‚åœº</a>
<a href=https://kubesphere.cloud target=_blank rel="noopener noreferrer">äº‘åŸç”Ÿåº”ç”¨æœåŠ¡å¹³å°</a>
<a href=https://m.qingcloud.com/p/aec50 target=_blank rel="noopener noreferrer">äº†è§£å•†ä¸šäº§å“ä¸å’¨è¯¢åˆä½œ</a></li></ul></div></div><div class=down-main><div class=img-div><a class=wechat href=javascript:void(0); aria-label=wechat><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28"><defs><path id="a" d="M0 0h15.673v12.156H0z"/></defs><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="13" cy="13" r="13" stroke="#B6C2CD"/><g transform="translate(5 7)"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59.0-4.625 1.679-4.625 3.74.0 2.066 2.035 3.738 4.625 3.738.542.0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27.0-.541-.257-.541-.514.0-.256.27-.514.541-.514.41.0.681.258.681.514.0.257-.271.514-.681.514zm2.994.0c-.27.0-.541-.257-.541-.514.0-.256.27-.514.54-.514.41.0.681.258.681.514.0.257-.277.514-.68.514z" mask="url(#b)"/><path fill="currentColor" d="M10.602 3.674c.177.0.356.011.533.029C10.657 1.576 8.27.0 5.543.0 2.498.0.0 1.974.0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17.0.343-.005.515-.022a3.68 3.68.0 01-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417.0.693.263.693.66s-.276.66-.693.66c-.418.0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417.0-.834-.263-.834-.66s.417-.66.834-.66c.418.0.695.263.695.66.0.392-.277.66-.695.66z" mask="url(#b)"/></g></g></svg><div class=hide-div><img src=/images/home/wechat.svg alt></div></a><a class=facebook-a href=https://www.facebook.com/kubesphere target=_blank aria-label=facebook></a><a class=twitter-a href=https://x.com/KubeSphere target=_blank aria-label=twitter rel="noopener noreferrer"></a><a class=linkedin-a href=https://www.linkedin.com/company/kubesphere/ target=_blank aria-label=linkedin rel="noopener noreferrer"></a><a class=bilibili-a href=https://space.bilibili.com/438908638 target=_blank aria-label=bilibili rel="noopener noreferrer"></a><a class=slack-a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank aria-label=slack rel="noopener noreferrer"></a><a class=github-a href=https://github.com/kubesphere/kubesphere target=_blank aria-label=github rel="noopener noreferrer"></a><a class=medium-a href=https://itnext.io/@kubesphere target=_blank aria-label=medium rel="noopener noreferrer"></a></div><p class=p1></p><p class=case><a href=http://www.beian.miit.gov.cn/ target=_blank rel="noopener noreferrer"><span>äº¬ICPå¤‡13019086å·</span>
</a><a target=_blank rel="noopener noreferrer" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502041003"><img src=/images/footer/case-icon.png alt=å¤‡æ¡ˆå›¾æ ‡>
<span>äº¬å…¬ç½‘å®‰å¤‡ 11010502041003å·</span></a></p></div></div></div><div class=cookie><div class=common-layout><p>æ‚¨çš„éšç§å¯¹æˆ‘ä»¬å¾ˆé‡è¦ã€‚æˆ‘ä»¬ä½¿ç”¨Cookieæ¥è®°ä½è®¢é˜…è¯¦ç»†ä¿¡æ¯ï¼Œä¼˜åŒ–ç½‘ç«™åŠŸèƒ½å¹¶äº¤ä»˜æ ¹æ®æ‚¨çš„å…´è¶£é‡èº«å®šåˆ¶çš„å†…å®¹ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„<a href=/zh/privacy>éšç§æ”¿ç­–</a>.</p><button>
æ¥å—å¹¶ç»§ç»­</button></div></div></footer><script>var lazyLoad=function(e,t){for(var n,o,i,s=0;s<t;s++){if(n=e.eq(s),o=n.attr("data-loaded"),o)continue;n.offset().top<parseInt($(window).height())+parseInt($(window).scrollTop())&&(i=n.attr("src"),n.attr("src",i),n.attr("data-loaded",!0))}},bindLayLoad=function(){var e=$("img"),t=e.length;lazyLoad(e,t),$(window).scroll(function(){lazyLoad(e,t)})},bindAddPadding=function(){var e=$("#close-join");e.length>0&&$(".main-section").addClass("padding")},docCookies={getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t){return!!e&&!/^(?:expires|max-age|path|domain|secure)$/i.test(e)&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t),!0)}},bindHideCookie=function(){var t=docCookies.getItem("hasAuth"),e=$(".cookie");t?e.hide():e.show(),e.find("button").on("click",function(){docCookies.setItem("hasAuth","1"),e.hide()})};bindAddPadding(),bindHideCookie()</script><script type=text/javascript src=/js/aside.2d6977c0f16aef4ed3e886dd66675ce74bd0efcd467c2b2bcdb30b92d5e7c7c0e5c6e0c9d8f09a883c22f58df9e6b0b6347fcdd3c9a920b7faba6d7f91a201c3.js integrity="sha512-LWl3wPFq707T6IbdZmdc50vQ781GfCsrzbMLktXnx8DlxuDJ2PCaiDwi9Y355rC2NH/N08mpILf6um1/kaIBww=="></script><script type=text/javascript src=/js/markdown-tab.17f9f46b021adebc7250ce1b07134a577b307e7a436daa4aaf388f218e8463966f53770b26a64817c06c168738a887672d47fb4c29615adfc446e11d09a344cf.js integrity="sha512-F/n0awIa3rxyUM4bBxNKV3swfnpDbapKrziPIY6EY5ZvU3cLJqZIF8BsFoc4qIdnLUf7TClhWt/ERuEdCaNEzw=="></script><script>let forbidForm=!1;var viewer=new Viewer(document.querySelector(".md-body"),{url:"src"}),blogBindSubmit=function(){var e=$("#email-input-blog");$("#email-submit-blog").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message_blog").data("message1"),a=$("#message_blog").data("message2"),r=$("#message_blog").data("message3"),c=$("#message1_blog").data("success");if(n)if(validateEmail(n)){if(s=$("#blog_formAddress").data("usesendcloud"),!s)return;o=$("#blog_formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:n.toString()},success:function(){showSuccessMessage_blog(c),setTimeout(function(){window.onscroll="",$(".SubscribeForm").hide(),$("#email-input-blog").val("")},5e3)},error:function(){showMessage_blog(r)}})}else t.preventDefault(),$("#message_blog").html(a).show();else t.preventDefault(),$("#message_blog").html(i).show()})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},bindHideMessageBlog=function(){$(window).click(function(){$("#message_blog").hide()})},bindCloseBlog=function(){$(".SubscribeForm .close").click(function(e){e.stopPropagation(),$(".SubscribeForm").fadeOut(),window.onscroll=""})},showMessage_blog=function(e){$("#message_blog").html(e).show()},showSuccessMessage_blog=function(e){$("#message1_blog").html(e).show()};window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;forbidForm&&(window.onscroll=""),e+t>n-710?$(".SubscribeForm").hide():$(".SubscribeForm").show()},blogBindSubmit(),bindCloseBlog(),bindHideMessageBlog()</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>