<!doctype html><html lang=en-US><head><meta charset=utf-8><title>ARM 版 openEuler 22.03 部署 KubeSphere 3.4.0 不完全指南续篇</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="本文主要实战演示了在 ARM 版 openEuler 22.03 LTS SP2 服务器上，利用 KubeKey v3.0.10 自动化部署最小化 KubeSphere v3.4.0 和 Kubernetes v1.26.5 高可用集群的详细过程。"><meta name=keywords content="Kubernetes,KubeSphere,openEuler,ARM"><meta property="og:type" content="article"><meta property="og:title" content="ARM 版 openEuler 22.03 部署 KubeSphere 3.4.0 不完全指南续篇"><meta property="og:description" content="本文主要实战演示了在 ARM 版 openEuler 22.03 LTS SP2 服务器上，利用 KubeKey v3.0.10 自动化部署最小化 KubeSphere v3.4.0 和 Kubernetes v1.26.5 高可用集群的详细过程。"><meta property="og:image" content="https://pek3b.qingstor.com/kubesphere-community/images/kubesphere-3.4-on-openeuler-cover.png"><meta property="og:url" content="https://openksc.github.io/zh/blogs/deploy-kubesphere-v3.4.0-on-arm-openeuler-2/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeSphere"><meta property="twitter:image" content="https://pek3b.qingstor.com/kubesphere-community/images/kubesphere-3.4-on-openeuler-cover.png"><meta name=docsearch:language content="zh-CN"><meta name=docsearch:version content><link rel=canonical href=https://kubesphere.io/zh/blogs/deploy-kubesphere-v3.4.0-on-arm-openeuler-2/><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=apple-touch-icon href=/images/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/svg+xml href=/images/favicons/favicon.svg><link rel=icon type=image/png href=/images/favicons/favicon.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg color=#00ad6e><meta name=msapplication-config content='/images/favicons/browserconfig.xml'><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/fonts/Roboto/stylesheet.css><link rel=stylesheet href=/fonts/ProximaNova/stylesheet.css><link rel=stylesheet href=/css/jquery.modal.min.css><link rel=stylesheet href=/css/viewer.min.css><link rel=stylesheet href=/swiper/swiper-bundle.min.css><link rel=stylesheet href=/scss/common.min.0c3fdcc05ec210321169846714f74b11c4a1baf09a1833fa9273b2347c81e636.css><script src=/js/jquery-3.7.1.min.js></script><script src=/js/viewer.min.js></script><script src=/js/jquery.modal.min.js></script><script src=/swiper/swiper-bundle.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0888981f1fa45d241b1fb6962da2963e",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YYCVN36HT5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YYCVN36HT5")</script><script type=text/javascript>!function(e,t,n,s,o){e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=("https:"==document.location.protocol?"https://":"http://")+s,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio"),gio("init","8a24ae300cbf8b8c",{}),gio("send")</script><link rel=stylesheet href=/scss/content.min.f73b326fbf8c5bd331900b0de21c7dde608a4926f482f6465f9ae1d9049b83ad.css><link rel=stylesheet href=/scss/markdown.min.db47186481122431dffae72d17dbbd51f90b66f022cc163458645709924e4eac.css></head><body><header class=navigation><div class=join-div><div class=content>🚀 KubeSphere v4.1.3 发布，多项优化与改进，欢迎体验！<a href=/zh/docs/v4.1/20-release-notes/release-v413/ target=_blank rel="noopener noreferrer">请查看 Release notes →</a>
<img id=close-join src=/images/header/close.svg alt=close></div></div><div class=common-layout><div class=header-container><a href=/zh/ aria-label=logo><img src=/images/header/logo.svg alt class=logo></a><ul class=nav><li class=menu-li><span class=menu-span>应用场景</span><ul class="dropdown-menu menu-2"><li><a href=/zh/devops/>拥抱一站式 DevOps 工作流</a></li><li><a href=/zh/service-mesh/>在 Kubernetes 运行微服务</a></li><li><a href=/zh/observability/>构建丰富的云原生可观测性</a></li></ul></li><li class=menu-li><span class=menu-span>资源</span><ul class="dropdown-menu menu-3"><li><a href=/zh/projects/>开源项目</a></li><li><a href=/zh/conferences/>开源峰会</a></li><li><a href=/zh/blogs/>技术博客</a></li><li><a href=/zh/videos/>视频资源</a></li><li><a href=/zh/learn/>云原生实战</a></li></ul></li><li class=menu-li><span class=menu-span>文档中心</span><ul class="dropdown-menu menu-4"><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/ target=_blank rel="noopener noreferrer">扩展组件开发</a></li><li><a href=https://kube.design/ target=_blank rel="noopener noreferrer">Kube Design</a></li></ul></li><li class=menu-li><span class=menu-span>开源社区</span><ul class="dropdown-menu menu-5"><li><a href=/zh/contribution/>参与贡献</a></li><li><a href=/zh/live/>社区活动</a></li><li><a href=/zh/case/>案例学习</a></li><li><a href=/zh/partner/>合作伙伴</a></li><li><a href=/zh/user-group/>用户委员会</a></li><li><a href=/zh/news/>动态</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">版本计划</a></li><li><a href=https://www.kubesphere.io/zh/ target=_blank rel="noopener noreferrer">中国站</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025 target=_blank rel="noopener noreferrer">开源之夏 2025</a></li></ul></li><li><a data-docs=用户论坛 href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">用户论坛</a></li><li><a data-docs=认证 href=https://kubesphere.cloud/certification/ target=_blank rel="noopener noreferrer">认证</a></li></ul><div class=right-menu><ul><li class=language-menu><div><img src=/images/header/black.svg alt>
<span>简体中文</span></div><ul class=dropdown-menu><li onclick='handleLangClick("zh","/zh/blogs/deploy-kubesphere-v3.4.0-on-arm-openeuler-2/")'>简体中文</li></ul></li><li class=github-li><div class=github-star><a class=star-btn href=https://github.com/kubesphere/kubesphere rel="noopener noreferrer" target=_blank><span class=star-img></span>&nbsp;<span>Star</span>
</a><a class=social-count href=https://github.com/kubesphere/kubesphere/stargazers rel="noopener noreferrer" target=_blank></a></div></li><li class=menu-icon><img src=/images/header/menu.svg alt></li></ul></div></div></div><div id=modal-for-menu class=modal><ul class=nav><li data-check=0 class=menu-li><span class=menu-span>应用场景</span><ul class=dropdown-menu><li><a href=/zh/devops/>拥抱一站式 DevOps 工作流</a></li><li><a href=/zh/service-mesh/>在 Kubernetes 运行微服务</a></li><li><a href=/zh/observability/>构建丰富的云原生可观测性</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>资源</span><ul class=dropdown-menu><li><a href=/zh/projects/>开源项目</a></li><li><a href=/zh/conferences/>开源峰会</a></li><li><a href=/zh/blogs/>技术博客</a></li><li><a href=/zh/videos/>视频资源</a></li><li><a href=/zh/learn/>云原生实战</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>文档中心</span><ul class=dropdown-menu><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/>扩展组件开发</a></li><li><a href=https://kube.design/>Kube Design</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>开源社区</span><ul class=dropdown-menu><li><a href=/zh/contribution/>参与贡献</a></li><li><a href=/zh/live/>社区活动</a></li><li><a href=/zh/case/>案例学习</a></li><li><a href=/zh/partner/>合作伙伴</a></li><li><a href=/zh/user-group/>用户委员会</a></li><li><a href=/zh/news/>动态</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md>版本计划</a></li><li><a href=https://www.kubesphere.io/zh/>中国站</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025>开源之夏 2025</a></li></ul></li><li><a data-docs=用户论坛 href=https://ask.kubesphere.io/forum>用户论坛</a></li><li><a data-docs=认证 href=https://kubesphere.cloud/certification/>认证</a></li></ul><div class=link-div><a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank rel="noopener noreferrer" aria-label=slack><img src=/images/header/slack-hover.svg alt>
</a><a href=https://x.com/KubeSphere target=_blank rel="noopener noreferrer" aria-label=twitter><img src=/images/header/twitter-hover.svg alt>
</a><a href=https://github.com/kubesphere/kubesphere target=_blank rel="noopener noreferrer" aria-label=github><img src=/images/header/github-hover.svg alt></a></div></div></header><script>var bindNavMouseEvent,bindScrollChangeHeader,bindClickShowMenu,bindClickModalLi,bindClickClose,language,handleLangClick,githubApiLink="https://api.github.com/repos/kubesphere/kubesphere",getStar=function(){$(".social-count").hide(),$.getJSON(githubApiLink,function(e){$(".social-count").show().html(e.stargazers_count)})};getStar(),bindNavMouseEvent=function(e,t){t||(t=$(e));var n=!1;t.mouseenter(function(){if(n)return!1;n=!0,$(this).find(".dropdown-menu").fadeIn(200,function(){n=!1})}),t.mouseleave(function(){$(this).find(".dropdown-menu").fadeOut(200)})},bindScrollChangeHeader=function(){var t=100,e=$("header");window.addEventListener("scroll",function(){var t=window.scrollY;t>0?e.addClass("navigationScroll"):e.removeClass("navigationScroll")})},bindClickShowMenu=function(){$(".menu-icon").click(function(){$("#modal-for-menu").modal()})},bindClickModalLi=function(){$(".modal .menu-li").click(function(){var e=$(this).data("check");e===0?($(this).data("check",1),$(this).find(".dropdown-menu").slideDown(200)):($(this).data("check",0),$(this).find(".dropdown-menu").slideUp(200)),$(this).find(".menu-span").toggleClass("up")})},bindClickClose=function(){$("#close-join").click(function(){$(".navigation .join-div").hide(),$(".main-section").removeClass("padding")})},language="zh",bindClickClose(),bindScrollChangeHeader(),$(".header-container .menu-li").each(function(){bindNavMouseEvent("",$(this))}),bindNavMouseEvent(".header-container .language-menu"),bindNavMouseEvent(".header-container .btn-li"),bindClickShowMenu(),bindClickModalLi(),handleLangClick=function(e,t){try{localStorage.setItem("lang",e)}catch{}location.href=t}</script><section class=main-section><div class=common-layout><div class=breadcrumb><span><a href=/zh/blogs/>技术博客</a> > </span><span>ARM 版 openEuler 22.03 部署 KubeSphere 3.4.0 不完全指南续篇</span></div><div class='main-div middle-div'><div class=author>运维有术</div><span class=date>发布于：2023-10-31</span>&nbsp;&nbsp;&nbsp;
<span style=font-size:14px;color:#919aa3 id=busuanzi_container_page_pv>本文总阅读量：<span id=busuanzi_value_page_pv></span></span><h1>ARM 版 openEuler 22.03 部署 KubeSphere 3.4.0 不完全指南续篇</h1><div class=share-1><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-kubesphere-v3.4.0-on-arm-openeuler-2%2f&text=ARM%20%e7%89%88%20openEuler%2022.03%20%e9%83%a8%e7%bd%b2%20KubeSphere%203.4.0%20%e4%b8%8d%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%e7%bb%ad%e7%af%87" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-kubesphere-v3.4.0-on-arm-openeuler-2%2f&title=ARM%20%e7%89%88%20openEuler%2022.03%20%e9%83%a8%e7%bd%b2%20KubeSphere%203.4.0%20%e4%b8%8d%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%e7%bb%ad%e7%af%87" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-kubesphere-v3.4.0-on-arm-openeuler-2%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-kubesphere-v3.4.0-on-arm-openeuler-2%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-kubesphere-v3.4.0-on-arm-openeuler-2%2f&t=ARM%20%e7%89%88%20openEuler%2022.03%20%e9%83%a8%e7%bd%b2%20KubeSphere%203.4.0%20%e4%b8%8d%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%e7%bb%ad%e7%af%87" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div><div class=content><div class=md-body><h2 id=前言>前言</h2><h3 id=知识点>知识点</h3><ul><li>定级：<strong>入门级</strong></li><li>KubeKey 安装部署 ARM 版 KubeSphere 和 Kubernetes</li><li>ARM 版 KubeSphere 和 Kubernetes 常见问题</li></ul><h3 id=实战服务器配置-个人云上测试服务器>实战服务器配置 (个人云上测试服务器)</h3><table><thead><tr><th style=text-align:center>主机名</th><th style=text-align:center>IP</th><th style=text-align:center>CPU</th><th style=text-align:center>内存</th><th style=text-align:center>系统盘</th><th style=text-align:center>数据盘</th><th style=text-align:center>用途</th></tr></thead><tbody><tr><td style=text-align:center>ks-master-1</td><td style=text-align:center>172.16.33.16</td><td style=text-align:center>6</td><td style=text-align:center>16</td><td style=text-align:center>50</td><td style=text-align:center>200</td><td style=text-align:center>KubeSphere/k8s-master</td></tr><tr><td style=text-align:center>ks-master-2</td><td style=text-align:center>172.16.33.22</td><td style=text-align:center>6</td><td style=text-align:center>16</td><td style=text-align:center>50</td><td style=text-align:center>200</td><td style=text-align:center>KubeSphere/k8s-master</td></tr><tr><td style=text-align:center>ks-master-3</td><td style=text-align:center>172.16.33.23</td><td style=text-align:center>6</td><td style=text-align:center>16</td><td style=text-align:center>50</td><td style=text-align:center>200</td><td style=text-align:center>KubeSphere/k8s-master</td></tr><tr><td style=text-align:center>合计</td><td style=text-align:center>10</td><td style=text-align:center>18</td><td style=text-align:center>48</td><td style=text-align:center>150</td><td style=text-align:center>600+</td><td style=text-align:center></td></tr></tbody></table><h3 id=实战环境涉及软件版本信息>实战环境涉及软件版本信息</h3><ul><li><p>服务器芯片：<strong>Kunpeng-920</strong></p></li><li><p>操作系统：<strong>openEuler 22.03 LTS SP2 aarch64</strong></p></li><li><p>KubeSphere：<strong>v3.4.0</strong></p></li><li><p>Kubernetes：<strong>v1.26.5</strong></p></li><li><p>Containerd：<strong>1.6.4</strong></p></li><li><p>KubeKey: <strong>v3.0.10</strong></p></li></ul><h2 id=1-本文简介>1. 本文简介</h2><p>本文是 <a href=https://kubesphere.io/zh/blogs/deploy-kubesphere-v3.4.0-on-arm-openeuler/ target=_blank rel="noopener noreferrer">ARM 版 openEuler 22.03 部署 KubeSphere 3.4.0 不完全指南</a> 的续集，受限于字符数量限制，将完整的文档拆成了两篇。</p><p>上篇我们完成了 KubeSphere 和 Kubernetes 集群的部署，下篇我们主要介绍以下两个主题内容：</p><ul><li>部署测试资源验证 KubeSphere 和 Kubernetes 的基本功能是否正常</li><li>解决 ARM 版 KubeSphere 和 Kubernetes 服务组件异常的问题（<strong>本文核心价值</strong>）</li></ul><p>KubeSphere 和 Kubernetes 在 ARM 架构 和 X86 架构的服务器上部署，最大的区别在于所有服务使用的<strong>容器镜像架构类型</strong>的不同，KubeSphere 开源版对于 ARM 架构的默认支持可以实现 KubeSphere-Core 功能，即可以实现最小化的 KubeSphere 和完整的 Kubernetes 集群的部署。当启用了 KubeSphere 可插拔组件时，会遇到个别组件部署失败的情况，需要我们手工替换官方或是第三方提供的 ARM 版镜像或是根据官方源码手工构建 ARM 版镜像。</p><p>本文详细的记录了在完成最终部署的过程中，遇到的各种问题报错及相应的解决方案。由于能力有限，本文中所遇到的架构不兼容的问题，均采用了手工替换第三方仓库或是官方其他仓库相同或是相似 ARM 版本镜像的方案。</p><p>建议计划在生产中使用的读者最好能具备使用官方源码及 DockerFile 构建与 X86 版本完全相同的 ARM 版容器镜像的能力，不要替换相近版本或是使用第三方镜像。也正是因为本文并没有涉及利用官方源码及 Dockerfile 构建 ARM 镜像的相关内容，所以才取名为<strong>不完全指南</strong>。</p><h2 id=2-安装过程中出现的异常及解决方案>2. 安装过程中出现的异常及解决方案</h2><h3 id=21-kubernetes-相关组件二进制包格式不匹配>2.1 Kubernetes 相关组件二进制包格式不匹配</h3><ul><li>报错现象</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># containerd 启动失败</span>
</span></span><span style=display:flex><span>Oct <span style=color:#ae81ff>12</span> 10:44:00 KP-Euler-ZH-01 systemd<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>: Starting containerd container runtime...
</span></span><span style=display:flex><span>Oct <span style=color:#ae81ff>12</span> 10:44:00 KP-Euler-ZH-01 <span style=color:#f92672>(</span>ntainerd<span style=color:#f92672>)[</span>27271<span style=color:#f92672>]</span>: containerd.service: Failed to execute /usr/bin/containerd: Exec format error
</span></span><span style=display:flex><span>Oct <span style=color:#ae81ff>12</span> 10:44:00 KP-Euler-ZH-01 <span style=color:#f92672>(</span>ntainerd<span style=color:#f92672>)[</span>27271<span style=color:#f92672>]</span>: containerd.service: Failed at step EXEC spawning /usr/bin/containerd: Exec format error
</span></span><span style=display:flex><span>Oct <span style=color:#ae81ff>12</span> 10:44:00 KP-Euler-ZH-01 systemd<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>: containerd.service: Main process exited, code<span style=color:#f92672>=</span>exited, status<span style=color:#f92672>=</span>203/EXEC
</span></span><span style=display:flex><span>Oct <span style=color:#ae81ff>12</span> 10:44:00 KP-Euler-ZH-01 systemd<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>: containerd.service: Failed with result <span style=color:#e6db74>&#39;exit-code&#39;</span>.
</span></span><span style=display:flex><span>Oct <span style=color:#ae81ff>12</span> 10:44:00 KP-Euler-ZH-01 systemd<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>: Failed to start containerd container runtime.
</span></span><span style=display:flex><span>Oct <span style=color:#ae81ff>12</span> 10:44:05 KP-Euler-ZH-01 systemd<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>: containerd.service: Scheduled restart job, restart counter is at 241.
</span></span><span style=display:flex><span>Oct <span style=color:#ae81ff>12</span> 10:44:05 KP-Euler-ZH-01 systemd<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>: Stopped containerd container runtime.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看 kk 下载的二进制包</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 kubekey<span style=color:#f92672>]</span><span style=color:#75715e># ll kubekey/kube/v1.26.5/ -R</span>
</span></span><span style=display:flex><span>kubekey/kube/v1.26.5/:
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>2</span> root root <span style=color:#ae81ff>4096</span> Oct <span style=color:#ae81ff>12</span> 10:18 amd64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubekey/kube/v1.26.5/amd64:
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>211048</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>46788608</span> Oct <span style=color:#ae81ff>12</span> 10:04 kubeadm
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>48046080</span> Oct <span style=color:#ae81ff>12</span> 10:18 kubectl
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>121277432</span> Oct <span style=color:#ae81ff>12</span> 10:04 kubelet
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 kubekey<span style=color:#f92672>]</span><span style=color:#75715e># ll kubekey/containerd/1.6.4/ -R</span>
</span></span><span style=display:flex><span>kubekey/containerd/1.6.4/:
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>drwxr-xr-x. <span style=color:#ae81ff>2</span> root root <span style=color:#ae81ff>4096</span> Oct <span style=color:#ae81ff>12</span> 10:20 amd64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubekey/containerd/1.6.4/amd64:
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>43396</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>44436699</span> Oct <span style=color:#ae81ff>12</span> 10:21 containerd-1.6.4-linux-amd64.tar.gz
</span></span></code></pre></div><ul><li>解决方案</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kk 默认下载的二进制包都是 amd64 格式的不适用于 ARM 环境，需要手工修改创建集群的配置文件
</span></span><span style=display:flex><span>在 spec.hosts 的主机配置中增加节点的 arch 属性
</span></span></code></pre></div><ul><li>正确的安装效果</li></ul><p>安装过程日志输出比较多，本文只展示重要的一点，一定要观察下载二进制包的时候，格式为 <strong>arm64</strong>，其它的日志输出，为了节省篇幅这里就不展示了。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Continue this installation? <span style=color:#f92672>[</span>yes/no<span style=color:#f92672>]</span>: yes
</span></span><span style=display:flex><span>10:49:21 CST success: <span style=color:#f92672>[</span>LocalHost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>10:49:21 CST <span style=color:#f92672>[</span>NodeBinariesModule<span style=color:#f92672>]</span> Download installation binaries
</span></span><span style=display:flex><span>10:49:21 CST message: <span style=color:#f92672>[</span>localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>downloading arm64 kubeadm v1.26.5 ...
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span> 43.3M  <span style=color:#ae81ff>100</span> 43.3M    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>  1035k      <span style=color:#ae81ff>0</span>  0:00:42  0:00:42 --:--:-- 1212k
</span></span><span style=display:flex><span>10:50:04 CST message: <span style=color:#f92672>[</span>localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>downloading arm64 kubelet v1.26.5 ...
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span>  111M  <span style=color:#ae81ff>100</span>  111M    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>  1018k      <span style=color:#ae81ff>0</span>  0:01:51  0:01:51 --:--:-- 1027k
</span></span><span style=display:flex><span>10:51:56 CST message: <span style=color:#f92672>[</span>localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>downloading arm64 kubectl v1.26.5 ...
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span> 44.3M  <span style=color:#ae81ff>100</span> 44.3M    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>  1022k      <span style=color:#ae81ff>0</span>  0:00:44  0:00:44 --:--:-- 1081k
</span></span><span style=display:flex><span>10:52:41 CST message: <span style=color:#f92672>[</span>localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>downloading arm64 helm v3.9.0 ...
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span> 43.6M  <span style=color:#ae81ff>100</span> 43.6M    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>  1035k      <span style=color:#ae81ff>0</span>  0:00:43  0:00:43 --:--:-- 1181k
</span></span><span style=display:flex><span>10:53:24 CST message: <span style=color:#f92672>[</span>localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>downloading arm64 kubecni v1.2.0 ...
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span> 36.2M  <span style=color:#ae81ff>100</span> 36.2M    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>  1039k      <span style=color:#ae81ff>0</span>  0:00:35  0:00:35 --:--:-- 1236k
</span></span><span style=display:flex><span>10:54:00 CST message: <span style=color:#f92672>[</span>localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>downloading arm64 crictl v1.24.0 ...
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span> 12.7M  <span style=color:#ae81ff>100</span> 12.7M    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>  1032k      <span style=color:#ae81ff>0</span>  0:00:12  0:00:12 --:--:-- 1080k
</span></span><span style=display:flex><span>10:54:13 CST message: <span style=color:#f92672>[</span>localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>downloading arm64 etcd v3.4.13 ...
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span> 15.3M  <span style=color:#ae81ff>100</span> 15.3M    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>  1026k      <span style=color:#ae81ff>0</span>  0:00:15  0:00:15 --:--:-- 1074k
</span></span><span style=display:flex><span>10:54:28 CST message: <span style=color:#f92672>[</span>localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>downloading arm64 containerd 1.6.4 ...
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span> 31.9M  <span style=color:#ae81ff>100</span> 31.9M    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>  1015k      <span style=color:#ae81ff>0</span>  0:00:32  0:00:32 --:--:-- 1021k
</span></span><span style=display:flex><span>10:55:01 CST message: <span style=color:#f92672>[</span>localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>downloading arm64 runc v1.1.1 ...
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span> 8837k  <span style=color:#ae81ff>100</span> 8837k    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>  1099k      <span style=color:#ae81ff>0</span>  0:00:08  0:00:08 --:--:-- 1182k
</span></span><span style=display:flex><span>10:55:09 CST message: <span style=color:#f92672>[</span>localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>downloading arm64 calicoctl v3.23.2 ...
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span> 55.5M  <span style=color:#ae81ff>100</span> 55.5M    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>  1030k      <span style=color:#ae81ff>0</span>  0:00:55  0:00:55 --:--:-- 1214k
</span></span><span style=display:flex><span>10:56:04 CST success: <span style=color:#f92672>[</span>LocalHost<span style=color:#f92672>]</span>
</span></span></code></pre></div><h2 id=3-异常组件及解决方案>3. 异常组件及解决方案</h2><p>由于 KubeSphere 社区版对 ARM 的支持并不完美，默认仅能保证 KubeSphere-Core 在 ARM 架构下能部署成功，当启用了插件后，并不是所有插件都有 ARM 镜像，当没有对应 ARM 版本镜像时，系统拉取 x86 版本的镜像创建并启动服务，因此会导致架构不同引发的服务启动异常，需要根据报错信息解决异常。</p><p>解决异常的方案有以下几种：</p><ul><li>使用异常组件官方其他仓库或是第三方提供的<strong>相同版本</strong>的 ARM 镜像（<strong>次优</strong>方案，优先在官方找，实在没有再找第三方用户提供的镜像）</li><li>使用异常组件官方其他仓库或是第三方提供的<strong>相近版本</strong>的 ARM 镜像（<strong>保底</strong>方案，仅限于研发测试环境）</li><li>使用官方组件源代码和 Dockerfile <strong>自己构建</strong> ARM 镜像（<strong>最优</strong>方案，因暂时能力有限，所以本文并未涉及，后续可能会有更新）</li></ul><p>本小节的内容完整的记录了在整个部署过程中遇到的问题及相应的解决方案，也是本文的核心价值所在。</p><h3 id=31-查看异常组件对应的-pod>3.1 查看异常组件对应的 Pod</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pods -A -o wide | grep CrashLoopBackOff | grep -v weave</span>
</span></span><span style=display:flex><span>argocd                         devops-argocd-applicationset-controller-8486797d4d-72888   0/1     CrashLoopBackOff        <span style=color:#ae81ff>24</span> <span style=color:#f92672>(</span>5m4s ago<span style=color:#f92672>)</span>    107m   10.233.103.12   ks-master-1   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>istio-system                   istiod-1-14-6-6576b8664b-28c44                             0/1     CrashLoopBackOff        <span style=color:#ae81ff>25</span> <span style=color:#f92672>(</span>43s ago<span style=color:#f92672>)</span>     107m   10.233.102.8    ks-master-2   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>kubesphere-controls-system     default-http-backend-767cdb5fdc-ptqhh                      0/1     CrashLoopBackOff        <span style=color:#ae81ff>24</span> <span style=color:#f92672>(</span>5m5s ago<span style=color:#f92672>)</span>    108m   10.233.93.9     ks-master-3   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>kubesphere-devops-system       devops-jenkins-774fdb948b-4rk56                            0/1     Init:CrashLoopBackOff   <span style=color:#ae81ff>23</span> <span style=color:#f92672>(</span>4m57s ago<span style=color:#f92672>)</span>   107m   10.233.93.18    ks-master-3   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>如果你跟我一样在初始部署的时候就选择了 weave 组件，在失败的 Pod 列表中也会有 weave 命名空间下的相应 Pod。因为，weave 已经过时且无法解决，所以在过滤异常 Pod 的时候排除了 weave 相应的 Pod。</p><p>上面的输出结果在排除 weave 以后，也没有包含全部异常组件。因为在采集这个结果之前，我已经解决了其他几个组件的问题。</p><p>我们先按上面输出的结果排序来处理异常，不在上面结果中的异常组件的问题报错及解决过程放在了后面，具体细节请看下文。</p><h3 id=32-解决-argo-cd-异常>3.2 解决 Argo CD 异常</h3><ul><li>查看异常 Pod</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pods -A -o wide | grep -v Running | grep -v Completed</span>
</span></span><span style=display:flex><span>NAMESPACE                      NAME                                                           READY   STATUS             RESTARTS           AGE     IP               NODE          NOMINATED NODE   READINESS GATES
</span></span><span style=display:flex><span>argocd                         devops-argocd-applicationset-controller-8486797d4d-72888       0/1     CrashLoopBackOff   <span style=color:#ae81ff>1119</span> <span style=color:#f92672>(</span>4m4s ago<span style=color:#f92672>)</span>    3d23h   10.233.103.12    ks-master-1   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>istio-system                   istiod-1-14-6-6576b8664b-28c44                                 0/1     CrashLoopBackOff   <span style=color:#ae81ff>1119</span> <span style=color:#f92672>(</span>3m37s ago<span style=color:#f92672>)</span>   3d23h   10.233.102.8     ks-master-2   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><ul><li>查看异常 Pod 的日志（<strong>典型的二进制程序架构不匹配造成的，也就是说 x86 的程序，在 ARM 上运行</strong>）</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl logs --all-containers devops-argocd-applicationset-controller-8486797d4d-72888 -n argocd</span>
</span></span><span style=display:flex><span>exec /usr/local/bin/applicationset-controller: exec format error
</span></span></code></pre></div><ul><li>查看异常 Pod 使用的镜像</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl describe pods devops-argocd-applicationset-controller-8486797d4d-72888 -n argocd | grep Image:</span>
</span></span><span style=display:flex><span>    Image:         registry.cn-beijing.aliyuncs.com/kubesphereio/argocd-applicationset:v0.4.1
</span></span></code></pre></div><ul><li>查看异常 Pod 镜像架构</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 查看异常 Pod 镜像架构</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># crictl inspecti registry.cn-beijing.aliyuncs.com/kubesphereio/argocd-applicationset:v0.4.1 | grep arch</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;architecture&#34;</span>: <span style=color:#e6db74>&#34;amd64&#34;</span>,
</span></span></code></pre></div><ul><li>获取适配的 ARM 版镜像（<strong>相同版本 KubeSphere 官方 ARM 版镜像</strong>）</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 找个相同版本的 ARM 架构的镜像</span>
</span></span><span style=display:flex><span>crictl pull kubespheredev/argocd-applicationset-arm64:v0.4.1
</span></span></code></pre></div><ul><li>镜像重新打 tag（<strong>为了保持镜像名称风格一致</strong>）</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ctr -n k8s.io images tag docker.io/kubespheredev/argocd-applicationset-arm64:v0.4.1 registry.cn-beijing.aliyuncs.com/kubesphereio/argocd-applicationset-arm64:v0.4.1
</span></span></code></pre></div><ul><li>重新部署组件</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 修改 Deployment 使用的镜像，并重启</span>
</span></span><span style=display:flex><span>kubectl set image deployment/devops-argocd-applicationset-controller applicationset-controller<span style=color:#f92672>=</span>registry.cn-beijing.aliyuncs.com/kubesphereio/argocd-applicationset-arm64:v0.4.1 -n argocd
</span></span><span style=display:flex><span>kubectl rollout restart deployment/devops-argocd-applicationset-controller -n argocd
</span></span></code></pre></div><ul><li>验证新的 Pod 创建并启动成功</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pods -o wide -n argocd | grep applicationset-controller</span>
</span></span><span style=display:flex><span>devops-argocd-applicationset-controller-864f464855-64zvf   1/1     Running   <span style=color:#ae81ff>0</span>          56s     10.233.103.125   ks-master-1   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><h3 id=33-解决-istio-异常>3.3 解决 Istio 异常</h3><ul><li>查看异常 Pod</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pods -A -o wide | grep -v Running | grep -v Completed</span>
</span></span><span style=display:flex><span>NAMESPACE                      NAME                                                           READY   STATUS             RESTARTS           AGE     IP               NODE          NOMINATED NODE   READINESS GATES
</span></span><span style=display:flex><span>istio-system                   istiod-1-14-6-6576b8664b-28c44                                 0/1     CrashLoopBackOff   <span style=color:#ae81ff>1122</span> <span style=color:#f92672>(</span>3m10s ago<span style=color:#f92672>)</span>   3d23h   10.233.102.8     ks-master-2   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><ul><li>查看异常 Pod 的日志</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl logs --all-containers istiod-1-14-6-6576b8664b-28c44 -n istio-system</span>
</span></span><span style=display:flex><span>exec /usr/local/bin/pilot-discovery: exec format error
</span></span></code></pre></div><ul><li>查看异常 Pod 使用的镜像</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl describe pods istiod-1-14-6-6576b8664b-28c44 -n istio-system | grep Image:</span>
</span></span><span style=display:flex><span>    Image:         registry.cn-beijing.aliyuncs.com/kubesphereio/pilot:1.14.6
</span></span></code></pre></div><ul><li>查看异常 Pod 镜像架构</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 查看异常 Pod 镜像架构</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-2 ~<span style=color:#f92672>]</span><span style=color:#75715e># crictl inspecti registry.cn-beijing.aliyuncs.com/kubesphereio/pilot:1.14.6 | grep arch</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;architecture&#34;</span>: <span style=color:#e6db74>&#34;amd64&#34;</span>,
</span></span></code></pre></div><ul><li>获取适配的 ARM 版镜像 (<strong>Istio 官方相近版本 ARM 镜像</strong>)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 找个相近版本的 ARM 架构的镜像（官方没有 1.14.6 的 ARM 镜像，从 1.15 开始才原生支持 ARM，所以用了 1.15.7 代替，生产环境建议自己用 1.14.6 版本的源码编译构建）</span>
</span></span><span style=display:flex><span>crictl pull istio/pilot:1.15.7 --platform arm64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 确保镜像架构是 arm64</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-2 ~<span style=color:#f92672>]</span><span style=color:#75715e># crictl inspecti registry.cn-beijing.aliyuncs.com/kubesphereio/pilot:1.15.7 | grep arch</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;architecture&#34;</span>: <span style=color:#e6db74>&#34;arm64&#34;</span>,
</span></span></code></pre></div><ul><li>镜像重新打 tag</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ctr -n k8s.io images tag docker.io/istio/pilot:1.15.7 registry.cn-beijing.aliyuncs.com/kubesphereio/pilot:1.15.7
</span></span></code></pre></div><ul><li>重新部署组件</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 修改 Deployment 使用的镜像，并重启</span>
</span></span><span style=display:flex><span>kubectl set image deployment/istiod-1-14-6 discovery<span style=color:#f92672>=</span>registry.cn-beijing.aliyuncs.com/kubesphereio/pilot:1.15.7 -n istio-system
</span></span><span style=display:flex><span>kubectl rollout restart deployment/istiod-1-14-6 -n istio-system
</span></span></code></pre></div><ul><li>验证新的 Pod 创建并启动成功</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 确保新的 Pod 创建并启动成功</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pods -o wide -n istio-system | grep istio</span>
</span></span><span style=display:flex><span>istiod-1-14-6-58ff9f7cc-59djl      0/1     Pending   <span style=color:#ae81ff>0</span>          7m59s   &lt;none&gt;           &lt;none&gt;        &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>istiod-1-14-6-747f5b86b-bg29h      1/1     Running   <span style=color:#ae81ff>0</span>          15m     10.233.102.122   ks-master-2   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 上面的结果中，有一个 POd 一直处于 Pending 状态，查看具体原因</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl events pod --for=pod/istiod-1-14-6-58ff9f7cc-59djl -n istio-system</span>
</span></span><span style=display:flex><span>LAST SEEN               TYPE      REASON             OBJECT                              MESSAGE
</span></span><span style=display:flex><span>3m26s <span style=color:#f92672>(</span>x2 over 8m42s<span style=color:#f92672>)</span>   Warning   FailedScheduling   Pod/istiod-1-14-6-58ff9f7cc-59djl   0/3 nodes are available: <span style=color:#ae81ff>3</span> Insufficient cpu. preemption: 0/3 nodes are available: <span style=color:#ae81ff>3</span> No preemption victims found <span style=color:#66d9ef>for</span> incoming pod..
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 结果显示 CPU 资源不足，验证</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># for i in {1..3};do echo ks-master-$i Cpu Usage: &amp;&amp; kubectl describe node ks-master-$i | grep cpu | grep -v cpu: ;done</span>
</span></span><span style=display:flex><span>ks-master-1 Cpu Usage:
</span></span><span style=display:flex><span>  cpu                3317m <span style=color:#f92672>(</span>92%<span style=color:#f92672>)</span>   10500m <span style=color:#f92672>(</span>291%<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>ks-master-2 Cpu Usage:
</span></span><span style=display:flex><span>  cpu                3587m <span style=color:#f92672>(</span>99%<span style=color:#f92672>)</span>   11910m <span style=color:#f92672>(</span>330%<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>ks-master-3 Cpu Usage:
</span></span><span style=display:flex><span>  cpu                3317m <span style=color:#f92672>(</span>92%<span style=color:#f92672>)</span>   10800m <span style=color:#f92672>(</span>300%<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 增加服务器 CPU 资源，重启服务器后，再次查看</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pods -o wide -n istio-system | grep istio</span>
</span></span><span style=display:flex><span>istiod-1-14-6-6d4dbc56df-n5z9g     1/1     Running             <span style=color:#ae81ff>0</span>             17s   10.233.102.149   ks-master-2   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><h3 id=34-解决-http-backupend-异常>3.4 解决 http-backupend 异常</h3><ul><li>查看异常 Pod</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pods -A -o wide | grep -v Running | grep -v Completed</span>
</span></span><span style=display:flex><span>NAMESPACE                      NAME                                                           READY   STATUS             RESTARTS           AGE     IP               NODE          NOMINATED NODE   READINESS GATES
</span></span><span style=display:flex><span>kubesphere-controls-system     default-http-backend-767cdb5fdc-ptqhh                          0/1     CrashLoopBackOff   <span style=color:#ae81ff>1108</span> <span style=color:#f92672>(</span>4m7s ago<span style=color:#f92672>)</span>    3d22h   10.233.93.9      ks-master-3   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><ul><li>查看异常 Pod 的日志</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl logs --all-containers default-http-backend-767cdb5fdc-ptqhh -n kubesphere-controls-system</span>
</span></span><span style=display:flex><span>exec /server: exec format error
</span></span></code></pre></div><ul><li>查看异常 Pod 使用的镜像</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl describe pods default-http-backend-767cdb5fdc-ptqh -n kubesphere-controls-system | grep Image:</span>
</span></span><span style=display:flex><span>    Image:          registry.cn-beijing.aliyuncs.com/kubesphereio/defaultbackend-amd64:1.4
</span></span></code></pre></div><ul><li>查看异常 Pod 镜像架构</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-3 ~<span style=color:#f92672>]</span><span style=color:#75715e># crictl inspecti registry.cn-beijing.aliyuncs.com/kubesphereio/defaultbackend-amd64:1.4 | grep arch</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;architecture&#34;</span>: <span style=color:#e6db74>&#34;amd64&#34;</span>,
</span></span></code></pre></div><ul><li>获取适配的 ARM 版镜像（<strong>第三方相同版本 ARM 镜像</strong>）</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>crictl pull mirrorgooglecontainers/defaultbackend-arm64:1.4
</span></span></code></pre></div><ul><li>镜像重新打 tag（<strong>为了保持镜像名称风格一致</strong>）</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ctr -n k8s.io images tag docker.io/mirrorgooglecontainers/defaultbackend-arm64:1.4 registry.cn-beijing.aliyuncs.com/kubesphereio/defaultbackend-arm64:1.4
</span></span></code></pre></div><ul><li>重新部署组件</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 修改 Deployment 使用的镜像，并重启</span>
</span></span><span style=display:flex><span>kubectl set image deployment/default-http-backend default-http-backend<span style=color:#f92672>=</span>registry.cn-beijing.aliyuncs.com/kubesphereio/defaultbackend-arm64:1.4 -n kubesphere-controls-system
</span></span><span style=display:flex><span>kubectl rollout restart deployment/default-http-backend -n kubesphere-controls-system
</span></span></code></pre></div><ul><li>验证新的 Pod 创建并启动成功</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pods -o wide -n kubesphere-controls-system | grep default-http-backend</span>
</span></span><span style=display:flex><span>default-http-backend-694d6557b5-h674b   1/1     Running   <span style=color:#ae81ff>0</span>          14m     10.233.102.120   ks-master-2   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><h3 id=35-解决-jenkins-异常>3.5 解决 Jenkins 异常</h3><ul><li>查看异常 Pod 的日志</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl logs --all-containers devops-jenkins-774fdb948b-4rk56 -n kubesphere-devops-system</span>
</span></span><span style=display:flex><span>exec /bin/sh: exec format error
</span></span><span style=display:flex><span>Error from server <span style=color:#f92672>(</span>BadRequest<span style=color:#f92672>)</span>: container <span style=color:#e6db74>&#34;devops-jenkins&#34;</span> in pod <span style=color:#e6db74>&#34;devops-jenkins-774fdb948b-4rk56&#34;</span> is waiting to start: PodInitializing
</span></span></code></pre></div><ul><li>查看异常 Pod 的事件</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl events devops-jenkins-774fdb948b-4rk56 -n kubesphere-devops-system</span>
</span></span><span style=display:flex><span>LAST SEEN             TYPE      REASON             OBJECT                                MESSAGE
</span></span><span style=display:flex><span>40m                   Normal    SuccessfulCreate   CronJob/devops                        Created job devops-28284990
</span></span><span style=display:flex><span>40m                   Normal    SuccessfulCreate   Job/devops-28284990                   Created pod: devops-28284990-59cvp
</span></span><span style=display:flex><span>40m                   Normal    Scheduled          Pod/devops-28284990-59cvp             Successfully assigned kubesphere-devops-system/devops-28284990-59cvp to ks-master-1
</span></span><span style=display:flex><span>40m                   Normal    Pulling            Pod/devops-28284990-59cvp             Pulling image <span style=color:#e6db74>&#34;registry.cn-beijing.aliyuncs.com/kubesphereio/devops-tools:ks-v3.4.0&#34;</span>
</span></span><span style=display:flex><span>40m                   Normal    Pulled             Pod/devops-28284990-59cvp             Successfully pulled image <span style=color:#e6db74>&#34;registry.cn-beijing.aliyuncs.com/kubesphereio/devops-tools:ks-v3.4.0&#34;</span> in 427.197317ms <span style=color:#f92672>(</span>427.222677ms including waiting<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>40m                   Normal    Created            Pod/devops-28284990-59cvp             Created container pipeline-run-gc
</span></span><span style=display:flex><span>40m                   Normal    Started            Pod/devops-28284990-59cvp             Started container pipeline-run-gc
</span></span><span style=display:flex><span>40m                   Normal    Completed          Job/devops-28284990                   Job completed
</span></span><span style=display:flex><span>40m                   Normal    SawCompletedJob    CronJob/devops                        Saw completed job: devops-28284990, status: Complete
</span></span><span style=display:flex><span>10m                   Normal    SuccessfulCreate   CronJob/devops                        Created job devops-28285020
</span></span><span style=display:flex><span>10m                   Normal    Scheduled          Pod/devops-28285020-zqd72             Successfully assigned kubesphere-devops-system/devops-28285020-zqd72 to ks-master-1
</span></span><span style=display:flex><span>10m                   Normal    SuccessfulCreate   Job/devops-28285020                   Created pod: devops-28285020-zqd72
</span></span><span style=display:flex><span>10m                   Normal    Started            Pod/devops-28285020-zqd72             Started container pipeline-run-gc
</span></span><span style=display:flex><span>10m                   Normal    Created            Pod/devops-28285020-zqd72             Created container pipeline-run-gc
</span></span><span style=display:flex><span>10m                   Normal    Pulled             Pod/devops-28285020-zqd72             Successfully pulled image <span style=color:#e6db74>&#34;registry.cn-beijing.aliyuncs.com/kubesphereio/devops-tools:ks-v3.4.0&#34;</span> in 423.190976ms <span style=color:#f92672>(</span>423.205056ms including waiting<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>10m                   Normal    Pulling            Pod/devops-28285020-zqd72             Pulling image <span style=color:#e6db74>&#34;registry.cn-beijing.aliyuncs.com/kubesphereio/devops-tools:ks-v3.4.0&#34;</span>
</span></span><span style=display:flex><span>10m                   Normal    Completed          Job/devops-28285020                   Job completed
</span></span><span style=display:flex><span>10m                   Normal    SuccessfulDelete   CronJob/devops                        Deleted job devops-28284930
</span></span><span style=display:flex><span>10m                   Normal    SawCompletedJob    CronJob/devops                        Saw completed job: devops-28285020, status: Complete
</span></span><span style=display:flex><span>83s <span style=color:#f92672>(</span>x431 over 95m<span style=color:#f92672>)</span>   Warning   BackOff            Pod/devops-jenkins-774fdb948b-4rk56   Back-off restarting failed container copy-default-config in pod devops-jenkins-774fdb948b-4rk56_kubesphere-devops-system<span style=color:#f92672>(</span>d4e1ad50-0930-4ea7-823d-200bd90df471<span style=color:#f92672>)</span>
</span></span></code></pre></div><ul><li>查看异常 Pod 使用的镜像</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl describe pods devops-jenkins-774fdb948b-4rk56 -n kubesphere-devops-system | grep Image:</span>
</span></span><span style=display:flex><span>    Image:         registry.cn-beijing.aliyuncs.com/kubesphereio/ks-jenkins:v3.4.0-2.319.3-1
</span></span><span style=display:flex><span>    Image:         registry.cn-beijing.aliyuncs.com/kubesphereio/ks-jenkins:v3.4.0-2.319.3-1
</span></span></code></pre></div><ul><li>查看异常 Pod 镜像架构</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-3 ~<span style=color:#f92672>]</span><span style=color:#75715e># crictl inspecti registry.cn-beijing.aliyuncs.com/kubesphereio/ks-jenkins:v3.4.0-2.319.3-1 | grep arch</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;architecture&#34;</span>: <span style=color:#e6db74>&#34;amd64&#34;</span>,
</span></span></code></pre></div><ul><li>获取适配的 ARM 版镜像（<strong>相近版本 KubeSphere 官方 ARM 版镜像</strong>）</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 没有找到同版本的，只能找了一个相近版本的 ARM 架构的镜像</span>
</span></span><span style=display:flex><span>crictl pull docker.io/kubesphere/ks-jenkins:v3.4.1-2.319.3  --platform arm64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 确保 image 架构是 arm64</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-3 ~<span style=color:#f92672>]</span><span style=color:#75715e># crictl inspecti registry.cn-beijing.aliyuncs.com/kubesphereio/ks-jenkins:v3.4.0-2.319.3-1 | grep arch</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;architecture&#34;</span>: <span style=color:#e6db74>&#34;arm64&#34;</span>,
</span></span></code></pre></div><ul><li>镜像重新打 tag（<strong>为了保持镜像名风格一致</strong>）</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>crictl rmi registry.cn-beijing.aliyuncs.com/kubesphereio/ks-jenkins:v3.4.0-2.319.3-1
</span></span><span style=display:flex><span>ctr -n k8s.io images tag docker.io/kubesphere/ks-jenkins:v3.4.1-2.319.3 registry.cn-beijing.aliyuncs.com/kubesphereio/ks-jenkins:v3.4.0-2.319.3-1
</span></span></code></pre></div><ul><li>重新部署组件</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 查找现有 pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-3 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pods -A -o wide | grep jenkins</span>
</span></span><span style=display:flex><span>kubesphere-devops-system       devops-jenkins-774fdb948b-fmmls                                0/1     Init:CrashLoopBackOff   <span style=color:#ae81ff>6</span> <span style=color:#f92672>(</span>43s ago<span style=color:#f92672>)</span>       6m28s   10.233.93.27    ks-master-3   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 删除 pod，系统会自动重建</span>
</span></span><span style=display:flex><span>kubectl delete pod devops-jenkins-774fdb948b-fmmls -n kubesphere-devops-system
</span></span></code></pre></div><h3 id=36-解决-weave-异常>3.6 解决 weave 异常</h3><p>初始化部署时启用了 weave，导致服务部署异常，需要做如下操作卸载 weave 插件。</p><p><strong>注：</strong> 有能力的可以自己打对应版本的 ARM 镜像，我放弃了，毕竟这个功能模块用处不大了，该项目都已经不在维护了，<a href=https://www.weave.works/blog/weave-cloud-end-of-service title=停止维护说明 target=_blank rel="noopener noreferrer">停止维护说明</a>。</p><ul><li>查看异常 Pod</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pods -A -o wide | grep weave</span>
</span></span><span style=display:flex><span>weave                          weave-scope-agent-78r2r                                    0/1     CrashLoopBackOff    <span style=color:#ae81ff>5</span> <span style=color:#f92672>(</span>95s ago<span style=color:#f92672>)</span>    8m41s   172.16.33.16    ks-master-1   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>weave                          weave-scope-agent-gcm6z                                    0/1     CrashLoopBackOff    <span style=color:#ae81ff>5</span> <span style=color:#f92672>(</span>69s ago<span style=color:#f92672>)</span>    8m40s   172.16.33.23    ks-master-3   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>weave                          weave-scope-agent-kpp46                                    0/1     CrashLoopBackOff    <span style=color:#ae81ff>5</span> <span style=color:#f92672>(</span>79s ago<span style=color:#f92672>)</span>    8m40s   172.16.33.22    ks-master-2   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>weave                          weave-scope-app-c6966bf4-c79n2                             0/1     CrashLoopBackOff    <span style=color:#ae81ff>5</span> <span style=color:#f92672>(</span>67s ago<span style=color:#f92672>)</span>    8m42s   10.233.93.10    ks-master-3   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>weave                          weave-scope-cluster-agent-6f8f6596ff-xpctc                 0/1     CrashLoopBackOff    <span style=color:#ae81ff>5</span> <span style=color:#f92672>(</span>75s ago<span style=color:#f92672>)</span>    8m41s   10.233.102.7    ks-master-2   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><ul><li>查看异常 Pod 的日志</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl logs -n weave weave-scope-agent-78r2r</span>
</span></span><span style=display:flex><span>exec /home/weave/scope: exec format error
</span></span></code></pre></div><ul><li>查看异常 Pod 使用的镜像</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl describe pod weave-scope-agent-78r2r -n weave | grep Image:</span>
</span></span><span style=display:flex><span>    Image:         registry.cn-beijing.aliyuncs.com/kubesphereio/scope:1.13.0
</span></span></code></pre></div><ul><li>查看异常 Pod 镜像架构</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># crictl inspecti registry.cn-beijing.aliyuncs.com/kubesphereio/scope:1.13.0 | grep arch</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;architecture&#34;</span>: <span style=color:#e6db74>&#34;amd64&#34;</span>,
</span></span></code></pre></div><ul><li>编辑集群配置文件，<code>kubectl edit cc ks-installer -n kubesphere-system</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> network:
</span></span><span style=display:flex><span>    ippool:
</span></span><span style=display:flex><span>      type: calico
</span></span><span style=display:flex><span>    networkpolicy:
</span></span><span style=display:flex><span>      enabled: true
</span></span><span style=display:flex><span>    topology:
</span></span><span style=display:flex><span>      type: weave-scope <span style=color:#75715e># 修改为 none</span>
</span></span></code></pre></div><ul><li>修改完成后，会自动重新部署（也可以用下面的命令删除 ks-installer 的 pod，手工强制重启部署任务）</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete pod ks-installer-6674579f54-4s4tp -n kubesphere-system
</span></span></code></pre></div><ul><li>观察部署日志</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl logs -n kubesphere-system <span style=color:#66d9ef>$(</span>kubectl get pod -n kubesphere-system -l <span style=color:#e6db74>&#39;app in (ks-install, ks-installer)&#39;</span> -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.items[0].metadata.name}&#39;</span><span style=color:#66d9ef>)</span> -f
</span></span></code></pre></div><h3 id=37-解决-metrics-server-异常>3.7 解决 metrics-server 异常</h3><ul><li>查看异常 Pod</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 kubekey<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pods -A</span>
</span></span><span style=display:flex><span>NAMESPACE           NAME                                           READY   STATUS             RESTARTS        AGE
</span></span><span style=display:flex><span>kube-system         metrics-server-66b6cfb784-85l94                0/1     CrashLoopBackOff   <span style=color:#ae81ff>38</span> <span style=color:#f92672>(</span>114s ago<span style=color:#f92672>)</span>   171m
</span></span></code></pre></div><ul><li>查看异常 Pod 的日志</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 kubekey<span style=color:#f92672>]</span><span style=color:#75715e># kubectl logs metrics-server-66b6cfb784-85l94 -n kube-system</span>
</span></span><span style=display:flex><span>exec /metrics-server: exec format error
</span></span></code></pre></div><ul><li>查看异常 Pod 使用的镜像</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 kubekey<span style=color:#f92672>]</span><span style=color:#75715e># kubectl describe pod metrics-server-66b6cfb784-85l94 -n kube-system | grep Image:</span>
</span></span><span style=display:flex><span>    Image:         registry.cn-beijing.aliyuncs.com/kubesphereio/metrics-server:v0.4.2
</span></span></code></pre></div><ul><li>查看异常 Pod 镜像架构</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-3 ~<span style=color:#f92672>]</span><span style=color:#75715e># crictl inspecti registry.cn-beijing.aliyuncs.com/kubesphereio/metrics-server:v0.4.2 | grep arch</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;architecture&#34;</span>: <span style=color:#e6db74>&#34;amd64&#34;</span>,
</span></span></code></pre></div><ul><li>获取适配的 ARM 版镜像（<strong>相同版本 KubeSphere 官方 ARM 版镜像</strong>）</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 拉取 arm64 镜像</span>
</span></span><span style=display:flex><span>crictl pull registry.cn-beijing.aliyuncs.com/kubesphereio/metrics-server:v0.4.2-arm64  --platform arm64
</span></span></code></pre></div><ul><li>镜像重新打 tag</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 删除 amd64 镜像</span>
</span></span><span style=display:flex><span>crictl rmi registry.cn-beijing.aliyuncs.com/kubesphereio/metrics-server:v0.4.2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 重新打 tag</span>
</span></span><span style=display:flex><span>ctr -n k8s.io images tag registry.cn-beijing.aliyuncs.com/kubesphereio/metrics-server:v0.4.2-arm64 registry.cn-beijing.aliyuncs.com/kubesphereio/metrics-server:v0.4.2
</span></span></code></pre></div><ul><li>重新部署组件</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 删除 ks-install 重启安装任务</span>
</span></span><span style=display:flex><span>kubectl delete pod ks-installer-6674579f54-4s4tp -n kubesphere-system
</span></span></code></pre></div><h3 id=38-解决-minio-异常>3.8 解决 Minio 异常</h3><ul><li>查看异常 Pod</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pods -A -o wide</span>
</span></span><span style=display:flex><span>NAMESPACE           NAME                                           READY   STATUS             RESTARTS        AGE     IP             NODE          NOMINATED NODE   READINESS GATES
</span></span><span style=display:flex><span>kubesphere-system   minio-757c8bc7f-tlnts                          0/1     CrashLoopBackOff   <span style=color:#ae81ff>5</span> <span style=color:#f92672>(</span>111s ago<span style=color:#f92672>)</span>    5m27s   10.233.103.4   ks-master-1   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>kubesphere-system   minio-make-bucket-job-fzz95                    0/1     Error     <span style=color:#ae81ff>2</span> <span style=color:#f92672>(</span>24s ago<span style=color:#f92672>)</span>    31s    10.233.93.5    ks-master-3   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><ul><li>查看异常 Pod 的日志</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl logs minio-757c8bc7f-tlnts -n kubesphere-system</span>
</span></span><span style=display:flex><span>exec /bin/sh: exec format error
</span></span></code></pre></div><ul><li>查看异常 Pod 使用的镜像</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Minio 组件对应两个镜像</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># crictl images ls | grep minio</span>
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/minio                     RELEASE.2019-08-07T01-59-21Z   29c267893b048       23.1MB
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-3 ~<span style=color:#f92672>]</span><span style=color:#75715e># crictl images ls | grep mc</span>
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/mc                        RELEASE.2019-08-07T23-14-43Z         c02b00df169fc       9.32MB
</span></span></code></pre></div><ul><li>查看异常 Pod 镜像架构</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 查看异常 Pod 镜像架构（以 minio 为例）</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># crictl inspecti registry.cn-beijing.aliyuncs.com/kubesphereio/minio:RELEASE.2019-08-07T01-59-21Z | grep arch</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;architecture&#34;</span>: <span style=color:#e6db74>&#34;amd64&#34;</span>,
</span></span></code></pre></div><ul><li>获取适配的 ARM 版镜像（<strong>相近版本 minio 官方 ARM 版镜像</strong>）</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 找个相近版本的 ARM 架构的镜像</span>
</span></span><span style=display:flex><span><span style=color:#75715e># minio</span>
</span></span><span style=display:flex><span>crictl pull minio/minio:RELEASE.2020-11-25T22-36-25Z-arm64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># mc</span>
</span></span><span style=display:flex><span>crictl pull minio/mc:RELEASE.2020-11-25T23-04-07Z-arm64
</span></span></code></pre></div><ul><li>镜像重新打 tag</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># minio</span>
</span></span><span style=display:flex><span>crictl rmi registry.cn-beijing.aliyuncs.com/kubesphereio/minio:RELEASE.2019-08-07T01-59-21Z
</span></span><span style=display:flex><span>ctr -n k8s.io images tag docker.io/minio/minio:RELEASE.2020-11-25T22-36-25Z-arm64 registry.cn-beijing.aliyuncs.com/kubesphereio/minio:RELEASE.2019-08-07T01-59-21Z
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># mc</span>
</span></span><span style=display:flex><span>crictl rmi registry.cn-beijing.aliyuncs.com/kubesphereio/mc:RELEASE.2019-08-07T23-14-43Z
</span></span><span style=display:flex><span>ctr -n k8s.io images tag --force docker.io/minio/mc:RELEASE.2020-11-25T23-04-07Z-arm64 registry.cn-beijing.aliyuncs.com/kubesphereio/mc:RELEASE.2019-08-07T23-14-43Z
</span></span></code></pre></div><ul><li>重新部署组件</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 重新部署,删除旧的 Pod，系统会自动创建新的（此步的操作也可以使用修改 minio 对应的 deployment 使用的镜像名称的方式）</span>
</span></span><span style=display:flex><span>kubectl delete pod minio-757c8bc7f-tlnts -n kubesphere-system
</span></span><span style=display:flex><span>kubectl delete pod minio-make-bucket-job-fzz95 -n kubesphere-system
</span></span></code></pre></div><h3 id=39-解决组件异常通用方案>3.9 解决组件异常通用方案</h3><p>在部署 ARM 的 KubeSphere 和 Kubernetes 集群时，遇到的异常多数都是因为镜像架构不匹配造成的，当遇到本文没有涉及的异常组件时，可以参考以下流程解决。</p><ul><li>查看异常 Pod</li><li>查看异常 Pod 的日志</li><li>查看异常 Pod 使用的镜像</li><li>查看异常 Pod 镜像架构</li><li>获取适配的 ARM 版镜像</li><li>镜像重新打 tag</li><li>重新部署组件</li></ul><h2 id=4-部署测试资源>4. 部署测试资源</h2><p>在解决完所有异常组件后，整个 Kubetnetes 集群中的 Pod 都应该处于 Running 状态，代表着 KubeSphere 和 Kubernetes 表面上看着是正常的。</p><p>在上篇文档中我们已经验证测试了 KubeSphere 和 Kubernetes 集群的状态。</p><p>接下来我们将在 Kubernetes 集群上部署一个简单的 Nginx Web 服务器，测试验证 Kubernetes 和 KubeSphere 基本功能是否正常。</p><p>本示例使用命令行工具在 Kubernetes 集群上部署一个 Nginx Web 服务器并利用 KubeSphere 图形化管理控制台查看部署的资源信息。</p><h3 id=41-创建-nginx-deployment>4.1 创建 Nginx Deployment</h3><p>运行以下命令创建一个部署 Nginx Web 服务器的 Deployment。此示例中，我们将创建具有两个副本基于 nginx:alpine 镜像的 Pod。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create deployment nginx --image<span style=color:#f92672>=</span>nginx:alpine --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>
</span></span></code></pre></div><h3 id=42-创建-nginx-service>4.2 创建 Nginx Service</h3><p>创建一个新的 Kubernetes 服务，服务名称 nginx，服务类型 Nodeport，对外的服务端口 80。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl create service nodeport nginx --tcp<span style=color:#f92672>=</span>80:80
</span></span></code></pre></div><h3 id=43-验证-nginx-deployment-和-pod>4.3 验证 Nginx Deployment 和 Pod</h3><ul><li>运行以下命令查看创建的 Deployment 和 Pod 资源。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get deployment -o wide
</span></span><span style=display:flex><span>kubectl get pods -o wide
</span></span></code></pre></div><ul><li>查看结果如下：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get deployment -o wide</span>
</span></span><span style=display:flex><span>NAME    READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES         SELECTOR
</span></span><span style=display:flex><span>nginx   2/2     <span style=color:#ae81ff>2</span>            <span style=color:#ae81ff>2</span>           20s   nginx        nginx:alpine   app<span style=color:#f92672>=</span>nginx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pods -o wide</span>
</span></span><span style=display:flex><span>NAME                     READY   STATUS    RESTARTS   AGE   IP               NODE          NOMINATED NODE   READINESS GATES
</span></span><span style=display:flex><span>nginx-6c557cc74d-tbw9c   1/1     Running   <span style=color:#ae81ff>0</span>          23s   10.233.102.187   ks-master-2   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>nginx-6c557cc74d-xzzss   1/1     Running   <span style=color:#ae81ff>0</span>          23s   10.233.103.148   ks-master-1   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><h3 id=44-验证-nginx-镜像架构>4.4 验证 Nginx 镜像架构</h3><ul><li>运行以下命令查看 Nginx Image 的架构类型</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>crictl inspecti nginx:alpine | grep architecture
</span></span></code></pre></div><ul><li>查看结果如下：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># crictl inspecti nginx:alpine | grep architecture</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;architecture&#34;</span>: <span style=color:#e6db74>&#34;arm64&#34;</span>
</span></span></code></pre></div><h3 id=45-验证-nginx-service>4.5 验证 Nginx Service</h3><p>运行以下命令查看可用的服务列表，在列表中我们可以看到 Nginx 服务类型 为 Nodeport，并在 Kubernetes 主机上开放了 <strong>30563</strong> 端口。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get svc -o wide
</span></span></code></pre></div><p>查看结果如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get svc -o wide</span>
</span></span><span style=display:flex><span>NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span style=color:#f92672>(</span>S<span style=color:#f92672>)</span>        AGE     SELECTOR
</span></span><span style=display:flex><span>kubernetes   ClusterIP   10.233.0.1     &lt;none&gt;        443/TCP        4d22h   &lt;none&gt;
</span></span><span style=display:flex><span>nginx        NodePort    10.233.14.48   &lt;none&gt;        80:30619/TCP   5s      app<span style=color:#f92672>=</span>nginx
</span></span></code></pre></div><h3 id=46-验证服务>4.6 验证服务</h3><p>运行以下命令访问部署的 Nginx 服务，验证服务是否成功部署。</p><ul><li>验证直接访问 Pod</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl 10.233.102.187
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 访问结果如下</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># curl 10.233.102.187</span>
</span></span><span style=display:flex><span>&lt;!DOCTYPE html&gt;
</span></span><span style=display:flex><span>&lt;html&gt;
</span></span><span style=display:flex><span>&lt;head&gt;
</span></span><span style=display:flex><span>&lt;title&gt;Welcome to nginx!&lt;/title&gt;
</span></span><span style=display:flex><span>&lt;style&gt;
</span></span><span style=display:flex><span>html <span style=color:#f92672>{</span> color-scheme: light dark; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>body <span style=color:#f92672>{</span> width: 35em; margin: <span style=color:#ae81ff>0</span> auto;
</span></span><span style=display:flex><span>font-family: Tahoma, Verdana, Arial, sans-serif; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>&lt;/style&gt;
</span></span><span style=display:flex><span>&lt;/head&gt;
</span></span><span style=display:flex><span>&lt;body&gt;
</span></span><span style=display:flex><span>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
</span></span><span style=display:flex><span>&lt;p&gt;If you see this page, the nginx web server is successfully installed and
</span></span><span style=display:flex><span>working. Further configuration is required.&lt;/p&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;p&gt;For online documentation and support please refer to
</span></span><span style=display:flex><span>&lt;a href<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://nginx.org/&#34;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
</span></span><span style=display:flex><span>Commercial support is available at
</span></span><span style=display:flex><span>&lt;a href<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://nginx.com/&#34;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;p&gt;&lt;em&gt;Thank you <span style=color:#66d9ef>for</span> using nginx.&lt;/em&gt;&lt;/p&gt;
</span></span><span style=display:flex><span>&lt;/body&gt;
</span></span><span style=display:flex><span>&lt;/html&gt;
</span></span></code></pre></div><ul><li>验证访问 Service</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl 10.233.14.48
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 访问结果同上，略</span>
</span></span></code></pre></div><ul><li>验证访问 Nodeport</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl 172.16.33.16:30619
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 访问结果同上，略</span>
</span></span></code></pre></div><h3 id=47-在管理控制台查看>4.7 在管理控制台查看</h3><p>接下来我们回到 KubeSphere 管理控制台，在管理控制台查看已经创建的资源。</p><blockquote><p><strong>说明：</strong> KubeSphere 的管理控制台具有友好地、图形化创建 Kubernetes 各种资源的功能，主要是截图太麻烦了，所以本文采用了命令行的方式简单的创建了测试资源。</p><p>只是在查看的时候给大家演示一下 KubeSphere 管理控制台的基本功能，实际使用中，大家可以使用图形化方式创建和管理 Kubernetes 资源。</p></blockquote><ul><li>登录 KubeSphere 管理控制台，点击「平台管理」，选择「集群管理」。</li><li>单击集群管理页面左侧的「应用负载」，点击「工作负载」。默认会看到所有类型为<strong>部署</strong>的工作负载。</li></ul><p>我们使用的是 admin 账户，因此可以看到所有的工作负载，在搜索框输入 nginx，只显示 Nginx 部署工作负载。</p><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-clusters-deployments-v340-v126-arm.png alt></p><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-clusters-deployments-nginx-v340-v126-arm.png alt></p><ul><li>单击部署列表中的 Nginx，可以查看更详细的信息，并且管理 Nginx 部署 (Deployment)。</li></ul><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-clusters-deployments-nginx-resource-status-v340-v126-arm.png alt></p><ul><li>单击容器组中的一个 Nginx 容器，可以查看容器的状态、监控等信息。</li></ul><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-clusters-pods-nginx-monitors-v340-v126-arm.png alt></p><ul><li>回到「平台管理」-「集群管理」页面，单击集群管理页面左侧的「应用负载」，点击「服务」。默认会看到所有类型为<strong>服务</strong>的工作负载。</li></ul><p>我们使用的是 admin 账户，因此可以看到所有的工作负载，在搜索框输入 Nginx，只显示 Nginx 服务工作负载。</p><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-clusters-services-v340-v126-arm.png alt></p><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-clusters-services-nginx-v340-v126-arm.png alt></p><ul><li>单击服务列表中的 Nginx，可以查看更详细的信息，并且管理 Nginx 服务 (Service)。</li></ul><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-clusters-services-nginx-resource-status-v340-v126-arm.png alt></p><p>至此，我们实现了将 Nginx Web 服务器部署到 Kubernetes 集群，并通过 KubeSphere 管理控制台查看、验证了部署的 Deployment、Pod、Service 的详细信息。</p><p>本文仅对 ARM 架构下部署的 KubeSphere 和 Kubernetes 做了最基本的资源创建的验证测试，更多的完整的可插拔组件的测试并未涉及，请读者根据需求自己验证、测试。</p><p>在验证测试过程中遇到的问题多数都应该是镜像架构不匹配造成的，参考本文<strong>第 5 小节</strong>中解决问题的思路和流程，应该能解决大部分问题。</p><h2 id=5-补充说明>5. 补充说明</h2><p>本小节我们展示一些集群的基本信息和一些测试验证的说明。</p><h3 id=51-查看-image-列表>5.1 查看 Image 列表</h3><p>本小节，我们查看一下到目前为止，整个 KubeSphere 和 Kubernetes 集群用到了哪些镜像。</p><p>在每个节点输入以下命令获取在 Kubernetes 集群节点上已经下载的 Image 列表。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>crictl images ls
</span></span></code></pre></div><p>以下结果是在所有执行查看命令后的汇总输出：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># crictl images ls | grep -v docker.io &gt; /tmp/1.txt</span>
</span></span><span style=display:flex><span><span style=color:#75715e># crictl images ls | grep -v docker.io &gt; /tmp/2.txt</span>
</span></span><span style=display:flex><span><span style=color:#75715e># crictl images ls | grep -v docker.io &gt; /tmp/3.txt</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  cat 1.txt 2.txt 3.txt | awk &#39;{if (!seen[$1]++) {print}}&#39; | sort</span>
</span></span><span style=display:flex><span>IMAGE                                                                       TAG                                  IMAGE ID            SIZE
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/alertmanager                  v0.23.0                              44a71f29f42b0       25MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/argocd-applicationset-arm64   v0.4.1                               758eaf0d9da26       76.2MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/argocd-applicationset         v0.4.1                               f5ac1e612edca       77.7MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/argocd                        v2.3.3                               9a557f111ba0b       185MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/cni                           v3.23.2                              dbad3c1a529ac       76.3MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/configmap-reload              v0.7.1                               b4151c08af07d       3.73MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/coredns                       1.9.3                                b19406328e70d       13.4MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/defaultbackend-amd64          1.4                 							   846921f0fe0e5       1.82MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/defaultbackend-arm64          1.4                                  156fbd4afe405       1.67MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/devops-apiserver              ks-v3.4.0                            c89baacbfca67       29.8MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/devops-controller             ks-v3.4.0                            5b4ce4e345d4a       26.3MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/devops-tools                  ks-v3.4.0                            3b2bc61feca12       28.9MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/dex                           v2.30.2                              cd0eb92a37da5       24.1MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/docker                        19.03                                59291a2ff3232       60.8MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/fluentbit-operator            v0.14.0                              1fe6aebe29cb9       18.7MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/fluent-bit                    v1.9.4                               bb0200a3096d6       25.8MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/haproxy                       2.3                                  5be62463c49bf       37.3MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-operator               1.29                                 7e6f4ab1586b7       105MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/k8s-dns-node-cache            1.15.12                              c5c27a390f5fa       41.9MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/kiali-operator                v1.50.1                              c3dc2b49c5e8b       250MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/kiali                         v1.50                                97c5cab789c50       78MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/ks-apiserver                  v3.4.0                               de0e22c9bcf4f       61.5MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/ks-console                    v3.4.0                               42b2364bcafe3       38.7MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/ks-controller-manager         v3.4.0                               4ff90f750485b       46.9MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/ks-installer                  v3.4.0                               3471e6e1d2af0       153MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/ks-jenkins                    v3.4.0-2.319.3-1                     4b52636ce9e50       581MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-apiserver                v1.26.5                              06a268629a822       32.4MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-auditing-operator        v0.2.0                               9c5612b5f8a8e       8.37MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-auditing-webhook         v0.2.0                               f23e1078e2b2c       11.5MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-controller-manager       v1.26.5                              a7b6fa1339316       29.6MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-controllers              v3.23.2                              5a33f410afb91       25.1MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/kubectl                       v1.22.0                              29c024bbbf9b1       25.2MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-events-exporter          v0.6.0                               452463fb02cb2       19.7MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-events-operator          v0.6.0                               27146d6e5ab73       21.5MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-events-ruler             v0.6.0                               12573f2ffe64d       25.1MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-proxy                    v1.26.5                              5e89f86edbb88       19.3MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-rbac-proxy               v0.11.0                              bee4dbe8a9f42       17.9MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-scheduler                v1.26.5                              9eb699cb795f8       16.1MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-state-metrics            v2.6.0                               150fa1ddd5ab3       10.8MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/linux-utils                   3.3.0                                d06b9d3a552bc       27.3MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/log-sidecar-injector          v1.2.0                               dbad25c47d9ec       9.9MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/mc                            RELEASE.2019-08-07T23-14-43Z         c02b00df169fc       11.7MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/metrics-server                v0.4.2                               b266eabac7d6a       23.6MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/minio                         RELEASE.2019-08-07T01-59-21Z         6760283c70e3e       23MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/node-exporter                 v1.3.1                               bb203ba967a80       9.72MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/node                          v3.23.2                              2a3416a8ae05d       73MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/notification-manager-operator v2.3.0                               3d8285028607a       17.9MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/notification-manager          v2.3.0                               b4d8dc4ea25ac       20.1MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/notification-tenant-sidecar   v3.2.0                               e41b413830c35       13.2MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/openldap                      1.3.0                                8803fc65b2bfa       91.6MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/openpitrix-jobs               v3.3.2                               d1afba2bac100       15.3MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/opensearch                    2.6.0                                92fe7c48b27f4       813MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/opensearch-curator            v0.0.5                               5791cbce4e83d       19MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/pause                         3.8                                  4e42fb3c9d90e       268kB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/pilot                         1.15.7                               4f12fc8040fe7       66MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/pod2daemon-flexvol            v3.23.2                              d48543e4a525a       4.56MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/prometheus-config-reloader    v0.55.1                              4152fd84f8c36       4.61MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/prometheus-operator           v0.55.1                              8e6f6c78032e8       13.1MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/prometheus                    v2.39.1                              af3e34b4a84e5       83.4MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/provisioner-localpv           3.3.0                                2f625755a998b       27.3MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/redis                         6.2.6-alpine                         50bbab999a871       10.8MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/s2ioperator                   v3.2.1                               30b700dff15f8       11.8MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/scope                         1.13.0                               ca6176be9738f       30.7MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/snapshot-controller           v4.0.0                               3758cfc26c6db       17.7MB
</span></span><span style=display:flex><span>registry.cn-beijing.aliyuncs.com/kubesphereio/thanos                        v0.31.0                              5595f682eee8a       37.7MB
</span></span></code></pre></div><h3 id=52-devops-模块验证说明>5.2 DevOps 模块验证说明</h3><p>在解决了 Jenkins 等镜像架构异常后，DevOps 流水线能创建项目、创建流水线，编辑 Jenkinsfile，流水线的流程图也能正常显示。</p><p>构建应用的时候 Maven 容器依旧起不来，暂时没有找到解决方案，作为遗留问题，后续解决了再说。</p><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-v340-v126-devops-pipelines.png alt></p><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-v340-v126-devops-pipelines-test.png alt></p><p><img src=https://opsman-1258881081.cos.ap-beijing.myqcloud.com//ksp-v340-v126-devops-pipelines-test-error.png alt></p><h2 id=6-常见问题>6. 常见问题</h2><h3 id=61-问题-1>6.1 问题 1</h3><ul><li>报错现象</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 安装失败，最后报错</span>
</span></span><span style=display:flex><span>Please wait <span style=color:#66d9ef>for</span> the installation to complete:   &gt;&gt;---&gt;
</span></span><span style=display:flex><span>13:08:38 CST skipped: <span style=color:#f92672>[</span>ks-master-3<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>13:08:38 CST skipped: <span style=color:#f92672>[</span>ks-master-2<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>13:08:38 CST failed: <span style=color:#f92672>[</span>ks-master-1<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>error: Pipeline<span style=color:#f92672>[</span>CreateClusterPipeline<span style=color:#f92672>]</span> execute failed: Module<span style=color:#f92672>[</span>CheckResultModule<span style=color:#f92672>]</span> exec failed:
</span></span><span style=display:flex><span>failed: <span style=color:#f92672>[</span>ks-master-1<span style=color:#f92672>]</span> execute task timeout, Timeout<span style=color:#f92672>=</span>2h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看 Pods</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 kubekey<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pods -A</span>
</span></span><span style=display:flex><span>NAMESPACE           NAME                                           READY   STATUS             RESTARTS        AGE
</span></span><span style=display:flex><span>kube-system         metrics-server-66b6cfb784-85l94                0/1     CrashLoopBackOff   <span style=color:#ae81ff>38</span> <span style=color:#f92672>(</span>114s ago<span style=color:#f92672>)</span>   171m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看 Pod 日志</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 kubekey<span style=color:#f92672>]</span><span style=color:#75715e># kubectl logs metrics-server-66b6cfb784-85l94 -n kube-system</span>
</span></span><span style=display:flex><span>exec /metrics-server: exec format error
</span></span></code></pre></div><ul><li>解决方案</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>参考 3.7 小节的 解决 metrics-server 异常
</span></span></code></pre></div><h3 id=62-问题-2>6.2 问题 2</h3><ul><li>报错信息</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>## devops 流水线功能异常，仅做记录，未最终解决</span>
</span></span><span style=display:flex><span>Started by user opsman
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Pipeline<span style=color:#f92672>]</span> Start of Pipeline
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Pipeline<span style=color:#f92672>]</span> node
</span></span><span style=display:flex><span>Still waiting to schedule task
</span></span><span style=display:flex><span>All nodes of label ‘maven’ are offline
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-1 ~<span style=color:#f92672>]</span><span style=color:#75715e># kubectl get pods -n kubesphere-devops-worker</span>
</span></span><span style=display:flex><span>NAME          READY   STATUS        RESTARTS   AGE
</span></span><span style=display:flex><span>maven-604qz   1/2     Terminating   <span style=color:#ae81ff>0</span>          5s
</span></span><span style=display:flex><span>maven-7krjb   1/2     Terminating   <span style=color:#ae81ff>0</span>          5s
</span></span><span style=display:flex><span>maven-b43fl   1/2     Terminating   <span style=color:#ae81ff>0</span>          5s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>5s                      Normal   Started     Pod/maven-pxrt3   Started container jnlp
</span></span><span style=display:flex><span>4s                      Normal   Started     Pod/maven-xnt3j   Started container jnlp
</span></span><span style=display:flex><span>4s                      Normal   Pulled      Pod/maven-xnt3j   Container image <span style=color:#e6db74>&#34;registry.cn-beijing.aliyuncs.com/kubesphereio/inbound-agent:4.10-2&#34;</span> already present on machine
</span></span><span style=display:flex><span>4s                      Normal   Started     Pod/maven-xnt3j   Started container maven
</span></span><span style=display:flex><span>4s                      Normal   Created     Pod/maven-xnt3j   Created container maven
</span></span><span style=display:flex><span>4s                      Normal   Created     Pod/maven-xnt3j   Created container jnlp
</span></span><span style=display:flex><span>4s                      Normal   Pulled      Pod/maven-xnt3j   Container image <span style=color:#e6db74>&#34;registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.0-podman&#34;</span> already present on machine
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-2 ~<span style=color:#f92672>]</span><span style=color:#75715e># crictl inspecti registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.0-podman | grep arch</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;architecture&#34;</span>: <span style=color:#e6db74>&#34;amd64&#34;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-2 ~<span style=color:#f92672>]</span><span style=color:#75715e># crictl inspecti registry.cn-beijing.aliyuncs.com/kubesphereio/inbound-agent:4.10-2 | grep arch</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;architecture&#34;</span>: <span style=color:#e6db74>&#34;arm64&#34;</span>,
</span></span></code></pre></div><ul><li>解决方案</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 说明：没有最终解决，只解决了镜像架构异常，但是后面构建应用的时候 maven 容器依旧起不来</span>
</span></span><span style=display:flex><span>crictl pull kubespheredev/builder-maven:v3.3.1-podman --platform arm64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@ks-master-2 ~<span style=color:#f92672>]</span><span style=color:#75715e># crictl inspecti kubespheredev/builder-maven:v3.3.1-podman | grep arch | head -1</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;architecture&#34;</span>: <span style=color:#e6db74>&#34;arm64&#34;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 偷梁换柱，强制修改 tag（这个方案比较粗暴，建议采取自己构建同版本 ARM 镜像或是修改 kubesphere-devops-system 项目下的配置字典 jenkins-casc-config 中的 jenkins_user.yaml ，修改镜像版本）</span>
</span></span><span style=display:flex><span>crictl rmi registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.0-podman
</span></span><span style=display:flex><span>ctr -n k8s.io images tag docker.io/kubespheredev/builder-maven:v3.3.1-podman registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.0-podman --force
</span></span><span style=display:flex><span><span style=color:#75715e>#ctr -n k8s.io images tag docker.io/kubespheredev/builder-maven:v3.3.1-podman registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.3.1-podman</span>
</span></span></code></pre></div><h2 id=7-总结>7. 总结</h2><p>本专题主要实战演示了在 ARM 版 openEuler 22.03 LTS SP2 服务器上，利用 KubeKey 3.0.10 自动化部署最小化 KubeSphere 3.4.0 和 Kubernetes 1.26.5 高可用集群的详细过程。</p><p>部署完成后，我们还利用 KubeSphere 管理控制台和 kubectl 命令行，查看并验证了 KubeSphere 和 Kubernetes 集群的状态。</p><p>最终我们通过在 Kubenetes 集群上部署 Nginx Web 服务器验证了 Kubernetes 集群和 KubeSphere 的可用性，并通过在 KubeSphere 管理控制台查看 Nginx Pod 和服务状态的操作，了解了 KubeSphere 的基本用法。</p><p>概括总结全文主要涉及以下内容：</p><ul><li>openEuler 22.03 LTS SP2 aarch64 操作系统基础配置</li><li>操作系统数据盘 LVM 配置、磁盘挂载、数据目录创建</li><li>KubeKey 下载及创建集群配置文件</li><li>利用 KubeKey 自动化部署 KubeSphere 和 Kubernetes 集群</li><li>解决 ARM 版 KubeSphere 和 Kubernetes 服务组件异常的问题</li><li>部署完成后的 KubeSphere 和 Kubernetes 集群状态验证</li><li>部署 Nginx 验证测试 KubeSphere 和 Kubernetes 基本功能</li></ul><p>本文部署环境虽然是基于 <strong>Kunpeng-920</strong> 芯片的 aarch64 版 openEuler 22.03 LTS SP2 ，但是对于 CentOS、麒麟 V10 SP2 等 ARM 版操作系统以及飞腾（FT-2500）等芯片也有一定的借鉴意义。</p><p>本文介绍的内容可直接用于研发、测试环境，对于生产环境有一定的参考意义，<strong>绝对不能</strong>直接用于生产环境。</p><p><strong>本文的不完全测试结论：</strong> KubeSphere 和 Kubernetes 基本功能可用，DevOps 功能部分可用，主要问题在构建镜像时 Maven 容器启动异常，<strong>其他插件功能未做验证</strong>。</p></div></div><div class=share-2><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-kubesphere-v3.4.0-on-arm-openeuler-2%2f&text=ARM%20%e7%89%88%20openEuler%2022.03%20%e9%83%a8%e7%bd%b2%20KubeSphere%203.4.0%20%e4%b8%8d%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%e7%bb%ad%e7%af%87" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-kubesphere-v3.4.0-on-arm-openeuler-2%2f&title=ARM%20%e7%89%88%20openEuler%2022.03%20%e9%83%a8%e7%bd%b2%20KubeSphere%203.4.0%20%e4%b8%8d%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%e7%bb%ad%e7%af%87" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-kubesphere-v3.4.0-on-arm-openeuler-2%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-kubesphere-v3.4.0-on-arm-openeuler-2%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-kubesphere-v3.4.0-on-arm-openeuler-2%2f&t=ARM%20%e7%89%88%20openEuler%2022.03%20%e9%83%a8%e7%bd%b2%20KubeSphere%203.4.0%20%e4%b8%8d%e5%ae%8c%e5%85%a8%e6%8c%87%e5%8d%97%e7%bb%ad%e7%af%87" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div></div><div class=aside><div class=inner-div><div class=title>目录</div><div class=tabs><nav id=TableOfContents><ul><li><a href=#前言>前言</a><ul><li><a href=#知识点>知识点</a></li><li><a href=#实战服务器配置-个人云上测试服务器>实战服务器配置 (个人云上测试服务器)</a></li><li><a href=#实战环境涉及软件版本信息>实战环境涉及软件版本信息</a></li></ul></li><li><a href=#1-本文简介>1. 本文简介</a></li><li><a href=#2-安装过程中出现的异常及解决方案>2. 安装过程中出现的异常及解决方案</a><ul><li><a href=#21-kubernetes-相关组件二进制包格式不匹配>2.1 Kubernetes 相关组件二进制包格式不匹配</a></li></ul></li><li><a href=#3-异常组件及解决方案>3. 异常组件及解决方案</a><ul><li><a href=#31-查看异常组件对应的-pod>3.1 查看异常组件对应的 Pod</a></li><li><a href=#32-解决-argo-cd-异常>3.2 解决 Argo CD 异常</a></li><li><a href=#33-解决-istio-异常>3.3 解决 Istio 异常</a></li><li><a href=#34-解决-http-backupend-异常>3.4 解决 http-backupend 异常</a></li><li><a href=#35-解决-jenkins-异常>3.5 解决 Jenkins 异常</a></li><li><a href=#36-解决-weave-异常>3.6 解决 weave 异常</a></li><li><a href=#37-解决-metrics-server-异常>3.7 解决 metrics-server 异常</a></li><li><a href=#38-解决-minio-异常>3.8 解决 Minio 异常</a></li><li><a href=#39-解决组件异常通用方案>3.9 解决组件异常通用方案</a></li></ul></li><li><a href=#4-部署测试资源>4. 部署测试资源</a><ul><li><a href=#41-创建-nginx-deployment>4.1 创建 Nginx Deployment</a></li><li><a href=#42-创建-nginx-service>4.2 创建 Nginx Service</a></li><li><a href=#43-验证-nginx-deployment-和-pod>4.3 验证 Nginx Deployment 和 Pod</a></li><li><a href=#44-验证-nginx-镜像架构>4.4 验证 Nginx 镜像架构</a></li><li><a href=#45-验证-nginx-service>4.5 验证 Nginx Service</a></li><li><a href=#46-验证服务>4.6 验证服务</a></li><li><a href=#47-在管理控制台查看>4.7 在管理控制台查看</a></li></ul></li><li><a href=#5-补充说明>5. 补充说明</a><ul><li><a href=#51-查看-image-列表>5.1 查看 Image 列表</a></li><li><a href=#52-devops-模块验证说明>5.2 DevOps 模块验证说明</a></li></ul></li><li><a href=#6-常见问题>6. 常见问题</a><ul><li><a href=#61-问题-1>6.1 问题 1</a></li><li><a href=#62-问题-2>6.2 问题 2</a></li></ul></li><li><a href=#7-总结>7. 总结</a></li></ul></nav></div></div></div></div></section><div class=SubscribeForm><div class=innerBox><img class=close src=/images/home/close.svg alt=close><p class=description>通过邮件接收 KubeSphere 最新的技术博客与产品更新的通知</p><div id=blog_formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input-blog type=text placeholder>
<button id=email-submit-blog>订阅</button>
<span id=message_blog data-message1=请提供您的邮箱 data-message2=请输入有效的邮箱地址! data-message3=邮箱地址已经存在 style=color:red></span><span id=message1_blog style=color:#00a971 data-success=订阅成功啦，我们保证不会给你发垃圾邮件的啦></span></div></div></div><footer><div class=footer><div class="footer-main common-layout"><div class=up-main><div class=left-div><img src=/images/logo.svg alt class=foot-logo><p>通过邮件接收 KubeSphere 最新的技术博客与产品更新的通知</p><div id=formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input type=text placeholder=请输入您的邮箱地址>
<button id=email-submit>订阅</button></div><span id=message data-message1=请提供您的邮箱 data-message2=请输入有效的邮箱地址! data-message3=邮箱地址已经存在></span><span id=message1 style=color:#00a971 data-success=订阅成功啦，我们保证不会给你发垃圾邮件的啦></span><script>var bindSubmit=function(){var e=$("#email-input");$("#email-submit").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message").data("message1"),a=$("#message").data("message2"),r=$("#message").data("message3"),c=$("#message1").data("success");if(n)if(validateEmail(n)){if(s=$("#formAddress").data("usesendcloud"),!s)return;o=$("#formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:$("#email-input").val().toString()},success:function(){showSuccessMessage(c),setTimeout(function(){$("#email-input").val("")},1e3)},error:function(){showMessage(r)}})}else t.preventDefault(),showMessage(a);else t.preventDefault(),showMessage(i)})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},showMessage=function(e){$("#message").html(e).show()},showSuccessMessage=function(e){$("#message1").html(e).show()},bindHideMessage=function(){$(window).click(function(){$("#message").hide(),$("#message1").hide()})},bindClose=function(){$(".formBox .close").click(function(e){e.stopPropagation(),$(".formBox").fadeOut()})};bindSubmit(),bindClose(),bindHideMessage()</script><span id=message data-message1=请提供您的邮箱 data-message2=请输入有效的邮箱地址!></span></div><div class=right-div><ul class=common-flex-layout><li class=nowrap-li><div class=h3>应用场景</div><a href=/zh/devops/>拥抱一站式 DevOps</a>
<a href=/zh/service-mesh/>在 K8s 运行微服务</a>
<a href=/zh/observability/>构建云原生可观测性</a>
<a href=https://github.com/kubesphere/kubekey target=_blank rel="noopener noreferrer">K8s 一键部署与运维</a>
<a href=https://github.com/OpenFunction/OpenFunction target=_blank rel="noopener noreferrer">构建 FaaS 平台与 Serverless 架构</a>
<a href=https://github.com/openpitrix/openpitrix target=_blank rel="noopener noreferrer">多云应用管理平台</a></li><li class=nowrap-li><div class=h3>资源</div><a href=/zh/projects/>开源项目</a>
<a href=/zh/blogs/>技术博客</a>
<a href=/zh/conferences/>开源峰会</a>
<a href=/zh/videos/>视频资源</a>
<a href=/zh/learn/>云原生实战</a></li><li class=nowrap-li><div class=h3>文档中心</div><a href=/zh/docs/v4.1/01-intro/01-introduction/>产品介绍</a>
<a href=/zh/docs/v4.1/03-installation-and-upgrade/02-install-kubesphere/02-install-kubernetes-and-kubesphere/>如何安装</a>
<a href=/zh/docs/v4.1/02-quickstart/>快速入门</a>
<a href=/zh/docs/v3.4/reference/api-docs/>API 文档</a></li><li class=nowrap-li><div class=h3>开源社区</div><a href=/zh/contribution/>参与贡献</a>
<a href=/zh/live/>社区活动</a>
<a href=/zh/case/>案例学习</a>
<a href=/zh/partner/>合作伙伴</a>
<a href=/zh/user-group/>用户委员会</a>
<a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">版本计划</a>
<a href=https://kubesphere.com.cn/ target=_blank rel="noopener noreferrer">中国站</a>
<a href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">中文论坛</a>
<a href=https://kubesphere.io target=_blank rel="noopener noreferrer">全球站</a></li><li class=nowrap-li><div class=h3>产品与服务</div><a href=https://aws.amazon.com/cn/quickstart/architecture/qingcloud-kubesphere/ target=_blank rel="noopener noreferrer">KubeSphere on AWS</a>
<a href=https://market.azure.cn/marketplace/apps/qingcloud.kubesphere target=_blank rel="noopener noreferrer">KubeSphere on Azure</a>
<a href=https://marketplace.digitalocean.com/apps/kubesphere target=_blank rel="noopener noreferrer">KubeSphere on DigitalOcean</a>
<a href=https://www.qingcloud.com/products/kubesphereqke target=_blank rel="noopener noreferrer">KubeSphere on QingCloud(QKE)</a>
<a href=https://kubesphere.com.cn/kse/ target=_blank rel="noopener noreferrer">KubeSphere 企业版</a>
<a href=https://kubesphere.cloud/ksv/ target=_blank rel="noopener noreferrer">KubeSphere 虚拟化平台</a>
<a href=https://kubesphere.com.cn/marketplace/ target=_blank rel="noopener noreferrer">云原生扩展组件市场</a>
<a href=https://kubesphere.cloud target=_blank rel="noopener noreferrer">云原生应用服务平台</a>
<a href=https://m.qingcloud.com/p/aec50 target=_blank rel="noopener noreferrer">了解商业产品与咨询合作</a></li></ul></div></div><div class=down-main><div class=img-div><a class=wechat href=javascript:void(0); aria-label=wechat><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28"><defs><path id="a" d="M0 0h15.673v12.156H0z"/></defs><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="13" cy="13" r="13" stroke="#B6C2CD"/><g transform="translate(5 7)"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59.0-4.625 1.679-4.625 3.74.0 2.066 2.035 3.738 4.625 3.738.542.0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27.0-.541-.257-.541-.514.0-.256.27-.514.541-.514.41.0.681.258.681.514.0.257-.271.514-.681.514zm2.994.0c-.27.0-.541-.257-.541-.514.0-.256.27-.514.54-.514.41.0.681.258.681.514.0.257-.277.514-.68.514z" mask="url(#b)"/><path fill="currentColor" d="M10.602 3.674c.177.0.356.011.533.029C10.657 1.576 8.27.0 5.543.0 2.498.0.0 1.974.0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17.0.343-.005.515-.022a3.68 3.68.0 01-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417.0.693.263.693.66s-.276.66-.693.66c-.418.0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417.0-.834-.263-.834-.66s.417-.66.834-.66c.418.0.695.263.695.66.0.392-.277.66-.695.66z" mask="url(#b)"/></g></g></svg><div class=hide-div><img src=/images/home/wechat.svg alt></div></a><a class=facebook-a href=https://www.facebook.com/kubesphere target=_blank aria-label=facebook></a><a class=twitter-a href=https://x.com/KubeSphere target=_blank aria-label=twitter rel="noopener noreferrer"></a><a class=linkedin-a href=https://www.linkedin.com/company/kubesphere/ target=_blank aria-label=linkedin rel="noopener noreferrer"></a><a class=bilibili-a href=https://space.bilibili.com/438908638 target=_blank aria-label=bilibili rel="noopener noreferrer"></a><a class=slack-a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank aria-label=slack rel="noopener noreferrer"></a><a class=github-a href=https://github.com/kubesphere/kubesphere target=_blank aria-label=github rel="noopener noreferrer"></a><a class=medium-a href=https://itnext.io/@kubesphere target=_blank aria-label=medium rel="noopener noreferrer"></a></div><p class=p1></p><p class=case><a href=http://www.beian.miit.gov.cn/ target=_blank rel="noopener noreferrer"><span>京ICP备13019086号</span>
</a><a target=_blank rel="noopener noreferrer" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502041003"><img src=/images/footer/case-icon.png alt=备案图标>
<span>京公网安备 11010502041003号</span></a></p></div></div></div><div class=cookie><div class=common-layout><p>您的隐私对我们很重要。我们使用Cookie来记住订阅详细信息，优化网站功能并交付根据您的兴趣量身定制的内容。要了解更多信息，请参阅我们的<a href=/zh/privacy>隐私政策</a>.</p><button>
接受并继续</button></div></div></footer><script>var lazyLoad=function(e,t){for(var n,o,i,s=0;s<t;s++){if(n=e.eq(s),o=n.attr("data-loaded"),o)continue;n.offset().top<parseInt($(window).height())+parseInt($(window).scrollTop())&&(i=n.attr("src"),n.attr("src",i),n.attr("data-loaded",!0))}},bindLayLoad=function(){var e=$("img"),t=e.length;lazyLoad(e,t),$(window).scroll(function(){lazyLoad(e,t)})},bindAddPadding=function(){var e=$("#close-join");e.length>0&&$(".main-section").addClass("padding")},docCookies={getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t){return!!e&&!/^(?:expires|max-age|path|domain|secure)$/i.test(e)&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t),!0)}},bindHideCookie=function(){var t=docCookies.getItem("hasAuth"),e=$(".cookie");t?e.hide():e.show(),e.find("button").on("click",function(){docCookies.setItem("hasAuth","1"),e.hide()})};bindAddPadding(),bindHideCookie()</script><script type=text/javascript src=/js/aside.2d6977c0f16aef4ed3e886dd66675ce74bd0efcd467c2b2bcdb30b92d5e7c7c0e5c6e0c9d8f09a883c22f58df9e6b0b6347fcdd3c9a920b7faba6d7f91a201c3.js integrity="sha512-LWl3wPFq707T6IbdZmdc50vQ781GfCsrzbMLktXnx8DlxuDJ2PCaiDwi9Y355rC2NH/N08mpILf6um1/kaIBww=="></script><script type=text/javascript src=/js/markdown-tab.17f9f46b021adebc7250ce1b07134a577b307e7a436daa4aaf388f218e8463966f53770b26a64817c06c168738a887672d47fb4c29615adfc446e11d09a344cf.js integrity="sha512-F/n0awIa3rxyUM4bBxNKV3swfnpDbapKrziPIY6EY5ZvU3cLJqZIF8BsFoc4qIdnLUf7TClhWt/ERuEdCaNEzw=="></script><script>let forbidForm=!1;var viewer=new Viewer(document.querySelector(".md-body"),{url:"src"}),blogBindSubmit=function(){var e=$("#email-input-blog");$("#email-submit-blog").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message_blog").data("message1"),a=$("#message_blog").data("message2"),r=$("#message_blog").data("message3"),c=$("#message1_blog").data("success");if(n)if(validateEmail(n)){if(s=$("#blog_formAddress").data("usesendcloud"),!s)return;o=$("#blog_formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:n.toString()},success:function(){showSuccessMessage_blog(c),setTimeout(function(){window.onscroll="",$(".SubscribeForm").hide(),$("#email-input-blog").val("")},5e3)},error:function(){showMessage_blog(r)}})}else t.preventDefault(),$("#message_blog").html(a).show();else t.preventDefault(),$("#message_blog").html(i).show()})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},bindHideMessageBlog=function(){$(window).click(function(){$("#message_blog").hide()})},bindCloseBlog=function(){$(".SubscribeForm .close").click(function(e){e.stopPropagation(),$(".SubscribeForm").fadeOut(),window.onscroll=""})},showMessage_blog=function(e){$("#message_blog").html(e).show()},showSuccessMessage_blog=function(e){$("#message1_blog").html(e).show()};window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;forbidForm&&(window.onscroll=""),e+t>n-710?$(".SubscribeForm").hide():$(".SubscribeForm").show()},blogBindSubmit(),bindCloseBlog(),bindHideMessageBlog()</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>