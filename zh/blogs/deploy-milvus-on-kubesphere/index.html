<!doctype html><html lang=en-US><head><meta charset=utf-8><title>KubeSphere 部署向量数据库 Milvus 实战指南</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="如何在 KubeSphere 管理的 Kubernetes 集群上，高效地部署和管理 Milvus 集群，让您的应用能够充分利用 Milvus 的强大功能。"><meta name=keywords content="Kubernetes,KubeSphere,Milvus"><meta property="og:type" content="article"><meta property="og:title" content="KubeSphere 部署向量数据库 Milvus 实战指南"><meta property="og:description" content="如何在 KubeSphere 管理的 Kubernetes 集群上，高效地部署和管理 Milvus 集群，让您的应用能够充分利用 Milvus 的强大功能。"><meta property="og:image" content="https://pek3b.qingstor.com/kubesphere-community/images/milvus-kubesphere-20240730-cover.png"><meta property="og:url" content="https://openksc.github.io/zh/blogs/deploy-milvus-on-kubesphere/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@KubeSphere"><meta property="twitter:image" content="https://pek3b.qingstor.com/kubesphere-community/images/milvus-kubesphere-20240730-cover.png"><meta name=docsearch:language content="zh-CN"><meta name=docsearch:version content><link rel=canonical href=https://kubesphere.io/zh/blogs/deploy-milvus-on-kubesphere/><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=apple-touch-icon href=/images/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/svg+xml href=/images/favicons/favicon.svg><link rel=icon type=image/png href=/images/favicons/favicon.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg color=#00ad6e><meta name=msapplication-config content='/images/favicons/browserconfig.xml'><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/fonts/Roboto/stylesheet.css><link rel=stylesheet href=/fonts/ProximaNova/stylesheet.css><link rel=stylesheet href=/css/jquery.modal.min.css><link rel=stylesheet href=/css/viewer.min.css><link rel=stylesheet href=/swiper/swiper-bundle.min.css><link rel=stylesheet href=/scss/common.min.0c3fdcc05ec210321169846714f74b11c4a1baf09a1833fa9273b2347c81e636.css><script src=/js/jquery-3.7.1.min.js></script><script src=/js/viewer.min.js></script><script src=/js/jquery.modal.min.js></script><script src=/swiper/swiper-bundle.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0888981f1fa45d241b1fb6962da2963e",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YYCVN36HT5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YYCVN36HT5")</script><script type=text/javascript>!function(e,t,n,s,o){e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=("https:"==document.location.protocol?"https://":"http://")+s,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio"),gio("init","8a24ae300cbf8b8c",{}),gio("send")</script><link rel=stylesheet href=/scss/content.min.f73b326fbf8c5bd331900b0de21c7dde608a4926f482f6465f9ae1d9049b83ad.css><link rel=stylesheet href=/scss/markdown.min.db47186481122431dffae72d17dbbd51f90b66f022cc163458645709924e4eac.css></head><body><header class=navigation><div class=join-div><div class=content>🚀 KubeSphere v4.1.3 发布，多项优化与改进，欢迎体验！<a href=/zh/docs/v4.1/20-release-notes/release-v413/ target=_blank rel="noopener noreferrer">请查看 Release notes →</a>
<img id=close-join src=/images/header/close.svg alt=close></div></div><div class=common-layout><div class=header-container><a href=/zh/ aria-label=logo><img src=/images/header/logo.svg alt class=logo></a><ul class=nav><li class=menu-li><span class=menu-span>应用场景</span><ul class="dropdown-menu menu-2"><li><a href=/zh/devops/>拥抱一站式 DevOps 工作流</a></li><li><a href=/zh/service-mesh/>在 Kubernetes 运行微服务</a></li><li><a href=/zh/observability/>构建丰富的云原生可观测性</a></li></ul></li><li class=menu-li><span class=menu-span>资源</span><ul class="dropdown-menu menu-3"><li><a href=/zh/projects/>开源项目</a></li><li><a href=/zh/conferences/>开源峰会</a></li><li><a href=/zh/blogs/>技术博客</a></li><li><a href=/zh/videos/>视频资源</a></li><li><a href=/zh/learn/>云原生实战</a></li></ul></li><li class=menu-li><span class=menu-span>文档中心</span><ul class="dropdown-menu menu-4"><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/ target=_blank rel="noopener noreferrer">扩展组件开发</a></li><li><a href=https://kube.design/ target=_blank rel="noopener noreferrer">Kube Design</a></li></ul></li><li class=menu-li><span class=menu-span>开源社区</span><ul class="dropdown-menu menu-5"><li><a href=/zh/contribution/>参与贡献</a></li><li><a href=/zh/live/>社区活动</a></li><li><a href=/zh/case/>案例学习</a></li><li><a href=/zh/partner/>合作伙伴</a></li><li><a href=/zh/user-group/>用户委员会</a></li><li><a href=/zh/news/>动态</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">版本计划</a></li><li><a href=https://www.kubesphere.io/zh/ target=_blank rel="noopener noreferrer">中国站</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025 target=_blank rel="noopener noreferrer">开源之夏 2025</a></li></ul></li><li><a data-docs=用户论坛 href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">用户论坛</a></li><li><a data-docs=认证 href=https://kubesphere.cloud/certification/ target=_blank rel="noopener noreferrer">认证</a></li></ul><div class=right-menu><ul><li class=language-menu><div><img src=/images/header/black.svg alt>
<span>简体中文</span></div><ul class=dropdown-menu><li onclick='handleLangClick("zh","/zh/blogs/deploy-milvus-on-kubesphere/")'>简体中文</li></ul></li><li class=github-li><div class=github-star><a class=star-btn href=https://github.com/kubesphere/kubesphere rel="noopener noreferrer" target=_blank><span class=star-img></span>&nbsp;<span>Star</span>
</a><a class=social-count href=https://github.com/kubesphere/kubesphere/stargazers rel="noopener noreferrer" target=_blank></a></div></li><li class=menu-icon><img src=/images/header/menu.svg alt></li></ul></div></div></div><div id=modal-for-menu class=modal><ul class=nav><li data-check=0 class=menu-li><span class=menu-span>应用场景</span><ul class=dropdown-menu><li><a href=/zh/devops/>拥抱一站式 DevOps 工作流</a></li><li><a href=/zh/service-mesh/>在 Kubernetes 运行微服务</a></li><li><a href=/zh/observability/>构建丰富的云原生可观测性</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>资源</span><ul class=dropdown-menu><li><a href=/zh/projects/>开源项目</a></li><li><a href=/zh/conferences/>开源峰会</a></li><li><a href=/zh/blogs/>技术博客</a></li><li><a href=/zh/videos/>视频资源</a></li><li><a href=/zh/learn/>云原生实战</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>文档中心</span><ul class=dropdown-menu><li><a href=/zh/docs/v4.1>v4.1 <img src=/images/header/star.svg alt=star></a></li><li><a href=/zh/docs/v3.4>v3.4</a></li><li><a href=/zh/docs/v3.3>v3.3</a></li><li><a href=https://dev-guide.kubesphere.io/extension-dev-guide/zh/>扩展组件开发</a></li><li><a href=https://kube.design/>Kube Design</a></li></ul></li><li data-check=0 class=menu-li><span class=menu-span>开源社区</span><ul class=dropdown-menu><li><a href=/zh/contribution/>参与贡献</a></li><li><a href=/zh/live/>社区活动</a></li><li><a href=/zh/case/>案例学习</a></li><li><a href=/zh/partner/>合作伙伴</a></li><li><a href=/zh/user-group/>用户委员会</a></li><li><a href=/zh/news/>动态</a></li><li><a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md>版本计划</a></li><li><a href=https://www.kubesphere.io/zh/>中国站</a></li><li><a href=https://github.com/kubesphere/community/tree/master/sig-advocacy-and-outreach/ospp-2025>开源之夏 2025</a></li></ul></li><li><a data-docs=用户论坛 href=https://ask.kubesphere.io/forum>用户论坛</a></li><li><a data-docs=认证 href=https://kubesphere.cloud/certification/>认证</a></li></ul><div class=link-div><a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank rel="noopener noreferrer" aria-label=slack><img src=/images/header/slack-hover.svg alt>
</a><a href=https://x.com/KubeSphere target=_blank rel="noopener noreferrer" aria-label=twitter><img src=/images/header/twitter-hover.svg alt>
</a><a href=https://github.com/kubesphere/kubesphere target=_blank rel="noopener noreferrer" aria-label=github><img src=/images/header/github-hover.svg alt></a></div></div></header><script>var bindNavMouseEvent,bindScrollChangeHeader,bindClickShowMenu,bindClickModalLi,bindClickClose,language,handleLangClick,githubApiLink="https://api.github.com/repos/kubesphere/kubesphere",getStar=function(){$(".social-count").hide(),$.getJSON(githubApiLink,function(e){$(".social-count").show().html(e.stargazers_count)})};getStar(),bindNavMouseEvent=function(e,t){t||(t=$(e));var n=!1;t.mouseenter(function(){if(n)return!1;n=!0,$(this).find(".dropdown-menu").fadeIn(200,function(){n=!1})}),t.mouseleave(function(){$(this).find(".dropdown-menu").fadeOut(200)})},bindScrollChangeHeader=function(){var t=100,e=$("header");window.addEventListener("scroll",function(){var t=window.scrollY;t>0?e.addClass("navigationScroll"):e.removeClass("navigationScroll")})},bindClickShowMenu=function(){$(".menu-icon").click(function(){$("#modal-for-menu").modal()})},bindClickModalLi=function(){$(".modal .menu-li").click(function(){var e=$(this).data("check");e===0?($(this).data("check",1),$(this).find(".dropdown-menu").slideDown(200)):($(this).data("check",0),$(this).find(".dropdown-menu").slideUp(200)),$(this).find(".menu-span").toggleClass("up")})},bindClickClose=function(){$("#close-join").click(function(){$(".navigation .join-div").hide(),$(".main-section").removeClass("padding")})},language="zh",bindClickClose(),bindScrollChangeHeader(),$(".header-container .menu-li").each(function(){bindNavMouseEvent("",$(this))}),bindNavMouseEvent(".header-container .language-menu"),bindNavMouseEvent(".header-container .btn-li"),bindClickShowMenu(),bindClickModalLi(),handleLangClick=function(e,t){try{localStorage.setItem("lang",e)}catch{}location.href=t}</script><section class=main-section><div class=common-layout><div class=breadcrumb><span><a href=/zh/blogs/>技术博客</a> > </span><span>KubeSphere 部署向量数据库 Milvus 实战指南</span></div><div class='main-div middle-div'><div class=author>运维有术</div><span class=date>发布于：2024-07-30</span>&nbsp;&nbsp;&nbsp;
<span style=font-size:14px;color:#919aa3 id=busuanzi_container_page_pv>本文总阅读量：<span id=busuanzi_value_page_pv></span></span><h1>KubeSphere 部署向量数据库 Milvus 实战指南</h1><div class=share-1><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-milvus-on-kubesphere%2f&text=KubeSphere%20%e9%83%a8%e7%bd%b2%e5%90%91%e9%87%8f%e6%95%b0%e6%8d%ae%e5%ba%93%20Milvus%20%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-milvus-on-kubesphere%2f&title=KubeSphere%20%e9%83%a8%e7%bd%b2%e5%90%91%e9%87%8f%e6%95%b0%e6%8d%ae%e5%ba%93%20Milvus%20%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-milvus-on-kubesphere%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-milvus-on-kubesphere%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-milvus-on-kubesphere%2f&t=KubeSphere%20%e9%83%a8%e7%bd%b2%e5%90%91%e9%87%8f%e6%95%b0%e6%8d%ae%e5%ba%93%20Milvus%20%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div><div class=content><div class=md-body><p>Milvus 是一个为通用人工智能（GenAI）应用而构建的开源向量数据库。它以卓越的性能和灵活性，提供了一个强大的平台，用于存储、搜索和管理大规模的向量数据。Milvus 能够执行高速搜索，并以最小的性能损失扩展到数百亿向量。其分布式架构确保了系统的高可用性和水平可扩展性，满足不断增长的数据需求。同时，Milvus 提供了丰富的 API 和集成选项，使其成为机器学习、计算机视觉和自然语言处理等 AI 应用的理想选择。</p><p>随着 AI 大模型的兴起，Milvus 成为了众多 AI 应用的首选向量数据库。本文将引导您探索，如何在 KubeSphere 管理的 Kubernetes 集群上，高效地部署和管理 Milvus 集群，让您的应用能够充分利用 Milvus 的强大功能。</p><p><strong>实战服务器配置(架构 1:1 复刻小规模生产环境，配置略有不同)</strong></p><table><thead><tr><th style=text-align:center>主机名</th><th style=text-align:center>IP</th><th style=text-align:center>CPU</th><th style=text-align:center>内存</th><th style=text-align:center>系统盘</th><th style=text-align:center>数据盘</th><th style=text-align:center>用途</th></tr></thead><tbody><tr><td style=text-align:center>ksp-registry</td><td style=text-align:center>192.168.9.90</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>200</td><td style=text-align:center>Harbor 镜像仓库</td></tr><tr><td style=text-align:center>ksp-control-1</td><td style=text-align:center>192.168.9.91</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>KubeSphere/k8s-control-plane</td></tr><tr><td style=text-align:center>ksp-control-2</td><td style=text-align:center>192.168.9.92</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>KubeSphere/k8s-control-plane</td></tr><tr><td style=text-align:center>ksp-control-3</td><td style=text-align:center>192.168.9.93</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>KubeSphere/k8s-control-plane</td></tr><tr><td style=text-align:center>ksp-worker-1</td><td style=text-align:center>192.168.9.94</td><td style=text-align:center>8</td><td style=text-align:center>16</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>k8s-worker/CI</td></tr><tr><td style=text-align:center>ksp-worker-2</td><td style=text-align:center>192.168.9.95</td><td style=text-align:center>8</td><td style=text-align:center>16</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>k8s-worker</td></tr><tr><td style=text-align:center>ksp-worker-3</td><td style=text-align:center>192.168.9.96</td><td style=text-align:center>8</td><td style=text-align:center>16</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>k8s-worker</td></tr><tr><td style=text-align:center>ksp-storage-1</td><td style=text-align:center>192.168.9.97</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>400+</td><td style=text-align:center>ElasticSearch/Longhorn/Ceph/NFS</td></tr><tr><td style=text-align:center>ksp-storage-2</td><td style=text-align:center>192.168.9.98</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>300+</td><td style=text-align:center>ElasticSearch/Longhorn/Ceph</td></tr><tr><td style=text-align:center>ksp-storage-3</td><td style=text-align:center>192.168.9.99</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>300+</td><td style=text-align:center>ElasticSearch/Longhorn/Ceph</td></tr><tr><td style=text-align:center>ksp-gpu-worker-1</td><td style=text-align:center>192.168.9.101</td><td style=text-align:center>4</td><td style=text-align:center>16</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>k8s-worker(GPU NVIDIA Tesla M40 24G)</td></tr><tr><td style=text-align:center>ksp-gpu-worker-2</td><td style=text-align:center>192.168.9.102</td><td style=text-align:center>4</td><td style=text-align:center>16</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>k8s-worker(GPU NVIDIA Tesla P100 16G)</td></tr><tr><td style=text-align:center>ksp-gateway-1</td><td style=text-align:center>192.168.9.103</td><td style=text-align:center>2</td><td style=text-align:center>4</td><td style=text-align:center>40</td><td style=text-align:center></td><td style=text-align:center>自建应用服务代理网关/VIP：192.168.9.100</td></tr><tr><td style=text-align:center>ksp-gateway-2</td><td style=text-align:center>192.168.9.104</td><td style=text-align:center>2</td><td style=text-align:center>4</td><td style=text-align:center>40</td><td style=text-align:center></td><td style=text-align:center>自建应用服务代理网关/VIP：192.168.9.100</td></tr><tr><td style=text-align:center>ksp-mid</td><td style=text-align:center>192.168.9.105</td><td style=text-align:center>4</td><td style=text-align:center>8</td><td style=text-align:center>40</td><td style=text-align:center>100</td><td style=text-align:center>部署在 k8s 集群之外的服务节点（Gitlab 等）</td></tr><tr><td style=text-align:center>合计</td><td style=text-align:center>15</td><td style=text-align:center>68</td><td style=text-align:center>152</td><td style=text-align:center>600</td><td style=text-align:center>2100+</td><td style=text-align:center></td></tr></tbody></table><p><strong>实战环境涉及软件版本信息</strong></p><ul><li>操作系统：<strong>openEuler 22.03 LTS SP3 x86_64</strong></li><li>KubeSphere：<strong>v3.4.1</strong></li><li>Kubernetes：<strong>v1.28.8</strong></li><li>KubeKey: <strong>v3.1.1</strong></li><li>Milvus Helm Charts：<strong>4.2.0</strong></li><li>Milvus： <strong>v.2.4.6</strong></li></ul><h2 id=1-milvus-部署规划>1. Milvus 部署规划</h2><p><strong>部署目标：官方架构图所示的 Milvus 集群（不包含 Load Balancer）。</strong></p><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//milvus-architecture-overview.png alt=milvus-architecture-overview></p><p>由于是初次安装部署，对 Milvus 的架构、组件关系仅有一个初步的了解，所以第一次部署只做如下考虑：</p><ul><li>使用 Helm 的方式，大部分配置采用默认的 Values 部署</li><li>更改组件镜像地址为本地私有仓库</li><li>持久化存储使用自定义的 NFS 存储类 <code>nfs-sc</code>（生产不建议用，可能会造成磁盘 IO 不满足 etcd 的需求）</li><li>coordinators 没有选择 <strong>mixCoordinator</strong>，而是使用多个独立的 <strong>coordinators</strong>，这种方案运维成本高，维护麻烦</li><li>消息队列使用官方默认推荐的 <strong>pulsar</strong>，不选择 <strong>kafka</strong></li></ul><p>后续会深入研究，更正式的部署考虑：</p><ul><li>使用 Helm 和自定义 values 生成部署资源清单，修改清单，使用原生 kubectl 方式部署</li><li>使用 Ceph 或是其它高性能存储，不使用 NFS 存储</li><li>消息队列继续使用官方推荐的 <strong>pulsar</strong></li><li>使用社区官方推荐的包含所有 coordinators 的 <strong>mixCoordinator</strong> ，降低运维成本</li><li>合理规划 Minio、Etcd、pulsar 等组件使用持久化存储时所分配的存储空间，默认配置不可能满足所有场景</li><li>Milvus 日志存储到持久化存储，适配没有集中日志采集能力的 k8s 集群</li></ul><p><strong>重要说明：</strong> 本文的内容对于安装部署 Milvus 有一定的借鉴意义，但<strong>切勿将本文的实战过程直接用于任何类型的正式环境</strong>。</p><h2 id=2-前置条件>2. 前置条件</h2><p>以下内容来自 <a href=https://milvus.io/docs/v2.3.x/prerequisite-helm.md target=_blank rel="noopener noreferrer">Milvus 官方环境需求文档</a>，比较好理解，不做翻译了。</p><h3 id=21-硬件需求>2.1 硬件需求</h3><table><thead><tr><th style=text-align:left>Component</th><th style=text-align:left>Requirement</th><th style=text-align:left>Recommendation</th><th style=text-align:left>Note</th></tr></thead><tbody><tr><td style=text-align:left>CPU</td><td style=text-align:left>Intel 2nd Gen Core CPU or higherApple Silicon</td><td style=text-align:left>Standalone: 4 core or moreCluster: 8 core or more</td><td style=text-align:left></td></tr><tr><td style=text-align:left>CPU instruction set</td><td style=text-align:left>SSE4.2AVXAVX2AVX-512</td><td style=text-align:left>SSE4.2AVXAVX2AVX-512</td><td style=text-align:left>Vector similarity search and index building within Milvus require CPU's support of single instruction, multiple data (SIMD) extension sets. Ensure that the CPU supports at least one of the SIMD extensions listed. See <a href=https://en.wikipedia.org/wiki/Advanced_Vector_Extensions#CPUs_with_AVX target=_blank rel="noopener noreferrer">CPUs with AVX</a> for more information.</td></tr><tr><td style=text-align:left>RAM</td><td style=text-align:left>Standalone: 8GCluster: 32G</td><td style=text-align:left>Standalone: 16GCluster: 128G</td><td style=text-align:left>The size of RAM depends on the data volume.</td></tr><tr><td style=text-align:left>Hard drive</td><td style=text-align:left>SATA 3.0 SSD or CloudStorage</td><td style=text-align:left>NVMe SSD or higher</td><td style=text-align:left>The size of hard drive depends on the data volume.</td></tr></tbody></table><h3 id=22-软件需求>2.2 软件需求</h3><table><thead><tr><th style=text-align:left>Operating system</th><th style=text-align:left>Software</th><th style=text-align:left>Note</th></tr></thead><tbody><tr><td style=text-align:left>Linux platforms</td><td style=text-align:left>Kubernetes 1.16 or laterkubectlHelm 3.0.0 or laterminikube (for Milvus standalone)Docker 19.03 or later (for Milvus standalone)</td><td style=text-align:left>See <a href=https://helm.sh/docs/ target=_blank rel="noopener noreferrer">Helm Docs</a> for more information.</td></tr></tbody></table><table><thead><tr><th style=text-align:left>Software</th><th style=text-align:left>Version</th><th style=text-align:left>Note</th></tr></thead><tbody><tr><td style=text-align:left>etcd</td><td style=text-align:left>3.5.0</td><td style=text-align:left>See <a href=https://milvus.io/docs/v2.3.x/prerequisite-helm.md#Additional-disk-requirements target=_blank rel="noopener noreferrer">additional disk requirements</a>.</td></tr><tr><td style=text-align:left>MinIO</td><td style=text-align:left>RELEASE.2023-03-20T20-16-18Z</td><td style=text-align:left></td></tr><tr><td style=text-align:left>Pulsar</td><td style=text-align:left>2.8.2</td><td style=text-align:left></td></tr></tbody></table><h3 id=23-磁盘需求>2.3 磁盘需求</h3><p>磁盘性能对 etcd 至关重要。官方强烈建议使用本地 NVMe SSD 磁盘。较慢的磁盘响应可能导致频繁的集群选举，最终降低 etcd 服务的性能，甚至是集群的崩溃。</p><p>这个需求比较重要，我刚接触 Milvus 时，由于时间比较仓促，在略知一二的情况下，使用默认配置部署了一套半生产的 Milvus 集群。</p><p>因为选择了 NFS 存储且没有测试磁盘 IO 性能，经常会出现 etcd 服务异常，响应慢，被 Kubernetes 的存活检测机制判断为不可用，导致频繁自动重建 etcd 集群。</p><p>因此，在 K8s 上创建 Milvus 集群时最好先测试一下集群持久化存储的性能。</p><p>Milvus 官方给出的测试磁盘性能的工具和命令如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir test-data
</span></span><span style=display:flex><span>fio --rw<span style=color:#f92672>=</span>write --ioengine<span style=color:#f92672>=</span>sync --fdatasync<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> --directory<span style=color:#f92672>=</span>test-data --size<span style=color:#f92672>=</span>2200m --bs<span style=color:#f92672>=</span><span style=color:#ae81ff>2300</span> --name<span style=color:#f92672>=</span>mytest
</span></span></code></pre></div><p>测试结果，理想情况下，您的磁盘应该达到 <strong>500 IOPS</strong> 以上，99th percentile fsync latency 低于 10ms。请阅读 <a href=https://etcd.io/docs/v3.5/op-guide/hardware/#disks target=_blank rel="noopener noreferrer">etcd 官方文档</a> 了解更详细的需求。</p><p>具体的磁盘性能测试过程，请参考下文。</p><h3 id=24-kubernetes-集群配置>2.4 Kubernetes 集群配置</h3><p>k8s 集群一定要配置默认存储类，Milvus 的 Helm 控制 storageClass 的参数不够灵活，最好直接使用默认存储类，简化配置。</p><h2 id=3-持久化存储性能测试>3. 持久化存储性能测试</h2><p>实战环境使用了自建的 NFS 存储，部署 Milvus 之前，先测试存储性能：</p><p>官方建议的测试工具是 <code>fio</code> ，为了在 K8s 中模拟测试，我选择了 openEBS 官方提供的 <code>openebs/tests-fio:latest</code> 作为测试镜像，创建测试 Pod。</p><h3 id=31-创建测试-pvc>3.1 创建测试 pvc</h3><p>编辑测试 PVC 资源清单，<code>vi test-nfs-fio-pvc.yaml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PersistentVolumeClaim</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>test-nfs-fio-pvc</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>storageClassName</span>: <span style=color:#ae81ff>nfs-sc</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>accessModes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>ReadWriteMany</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>1Gi</span>
</span></span></code></pre></div><p>执行命令，创建 PVC。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f test-nfs-fio-pvc.yaml
</span></span></code></pre></div><h3 id=32-创建测试-pod>3.2 创建测试 Pod</h3><p>编辑测试 Pod 资源清单，<code>vi test-nfs-fio-pod.yaml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>test-nfs-fio-pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>test-nfs-fio-pod</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>openebs/tests-fio:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;/bin/sh&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>args</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;-c&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;touch /mnt/SUCCESS &amp;&amp; sleep 86400&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nfs-fio-pvc</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>mountPath</span>: <span style=color:#e6db74>&#34;/mnt&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>restartPolicy</span>: <span style=color:#e6db74>&#34;Never&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nfs-fio-pvc</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>persistentVolumeClaim</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>claimName</span>: <span style=color:#ae81ff>test-nfs-fio-pvc</span>
</span></span></code></pre></div><p>执行命令，创建 Pod。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f test-nfs-fio-pod.yaml
</span></span></code></pre></div><h3 id=33-连接测试-pod-终端>3.3 连接测试 Pod 终端</h3><p>执行下面的命令，打开 fio 测试 Pod 终端。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl exec -it test-nfs-fio-pod -- /bin/bash
</span></span></code></pre></div><p>查看已经挂载的 NFS 存储。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bas data-lang=bas><span style=display:flex><span>root@test<span style=color:#f92672>-</span>nfs<span style=color:#f92672>-</span>fio<span style=color:#f92672>-</span>pod:<span style=color:#f92672>/</span><span style=color:#960050;background-color:#1e0010>#</span> df <span style=color:#f92672>-</span>h
</span></span><span style=display:flex><span>Filesystem                                                                                   Size  Used Avail Use<span style=color:#f92672>%</span> Mounted on
</span></span><span style=display:flex><span>overlay                                                                                      <span style=color:#ae81ff>100</span>G  <span style=color:#ae81ff>6.5</span>G   <span style=color:#ae81ff>94</span>G   <span style=color:#ae81ff>7</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>
</span></span><span style=display:flex><span>tmpfs                                                                                         <span style=color:#ae81ff>64</span>M     <span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>64</span>M   <span style=color:#ae81ff>0</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>dev
</span></span><span style=display:flex><span>tmpfs                                                                                        <span style=color:#ae81ff>7.6</span>G     <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>7.6</span>G   <span style=color:#ae81ff>0</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>sys<span style=color:#f92672>/</span>fs<span style=color:#f92672>/</span>cgroup
</span></span><span style=display:flex><span>192<span style=color:#ae81ff>.168.9.97</span><span style=color:#f92672>:/</span>datanfs<span style=color:#f92672>/</span>k8s<span style=color:#f92672>/</span>default<span style=color:#f92672>-</span>test<span style=color:#f92672>-</span>nfs<span style=color:#f92672>-</span>fio<span style=color:#f92672>-</span>pvc<span style=color:#f92672>-</span>pvc<span style=color:#ae81ff>-7158</span>aa17<span style=color:#f92672>-</span>f003<span style=color:#ae81ff>-47</span>a2<span style=color:#f92672>-</span>b6d6<span style=color:#ae81ff>-07</span>c69d014178  <span style=color:#ae81ff>100</span>G  <span style=color:#ae81ff>746</span>M  <span style=color:#ae81ff>100</span>G   <span style=color:#ae81ff>1</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>mnt
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>mapper<span style=color:#f92672>/</span>openeuler<span style=color:#f92672>-</span>root                                                                    <span style=color:#ae81ff>35</span>G  <span style=color:#ae81ff>2.3</span>G   <span style=color:#ae81ff>31</span>G   <span style=color:#ae81ff>7</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>etc<span style=color:#f92672>/</span>hosts
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>mapper<span style=color:#f92672>/</span>data<span style=color:#f92672>-</span>lvdata                                                                      <span style=color:#ae81ff>100</span>G  <span style=color:#ae81ff>6.5</span>G   <span style=color:#ae81ff>94</span>G   <span style=color:#ae81ff>7</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>etc<span style=color:#f92672>/</span>hostname
</span></span><span style=display:flex><span>shm                                                                                           <span style=color:#ae81ff>64</span>M     <span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>64</span>M   <span style=color:#ae81ff>0</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>shm
</span></span><span style=display:flex><span>tmpfs                                                                                         <span style=color:#ae81ff>14</span>G   <span style=color:#ae81ff>12</span>K   <span style=color:#ae81ff>14</span>G   <span style=color:#ae81ff>1</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>run<span style=color:#f92672>/</span>secrets<span style=color:#f92672>/</span>kubernetes<span style=color:#f92672>.</span>io<span style=color:#f92672>/</span>serviceaccount
</span></span><span style=display:flex><span>tmpfs                                                                                        <span style=color:#ae81ff>7.6</span>G     <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>7.6</span>G   <span style=color:#ae81ff>0</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>proc<span style=color:#f92672>/</span>acpi
</span></span><span style=display:flex><span>tmpfs                                                                                        <span style=color:#ae81ff>7.6</span>G     <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>7.6</span>G   <span style=color:#ae81ff>0</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>proc<span style=color:#f92672>/</span>scsi
</span></span><span style=display:flex><span>tmpfs                                                                                        <span style=color:#ae81ff>7.6</span>G     <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>7.6</span>G   <span style=color:#ae81ff>0</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>sys<span style=color:#f92672>/</span>firmware
</span></span></code></pre></div><h3 id=34-测试磁盘性能>3.4 测试磁盘性能</h3><p>执行下面的测试命令。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir /mnt/test-data
</span></span><span style=display:flex><span>fio --rw<span style=color:#f92672>=</span>write --ioengine<span style=color:#f92672>=</span>sync --fdatasync<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> --directory<span style=color:#f92672>=</span>/mnt/test-data --size<span style=color:#f92672>=</span>2200m --bs<span style=color:#f92672>=</span><span style=color:#ae81ff>2300</span> --name<span style=color:#f92672>=</span>nfstest
</span></span></code></pre></div><p><strong>测试结果：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@test-nfs-fio-pod:/# fio --rw<span style=color:#f92672>=</span>write --ioengine<span style=color:#f92672>=</span>sync --fdatasync<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> --directory<span style=color:#f92672>=</span>/mnt/test-data --size<span style=color:#f92672>=</span>2200m --bs<span style=color:#f92672>=</span><span style=color:#ae81ff>2300</span> --name<span style=color:#f92672>=</span>nfstest
</span></span><span style=display:flex><span>nfstest: <span style=color:#f92672>(</span>g<span style=color:#f92672>=</span>0<span style=color:#f92672>)</span>: rw<span style=color:#f92672>=</span>write, bs<span style=color:#f92672>=</span>2300-2300/2300-2300/2300-2300, ioengine<span style=color:#f92672>=</span>sync, iodepth<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>fio-2.2.10
</span></span><span style=display:flex><span>Starting <span style=color:#ae81ff>1</span> process
</span></span><span style=display:flex><span>nfstest: Laying out IO file<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> file<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> / 2200MB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Jobs: <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>f<span style=color:#f92672>=</span>1<span style=color:#f92672>)</span>: <span style=color:#f92672>[</span>W<span style=color:#f92672>(</span>1<span style=color:#f92672>)]</span> <span style=color:#f92672>[</span>100.0% <span style=color:#66d9ef>done</span><span style=color:#f92672>]</span> <span style=color:#f92672>[</span>0KB/956KB/0KB /s<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>0/426/0 iops<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>eta 00m:00s<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>nfstest: <span style=color:#f92672>(</span>groupid<span style=color:#f92672>=</span>0, jobs<span style=color:#f92672>=</span>1<span style=color:#f92672>)</span>: err<span style=color:#f92672>=</span> 0: pid<span style=color:#f92672>=</span>26: Tue Jul <span style=color:#ae81ff>23</span> 02:55:35 <span style=color:#ae81ff>2024</span>
</span></span><span style=display:flex><span>  write: io<span style=color:#f92672>=</span>2199.2MB, bw<span style=color:#f92672>=</span>870003B/s, iops<span style=color:#f92672>=</span>378, runt<span style=color:#f92672>=</span>2651558msec
</span></span><span style=display:flex><span>    clat <span style=color:#f92672>(</span>usec<span style=color:#f92672>)</span>: min<span style=color:#f92672>=</span>4, max<span style=color:#f92672>=</span>87472, avg<span style=color:#f92672>=</span>224.30, stdev<span style=color:#f92672>=</span>309.99
</span></span><span style=display:flex><span>     lat <span style=color:#f92672>(</span>usec<span style=color:#f92672>)</span>: min<span style=color:#f92672>=</span>4, max<span style=color:#f92672>=</span>87473, avg<span style=color:#f92672>=</span>224.71, stdev<span style=color:#f92672>=</span>310.00
</span></span><span style=display:flex><span>    clat percentiles <span style=color:#f92672>(</span>usec<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>     |  1.00th<span style=color:#f92672>=[</span>    7<span style=color:#f92672>]</span>,  5.00th<span style=color:#f92672>=[</span>    8<span style=color:#f92672>]</span>, 10.00th<span style=color:#f92672>=[</span>    8<span style=color:#f92672>]</span>, 20.00th<span style=color:#f92672>=[</span>    9<span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>     | 30.00th<span style=color:#f92672>=[</span>   10<span style=color:#f92672>]</span>, 40.00th<span style=color:#f92672>=[</span>   12<span style=color:#f92672>]</span>, 50.00th<span style=color:#f92672>=[</span>  302<span style=color:#f92672>]</span>, 60.00th<span style=color:#f92672>=[</span>  338<span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>     | 70.00th<span style=color:#f92672>=[</span>  366<span style=color:#f92672>]</span>, 80.00th<span style=color:#f92672>=[</span>  398<span style=color:#f92672>]</span>, 90.00th<span style=color:#f92672>=[</span>  442<span style=color:#f92672>]</span>, 95.00th<span style=color:#f92672>=[</span>  482<span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>     | 99.00th<span style=color:#f92672>=[</span>  588<span style=color:#f92672>]</span>, 99.50th<span style=color:#f92672>=[</span>  700<span style=color:#f92672>]</span>, 99.90th<span style=color:#f92672>=[</span> 1848<span style=color:#f92672>]</span>, 99.95th<span style=color:#f92672>=[</span> 3120<span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>     | 99.99th<span style=color:#f92672>=[</span> 7008<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    bw <span style=color:#f92672>(</span>KB  /s<span style=color:#f92672>)</span>: min<span style=color:#f92672>=</span>    1, max<span style=color:#f92672>=</span> 1078, per<span style=color:#f92672>=</span>100.00%, avg<span style=color:#f92672>=</span>873.03, stdev<span style=color:#f92672>=</span>221.69
</span></span><span style=display:flex><span>    lat <span style=color:#f92672>(</span>usec<span style=color:#f92672>)</span> : 10<span style=color:#f92672>=</span>25.84%, 20<span style=color:#f92672>=</span>16.33%, 50<span style=color:#f92672>=</span>1.64%, 100<span style=color:#f92672>=</span>0.03%, 250<span style=color:#f92672>=</span>0.23%
</span></span><span style=display:flex><span>    lat <span style=color:#f92672>(</span>usec<span style=color:#f92672>)</span> : 500<span style=color:#f92672>=</span>52.30%, 750<span style=color:#f92672>=</span>3.19%, 1000<span style=color:#f92672>=</span>0.15%
</span></span><span style=display:flex><span>    lat <span style=color:#f92672>(</span>msec<span style=color:#f92672>)</span> : 2<span style=color:#f92672>=</span>0.20%, 4<span style=color:#f92672>=</span>0.05%, 10<span style=color:#f92672>=</span>0.03%, 20<span style=color:#f92672>=</span>0.01%, 50<span style=color:#f92672>=</span>0.01%
</span></span><span style=display:flex><span>    lat <span style=color:#f92672>(</span>msec<span style=color:#f92672>)</span> : 100<span style=color:#f92672>=</span>0.01%
</span></span><span style=display:flex><span>  cpu          : usr<span style=color:#f92672>=</span>0.38%, sys<span style=color:#f92672>=</span>1.56%, ctx<span style=color:#f92672>=</span>1567342, majf<span style=color:#f92672>=</span>0, minf<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>
</span></span><span style=display:flex><span>  IO depths    : 1<span style=color:#f92672>=</span>100.0%, 2<span style=color:#f92672>=</span>0.0%, 4<span style=color:#f92672>=</span>0.0%, 8<span style=color:#f92672>=</span>0.0%, 16<span style=color:#f92672>=</span>0.0%, 32<span style=color:#f92672>=</span>0.0%, &gt;<span style=color:#f92672>=</span>64<span style=color:#f92672>=</span>0.0%
</span></span><span style=display:flex><span>     submit    : 0<span style=color:#f92672>=</span>0.0%, 4<span style=color:#f92672>=</span>100.0%, 8<span style=color:#f92672>=</span>0.0%, 16<span style=color:#f92672>=</span>0.0%, 32<span style=color:#f92672>=</span>0.0%, 64<span style=color:#f92672>=</span>0.0%, &gt;<span style=color:#f92672>=</span>64<span style=color:#f92672>=</span>0.0%
</span></span><span style=display:flex><span>     complete  : 0<span style=color:#f92672>=</span>0.0%, 4<span style=color:#f92672>=</span>100.0%, 8<span style=color:#f92672>=</span>0.0%, 16<span style=color:#f92672>=</span>0.0%, 32<span style=color:#f92672>=</span>0.0%, 64<span style=color:#f92672>=</span>0.0%, &gt;<span style=color:#f92672>=</span>64<span style=color:#f92672>=</span>0.0%
</span></span><span style=display:flex><span>     issued    : total<span style=color:#f92672>=</span>r<span style=color:#f92672>=</span>0/w<span style=color:#f92672>=</span>1002985/d<span style=color:#f92672>=</span>0, short<span style=color:#f92672>=</span>r<span style=color:#f92672>=</span>0/w<span style=color:#f92672>=</span>0/d<span style=color:#f92672>=</span>0, drop<span style=color:#f92672>=</span>r<span style=color:#f92672>=</span>0/w<span style=color:#f92672>=</span>0/d<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>     latency   : target<span style=color:#f92672>=</span>0, window<span style=color:#f92672>=</span>0, percentile<span style=color:#f92672>=</span>100.00%, depth<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Run status group <span style=color:#ae81ff>0</span> <span style=color:#f92672>(</span>all jobs<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>  WRITE: io<span style=color:#f92672>=</span>2199.2MB, aggrb<span style=color:#f92672>=</span>849KB/s, minb<span style=color:#f92672>=</span>849KB/s, maxb<span style=color:#f92672>=</span>849KB/s, mint<span style=color:#f92672>=</span>2651558msec, maxt<span style=color:#f92672>=</span>2651558msec
</span></span></code></pre></div><p><strong>测试结果说明：</strong> 测试结果明显不符合官方建议的最低值。由于，是个人测试环境也就无所谓了。<strong>生产环境请严谨测试、评估</strong>。</p><h2 id=4-使用-helm-安装-milvus-集群>4. 使用 Helm 安装 Milvus 集群</h2><p>Milvus 官方提供了 Operator、Helm 等多种方式的集群安装文档。本文实战演示了 Helm 的安装方式。其他方式请参考 <a href=https://milvus.io/docs/v2.3.x/install_cluster-milvusoperator.md target=_blank rel="noopener noreferrer">Milvus 官方文档</a>。</p><h3 id=41-安装-milvus-helm-chart>4.1 安装 Milvus Helm Chart</h3><p>添加 Milvus Helm repository。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add milvus https://zilliztech.github.io/milvus-helm/
</span></span></code></pre></div><p>更新本地 charts。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo update milvus
</span></span></code></pre></div><h3 id=42-安装-milvus>4.2 安装 Milvus</h3><p>官方默认安装命令（<strong>仅供参考，本文未用</strong>）。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install my-release milvus/milvus
</span></span></code></pre></div><p>按规划设置自定义配置项，执行下面的安装命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install --namespace opsxlab --create-namespace opsxlab milvus/milvus <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set image.all.repository<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;milvusdb/milvus&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set image.tools.repository<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;milvusdb/milvus-config-tool&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set etcd.image.registry<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;docker.io&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set etcd.image.repository<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;milvusdb/etcd&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set pulsar.images.broker.repository<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;milvusdb/pulsar&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set pulsar.images.autorecovery.repository<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;milvusdb/pulsar&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set pulsar.images.zookeeper.repository<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;milvusdb/pulsar&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set pulsar.images.bookie.repository<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;milvusdb/pulsar&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set pulsar.images.proxy.repository<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;milvusdb/pulsar&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set pulsar.images.pulsar_manager.repository<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;milvusdb/pulsar-manager&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set pulsar.pulsar_metadata.image.repository<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;milvusdb/pulsar&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set minio.image.repository<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;milvusdb/minio&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set etcd.persistence.storageClass<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;nfs-sc&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set minio.persistence.storageClass<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;nfs-sc&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set pulsar.zookeeper.volumes.data.storageClassName<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;nfs-sc&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --set pulsar.bookkeeper.volumes.journal.storageClassName<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;nfs-sc&#34;</span>
</span></span></code></pre></div><p>自定义配置说明：</p><ul><li>指定并自动创建命名空间 <strong>opsxlab</strong></li><li>设置组件的镜像地址，本文为了演示修改方法，保留了默认值，<strong>实际使用中可以修改为自己的镜像仓库地址</strong></li><li>etcd 的镜像地址比较特殊，有两个配置项，请注意</li><li>设置持久化存储类为 <code>nfs-sc</code>，适用于 k8s 有多种存储类，需要部署到指定存储类的场景</li><li>所有配置仅供参考，请参考官方文档查看更详细的配置</li></ul><p><strong>附录：</strong> 默认安装的组件镜像地址及版本：</p><table><thead><tr><th style=text-align:center>序号</th><th style=text-align:center>组件名称</th><th style=text-align:center>默认 repository</th><th style=text-align:center>组件版本</th></tr></thead><tbody><tr><td style=text-align:center>1</td><td style=text-align:center>milvus</td><td style=text-align:center>milvusdb/milvus</td><td style=text-align:center>v2.4.6</td></tr><tr><td style=text-align:center>2</td><td style=text-align:center>milvus-config-tool</td><td style=text-align:center>milvusdb/milvus-config-tool</td><td style=text-align:center>v0.1.2</td></tr><tr><td style=text-align:center>3</td><td style=text-align:center>etcd</td><td style=text-align:center>milvusdb/etcd</td><td style=text-align:center>3.5.5-r4</td></tr><tr><td style=text-align:center>4</td><td style=text-align:center>pulsar</td><td style=text-align:center>apachepulsar/pulsar</td><td style=text-align:center>2.9.5</td></tr><tr><td style=text-align:center>5</td><td style=text-align:center>pulsar-manager</td><td style=text-align:center>apachepulsar/pulsar-manager</td><td style=text-align:center>v0.1.0</td></tr><tr><td style=text-align:center>6</td><td style=text-align:center>minio</td><td style=text-align:center>minio/minio</td><td style=text-align:center>RELEASE.2023-03-20T20-16-18Z</td></tr></tbody></table><h3 id=43-查看安装结果>4.3 查看安装结果</h3><p>Helm 安装命令成功执行后，观察 Pod 运行状态。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods -n opsxlab
</span></span></code></pre></div><p><strong>安装成功后，输出结果如下：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get pods -n opsxlab
</span></span><span style=display:flex><span>NAME                                         READY   STATUS      RESTARTS        AGE
</span></span><span style=display:flex><span>opsxlab-etcd-0                               1/1     Running     <span style=color:#ae81ff>0</span>               8m9s
</span></span><span style=display:flex><span>opsxlab-etcd-1                               1/1     Running     <span style=color:#ae81ff>0</span>               8m20s
</span></span><span style=display:flex><span>opsxlab-etcd-2                               1/1     Running     <span style=color:#ae81ff>0</span>               11m
</span></span><span style=display:flex><span>opsxlab-milvus-datacoord-6cd875684d-fbkgx    1/1     Running     <span style=color:#ae81ff>6</span> <span style=color:#f92672>(</span>9m19s ago<span style=color:#f92672>)</span>   13m
</span></span><span style=display:flex><span>opsxlab-milvus-datanode-5c5558cbc7-r24vj     1/1     Running     <span style=color:#ae81ff>6</span> <span style=color:#f92672>(</span>9m40s ago<span style=color:#f92672>)</span>   13m
</span></span><span style=display:flex><span>opsxlab-milvus-indexcoord-f48d66647-52crb    1/1     Running     <span style=color:#ae81ff>0</span>               13m
</span></span><span style=display:flex><span>opsxlab-milvus-indexnode-c6979d59b-rvm5p     1/1     Running     <span style=color:#ae81ff>6</span> <span style=color:#f92672>(</span>9m44s ago<span style=color:#f92672>)</span>   13m
</span></span><span style=display:flex><span>opsxlab-milvus-proxy-79997676f9-hftdf        1/1     Running     <span style=color:#ae81ff>6</span> <span style=color:#f92672>(</span>9m22s ago<span style=color:#f92672>)</span>   13m
</span></span><span style=display:flex><span>opsxlab-milvus-querycoord-5d94f97dc4-tv52n   1/1     Running     <span style=color:#ae81ff>6</span> <span style=color:#f92672>(</span>9m43s ago<span style=color:#f92672>)</span>   13m
</span></span><span style=display:flex><span>opsxlab-milvus-querynode-59b9bd7c8b-7qljj    1/1     Running     <span style=color:#ae81ff>6</span> <span style=color:#f92672>(</span>9m26s ago<span style=color:#f92672>)</span>   13m
</span></span><span style=display:flex><span>opsxlab-milvus-rootcoord-745b9fbb68-mr7st    1/1     Running     <span style=color:#ae81ff>6</span> <span style=color:#f92672>(</span>9m36s ago<span style=color:#f92672>)</span>   13m
</span></span><span style=display:flex><span>opsxlab-minio-0                              1/1     Running     <span style=color:#ae81ff>0</span>               13m
</span></span><span style=display:flex><span>opsxlab-minio-1                              1/1     Running     <span style=color:#ae81ff>0</span>               13m
</span></span><span style=display:flex><span>opsxlab-minio-2                              1/1     Running     <span style=color:#ae81ff>0</span>               13m
</span></span><span style=display:flex><span>opsxlab-minio-3                              1/1     Running     <span style=color:#ae81ff>0</span>               13m
</span></span><span style=display:flex><span>opsxlab-pulsar-bookie-0                      1/1     Running     <span style=color:#ae81ff>0</span>               13m
</span></span><span style=display:flex><span>opsxlab-pulsar-bookie-1                      1/1     Running     <span style=color:#ae81ff>0</span>               13m
</span></span><span style=display:flex><span>opsxlab-pulsar-bookie-2                      1/1     Running     <span style=color:#ae81ff>0</span>               13m
</span></span><span style=display:flex><span>opsxlab-pulsar-bookie-init-7l4kh             0/1     Completed   <span style=color:#ae81ff>0</span>               13m
</span></span><span style=display:flex><span>opsxlab-pulsar-broker-0                      1/1     Running     <span style=color:#ae81ff>0</span>               13m
</span></span><span style=display:flex><span>opsxlab-pulsar-proxy-0                       1/1     Running     <span style=color:#ae81ff>0</span>               13m
</span></span><span style=display:flex><span>opsxlab-pulsar-pulsar-init-ntbh8             0/1     Completed   <span style=color:#ae81ff>0</span>               13m
</span></span><span style=display:flex><span>opsxlab-pulsar-recovery-0                    1/1     Running     <span style=color:#ae81ff>0</span>               13m
</span></span><span style=display:flex><span>opsxlab-pulsar-zookeeper-0                   1/1     Running     <span style=color:#ae81ff>0</span>               13m
</span></span><span style=display:flex><span>opsxlab-pulsar-zookeeper-1                   1/1     Running     <span style=color:#ae81ff>0</span>               13m
</span></span><span style=display:flex><span>opsxlab-pulsar-zookeeper-2                   1/1     Running     <span style=color:#ae81ff>0</span>               12m
</span></span></code></pre></div><p>KubeSphere 管理控制台查看部署的组件信息。</p><ul><li>Depolyment（<strong>8 个</strong>）</li></ul><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//milvus-deployments-v2.4.6.png alt=milvus-deployments-v2.4.6></p><ul><li>StatefulSet（<strong>7 个</strong>）</li></ul><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//milvus-statefulsets-v2.4.6.png alt=milvus-statefulsets-v2.4.6></p><ul><li>Services（<strong>17 个</strong>）</li></ul><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//milvus-services-v2.4.6.png alt=milvus-services-v2.4.6></p><p>从上面的 Deployment、StatefulSet、Services 资源数量来看，默认部署的 Milvus 组件还是比较多的，后期运维成本比较高。</p><h3 id=44-配置认证并开启外部访问>4.4 配置认证并开启外部访问</h3><p>默认配置部署的 Milvus，没有启用安全认证，<strong>任何人都可以随意读写</strong>。这不符合生产环境要求，因此，需要增加认证配置。</p><p>创建并编辑 Helm 自定义 values 配置文件，<code>vi custom-milvus.yaml</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>extraConfigFiles</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>user.yaml</span>: |+<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    common:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      security:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        authorizationEnabled: true</span>
</span></span></code></pre></div><p>执行 helm 命令更新配置。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm upgrade opsxlab milvus/milvus --values custom-milvus.yaml -n opsxlab
</span></span></code></pre></div><blockquote><p><strong>注意：</strong> 如果安装时自定义了镜像地址，上面的操作会导致所有组件的镜像地址被<strong>还原成 helm 默认值</strong>，请谨慎使用。</p></blockquote><p>默认配置部署的 Milvus 只能被 K8s 集群内部资源访问，如果开放给集群外部，需要定义外部访问方式，本文选择最简单的 NodePort 方式。</p><p>创建并编辑外部访问 svc 资源清单，<code>vi milvus-external-svc.yaml</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>opsxlab-milvus-external</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>opsxlab</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>opsxlab-milvus-external</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>app.kubernetes.io/name</span>: <span style=color:#ae81ff>milvus</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>milvus</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>19530</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>19530</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>31011</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app.kubernetes.io/instance</span>: <span style=color:#ae81ff>opsxlab</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>app.kubernetes.io/name</span>: <span style=color:#ae81ff>milvus</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>component</span>: <span style=color:#ae81ff>proxy</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>clusterIP</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span></code></pre></div><p>执行命令，创建外部服务。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f milvus-external-svc.yaml
</span></span></code></pre></div><h3 id=45-验证测试-milvus-服务可用性>4.5 验证测试 Milvus 服务可用性</h3><p>Milvus 官方默认提供了 <code>hello_milvus.py</code> 工具，用来测试数据库的连接和读写。</p><p>工具获取方式：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://raw.githubusercontent.com/milvus-io/pymilvus/master/examples/hello_milvus.py
</span></span></code></pre></div><p>该脚本运行需要 Python 环境，为了测试方便，我自己制作了一个 Docker 镜像，可用于在 Docker、k8s 环境中进行测试。</p><p>创建并编辑 milvus 测试 Pod 资源清单，<code>vi test-milvus-pod.yaml</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>test-milvus-pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>test-milvus-pod</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>opsxlab/milvus-hello:v2.3.7-amd64</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;/bin/sh&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>args</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;-c&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;sleep 86400&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>restartPolicy</span>: <span style=color:#e6db74>&#34;Never&#34;</span>
</span></span></code></pre></div><p>执行命令，创建测试 Pod。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f test-milvus-pod.yam
</span></span></code></pre></div><p>登录测试容器终端（等待一段时间，确认 Pod 创建成功后执行）。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl exec -it test-milvus-pod -- /bin/bash
</span></span></code></pre></div><p>官方<code>hello_milvus.py</code> 脚本，默认连接<strong>不带密码认证</strong>的 Milvus 集群。我们的集群增加了认证，需要修改脚本，添加认证配置，默认的用户名和密码为 <code>root/Milvus</code> 。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 原内容（32行）</span>
</span></span><span style=display:flex><span> connections<span style=color:#f92672>.</span>connect(<span style=color:#e6db74>&#34;default&#34;</span>, host<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;localhost&#34;</span>, port<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;19530&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 修改为</span>
</span></span><span style=display:flex><span>connections<span style=color:#f92672>.</span>connect(<span style=color:#e6db74>&#34;default&#34;</span>, host<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;192.168.9.91&#34;</span>, port<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;31011&#34;</span>, user<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;root&#34;</span>, password<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Milvus&#39;</span>)
</span></span></code></pre></div><p>执行测试命令。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python hello_milvus.py
</span></span></code></pre></div><p><strong>正确执行后，输出结果如下 :</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@test-milvus-pod:/app# python hello_milvus.py
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> start connecting to Milvus     <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Does collection hello_milvus exist in Milvus: False
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> Create collection <span style=color:#e6db74>`</span>hello_milvus<span style=color:#e6db74>`</span> <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> Start inserting entities       <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Number of entities in Milvus: 3001
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> Start Creating index IVF_FLAT  <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> Start loading                  <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> Start searching based on vector similarity <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hit: id: 2998, distance: 0.0, entity: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.9728033590489911<span style=color:#f92672>}</span>, random field: 0.9728033590489911
</span></span><span style=display:flex><span>hit: id: 999, distance: 0.09934990108013153, entity: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.9519034206569449<span style=color:#f92672>}</span>, random field: 0.9519034206569449
</span></span><span style=display:flex><span>hit: id: 1310, distance: 0.10135537385940552, entity: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.26669865443188623<span style=color:#f92672>}</span>, random field: 0.26669865443188623
</span></span><span style=display:flex><span>hit: id: 2999, distance: 0.0, entity: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.02316334456872482<span style=color:#f92672>}</span>, random field: 0.02316334456872482
</span></span><span style=display:flex><span>hit: id: 2502, distance: 0.13083189725875854, entity: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.9289998713260136<span style=color:#f92672>}</span>, random field: 0.9289998713260136
</span></span><span style=display:flex><span>hit: id: 2669, distance: 0.1590736210346222, entity: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.6080847854541138<span style=color:#f92672>}</span>, random field: 0.6080847854541138
</span></span><span style=display:flex><span>search latency <span style=color:#f92672>=</span> 0.2742s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> Start querying with <span style=color:#e6db74>`</span>random &gt; 0.5<span style=color:#e6db74>`</span> <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>query result:
</span></span><span style=display:flex><span>-<span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.6378742006852851, <span style=color:#e6db74>&#39;embeddings&#39;</span>: <span style=color:#f92672>[</span>np.float32<span style=color:#f92672>(</span>0.8367804<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.20963514<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.6766955<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.39746654<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.8180806<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.1201905<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.9467144<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.6947491<span style=color:#f92672>)]</span>, <span style=color:#e6db74>&#39;pk&#39;</span>: <span style=color:#e6db74>&#39;0&#39;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>search latency <span style=color:#f92672>=</span> 0.2361s
</span></span><span style=display:flex><span>query pagination<span style=color:#f92672>(</span>limit<span style=color:#f92672>=</span>4<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>[{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.6378742006852851, <span style=color:#e6db74>&#39;pk&#39;</span>: <span style=color:#e6db74>&#39;0&#39;</span><span style=color:#f92672>}</span>, <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.5763523024650556, <span style=color:#e6db74>&#39;pk&#39;</span>: <span style=color:#e6db74>&#39;100&#39;</span><span style=color:#f92672>}</span>, <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.9425935891639464, <span style=color:#e6db74>&#39;pk&#39;</span>: <span style=color:#e6db74>&#39;1000&#39;</span><span style=color:#f92672>}</span>, <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.7893211256191387, <span style=color:#e6db74>&#39;pk&#39;</span>: <span style=color:#e6db74>&#39;1001&#39;</span><span style=color:#f92672>}]</span>
</span></span><span style=display:flex><span>query pagination<span style=color:#f92672>(</span>offset<span style=color:#f92672>=</span>1, limit<span style=color:#f92672>=</span>3<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>[{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.5763523024650556, <span style=color:#e6db74>&#39;pk&#39;</span>: <span style=color:#e6db74>&#39;100&#39;</span><span style=color:#f92672>}</span>, <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.9425935891639464, <span style=color:#e6db74>&#39;pk&#39;</span>: <span style=color:#e6db74>&#39;1000&#39;</span><span style=color:#f92672>}</span>, <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.7893211256191387, <span style=color:#e6db74>&#39;pk&#39;</span>: <span style=color:#e6db74>&#39;1001&#39;</span><span style=color:#f92672>}]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> Start hybrid searching with <span style=color:#e6db74>`</span>random &gt; 0.5<span style=color:#e6db74>`</span> <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hit: id: 2998, distance: 0.0, entity: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.9728033590489911<span style=color:#f92672>}</span>, random field: 0.9728033590489911
</span></span><span style=display:flex><span>hit: id: 999, distance: 0.09934990108013153, entity: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.9519034206569449<span style=color:#f92672>}</span>, random field: 0.9519034206569449
</span></span><span style=display:flex><span>hit: id: 1553, distance: 0.12913644313812256, entity: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.7723335927084438<span style=color:#f92672>}</span>, random field: 0.7723335927084438
</span></span><span style=display:flex><span>hit: id: 2502, distance: 0.13083189725875854, entity: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.9289998713260136<span style=color:#f92672>}</span>, random field: 0.9289998713260136
</span></span><span style=display:flex><span>hit: id: 2669, distance: 0.1590736210346222, entity: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.6080847854541138<span style=color:#f92672>}</span>, random field: 0.6080847854541138
</span></span><span style=display:flex><span>hit: id: 2628, distance: 0.1914074569940567, entity: <span style=color:#f92672>{</span><span style=color:#e6db74>&#39;random&#39;</span>: 0.940077754658375<span style=color:#f92672>}</span>, random field: 0.940077754658375
</span></span><span style=display:flex><span>search latency <span style=color:#f92672>=</span> 0.2026s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> Start deleting with expr <span style=color:#e6db74>`</span>pk in <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;0&#34;</span> , <span style=color:#e6db74>&#34;1&#34;</span><span style=color:#f92672>]</span><span style=color:#e6db74>`</span> <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>query before delete by expr<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>pk in <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;0&#34;</span> , <span style=color:#e6db74>&#34;1&#34;</span><span style=color:#f92672>]</span><span style=color:#e6db74>`</span> -&gt; result:
</span></span><span style=display:flex><span>-<span style=color:#f92672>{</span><span style=color:#e6db74>&#39;embeddings&#39;</span>: <span style=color:#f92672>[</span>np.float32<span style=color:#f92672>(</span>0.8367804<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.20963514<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.6766955<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.39746654<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.8180806<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.1201905<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.9467144<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.6947491<span style=color:#f92672>)]</span>, <span style=color:#e6db74>&#39;pk&#39;</span>: <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;random&#39;</span>: 0.6378742006852851<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>-<span style=color:#f92672>{</span><span style=color:#e6db74>&#39;embeddings&#39;</span>: <span style=color:#f92672>[</span>np.float32<span style=color:#f92672>(</span>0.27875876<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.95355743<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.976228<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.54545516<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.16776836<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.82360446<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.65080017<span style=color:#f92672>)</span>, np.float32<span style=color:#f92672>(</span>0.21096307<span style=color:#f92672>)]</span>, <span style=color:#e6db74>&#39;pk&#39;</span>: <span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;random&#39;</span>: 0.43925103574669633<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>query after delete by expr<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>pk in <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;0&#34;</span> , <span style=color:#e6db74>&#34;1&#34;</span><span style=color:#f92672>]</span><span style=color:#e6db74>`</span> -&gt; result: <span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span> Drop collection <span style=color:#e6db74>`</span>hello_milvus<span style=color:#e6db74>`</span> <span style=color:#f92672>===</span>
</span></span></code></pre></div><h2 id=5-部署可视化管理工具-attu>5. 部署可视化管理工具 Attu</h2><p>Milvus 的可视化（GUI）管理工具官方推荐 Attu。它是一款 all-in-one 的 Milvus 管理工具。使用 Attu，可以显著的降低 Milvus 运维管理成本。</p><h3 id=51-安装-attu>5.1 安装 Attu</h3><p>Milvus Helm Chart 自带 Attu 的部署能力，默认是禁用的。我本人比较喜欢手工安装，所以下面介绍 kubectl 原生安装 Attu 的方法。</p><p>创建并编辑 Attu 部署资源清单， <code>vi milvus-attu.yaml</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>milvus-attu-external</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>opsxlab</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>attu</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>clusterIP</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>attu</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>31012</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>attu</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>milvus-attu</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>opsxlab</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>attu</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>attu</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>attu</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>attu</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>zilliz/attu:v2.4</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>imagePullPolicy</span>: <span style=color:#ae81ff>IfNotPresent</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>attu</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>MILVUS_URL</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;opsxlab-milvus:19530&#34;</span>
</span></span></code></pre></div><p>执行命令，创建 Attu 资源。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f milvus-attu.yaml
</span></span></code></pre></div><h3 id=52-登录-attu-管理控制台>5.2 登录 Attu 管理控制台</h3><p>打开浏览器，访问 K8s 集群任意节点 IP 的 <strong>31012</strong> 端口，例如 http://192.168.9.91:31012，默认用户名密码 <code>root/Milvus</code>。<strong>登录后请立即修改密码</strong>。</p><p>下面以一组 Attu 管理界面的预览截图，结束本文。请各位自己探究 Attu 的强大功能。</p><ul><li>登录页面</li></ul><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//milvus-attu-login-v2.4.png alt=milvus-attu-login-v2.4></p><ul><li>首页</li></ul><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//milvus-attu-home-v2.4.png alt=milvus-attu-home-v2.4></p><ul><li>系统视图</li></ul><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//milvus-attu-system-v2.4.png alt=milvus-attu-system-v2.4></p><ul><li>数据库-概览</li></ul><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//milvus-attu-databases-default-overview-v2.4.png alt=milvus-attu-databases-default-overview-v2.4></p><ul><li>数据库-向量搜索</li></ul><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//milvus-attu-databases-default-search-v2.4.png alt=milvus-attu-databases-default-search-v2.4></p><ul><li>数据库-数据</li></ul><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//milvus-attu-databases-default-data-v2.4.png alt=milvus-attu-databases-default-data-v2.4></p><ul><li>数据库-分区</li></ul><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//milvus-attu-databases-default-partitions-v2.4.png alt=milvus-attu-databases-default-partitions-v2.4></p><ul><li>数据库-数据段</li></ul><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//milvus-attu-databases-default-segments-v2.4.png alt=milvus-attu-databases-default-segments-v2.4></p><ul><li>数据库-属性</li></ul><p><img src=https://opsxlab-1258881081.cos.ap-beijing.myqcloud.com//milvus-attu-databases-default-properties-v2.4.png alt=milvus-attu-databases-default-properties-v2.4></p><p><strong>免责声明：</strong></p><ul><li>笔者水平有限，尽管经过多次验证和检查，尽力确保内容的准确性，<strong>但仍可能存在疏漏之处</strong>。敬请业界专家大佬不吝指教。</li><li>本文所述内容仅通过实战环境验证测试，读者可学习、借鉴，但<strong>严禁直接用于生产环境</strong>。<strong>由此引发的任何问题，作者概不负责</strong>！</li></ul></div></div><div class=share-2><div class=share><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-milvus-on-kubesphere%2f&text=KubeSphere%20%e9%83%a8%e7%bd%b2%e5%90%91%e9%87%8f%e6%95%b0%e6%8d%ae%e5%ba%93%20Milvus%20%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/Twitter.svg alt="twitter icon">
</a><a href="https://reddit.com/submit?url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-milvus-on-kubesphere%2f&title=KubeSphere%20%e9%83%a8%e7%bd%b2%e5%90%91%e9%87%8f%e6%95%b0%e6%8d%ae%e5%ba%93%20Milvus%20%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/Reddit.svg alt="reddit icon">
</a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-milvus-on-kubesphere%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Facebook.svg alt="facebook icon">
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-milvus-on-kubesphere%2f" target=_blank rel="noopener noreferrer"><img src=/images/share/Linkedin.svg alt="linkedin icon">
</a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fopenksc.github.io%2fzh%2fblogs%2fdeploy-milvus-on-kubesphere%2f&t=KubeSphere%20%e9%83%a8%e7%bd%b2%e5%90%91%e9%87%8f%e6%95%b0%e6%8d%ae%e5%ba%93%20Milvus%20%e5%ae%9e%e6%88%98%e6%8c%87%e5%8d%97" target=_blank rel="noopener noreferrer"><img src=/images/share/HackerNews.svg alt="hackernews icon"></a></div></div></div><div class=aside><div class=inner-div><div class=title>目录</div><div class=tabs><nav id=TableOfContents><ul><li><a href=#1-milvus-部署规划>1. Milvus 部署规划</a></li><li><a href=#2-前置条件>2. 前置条件</a><ul><li><a href=#21-硬件需求>2.1 硬件需求</a></li><li><a href=#22-软件需求>2.2 软件需求</a></li><li><a href=#23-磁盘需求>2.3 磁盘需求</a></li><li><a href=#24-kubernetes-集群配置>2.4 Kubernetes 集群配置</a></li></ul></li><li><a href=#3-持久化存储性能测试>3. 持久化存储性能测试</a><ul><li><a href=#31-创建测试-pvc>3.1 创建测试 pvc</a></li><li><a href=#32-创建测试-pod>3.2 创建测试 Pod</a></li><li><a href=#33-连接测试-pod-终端>3.3 连接测试 Pod 终端</a></li><li><a href=#34-测试磁盘性能>3.4 测试磁盘性能</a></li></ul></li><li><a href=#4-使用-helm-安装-milvus-集群>4. 使用 Helm 安装 Milvus 集群</a><ul><li><a href=#41-安装-milvus-helm-chart>4.1 安装 Milvus Helm Chart</a></li><li><a href=#42-安装-milvus>4.2 安装 Milvus</a></li><li><a href=#43-查看安装结果>4.3 查看安装结果</a></li><li><a href=#44-配置认证并开启外部访问>4.4 配置认证并开启外部访问</a></li><li><a href=#45-验证测试-milvus-服务可用性>4.5 验证测试 Milvus 服务可用性</a></li></ul></li><li><a href=#5-部署可视化管理工具-attu>5. 部署可视化管理工具 Attu</a><ul><li><a href=#51-安装-attu>5.1 安装 Attu</a></li><li><a href=#52-登录-attu-管理控制台>5.2 登录 Attu 管理控制台</a></li></ul></li></ul></nav></div></div></div></div></section><div class=SubscribeForm><div class=innerBox><img class=close src=/images/home/close.svg alt=close><p class=description>通过邮件接收 KubeSphere 最新的技术博客与产品更新的通知</p><div id=blog_formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input-blog type=text placeholder>
<button id=email-submit-blog>订阅</button>
<span id=message_blog data-message1=请提供您的邮箱 data-message2=请输入有效的邮箱地址! data-message3=邮箱地址已经存在 style=color:red></span><span id=message1_blog style=color:#00a971 data-success=订阅成功啦，我们保证不会给你发垃圾邮件的啦></span></div></div></div><footer><div class=footer><div class="footer-main common-layout"><div class=up-main><div class=left-div><img src=/images/logo.svg alt class=foot-logo><p>通过邮件接收 KubeSphere 最新的技术博客与产品更新的通知</p><div id=formAddress data-actionaddress="https://www.sendcloud.net/v3/api/subInvite/subscription?invitecode=1dc5a4fb-894c-4470-b01d-ca7fa9d47a46" data-usesendcloud=true data-lang=zh><input name=EMAIL id=email-input type=text placeholder=请输入您的邮箱地址>
<button id=email-submit>订阅</button></div><span id=message data-message1=请提供您的邮箱 data-message2=请输入有效的邮箱地址! data-message3=邮箱地址已经存在></span><span id=message1 style=color:#00a971 data-success=订阅成功啦，我们保证不会给你发垃圾邮件的啦></span><script>var bindSubmit=function(){var e=$("#email-input");$("#email-submit").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message").data("message1"),a=$("#message").data("message2"),r=$("#message").data("message3"),c=$("#message1").data("success");if(n)if(validateEmail(n)){if(s=$("#formAddress").data("usesendcloud"),!s)return;o=$("#formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:$("#email-input").val().toString()},success:function(){showSuccessMessage(c),setTimeout(function(){$("#email-input").val("")},1e3)},error:function(){showMessage(r)}})}else t.preventDefault(),showMessage(a);else t.preventDefault(),showMessage(i)})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},showMessage=function(e){$("#message").html(e).show()},showSuccessMessage=function(e){$("#message1").html(e).show()},bindHideMessage=function(){$(window).click(function(){$("#message").hide(),$("#message1").hide()})},bindClose=function(){$(".formBox .close").click(function(e){e.stopPropagation(),$(".formBox").fadeOut()})};bindSubmit(),bindClose(),bindHideMessage()</script><span id=message data-message1=请提供您的邮箱 data-message2=请输入有效的邮箱地址!></span></div><div class=right-div><ul class=common-flex-layout><li class=nowrap-li><div class=h3>应用场景</div><a href=/zh/devops/>拥抱一站式 DevOps</a>
<a href=/zh/service-mesh/>在 K8s 运行微服务</a>
<a href=/zh/observability/>构建云原生可观测性</a>
<a href=https://github.com/kubesphere/kubekey target=_blank rel="noopener noreferrer">K8s 一键部署与运维</a>
<a href=https://github.com/OpenFunction/OpenFunction target=_blank rel="noopener noreferrer">构建 FaaS 平台与 Serverless 架构</a>
<a href=https://github.com/openpitrix/openpitrix target=_blank rel="noopener noreferrer">多云应用管理平台</a></li><li class=nowrap-li><div class=h3>资源</div><a href=/zh/projects/>开源项目</a>
<a href=/zh/blogs/>技术博客</a>
<a href=/zh/conferences/>开源峰会</a>
<a href=/zh/videos/>视频资源</a>
<a href=/zh/learn/>云原生实战</a></li><li class=nowrap-li><div class=h3>文档中心</div><a href=/zh/docs/v4.1/01-intro/01-introduction/>产品介绍</a>
<a href=/zh/docs/v4.1/03-installation-and-upgrade/02-install-kubesphere/02-install-kubernetes-and-kubesphere/>如何安装</a>
<a href=/zh/docs/v4.1/02-quickstart/>快速入门</a>
<a href=/zh/docs/v3.4/reference/api-docs/>API 文档</a></li><li class=nowrap-li><div class=h3>开源社区</div><a href=/zh/contribution/>参与贡献</a>
<a href=/zh/live/>社区活动</a>
<a href=/zh/case/>案例学习</a>
<a href=/zh/partner/>合作伙伴</a>
<a href=/zh/user-group/>用户委员会</a>
<a href=https://github.com/kubesphere/kubesphere/blob/master/docs/roadmap.md target=_blank rel="noopener noreferrer">版本计划</a>
<a href=https://kubesphere.com.cn/ target=_blank rel="noopener noreferrer">中国站</a>
<a href=https://ask.kubesphere.io/forum target=_blank rel="noopener noreferrer">中文论坛</a>
<a href=https://kubesphere.io target=_blank rel="noopener noreferrer">全球站</a></li><li class=nowrap-li><div class=h3>产品与服务</div><a href=https://aws.amazon.com/cn/quickstart/architecture/qingcloud-kubesphere/ target=_blank rel="noopener noreferrer">KubeSphere on AWS</a>
<a href=https://market.azure.cn/marketplace/apps/qingcloud.kubesphere target=_blank rel="noopener noreferrer">KubeSphere on Azure</a>
<a href=https://marketplace.digitalocean.com/apps/kubesphere target=_blank rel="noopener noreferrer">KubeSphere on DigitalOcean</a>
<a href=https://www.qingcloud.com/products/kubesphereqke target=_blank rel="noopener noreferrer">KubeSphere on QingCloud(QKE)</a>
<a href=https://kubesphere.com.cn/kse/ target=_blank rel="noopener noreferrer">KubeSphere 企业版</a>
<a href=https://kubesphere.cloud/ksv/ target=_blank rel="noopener noreferrer">KubeSphere 虚拟化平台</a>
<a href=https://kubesphere.com.cn/marketplace/ target=_blank rel="noopener noreferrer">云原生扩展组件市场</a>
<a href=https://kubesphere.cloud target=_blank rel="noopener noreferrer">云原生应用服务平台</a>
<a href=https://m.qingcloud.com/p/aec50 target=_blank rel="noopener noreferrer">了解商业产品与咨询合作</a></li></ul></div></div><div class=down-main><div class=img-div><a class=wechat href=javascript:void(0); aria-label=wechat><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28" viewBox="0 0 28 28"><defs><path id="a" d="M0 0h15.673v12.156H0z"/></defs><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="13" cy="13" r="13" stroke="#B6C2CD"/><g transform="translate(5 7)"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path fill="currentColor" d="M15.673 7.898c0-2.061-2.173-3.74-4.619-3.74-2.59.0-4.625 1.679-4.625 3.74.0 2.066 2.035 3.738 4.625 3.738.542.0 1.09-.13 1.632-.256l1.493.776-.408-1.29c1.09-.776 1.902-1.81 1.902-2.968zm-6.119-.645c-.27.0-.541-.257-.541-.514.0-.256.27-.514.541-.514.41.0.681.258.681.514.0.257-.271.514-.681.514zm2.994.0c-.27.0-.541-.257-.541-.514.0-.256.27-.514.54-.514.41.0.681.258.681.514.0.257-.277.514-.68.514z" mask="url(#b)"/><path fill="currentColor" d="M10.602 3.674c.177.0.356.011.533.029C10.657 1.576 8.27.0 5.543.0 2.498.0.0 1.974.0 4.485c0 1.45.829 2.64 2.216 3.564l-.552 1.588 1.94-.929c.693.129 1.251.263 1.94.263.17.0.343-.005.515-.022a3.68 3.68.0 01-.172-1.104c0-2.302 2.081-4.171 4.715-4.171zM7.618 2.243c.417.0.693.263.693.66s-.276.66-.693.66c-.418.0-.835-.263-.835-.66.006-.398.423-.66.835-.66zm-3.88 1.319c-.417.0-.834-.263-.834-.66s.417-.66.834-.66c.418.0.695.263.695.66.0.392-.277.66-.695.66z" mask="url(#b)"/></g></g></svg><div class=hide-div><img src=/images/home/wechat.svg alt></div></a><a class=facebook-a href=https://www.facebook.com/kubesphere target=_blank aria-label=facebook></a><a class=twitter-a href=https://x.com/KubeSphere target=_blank aria-label=twitter rel="noopener noreferrer"></a><a class=linkedin-a href=https://www.linkedin.com/company/kubesphere/ target=_blank aria-label=linkedin rel="noopener noreferrer"></a><a class=bilibili-a href=https://space.bilibili.com/438908638 target=_blank aria-label=bilibili rel="noopener noreferrer"></a><a class=slack-a href=https://join.slack.com/t/kubesphere/shared_invite/zt-2b4t6rdb4-ico_4UJzCln_S2c1pcrIpQ target=_blank aria-label=slack rel="noopener noreferrer"></a><a class=github-a href=https://github.com/kubesphere/kubesphere target=_blank aria-label=github rel="noopener noreferrer"></a><a class=medium-a href=https://itnext.io/@kubesphere target=_blank aria-label=medium rel="noopener noreferrer"></a></div><p class=p1></p><p class=case><a href=http://www.beian.miit.gov.cn/ target=_blank rel="noopener noreferrer"><span>京ICP备13019086号</span>
</a><a target=_blank rel="noopener noreferrer" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502041003"><img src=/images/footer/case-icon.png alt=备案图标>
<span>京公网安备 11010502041003号</span></a></p></div></div></div><div class=cookie><div class=common-layout><p>您的隐私对我们很重要。我们使用Cookie来记住订阅详细信息，优化网站功能并交付根据您的兴趣量身定制的内容。要了解更多信息，请参阅我们的<a href=/zh/privacy>隐私政策</a>.</p><button>
接受并继续</button></div></div></footer><script>var lazyLoad=function(e,t){for(var n,o,i,s=0;s<t;s++){if(n=e.eq(s),o=n.attr("data-loaded"),o)continue;n.offset().top<parseInt($(window).height())+parseInt($(window).scrollTop())&&(i=n.attr("src"),n.attr("src",i),n.attr("data-loaded",!0))}},bindLayLoad=function(){var e=$("img"),t=e.length;lazyLoad(e,t),$(window).scroll(function(){lazyLoad(e,t)})},bindAddPadding=function(){var e=$("#close-join");e.length>0&&$(".main-section").addClass("padding")},docCookies={getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t){return!!e&&!/^(?:expires|max-age|path|domain|secure)$/i.test(e)&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t),!0)}},bindHideCookie=function(){var t=docCookies.getItem("hasAuth"),e=$(".cookie");t?e.hide():e.show(),e.find("button").on("click",function(){docCookies.setItem("hasAuth","1"),e.hide()})};bindAddPadding(),bindHideCookie()</script><script type=text/javascript src=/js/aside.2d6977c0f16aef4ed3e886dd66675ce74bd0efcd467c2b2bcdb30b92d5e7c7c0e5c6e0c9d8f09a883c22f58df9e6b0b6347fcdd3c9a920b7faba6d7f91a201c3.js integrity="sha512-LWl3wPFq707T6IbdZmdc50vQ781GfCsrzbMLktXnx8DlxuDJ2PCaiDwi9Y355rC2NH/N08mpILf6um1/kaIBww=="></script><script type=text/javascript src=/js/markdown-tab.17f9f46b021adebc7250ce1b07134a577b307e7a436daa4aaf388f218e8463966f53770b26a64817c06c168738a887672d47fb4c29615adfc446e11d09a344cf.js integrity="sha512-F/n0awIa3rxyUM4bBxNKV3swfnpDbapKrziPIY6EY5ZvU3cLJqZIF8BsFoc4qIdnLUf7TClhWt/ERuEdCaNEzw=="></script><script>let forbidForm=!1;var viewer=new Viewer(document.querySelector(".md-body"),{url:"src"}),blogBindSubmit=function(){var e=$("#email-input-blog");$("#email-submit-blog").click(function(t){t.stopPropagation();var s,o,n=e.val(),i=$("#message_blog").data("message1"),a=$("#message_blog").data("message2"),r=$("#message_blog").data("message3"),c=$("#message1_blog").data("success");if(n)if(validateEmail(n)){if(s=$("#blog_formAddress").data("usesendcloud"),!s)return;o=$("#blog_formAddress").data("actionaddress"),$.post({type:"post",url:o,data:{email:n.toString()},success:function(){showSuccessMessage_blog(c),setTimeout(function(){window.onscroll="",$(".SubscribeForm").hide(),$("#email-input-blog").val("")},5e3)},error:function(){showMessage_blog(r)}})}else t.preventDefault(),$("#message_blog").html(a).show();else t.preventDefault(),$("#message_blog").html(i).show()})},validateEmail=function(e){var t=/^[A-Za-z0-9]+([_.][A-Za-z0-9]+)*@([A-Za-z0-9-]+\.)+[A-Za-z]{2,6}$/;return t.test(e)},bindHideMessageBlog=function(){$(window).click(function(){$("#message_blog").hide()})},bindCloseBlog=function(){$(".SubscribeForm .close").click(function(e){e.stopPropagation(),$(".SubscribeForm").fadeOut(),window.onscroll=""})},showMessage_blog=function(e){$("#message_blog").html(e).show()},showSuccessMessage_blog=function(e){$("#message1_blog").html(e).show()};window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight,n=document.documentElement.scrollHeight||document.body.scrollHeight;forbidForm&&(window.onscroll=""),e+t>n-710?$(".SubscribeForm").hide():$(".SubscribeForm").show()},blogBindSubmit(),bindCloseBlog(),bindHideMessageBlog()</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>